import{a as w,p as A,H as C,_ as U}from"./components.globalSAVxUKYX.js";import{O as _}from"./OptionsComponentCq5Fppso.js";import{d as I,j as n,k as i,m as a,s as r,z as u,K as d,Q as f,F as T,P as R,r as c,i as s,R as h}from"./@vueC3Nhqlrl.js";const P=I({name:"ActivityComponent",mixins:[w],components:{OptionsComponent:_},props:{user:{type:Object,default:null,required:!1}},data(){return{targetUser:null,activity:null,filterToBlocked:!1,info:null,currentPage:0,perPage:30,totalRows:null,decryptionErrors:0,fields:[{label:"URL",key:"url",sortable:!0},{label:"Timestamp",key:"createdAt",sortable:!0},{label:"",key:"info",sortable:!1},{key:"options",label:" ",sortable:!1}]}},mounted(){},computed:{userId(){var e;return(e=this.user)==null?void 0:e._id},isCurrentUser(){return!this.userId||this.userId==this.currentUserId},activityItems(){return this.activity?this.activity.filter(e=>!e.decryptionError):[]}},methods:{prettyTimePast:A,prettyTime:C,toggleAdvanced(){const e=["blocked"];for(const t of this.fields)e.includes(t.key)&&(t.show=!t.show)},async removeActivityEntry(e){(await this.apiReq("/user/activity/removeEntry",{userId:this.userId,id:e._id})).success&&this.loadActivity(!0)},async deleteActivity(){await this.getRef("msgBoxConfirm").show("Are ytou sure you want to delete user activity? This cannot be undone.",{title:"Confirm",okVariant:"danger ",okTitle:"Delete",cancelTitle:"Cancel",hideHeaderClose:!1})&&(await this.apiReq("/user/activity/deleteAll",{userId:this.userId}),await this.loadActivity(!0),this.userId||await this.RefreshAll())},async loadMore(){this.perPage+=200,await this.loadActivity()},async loadActivity(e=!1){const t=await this.apiReq("/client/activity/list",{userId:this.userId,options:{currentPage:this.currentPage,perPage:this.perPage,includeTotalRows:e}}),{userActivity:y,count:p}=t.result;this.decryptionErrors=y.filter(v=>v.decryptionError).length,this.activity=y,p!=null&&e&&(this.totalRows=p)}},created(){this.targetUser=this.user||this.currentUser,this.loadActivity(!0)}}),E={class:"d-flex justify-content-between align-items-center mt-2"},B={class:"d-flex flex-gap-sm align-items-center flex-wrap"},V={key:0},$={key:0},O={key:0,class:"small alert alert-danger"},N={class:"container-fluid mt-4"},j={class:"col"},q=["title","href"],D={class:"col-md-3 d-flex align-items-center justify-content-between flex-gap-sm"},M={class:"d-flex flex-gap-sm"},L={key:0,title:"This request was blocked"},x={key:1,title:"This entry is encrypted"},F={key:0},H=["onClick"],S={key:0},z={class:"mt-5 pb-4 text-center"};function K(e,t,y,p,v,Q){const k=c("OptionsComponent"),b=c("b-form-checkbox"),l=c("b-icon"),m=c("b-button");return s(),n("div",null,[t[8]||(t[8]=i("div",{class:"d-flex align-items-center justify-content-between my-3"},null,-1)),i("div",E,[i("div",null,[e.isCurrentUser&&e.isAdminUser?(s(),a(k,{key:0,user:e.currentUser,selectedOptions:["logActivity"]},null,8,["user"])):r("",!0)]),i("div",B,[!e.isCurrentUser&&e.isAdminUser?(s(),a(b,{key:0,modelValue:e.filterToBlocked,"onUpdate:modelValue":t[0]||(t[0]=o=>e.filterToBlocked=o),switch:""},{default:u(()=>t[3]||(t[3]=[f(" Show blocked only ")])),_:1},8,["modelValue"])):r("",!0),!e.isCurrentUser&&e.isAdminUser?(s(),a(m,{key:1,variant:"link",class:"linklike",to:`/manage/user/${e.userId}/usage`},{default:u(()=>[d(l,{icon:"bar-chart-line"}),e.isMobile?r("",!0):(s(),n("span",V," Usage"))]),_:1},8,["to"])):r("",!0),e.isAdminUser?(s(),a(m,{key:2,variant:"link",class:"linklike",onClick:t[1]||(t[1]=o=>e.deleteActivity()),title:"Delete all user activity"},{default:u(()=>[d(l,{icon:"trash"}),e.isMobile?r("",!0):(s(),n("span",$," Clear all history"))]),_:1})):r("",!0)])]),e.decryptionErrors>0?(s(),n("div",O,[d(l,{icon:"exclamation-triangle"}),t[4]||(t[4]=f(" Not all data was decrypted. You must have encryption enable for you user to view encrypted data. "))])):r("",!0),i("div",N,[(s(!0),n(T,null,R(e.activityItems,(o,g)=>(s(),n("div",{key:g,class:"row d-flex align-items-center border-top py-1 small"},[i("div",j,[i("a",{title:o.url,href:o.url,class:"d-inline-block text-truncate",style:{"max-width":"300px"},target:"_blank"},h(o.url),9,q)]),i("div",D,[i("div",null,h(e.prettyTime(o.createdAt)),1),i("div",M,[o.blocked?(s(),n("span",L,[d(l,{icon:"slash-circle"})])):r("",!0),o.encInfo?(s(),n("span",x,[d(l,{icon:"lock-fill"})])):r("",!0)]),e.isAdminUser?(s(),n("div",F,[i("button",{class:"btn btn-link",onClick:Y=>e.removeActivityEntry(o),title:"Remove"},t[5]||(t[5]=[i("i",{class:"bi bi-x"},null,-1)]),8,H)])):r("",!0)])]))),128)),e.activity&&e.activityItems.length==0?(s(),n("div",S,t[6]||(t[6]=[i("div",{class:"text-muted"},"No activity logged",-1)]))):r("",!0)]),i("div",z,[e.totalRows&&e.totalRows>e.perPage?(s(),a(m,{key:0,onClick:t[2]||(t[2]=o=>e.loadMore()),variant:"primary"},{default:u(()=>t[7]||(t[7]=[f(" Load more ")])),_:1})):r("",!0)])])}const X=U(P,[["render",K]]);export{X as A};

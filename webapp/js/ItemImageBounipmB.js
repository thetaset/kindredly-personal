import{K as T,M as N,N as S,O as z,P as R,d as q,Q as B,V as $,_ as j}from"./components.global5n24RCIC.js";import{T as D}from"./TIIconDefaultDZ-9wHcm.js";import{d as L,r as v,i,j as C,p as m,q as s,m as l,z as U}from"./@vueC3Nhqlrl.js";const F=L({name:"ItemImage",components:{TIIconDefault:D},props:{item:{type:Object,required:!0},class:{type:String,required:!1},defaultIconClass:{type:String,required:!1},iconSize:{type:Number,default:1.2},style:{type:Object,required:!1},width:{type:Number,required:!1},height:{type:Number,required:!1},showPlaceholder:{type:Boolean,default:!1}},data(){return{src:null,vtype:"image",iconName:null}},computed:{tiiconclass(){return this.defaultIconClass||this.class},imageRefreshToken(){return"?v="+T()}},methods:{async getImagePath(e){var a;if((a=this.item)!=null&&a.pubItem)return N(e)+this.imageRefreshToken;{let r=await S();return z(e,r)+this.imageRefreshToken}},async loadImage(){var e,a,r,c,g,d,n,o,y,p,I,w,k;if(this.item){if(this.item.type=="tab"){this.src=(e=this.item)==null?void 0:e.favIconUrl;return}else if(this.item.imageUrl){this.src=this.item.imageUrl+this.imageRefreshToken;return}let t=(a=this.item)==null?void 0:a.imageFilename;if(t){if((w=this.item)!=null&&w.imageFilename.startsWith("http")){this.src=((k=this.item)==null?void 0:k.imageFilename)+this.imageRefreshToken;return}else if(!t.startsWith("uf_")){console.log("Creating image path",t),this.src=await this.getImagePath(t),console.log("Creating image path",this.src);return}}else{if(t=(c=(r=this.item)==null?void 0:r.meta)==null?void 0:c.bannerImagePath,!t){const h=((d=(g=this.item)==null?void 0:g.meta)==null?void 0:d.imageSrc)||((o=(n=this.item)==null?void 0:n.meta)==null?void 0:o.bannerImageSrcPath)||((p=(y=this.item)==null?void 0:y.meta)==null?void 0:p.faviconPath);if(h){this.src=h;return}this.item.type=="col"?this.vtype="colicon":this.item.type=="link"?(this.iconName="link-45deg",this.vtype="icon"):this.item.type=="note"?(this.iconName="journal-text",this.vtype="icon"):this.item.type=="thing"&&(this.iconName=this.item.typeIcon,this.vtype="icon");return}this.src=await this.getImagePath((I=this.item)==null?void 0:I.meta.bannerImagePath);return}let f=t.substring(3);try{const h=new Date().getTime(),b=await R(f);if(b){this.src=b,q("imageCache fetch time",new Date().getTime()-h);return}B("/client/userfile/getById",{id:f},{defaultPrefix:"image/jpeg"}).then(P=>{let u=P.result.trim();u&&$(f,u),this.src=u})}catch(h){console.error("Error loading image",h)}}}},watch:{item(){this.loadImage()}},created(){this.loadImage()}}),O=["width","height"],E=["src","width","height"];function G(e,a,r,c,g,d){const n=v("b-icon"),o=v("TIIconDefault");return e.vtype=="image"&&!e.src?(i(),C("div",{key:0,class:m(e.class),style:s(e.style),width:e.width,height:e.height},null,14,O)):e.vtype=="image"?(i(),C("img",{key:1,src:e.src,class:m(e.class),style:s(e.style),width:e.width,height:e.height},null,14,E)):e.vtype=="icon"?(i(),l(o,{key:2,text:e.item.name,class:m(e.tiiconclass),style:s(e.style),"hide-text":!0,selectBGClass:"iconBGgreygrad"},{default:U(()=>[e.iconName?(i(),l(n,{key:0,icon:e.iconName,class:"iconNonLinkColor1",width:e.width,height:e.height,style:s(`font-size:${e.iconSize}em;`),alt:""},null,8,["icon","width","height","style"])):(i(),l(n,{key:1,icon:"info",class:"iconNonLinkColor1",width:e.width,height:e.height,style:s(`font-size:${e.iconSize}em;`),alt:""},null,8,["width","height","style"]))]),_:1},8,["text","class","style"])):e.vtype=="colicon"?(i(),l(o,{key:3,text:e.item.name,class:m(e.tiiconclass),style:s(e.style)},null,8,["text","class","style"])):(i(),l(n,{key:5,icon:"box-arrow-up-right",class:"iconNonLinkColor1",width:e.width,height:e.height,style:s(`font-size:${e.iconSize}em;`),alt:""},null,8,["width","height","style"]))}const M=j(F,[["render",G]]);export{M as I};

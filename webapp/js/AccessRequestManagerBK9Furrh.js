import{a as g,p as I,H as A,t as U,j as w,_ as C}from"./components.globalSAVxUKYX.js";import{A as $}from"./AccessRequestApproverBx3Rs5iB.js";import{d as N,j as o,K as i,z as d,k as r,Q as a,F as T,P as F,s as c,r as l,i as n,R as u}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";import"./PopCollectionSelectorBo26MlBL.js";import"./CreateCollectionC2CAQQ8x.js";import"./TIIconDefaultBACySpee.js";import"./ai_lookup_utilszDX_hcwM.js";import"./ItemImageB4O-XpFn.js";const L=N({name:"AccessRequestManager",mixins:[g],components:{AccessRequestApprover:$},data(){return{requests:null,requestId:null,requestURL:null,requesterId:null,loading:!0,userIdFilter:null,selectedUser:null,fields:[{key:"user",sortable:!1},{label:"Request Item",key:"key",sortable:!0},{key:"status",sortable:!1},{key:"options",sortable:!1}]}},mounted(){},computed:{items(){return this.requests==null?[]:this.requests}},methods:{prettyTimePast:I,prettyTime:A,textTruncate:U,toURL:w,approve(e){this.requestId=e._id,this.requestURL=e.key,this.requesterId=e.requesterId,this.showModal("approve-modal")},processRequest(e,s){this.sendReq("/access_request/process",{id:s,status:e}).then(q=>{this.loadAccessRequests()})},async loadUserById(e){return(await this.sendReq("/user/info",{userId:e})).result},async loadAccessRequests(){this.loading=!0;const e=await this.sendReq("/access_request/listall");this.requests=e.result,this.userIdFilter&&(this.selectedUser=await this.loadUserById(this.userIdFilter),this.requests=this.requests.filter(s=>s.requesterId==this.userIdFilter)),this.RefreshStats(),this.loading=!1},closeThisModal(){this.closeModal("approve-modal"),this.loadAccessRequests()},async loadData(){if(await this.loadAccessRequests(),this.$route.query.requestId){const e=this.requests.find(s=>s._id==this.$route.query.requestId);e&&this.approve(e)}}},created(){this.userIdFilter=this.$route.params.userId,this.loadData()}}),D={key:0,class:"container-fluid-max1200"},M={class:"my-3"},B={key:0,class:"d-flex align-items-center"},j={key:1},P={class:"mb-1"},V={class:"mb-1"},z=["title"],S=["href"],x={class:"small"},E={key:0},H={class:"d-flex flex-gap-sm justify-content-center align-items-center"},K={key:0,class:"w-100"},Q={key:0},Y={key:1},G={key:1,class:"alert text-center"};function J(e,s,q,O,W,X){const _=l("AccessRequestApprover"),f=l("b-modal"),p=l("b-icon"),y=l("b-link"),v=l("b-col"),k=l("b-row"),R=l("router-link"),m=l("b-button");return n(),o("div",null,[i(f,{id:"approve-modal",title:"Approve Request","hide-footer":"",lazy:"true",size:"lg"},{default:d(()=>[i(_,{url:e.requestURL,userId:e.requesterId,onClose:e.closeThisModal,requestId:e.requestId},null,8,["url","userId","onClose","requestId"])]),_:1}),e.isAdminUser?(n(),o("div",D,[r("h2",M,[i(p,{icon:"key"}),s[0]||(s[0]=a(" User Access Requests"))]),i(k,{class:"row"},{default:d(()=>[i(v,{class:"col"},{default:d(()=>[e.selectedUser?(n(),o("div",B,[a(" Showing access requests for "+u(e.selectedUser.username)+" ",1),i(y,{title:"Clear",class:"btn btn-link p-0",to:"/settings/useraccessrequests"},{default:d(()=>[i(p,{icon:"x"})]),_:1})])):(n(),o("div",j))]),_:1})]),_:1}),s[5]||(s[5]=r("hr",null,null,-1)),(n(!0),o(T,null,F(e.items,(t,h)=>(n(),o("div",{key:h,class:"my-2 mx-1 d-flex flex-wrap justify-content-between flex-gap-1"},[r("div",null,[r("div",P,[s[1]||(s[1]=a(" Requester: ")),i(R,{to:`/manage/user/${t.requesterId}`},{default:d(()=>[a(u(t.requesterUsername),1)]),_:2},1032,["to"])]),r("div",V,[r("div",{class:"",title:t.key},[s[2]||(s[2]=a(" Requested Resource: ")),r("a",{target:"_blank",href:e.toURL(t.key)},u(e.textTruncate(t.key,50)),9,S)],8,z),r("div",x,u(t.requesterNote),1)]),r("div",null,u(e.prettyTimePast(t.createdAt))+" ago",1),t.approverNote?(n(),o("div",E,"Response: "+u(t.approverNote),1)):c("",!0)]),r("div",H,[i(m,{onClick:b=>e.approve(t),variant:"success"},{default:d(()=>s[3]||(s[3]=[a("Approve")])),_:2},1032,["onClick"]),i(m,{onClick:b=>e.processRequest("denied",t._id),variant:"danger"},{default:d(()=>s[4]||(s[4]=[a("Deny")])),_:2},1032,["onClick"])]),h<e.items.length-1?(n(),o("hr",K)):c("",!0)]))),128)),e.loading?(n(),o("div",Q,"Loading...")):c("",!0),!e.loading&&e.items.length==0?(n(),o("div",Y," No pending access requests. ")):c("",!0)])):(n(),o("div",G,s[6]||(s[6]=[r("h5",null,"Permission Denied",-1),a(" You don't have permission to access this page. ")])))])}const ue=C(L,[["render",J]]);export{ue as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/PopCollectionSelectorBW6dnAeB.js","js/CreateCollectionBbjx_AkR.js","js/components.globalDizx_NTC.js","js/@vueC3Nhqlrl.js","js/vue3-toastifyDll2FbVh.js","assets/vue3-toastify.css","js/@capacitorCjBcbZvA.js","js/bootstrap-vue-nextDnMzdrWQ.js","assets/bootstrap-vue-next.css","assets/components.css","js/TIIconDefaultB4jiNlod.js","assets/TIIconDefault.css","js/ai_lookup_utilszDX_hcwM.js","assets/CreateCollection.css","js/ItemImageDmIqiyLE.js","assets/PopCollectionSelector.css","js/ChatWidgetContentDHkUR2yu.js","js/markedJKvyS0Pp.js","kindredapp.js","js/vue-routerB6Jsgi62.js","js/browserTabsB7943WCj.js","js/vue-plugin-load-scriptXwA-LyvJ.js","js/bootstrapDQG5F40S.js","js/@popperjsCCtJ9KiL.js","js/@mozillaCDB2aYYy.js","assets/kindredapp.css","assets/ChatWidgetContent.css","js/CreatePostB-Mkk1Az.js","js/SelectImageB1vQtVs9.js","assets/SelectImage.css","js/AddItemDHXh2dX9.js","js/CollectionButtonListD_vH1okg.js","assets/CollectionButtonList.css","js/ItemTypesCPyKWlmw.js","assets/ItemTypes.css","js/AddItemFromLibraryResultsBWbIwWSk.js","assets/AddItem.css","js/SelectUserscnA2spUZ.js","assets/SelectUsers.css","js/EmojiPicker7OEHLUTB.js","js/@iconifyDLzQZ07j.js","js/@iconify-iconsCsSCFVIT.js","assets/EmojiPicker.css","js/item.storeCI0d-UrP.js","assets/CreatePost.css","js/ViewCommentsGXYnq22S.js","assets/ViewComments.css"])))=>i.map(i=>d[i]);
import{_ as T}from"./@capacitorCjBcbZvA.js";import{a as x,m as _,T as ee,ak as O,d as m,al as te,am as B,t as V,j as se,ae as L,n as ie,a0 as ne,l as S,o as $,aj as oe,an as le,_ as re}from"./components.globalDizx_NTC.js";import{T as ae}from"./TIFeedbackInfoPRQX6h6C.js";import{P as de}from"./TIIconDefaultB4jiNlod.js";import{I as ue}from"./ItemTypesCPyKWlmw.js";import{I as me}from"./ItemImageDmIqiyLE.js";import{d as pe,aa as U,j as l,K as o,z as p,k as s,L as C,m as I,p as W,Q as y,s as u,R as f,F as w,P,ab as R,r as c,ac as he,i as n}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./bootstrap-vue-nextDnMzdrWQ.js";async function ce(e){return new Promise((t,r)=>{chrome.tabs.query(e,d=>{if(chrome.runtime.lastError)return r(chrome.runtime.lastError);t(d)})})}function D(e,t=50){return e.length>t?e.substring(0,t)+"...":e}const fe=pe({name:"AppPop",mixins:[x,_],props:{propURL:{type:String,required:!1}},components:{TIFeedbackInfo:ae,PopCollectionSelector:U(()=>T(()=>import("./PopCollectionSelectorBW6dnAeB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),ProfileImage:de,TIcon:ee,ItemTypes:ue,ItemImage:me,ChatWidgetContent:U(()=>T(()=>import("./ChatWidgetContentDHkUR2yu.js"),__vite__mapDeps([16,2,3,4,5,6,7,8,9,17,18,10,11,19,20,14,21,22,23,24,25,26]))),CreatePost:U(()=>T(()=>import("./CreatePostB-Mkk1Az.js"),__vite__mapDeps([27,2,3,4,5,6,7,8,9,28,29,14,10,11,30,0,1,12,13,15,31,32,33,34,35,36,37,38,39,40,41,42,43,44]))),ViewComments:U(()=>T(()=>import("./ViewCommentsGXYnq22S.js"),__vite__mapDeps([45,2,3,4,5,6,7,8,9,37,10,11,38,46])))},data(){return{widgetMode:!1,listeningForActiveTab:!1,currentlySelectedCollectionId:void 0,collectionIdToLoad:void 0,inMyLibrary:!1,loading:!0,loadingItem:!0,loadingSubPage:!0,loadingItemCreate:!1,pageName:"main",subPageName:null,tab:null,favIconUrl:void 0,url:void 0,urltmp:void 0,origURL:void 0,diffURLSelected:!1,itemId:void 0,savingItem:!1,itemInfo:void 0,item:void 0,name:void 0,tags:void 0,type:"link",subType:void 0,patterns:void 0,description:void 0,feedback:{isLiked:!1,isReadLater:!1,isRead:!1,reaction:null,isDisliked:!1,notes:void 0},doneMessage:void 0,supported:!0,selectedCollectionIds:[],selectedCollections:[],collections:[],existingMatches:[],editURL:!0,selectedURL:void 0,errorMessage:void 0,sharedWithUserIds:[],notify:!1,notifyMessage:void 0,shareComplete:!1,similarItems:[],searchText:void 0,searchResults:void 0,loadingSuggestions:!1,recentCollections:[],urlOptions:[],meta:void 0,metaLoading:!1,metaResolved:!1,itemPermissions:null,encInfo:void 0,hideMenu:!1}},computed:{truncateLength(){return 50},typeName(){var e;return this.type?this.type!="thing"?this.type.charAt(0).toUpperCase()+this.type.slice(1):((e=O()[this.subType])==null?void 0:e.name)||this.subType:null},typeIcon(){var e;return(this==null?void 0:this.type)=="thing"&&((e=O()[this==null?void 0:this.subType])==null?void 0:e.icon)||null},isMenuless(){return this.isNativeClient||!this.isExtPopup||this.hideMenu},isExtPopup(){return this.appName=="pop"},urlShort(){if(this.url!==void 0){const e=this.url.replace("http://","").replace("https://","");return D(e,30)}},nameShort(){if(this.name)return D(this.name.split(" ").map(e=>D(e.trim(),15)).join(" "),140)},domainOnlyURL(){return this.url===void 0?void 0:new URL(this.url).origin},online(){return navigator.onLine}},mounted(){m("MOUNTED APPPOpup"),history.replaceState(null,document.title,location.href)},methods:{updateItemType(e){this.type=e.type,this.subType=e.subType,this.subPageName="editDetails"},addURLOption(e){let t=!0;for(const r of this.urlOptions)m("COMPARING ",e,r),te(e,r,{normalize:!0})==1&&(t=!1);t&&this.urlOptions.push(e)},getPathString:B,prettyCollection(e,t=10){const r=B(e.path);return t>0&&r.length>t?`${V(r,t,!0)}`:`${r}`},toURL:se,textTruncate:V,cleanURL:L,async loadTabInfo(){this._resetData();const e=new URLSearchParams(window.location.search);let t=e.get("url")||this.propURL;if(e.get("menuless")=="true"&&(this.hideMenu=!0),e.get("widgetMode")=="true"&&(this.widgetMode=!0),!t&&this.$route&&(t=this.$route.query.url),m("URL",t),t){if(this.invalidPageType(t)){this.supported=!1;return}this.url=L(t),this.origURL=this.url,this.name=e.get("name"),this.favIconUrl=e.get("favIconUrl")}else{const r=await ce({active:!0,lastFocusedWindow:!0});if(r.length>0&&r[0].url){this.tab=r[0];const d=this.tab.url;if(this.addUpdateListener(),this.invalidPageType(d)){this.supported=!1;return}this.url=L(d),this.origURL=this.url,this.name=this.tab.title,this.favIconUrl=this.tab.favIconUrl}else this.errorMessage="No active tab found. Please open a tab and try again."}await this.loadFromURL()},addUpdateListener(){this.listeningForActiveTab||(chrome.tabs.onUpdated.addListener(async(e,t,r)=>{var v,k;const d={tabId:e,tabInfo:{...r,...t},tab:r,changeInfo:t},h="url"in d.changeInfo||((v=d==null?void 0:d.changeInfo)==null?void 0:v.status)=="loading";((k=d==null?void 0:d.changeInfo)==null?void 0:k.status)=="complete",h&&(m("Tab Updated",d),d.tabInfo.url!=this.url&&this.loadTabInfo())}),chrome.tabs.onActivated.addListener(async e=>{this.loadTabInfo()}),chrome.tabs.onRemoved.addListener(async e=>{m("Tab Removed",e),this.loadTabInfo()}),chrome.tabs.onReplaced.addListener(async(e,t)=>{this.loadTabInfo()}),this.listeningForActiveTab=!0)},selectCollection(){this.pageName="main"},async _loadFromItemData(e){var t,r,d;this.itemInfo=e,this.item=ie(e),this.encInfo=this.item.encInfo,this.itemId=this.item._id,this.url=this.item.url,this.name=((t=this.itemInfo.details)==null?void 0:t.name)||((d=(r=this.itemInfo.details)==null?void 0:r.meta)==null?void 0:d.title),this.description=this.item.description,this.tags=this.item.tags?this.item.tags.join(","):"",this.type=this.item.type,this.subType=this.item.subType,this.patterns=!this.item.patterns||!Array.isArray(this.item.patterns)?"":this.item.patterns.join(`
`),this.selectedCollectionIds=e.collectionIds||[],this.loadPermissions()},_resetData(){this.supported=!0,this.selectedCollectionIds=[],this.selectedCollections=[],this.existingMatches=[],this.patterns="",this.tags="",this.meta=void 0,this.itemPermissions=null,this.itemInfo=null,this.itemId=void 0},async loadFromURL(){if(this._resetData(),!this.url||!this.url.startsWith("http:")&&!this.url.startsWith("https:"))return m("Unsupported website",this.url),this.supported=!1,!1;this.url=L(this.url),this.loadingItem=!0;const e=await this.sendReq("/client/item/similarItemsByURL",{url:this.url});if(!e.success){this.errorMessage=e.message,console.error(this.errorMessage),this.loadingItem=!1;return}const{exactMatches:t,similarMatches:r}=e.result;if(t.length>0?(await this._loadFromItemData(t[0]),this.loadSelectedCollections()):(m("No item found for this URL",this.url),this.patterns=ne(this.url),this.tab||this._loadMeta()),this.existingMatches=S(t.concat(r).filter(h=>h.details._id!=this.itemId)),!this.url){this.errorMessage="No URL found. Please open a tab and try again.",this.loadingItem=!1;return}let d=new URL(this.url);this.addURLOption(this.url),this.addURLOption(d.origin),this.errorMessage="",this.sendReq("/client/checkIfPermitted",{url:this.url}).then(h=>{if(!h.result){this.errorMessage="Warning: You are not permitted to access this site.",console.error(this.errorMessage);return}}),this.loadingItem=!1},async loadFromItemId(e){this.loadingItem=!0;const t=await this.sendReq("/client/item/info",{itemId:e});if(!t.success){this.errorMessage=t.message,console.error(this.errorMessage),this.loadingItem=!1;return}if(this._resetData(),await this._loadFromItemData(t.result),!this.url||!this.itemId){this.errorMessage="No URL found. Please open a tab and try again.",this.loadingItem=!1;return}let r=new URL(this.url);this.addURLOption(this.url),this.addURLOption(r.origin),this.loadSelectedCollections();try{const d=await this.sendReq("/client/item/similarItemsByURL",{url:this.url});if(d.success){const{exactMatches:h,similarMatches:v}=d.result;this.existingMatches=S(h.concat(v).filter(k=>k.details._id!=this.itemId))}}finally{this.loadingItem=!1}},async _loadMeta(){m("Loading metdata for"+this.url),this.meta=void 0,this.metaLoading=!0,this.metaResolved=!1;try{if(this.url==null){m("Undefined url, not loading meta"),this.meta={};return}let e=this.url;m("url:"+e);const t=await this.sendReq("/client/fetchMetadata",{url:e});if(t.success){let r=t.result;m(r),this.meta=r,this.name=r.title,this.favIconUrl=r.faviconSrcPath,this.metaResolved=r.resolved||!1}}catch(e){console.error(e)}finally{this.metaLoading=!1}},async openPage(e){this.isExtPopup?(e=`/index.html#${e}`,await $(e,"_blank")):this.$router.push(e)},async openLinkInBrowser(){await $(this.url)},async loadEditDetailsPage(){this.isAdminUser?this.subPageName="editDetails":this.errorMessage="You are not permitted to edit this item."},async addSelectedCollection(){this.currentlySelectedCollectionId&&this.addCollection(this.currentlySelectedCollectionId),this.currentlySelectedCollectionId=void 0,this.subPageName=null},async addSelectedCollectionFromPopup(e){this.addCollection(e),this.currentlySelectedCollectionId=void 0,this.subPageName=null},async addCollection(e){m("Add Collection result",e),this.pageName="main",this.subPageName=null,e!=null&&(this.selectedCollectionIds||(this.selectedCollectionIds=[]),this.selectedCollectionIds.includes(e)||(this.selectedCollectionIds.push(e),this.loadSelectedCollections()),await this.saveCollectionList(),this.pageName="main",this.subPageName=null)},async removeCollection(e){if(e==null||!this.selectedCollectionIds){this.pageName="main";return}m("Remove Collection",e),this.selectedCollectionIds=this.selectedCollectionIds.filter(t=>t!=e),await this.saveCollectionList(),this.loadSelectedCollections(),this.pageName="main"},async loadSelectedCollections(){if(this.errorMessage="",!this.selectedCollectionIds||this.selectedCollectionIds.length==0){this.selectedCollections=[];return}const e=await this.sendReq("/client/collection/listByAccount",{ids:this.selectedCollectionIds,includePath:!0,includeUserPermissions:!0});if(!e.success){this.errorMessage=e.message,console.error(this.errorMessage);return}this.selectedCollections=e.result.sort(function(t,r){return oe(t,r,"name")})},async closeAndNavTo(e){chrome.tabs.create({url:e}),window.close()},closeWindow(){this.widgetMode?window.parent.postMessage("kindred-close","*"):window.close()},async runUpdateURL(){this.errorMessage=void 0;const e=await this.sendReq("/client/checkIfPermitted",{url:this.urltmp});if(!e.success||!e.result){this.errorMessage="Warning: You are not permitted to access this site.",console.error(this.errorMessage);return}else this.url=this.urltmp,this.itemId?await this.saveItem():await this.loadFromURL(),this.closeModal("edit-url-modal")},async openEditURLModal(){this.errorMessage=void 0,this.urltmp=this.url,this.showModal("edit-url-modal")},async checkURLPermission(){return(await this.sendReq("/client/checkIfPermitted",{url:this.url})).result},prepItemDetails(){var h,v,k;if(!this.url){this.errorMessage="No URL found. Please open a tab and try again.";return}const e=L(this.url);let t=[];this.tags&&(t=this.tags.split(",").map(g=>g.toLowerCase().replace(/\s\s+/g,"_").trim()).filter(g=>g.length>0));const r=this.patterns?this.patterns.split(`
`).map(function(g){return g.trim()}):[],d={};return m("orig name:",(h=this==null?void 0:this.itemInfo)==null?void 0:h.meta,this.name),this.name!=((k=(v=this.itemInfo)==null?void 0:v.meta)==null?void 0:k.title)&&(d.name=this.name),{url:e,tags:t,patterns:r,description:this.description,type:this.type,subType:this.subType,...d,meta:this.meta,encInfo:this.encInfo}},async newItemFeedback(e){this.feedback[e.attr]=e.value,await this.saveItem(e)},async addWithoutOrganizing(){this.saveItem(),this.pageName="main"},async saveItem(e=null){if(!await this.checkURLPermission()){this.errorMessage="You don't have permission to this URL.",console.error(this.errorMessage);return}this.savingItem=!0;const t=this.prepItemDetails(),r=await this.sendReq("/client/item/save",{itemId:this.itemId,details:t,collectionIds:this.selectedCollectionIds,feedbackUpdate:e},{includeEncInfo:!0,dontBlockForMeta:!0});if(!r.success){m("Resonse",r),this.errorMessage=r.message,console.error(this.errorMessage),this.savingItem=!1;return}this.pageName="main",this.subPageName=null;const{itemId:d,encInfo:h}=r.result;this.itemId||(this.itemId=d,this.item={_id:d,feedback:{...this.feedback}},this.loadFromItemId(d)),this.savingItem=!1,this.encInfo=h,le()},async updateFeedbackValue(e,t){if(this.savingItem)return;let r=this.feedback[e];this.feedback[e]=t,this.itemId||await this.saveItem();const d=await this.sendReq("/item/feedback/value/update",{itemId:this.itemId,attr:e,value:t});if(!d.success){this.feedback[e]=r,this.errorMessage=d.message,console.error(this.errorMessage);return}},async newPost(){this.loadingItemCreate=!0,this.itemId||await this.saveItem(),this.itemId?(this.loadingItemCreate=!1,this.subPageName="share"):(this.errorMessage="failed to create post, item wasn't created properly.  Maybe try again.",this.loadingItemCreate=!1)},async viewComments(){this.loadingItemCreate=!0,this.itemId||await this.saveItem(),this.itemId?(this.loadingItemCreate=!1,this.subPageName="comments"):(this.errorMessage="failed to add comments, item wasn't created properly.  Maybe try again.",this.loadingItemCreate=!1)},async loadPermissions(){if(!this.itemId){this.itemPermissions=null;return}const e=await this.sendReq("/item/permissions/list",{itemId:this.itemId});if(!e.success){this.showToast("Error loading permissions"+e.message,{title:"Error",variant:"danger"});return}this.itemPermissions=e.result,this.inMyLibrary=this.itemPermissions.some(t=>t.userId==this.currentUserId)},async showSidePanel(){chrome.tabs.query({active:!0,currentWindow:!0},e=>{const t=e[0];chrome.sidePanel.open({windowId:t.windowId})})},async saveCollectionList(){if(!this.itemId){await this.saveItem();return}const e=await this.sendReq("/item/collections/save",{itemId:this.itemId,collectionIds:this.selectedCollectionIds,removeMissingCollections:!0});if(e.success)this.RefreshIndexQuick(),this.loadPermissions();else{this.errorMessage=e.message,console.error(this.errorMessage);return}},async createSnapshot(){if(!this.tab){this.errorMessage="No active tab found. Please open a tab and try again.";return}this.itemId||await this.saveItem(),m("MYTAB ID",this.tab);const e=this.tab.id;chrome.tabs.sendMessage(e,{type:"CREATE_SNAPSHOT",itemId:this.itemId},function(t){m(t)})},async openCollection(e){if(e){let t=`/collection/${e}`;this.appName!="pop"?this.$router.push(t):(t=`/index.html#${t}`,await $(t,"_blank"))}},async removeFromLibrary(){if(!(await this.sendReq("/item/delete",{itemId:this.itemId})).success){this.showToast("Error deleting item",{title:"Error",variant:"danger",solid:!0});return}await this.RefreshIndexQuick(),this.closeWindow()},async loadSimilar(){if(!this.name||!this.url)return;const t=this.name.split(/[\s,]+/).filter(v=>v.length>0);let r=new URL(this.url);const d=[...t,r.origin].join(" "),h=await this.sendReq("/client/searchMain",{searchType:"text",searchLookupValue:d});if(!h.success){this.errorMessage=h.message,console.error(this.errorMessage);return}this.similarItems=S(h.result).filter(v=>v.url!=null),this.subPageName="similarItems"},validPageType(e){return e&&(e.startsWith("http:")||e.startsWith("https:"))},invalidPageType(e){return m("Checking if url is invalid",e),!e||!e.startsWith("http")},async closeShare(e){this.subPageName=null,e&&this.closeWindow()},async loadData(){var e;if(this.checkDarkMode(),this.loadTabInfo(),!this.currentUser){m("AppPopup Loading",(e=this.$route)==null?void 0:e.query);const r=await this.RefreshCurrentUser(!1);this.RefreshUsers(!1),this.RefreshCurrentUserPermissions(!1),this.RefreshIndexQuick(),this.loading=!1,r?m("User Loaded"):this.showModal("login-modal")}}},filters:{},directives:{},created(){this.loadData()}}),ge={class:"all-content"},ve={class:"form-group"},ye=["onClick","title"],be=["innerHTML"],Ie={class:"d-flex justify-content-between mb-4"},ke={class:"my-3 text-center"},Ce={class:""},we={key:0},Pe={key:0,class:"menu-header d-flex justify-content-between align-items-center flex-gap-sm border-bottom"},Me={class:"d-flex justify-content-start align-items-center flex-gap-sm"},Le=["title"],Re={key:1,class:"popup-content"},Ne={key:0,class:"d-flex ani-fade-in-fast h-100"},Te={class:"w-100 d-flex flex-column main-item-content"},Ue={class:"d-flex flex-gap-1 justify-content-between fillrow p-1 py-2 border-bottom"},Se={class:"d-flex flex-gap-sm"},$e=["src"],De=["title"],Ee=["title"],Ae={key:0,class:"ani-fade-in-fast ms-3 me-2"},Fe={key:0},je={class:"mt-3"},qe={key:0},Oe={key:1,class:"small"},Be={class:"mt-3 d-flex flex-gap-1 flex-wrap align-items-center"},Ve={key:1},We={class:"mt-3"},He={class:"mt-3 d-flex flex-gap-1 flex-wrap align-items-center"},ze={key:0,class:"d-flex align-items-center mb-2 mt-3"},Qe={class:""},Ye={class:"smart-wrap"},Ke={class:"text-muted"},Ge=["onClick"],Je=["onClick"],Xe={key:2},Ze={class:"d-flex align-items-center flex-gap-sm flex-wrap"},xe=["title"],_e={key:3,class:"mt-3"},et=["onClick"],tt={class:""},st={class:"xsmall"},it={key:1,class:"mt-4 text-center ani-fade-in-slow",style:{"overflow-y":"none"}},nt=["innerHTML"],ot={key:1,class:"d-flex ani-fade-in-fast h-100"},lt={key:2},rt={key:2},at={class:"t-brand-logo"},dt={key:0,class:"mt-5 d-flex align-items-center justify-content-center h2"},ut={key:3},mt={key:1,class:"ani-fade-in-fast-old inner-content"},pt={class:"menu-header d-flex justify-content-left align-items-center px-2 py-2"},ht={class:"ms-auto"},ct={class:"inner-content px-2 small"},ft=["innerHTML"],gt={class:"mb-2"},vt=["title"],yt={class:"input-group input-group-sm mb-2"},bt={class:"mt-2"},It={class:"d-flex mt-1 mb-2"},kt={class:"input-group input-group-sm mb-2"},Ct={class:"input-group input-group-sm mb-2"},wt={class:"input-group input-group-sm mb-2"},Pt={key:2,class:"ani-fade-in-fast"},Mt={class:"menu-header d-flex justify-content-left align-items-center"},Lt={class:"container"},Rt={key:3,class:"ani-fade-in-fast"},Nt={class:"menu-header d-flex justify-content-left align-items-center"},Tt={class:"ms-auto d-flex align-items-center justify-content-end flex-gap-1"},Ut={class:"inner-content w-100 px-2"},St=["innerHTML"],$t={key:4,class:"ani-fade-in-fast"},Dt={class:"menu-header d-flex justify-content-left align-items-center"},Et={class:"inner-content w-100 px-2 small"},At={key:0},Ft={class:"mb-2"},jt=["title"],qt=["onClick"],Ot=["title"],Bt=["title"],Vt={key:5,class:"ani-fade-in-fast"},Wt={class:"menu-header d-flex justify-content-left align-items-center pt-3 px-2 flex-gap-sm"},Ht={class:"mx-3 my-3"},zt={key:6,class:"ani-fade-in-fast"},Qt={class:"menu-header d-flex justify-content-left align-items-center pt-3 px-2 flex-gap-sm"},Yt={class:"mx-3 my-3"},Kt={key:7,class:"ani-fade-in-fast"},Gt={class:"menu-header d-flex justify-content-left align-items-center pt-2 px-2 flex-gap-sm"},Jt={key:8,class:"ani-fade-in-fast"},Xt={class:"menu-header d-flex justify-content-left align-items-center pt-2 px-2"},Zt={class:"inner-content w-100 px-2 small"},xt={key:0},_t={class:"ms-2"},es=["title","href"],ts=["title"],ss={key:1,class:"mt-4 mx-3"};function is(e,t,r,d,h,v){var q;const k=c("b-modal"),g=c("b-button"),a=c("b-icon"),H=c("BOffcanvas"),E=c("ProfileImage"),A=c("ItemImage"),M=c("b-dropdown-item"),z=c("b-dropdown"),F=c("TIFeedbackInfo"),Q=c("b-spinner"),Y=c("ChatWidgetContent"),j=c("TIcon"),K=c("ItemTypes"),G=c("PopCollectionSelector"),J=c("CreatePost"),X=c("ViewComments"),Z=he("b-toggle");return n(),l("div",ge,[o(k,{lazy:"true",id:"edit-url-modal",title:"Edit URL","hide-footer":""},{default:p(()=>[s("div",null,[s("div",null,[s("div",ve,[C(s("textarea",{class:"form-control","onUpdate:modelValue":t[0]||(t[0]=i=>e.urltmp=i)},null,512),[[R,e.urltmp]])])]),s("div",null,[(n(!0),l(w,null,P(e.urlOptions,(i,b)=>(n(),l("div",{key:b},[s("div",{role:"button",class:"btn-link",onClick:N=>e.urltmp=i,title:i},f(e.textTruncate(i,e.truncateLength)),9,ye)]))),128))])]),s("div",null,[e.errorMessage?(n(),l("div",{key:0,class:"my-2 alert alert-danger",role:"alert",innerHTML:e.errorMessage},null,8,be)):u("",!0),t[49]||(t[49]=s("hr",null,null,-1)),s("div",Ie,[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:t[1]||(t[1]=i=>e.closeModal("edit-url-modal"))}," Cancel "),s("button",{type:"button",class:"btn btn-primary btn-sm",onClick:t[2]||(t[2]=i=>e.runUpdateURL())}," Load ")])])]),_:1}),o(k,{lazy:"true",id:"login-modal","hide-header":"",centered:"","hide-footer":"","no-close-on-backdrop":"","hide-header-close":"","no-close-on-esc":""},{default:p(()=>[s("div",ke,[o(g,{variant:"primary",onClick:t[3]||(t[3]=i=>e.openPage(""))},{default:p(()=>t[50]||(t[50]=[y(" Sign-in or Register ")])),_:1})])]),_:1}),o(H,{id:"menu-sidebar",title:"",left:"",shadow:"",backdrop:"",class:"b-sidebar"},{default:p(()=>[s("div",Ce,[s("div",{role:"button",onClick:t[4]||(t[4]=i=>e.openPage("/")),class:"px-2 py-1 d-flex align-items-center flex-gap-1"},[s("div",null,[o(a,{icon:"house"})]),t[51]||(t[51]=s("div",{class:"ms-1 text-muted"},"Home",-1))]),e.browserName=="chrome"?(n(),l("div",{key:0,role:"button",onClick:t[5]||(t[5]=i=>e.showSidePanel()),class:"px-2 py-1 d-flex align-items-center flex-gap-1"},[s("div",null,[o(a,{icon:"layout-sidebar-reverse"})]),t[52]||(t[52]=s("div",{class:"ms-1 text-muted"},"Show Side Panel",-1))])):u("",!0),s("div",{role:"button",onClick:t[6]||(t[6]=i=>e.openPage("/settings/loginprefs")),class:"px-2 py-1 d-flex align-items-center flex-gap-1"},[s("div",null,[s("div",null,[o(a,{icon:"gear"})])]),t[53]||(t[53]=s("div",{class:"ms-1 text-muted"},"Settings",-1))]),t[54]||(t[54]=s("div",{class:"mb-4"},null,-1))])]),_:1}),e.subPageName?u("",!0):(n(),l("div",we,[e.isMenuless?u("",!0):(n(),l("div",Pe,[s("div",Me,[C((n(),I(g,{title:"Menu",class:"btn btn-link btn-sm text-muted hoverrow"},{default:p(()=>[o(a,{icon:"list"})]),_:1})),[[Z,void 0,void 0,{"menu-sidebar":!0}]]),s("div",{role:"button",onClick:t[7]||(t[7]=i=>e.openPage("/")),title:"Home",class:"small rounded px-2 py-1 d-flex hoverrow flex-gap-sm text-muted align-items-center"},[o(a,{icon:"house"})]),e.widgetMode?(n(),l("div",{key:0,role:"button",onClick:t[8]||(t[8]=i=>e.pageName="main"),class:W([e.pageName=="main"?"fillrow":"","small rounded border px-2 py-0 hoverrow"]),title:"Menu"},[o(a,{icon:"window"}),t[55]||(t[55]=y(" Browser Tab "))],2)):u("",!0),e.widgetMode?(n(),l("div",{key:1,role:"button",onClick:t[9]||(t[9]=i=>e.pageName="companion"),class:W([e.pageName=="companion"?"fillrow":"","small rounded border px-2 py-0 hoverrow"]),title:"Companion"},[o(a,{icon:"robot"}),t[56]||(t[56]=y(" Kinbot "))],2)):u("",!0)]),e.currentUser&&!e.widgetMode?(n(),l("div",{key:0,role:"button",class:"ani-fade-in-fast",onClick:t[10]||(t[10]=i=>e.openPage("/settings")),title:e.currentUser.username},[o(E,{profileImage:e.currentProfileImage,width:32},null,8,["profileImage"])],8,Le)):e.widgetMode?(n(),l("div",{key:1,role:"button",class:"p-1",onClick:t[11]||(t[11]=i=>e.closeWindow())},[o(a,{icon:"x-lg"})])):u("",!0)])),e.supported&&e.currentUser||e.loading?(n(),l("div",Re,[e.pageName=="main"?(n(),l("div",Ne,[s("div",Te,[s("div",Ue,[s("div",Se,[s("div",{class:"d-flex justify-content-center align-items-center border rounded shadow-sm m-1 ms-2 wb-background bw-color",style:{"min-width":"80px","min-height":"80px","max-height":"80px",height:"80px","max-width":"160px"},role:"button",onClick:t[12]||(t[12]=i=>e.loadEditDetailsPage())},[(q=e.tab)!=null&&q.favIconUrl?(n(),l("img",{key:0,src:e.tab.favIconUrl,style:{"max-height":"100%"},alt:""},null,8,$e)):e.item?(n(),I(A,{key:1,item:e.item,style:{"max-height":"100%","max-width":"100%"},class:"rounded"},null,8,["item"])):(n(),I(a,{key:2,icon:"link",class:"larger"}))]),s("div",{class:"ms-1 mt-1",role:"button",onClick:t[13]||(t[13]=i=>e.loadEditDetailsPage())},[s("div",{title:e.name},f(e.nameShort),9,De),s("div",{title:e.url,class:"small"},f(e.urlShort),9,Ee)])]),s("div",null,[s("div",null,[o(z,{"no-caret":"",variant:"link","toggle-class":" px-2 py-1  rounded hoverrow default-text-color"},{"button-content":p(()=>[o(a,{icon:"three-dots-vertical"})]),default:p(()=>[e.isAdminUser?(n(),I(M,{key:0,onClick:t[14]||(t[14]=i=>e.loadEditDetailsPage())},{default:p(()=>[o(a,{icon:"pencil"}),t[57]||(t[57]=y(" Edit "))]),_:1})):u("",!0),e.itemId?(n(),I(M,{key:1,onClick:t[15]||(t[15]=i=>e.openPage(`/item/${e.itemId}`))},{default:p(()=>[o(a,{icon:"info"}),t[58]||(t[58]=y(" Details "))]),_:1})):u("",!0),o(M,{onClick:t[16]||(t[16]=i=>e.viewComments())},{default:p(()=>[o(a,{icon:"chat-left-text"}),t[59]||(t[59]=y(" Comments "))]),_:1}),o(M,{onClick:t[17]||(t[17]=i=>e.loadSimilar())},{default:p(()=>[o(a,{icon:"grid-3x3-gap-fill"}),t[60]||(t[60]=y(" Similar "))]),_:1}),e.itemId&&e.isAdminUser?(n(),I(M,{key:2,onClick:t[18]||(t[18]=i=>e.removeFromLibrary())},{default:p(()=>[o(a,{icon:"trash"}),t[61]||(t[61]=y(" Remove from Library "))]),_:1})):u("",!0)]),_:1})])])]),s("div",null,[e.loadingItem?(n(),l("div",it,[o(Q,{class:"spinnerxl",style:{"overflow-y":"none"}})])):(n(),l("div",Ae,[e.itemId?(n(),l("div",Ve,[s("div",We,[s("div",null,[o(a,{icon:"check-lg"}),t[64]||(t[64]=s("span",{class:"small"},"In your library",-1))]),s("div",He,[e.itemId?(n(),I(g,{key:0,variant:"primary",class:"px-2 py-1 nowrap",onClick:t[22]||(t[22]=i=>{e.subPageName="selectCollection",e.currentlySelectedCollectionId=void 0}),title:"Add Collection"},{default:p(()=>[o(a,{icon:"plus-lg"}),t[65]||(t[65]=y(" Add to Collection "))]),_:1})):u("",!0),o(F,{value:e.item,"onUpdate:value":t[23]||(t[23]=i=>e.item=i),class:"rounded hoverrow p-2",mainIconClass:"primary-color"},null,8,["value"]),s("div",{role:"button",title:"share in post",onClick:t[24]||(t[24]=i=>e.newPost()),class:"linklike p-2 rounded hoverrow"},[o(a,{icon:"share"})]),s("div",{role:"button",title:"View Item",onClick:t[25]||(t[25]=i=>e.openPage(`/item/${e.itemId}`)),class:"linklike p-2 rounded hoverrow"},[o(a,{icon:"info-circle"})]),e.isNativeClient&&!e.isAdminUser?(n(),l("div",{key:1,role:"button",title:"Open in Browser",onClick:t[26]||(t[26]=i=>e.openLinkInBrowser()),class:"linklike p-2 rounded hoverrow primary-color"},[o(a,{icon:"globe"})])):u("",!0)])]),e.selectedCollectionIds.length>0?(n(),l("div",ze,t[66]||(t[66]=[s("div",{class:"text-muted small"},"Collections",-1)]))):u("",!0),s("div",Qe,[e.selectedCollectionIds.length>0?(n(!0),l(w,{key:0},P(e.selectedCollections,(i,b)=>(n(),l("div",{key:b,class:"d-flex align-items-center justify-content-between px-2 py-1 my-2 rounded hoverrow truncateme"},[s("div",Ye,[o(a,{icon:"collection",class:"me-1"}),s("span",Ke,f(e.prettyCollection(i)),1),s("span",{role:"button",onClick:N=>e.openCollection(i._id),class:"linklike"},f(e.textTruncate(i.name,25)),9,Ge)]),s("div",{class:"btn-link",role:"button",onClick:N=>e.removeCollection(i._id),title:"Remove collection"},[o(a,{icon:"x-lg"})],8,Je)]))),128)):u("",!0)])])):(n(),l("div",Fe,[s("div",je,[e.savingItem?(n(),l("div",Oe," Saving to library ")):(n(),l("div",qe,t[62]||(t[62]=[s("span",{class:"small"},"Not in your library",-1)]))),s("div",Be,[o(g,{variant:"primary",onClick:t[19]||(t[19]=i=>{e.subPageName="selectCollection",e.currentlySelectedCollectionId=void 0}),title:"Add to Library"},{default:p(()=>[o(a,{icon:"plus-lg"}),t[63]||(t[63]=y(" Add to Library "))]),_:1}),e.itemId?u("",!0):(n(),I(F,{key:0,onNewItemFeedback:e.newItemFeedback,newItem:!0,class:"rounded hoverrow p-2 linklike",mainIconClass:"primary-color"},null,8,["onNewItemFeedback"])),s("div",{role:"button",title:"share in post",onClick:t[20]||(t[20]=i=>e.newPost()),class:"linklike p-2 rounded hoverrow"},[o(a,{icon:"share",class:""})]),e.isNativeClient&&!e.isAdminUser?(n(),l("div",{key:1,role:"button",title:"Open in Browser",onClick:t[21]||(t[21]=i=>e.openLinkInBrowser()),class:"linklike p-2 rounded hoverrow primary-color"},[o(a,{icon:"globe"})])):u("",!0)])])])),e.itemId&&e.itemPermissions&&e.itemPermissions.length>0?(n(),l("div",Xe,[t[67]||(t[67]=s("div",{class:"d-flex align-items-center mt-3 mb-2"},[s("div",{class:"text-muted small"},"Libraries")],-1)),s("div",Ze,[(n(!0),l(w,null,P(e.itemPermissions,(i,b)=>(n(),l("div",{key:b,class:"py-1 px-2 rounded fillrow small",title:i.permissionDetails.direct?"Users with access":"Inherited access from a collection"},[o(E,{profileImage:i.user.profileImage,width:18},null,8,["profileImage"]),y(" "+f(i.user._id==e.currentUserId?"*you":i.username),1)],8,xe))),128))])])):u("",!0),!e.itemId&&e.existingMatches.length>0?(n(),l("div",_e,[t[68]||(t[68]=s("div",{class:"mb-2 text-muted small"},"Related",-1)),(n(!0),l(w,null,P(e.existingMatches,(i,b)=>(n(),l("div",{role:"button",title:"Click to Select",key:b,class:"d-flex align-items-center flex-gap-sm small my-1 rounded hoverrow",onClick:N=>{e.loadFromItemId(i._id),e.subPageName=null}},[o(A,{item:i,width:32},null,8,["item"]),s("div",null,[s("div",tt,f(e.textTruncate(i.name,e.truncateLength)),1),s("div",st,f(e.textTruncate(i.url,e.truncateLength)),1)])],8,et))),128))])):u("",!0)]))]),e.errorMessage?(n(),l("div",{key:0,class:"mt-4 alert alert-danger small",role:"alert",innerHTML:e.errorMessage},null,8,nt)):u("",!0)])])):e.pageName=="companion"?(n(),l("div",ot,[o(Y)])):(n(),l("div",lt,"Tab Not Found"))])):e.loading?(n(),l("div",ut)):(n(),l("div",rt,[s("div",at,[o(g,{onClick:t[27]||(t[27]=i=>e.openPage("/")),class:"btn btn-link hoverrow d-flex flex-no-wrap align-items-center notextdecoration",title:"Kindredly"},{default:p(()=>[o(j,{class:"rotateonhover t-logo-sm t-collapsible t-collapsed",name:"kindred-simple2",width:40}),o(j,{class:"t-collapse-sm t-collapsible t-collapsed",name:"kindred-text-thin",width:140})]),_:1})]),e.supported?u("",!0):(n(),l("div",dt,[s("button",{onClick:t[28]||(t[28]=i=>e.openPage("/")),class:"btn btn-link d-flex align-items-center mb-2 larger"},[o(a,{icon:"search"})])]))]))])),e.pageName=="main"&&e.subPageName=="editDetails"?(n(),l("div",mt,[s("div",pt,[s("div",{role:"button",class:"p-1 me-2",onClick:t[29]||(t[29]=i=>e.subPageName=null)},[o(a,{icon:"chevron-left"})]),t[70]||(t[70]=s("div",null,"Edit Item Details",-1)),s("div",ht,[o(g,{variant:"primary",onClick:t[30]||(t[30]=i=>{e.saveItem(),e.subPageName=null})},{default:p(()=>t[69]||(t[69]=[s("span",null,"Save",-1)])),_:1})])]),s("div",ct,[s("div",null,[e.errorMessage?(n(),l("div",{key:0,class:"my-2 alert alert-danger",role:"alert",innerHTML:e.errorMessage},null,8,ft)):u("",!0),s("div",gt,[t[71]||(t[71]=s("label",{class:"text-muted"},"URL",-1)),s("div",null,[s("div",{class:"w-100 border rounded p-1 scrollingtext",onClick:t[31]||(t[31]=i=>e.openEditURLModal()),role:"button"},[s("div",{class:"wwrap3",title:e.url},[y(f(e.url)+" ",1),o(a,{icon:"pencil"})],8,vt)])])]),t[76]||(t[76]=s("label",{class:"text-muted"},"Name",-1)),s("div",yt,[C(s("textarea",{rows:"1",class:"form-control",placeholder:"Name","onUpdate:modelValue":t[32]||(t[32]=i=>e.name=i)},null,512),[[R,e.name]])]),s("div",bt,[t[72]||(t[72]=s("label",{class:"text-muted"},"Item Type",-1)),s("div",It,[s("div",{class:"d-flex flex-gap-1 align-items-center p-1 border rounded",onClick:t[33]||(t[33]=i=>e.subPageName="selectType"),role:"button"},[s("div",null,f(e.typeName),1),o(a,{icon:"pencil"})])]),t[73]||(t[73]=s("label",{class:"text-muted"},"Tags",-1)),s("div",kt,[C(s("input",{class:"form-control",type:"input","onUpdate:modelValue":t[34]||(t[34]=i=>e.tags=i),placeholder:"Separate with commas"},null,512),[[R,e.tags]])]),t[74]||(t[74]=s("label",{class:"text-muted"},"Description",-1)),s("div",Ct,[C(s("textarea",{class:"form-control",placeholder:"enter a description (optional)","onUpdate:modelValue":t[35]||(t[35]=i=>e.description=i)},null,512),[[R,e.description]])]),t[75]||(t[75]=s("label",{class:"text-muted"},"URI Patterns. For example: *.code.org/* - one per line",-1)),s("div",wt,[C(s("textarea",{class:"form-control","onUpdate:modelValue":t[36]||(t[36]=i=>e.patterns=i)},null,512),[[R,e.patterns]])])])])])])):u("",!0),e.pageName=="main"&&e.subPageName=="selectType"?(n(),l("div",Pt,[s("div",Mt,[s("div",{role:"button",class:"p-1 me-2",onClick:t[37]||(t[37]=i=>e.subPageName=null)},[o(a,{icon:"chevron-left"})]),t[77]||(t[77]=s("div",null,"Select Type",-1))]),s("div",Lt,[o(K,{disableButtons:!0,itemType:e.type||"link",itemSubType:e.subType,onUpdate:e.updateItemType,onClose:t[38]||(t[38]=i=>e.subPageName=null)},null,8,["itemType","itemSubType","onUpdate"])])])):u("",!0),e.pageName=="main"&&e.subPageName=="selectCollection"?(n(),l("div",Rt,[s("div",Nt,[s("div",{role:"button",class:"p-1 me-2",onClick:t[39]||(t[39]=i=>e.subPageName=null)},[o(a,{icon:"chevron-left"})]),t[80]||(t[80]=s("div",null,"Select Collection",-1)),s("div",Tt,[!e.itemId&&!e.currentlySelectedCollectionId?(n(),I(g,{key:0,variant:"primary",onClick:t[40]||(t[40]=i=>{e.addWithoutOrganizing(),e.subPageName=null})},{default:p(()=>[o(a,{icon:"plus-lg",class:"me-1"}),t[78]||(t[78]=s("span",null,"Add without organizing",-1))]),_:1})):e.currentlySelectedCollectionId?(n(),I(g,{key:1,variant:"primary",onClick:e.addSelectedCollection},{default:p(()=>[o(a,{icon:"plus-lg",class:"me-1"}),t[79]||(t[79]=s("span",null,"Select",-1))]),_:1},8,["onClick"])):(n(),l("div",{key:2,class:"btn btn-link",onClick:t[41]||(t[41]=i=>e.subPageName=null)}," Close "))])]),s("div",Ut,[e.errorMessage?(n(),l("div",{key:0,class:"my-2 alert alert-danger small",role:"alert",innerHTML:e.errorMessage},null,8,St)):u("",!0),t[82]||(t[82]=s("div",{class:"mt-2"},null,-1)),e.currentUser?(n(),I(G,{key:1,hideFooterButtons:!0,onChange:t[42]||(t[42]=i=>e.currentlySelectedCollectionId=i),onClear:t[43]||(t[43]=i=>e.currentlySelectedCollectionId=void 0),onClose:e.addSelectedCollectionFromPopup,excludedCollectionIds:e.selectedCollectionIds,suggestionQuery:`${e.name} ${e.url}`},{defaultoptions:p(()=>t[81]||(t[81]=[])),_:1},8,["onClose","excludedCollectionIds","suggestionQuery"])):u("",!0)])])):u("",!0),e.pageName=="main"&&e.subPageName=="otherMatches"?(n(),l("div",$t,[s("div",Dt,[s("div",{role:"button",class:"p-1 me-2",onClick:t[44]||(t[44]=i=>e.subPageName=null)},[o(a,{icon:"chevron-left"})]),t[83]||(t[83]=s("div",null,"URL Matches",-1)),t[84]||(t[84]=s("div",{class:"ms-auto"},null,-1))]),s("div",Et,[e.existingMatches.length>0?(n(),l("div",At,[s("div",Ft,[t[85]||(t[85]=s("div",{class:"text-muted"},"Current URL",-1)),s("div",{title:e.url},f(e.urlShort),9,jt)]),t[86]||(t[86]=s("div",{class:"text-muted"},"Similar Matches:",-1)),(n(!0),l(w,null,P(e.existingMatches,(i,b)=>(n(),l("div",{key:b,class:"d-flex align-items-center"},[s("button",{class:"btn btn-outline-primary my-1 me-2",onClick:N=>{e.loadFromItemId(i._id),e.subPageName=null}}," Select ",8,qt),s("div",null,[s("div",{class:"text-truncate",title:i.name},f(e.textTruncate(i.name,e.truncateLength)),9,Ot),s("div",{class:"text-truncate",title:i.url},f(e.textTruncate(i.url,e.truncateLength)),9,Bt)])]))),128))])):u("",!0)])])):u("",!0),e.pageName=="main"&&e.subPageName=="share"?(n(),l("div",Vt,[s("div",Wt,[s("div",{role:"button",onClick:t[45]||(t[45]=i=>e.subPageName=null)},[o(a,{icon:"chevron-left"})]),t[87]||(t[87]=s("div",null,"Share in Post",-1))]),s("div",Ht,[o(J,{quickPost:!0,itemIds:[e.itemId],onClose:e.closeShare},null,8,["itemIds","onClose"])])])):u("",!0),e.pageName=="main"&&e.subPageName=="comments"?(n(),l("div",zt,[s("div",Qt,[s("div",{role:"button",onClick:t[46]||(t[46]=i=>e.subPageName=null)},[o(a,{icon:"chevron-left"})]),t[88]||(t[88]=s("div",null,"Comments",-1))]),s("div",Yt,[o(X,{refId:e.itemId,refType:"item",refEncInfo:e.item.encInfo,isFocused:!0},null,8,["refId","refEncInfo"])])])):u("",!0),e.pageName=="main"&&e.subPageName=="history"?(n(),l("div",Kt,[s("div",Gt,[s("div",{role:"button",onClick:t[47]||(t[47]=i=>e.subPageName=null)},[o(a,{icon:"chevron-left"})]),t[89]||(t[89]=s("div",null,"Related History",-1))]),t[90]||(t[90]=s("div",{class:"mx-3 my-3"},null,-1))])):u("",!0),e.pageName=="main"&&e.subPageName=="similarItems"?(n(),l("div",Jt,[s("div",Xt,[s("div",{role:"button",class:"p-1 me-2",onClick:t[48]||(t[48]=i=>e.subPageName=null)},[o(a,{icon:"chevron-left"})]),t[91]||(t[91]=s("div",null,"Similar Items",-1)),t[92]||(t[92]=s("div",{class:"ms-auto"},null,-1))]),s("div",Zt,[e.similarItems.length>0?(n(),l("div",xt,[(n(!0),l(w,null,P(e.similarItems,(i,b)=>(n(),l("div",{key:b,class:"d-flex mb-2"},[s("div",null,[o(a,{icon:"link"})]),s("div",_t,[s("a",{title:i.url,href:i.url,target:"_blank",class:"wwrap3"},f(e.textTruncate(i.url,e.truncateLength)),9,es),s("div",{class:"wwrap3",title:i.name},f(e.textTruncate(i.name,e.truncateLength)),9,ts)])]))),128))])):(n(),l("div",ss,t[93]||(t[93]=[s("div",{class:"text-muted"},"No similar items found",-1)])))])])):u("",!0)])}const hs=re(fe,[["render",is]]);export{hs as default};

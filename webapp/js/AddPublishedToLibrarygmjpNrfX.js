import v from"./PopCollectionSelectorBW6dnAeB.js";import{P as k}from"./TIIconDefaultB4jiNlod.js";import{S as U}from"./SelectAccountUsers1I4pmgqf.js";import{a as P,_ as C}from"./components.globalDizx_NTC.js";import{d as L,j as t,K as n,s as l,Q as d,R as m,k as o,F as p,P as y,z as b,r as a,i}from"./@vueC3Nhqlrl.js";const w=L({name:"AddPublishedToLib",props:["itemId"],mixins:[P],components:{PopCollectionSelector:v,ProfileImage:k,SelectAccountUsers:U},data(){return{loadingPage:!0,loading:!1,page:"main",item:null,libraryItems:[],matches:[],importedLibraryItemId:null,selectedUserIds:[]}},mounted(){},computed:{availableUsers(){return this.users?this.users.filter(e=>e._id==this.currentUserId||e.type=="restricted"):[]}},methods:{async loadPublished(){const e=await this.sendReq("/published/view",{itemId:this.itemId});e.success&&e.result?(this.item=e.result.info,this.loading=!1):(console.error("Error:",e),this.loading=!1)},async isInLibrary(){const e=await this.sendReq("/item/withPubOrSubId",{itemId:this.itemId});e.success?this.libraryItems=e.result:this.errorMessage=e.message},async addCollection(e){if(this.page="main",this.loading=!0,!e){this.loading=!1;return}const s=await this.sendReq("/published/item/importFromPublished",{collectionIds:[e],itemId:this.itemId});s.success?(this.importedLibraryItemId=s.result,this.RefreshIndexQuick(),await this.isInLibrary(),this.$emit("updated"),this.showToast("Added to library",{title:"Success",variant:"success",autoClose:!1})):this.errorMessage=s.message,this.loading=!1},async subscribe(){this.loading=!0;const e=await this.sendReq("/published/subscribe",{collectionId:this.itemId,userIds:this.selectedUserIds});e.success?(this.importedLibraryItemId=e.result,await this.isInLibrary(),this.RefreshIndexQuick(),this.$emit("close",null),this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message),this.loading=!1},async toggleUserLibrary(e){this.selectedUserIds.includes(e)?this.selectedUserIds=this.selectedUserIds.filter(s=>s!=e):this.selectedUserIds.push(e)},async checkLibrary(){await this.isInLibrary(),this.item.type=="link"&&this.libraryItems.length==0&&this.matches.length==0&&(this.page="selectCollection")},async load(){this.loadingPage=!0,await this.loadPublished(),await this.checkLibrary(),this.loadingPage=!1}},created(){this.load()}}),$={key:0},S={key:1,class:"text-center"},A={key:0},_={key:0,class:"mb-4"},R={key:1,class:"mb-4"},T=["href"],V={key:1},q=["href"],M={key:2},N={class:"my-3 h3"},j={key:0},B={key:1},E={class:"d-flex mt-5 justify-content-end"},F={key:2,class:"text-center"};function Q(e,s,D,O,z,K){const f=a("PopCollectionSelector"),h=a("b-icon"),u=a("b-button"),I=a("SelectAccountUsers"),g=a("b-spinner");return i(),t("div",null,[e.page=="selectCollection"?(i(),t("div",$,[n(f,{onClose:e.addCollection},null,8,["onClose"])])):l("",!0),e.page=="main"&&e.item&&!e.loadingPage?(i(),t("div",S,[e.libraryItems.length>0?(i(),t("div",A,[e.importedLibraryItemId?(i(),t("div",_,[n(h,{icon:"check"}),s[3]||(s[3]=d(" In your library "))])):(i(),t("div",R,[n(h,{icon:"check"}),d(" "+m(e.item.name)+" ",1),s[4]||(s[4]=o("b",null,"is in your library.",-1))])),(i(!0),t(p,null,y(e.libraryItems,(r,c)=>(i(),t("div",{class:"d-flex justify-content-center flex-wrap",key:c},[o("a",{href:`${e.appPrefix}#/${r.type=="col"?"collection":"item"}/${r._id}`},"View in library",8,T)]))),128))])):e.matches.length>0?(i(),t("div",V,[s[5]||(s[5]=o("div",{class:"mb-4"},"There are similar item(s) in your library:",-1)),(i(!0),t(p,null,y(e.matches,(r,c)=>(i(),t("div",{key:c},[o("a",{href:`${e.appPrefix}#/item/${r._id}`},m(r.name||r.url),9,q)]))),128))])):(i(),t("div",M,[o("div",N,m(e.item.name),1),s[8]||(s[8]=o("div",{class:"text-muted mb-4"}," This will import a copy of the item(s) into your library. ",-1)),!e.loading&&e.item&&e.item.type=="link"?(i(),t("div",j,[n(u,{variant:"outline-primary",onClick:s[0]||(s[0]=r=>{e.page="selectCollection"})},{default:b(()=>s[6]||(s[6]=[d("Add to library")])),_:1})])):l("",!0),!e.loading&&e.item&&e.item.type=="col"?(i(),t("div",B,[s[7]||(s[7]=o("div",{class:"my-3"},"Select Library(s)",-1)),n(I,{selectedUserIds:e.selectedUserIds,"onUpdate:selectedUserIds":s[1]||(s[1]=r=>e.selectedUserIds=r),includeSelf:!0,restrictedOnly:!0},null,8,["selectedUserIds"]),o("div",E,[n(u,{disabled:!e.selectedUserIds||e.selectedUserIds.length==0,variant:"primary",onClick:s[2]||(s[2]=r=>e.subscribe())},{default:b(()=>[d("Import into "+m(e.selectedUserIds.length>1?"Libraries ("+e.selectedUserIds.length+")":"Library"),1)]),_:1},8,["disabled"])])])):l("",!0)]))])):l("",!0),e.loadingPage?(i(),t("div",F,[n(g)])):l("",!0)])}const Y=C(w,[["render",Q]]);export{Y as A};

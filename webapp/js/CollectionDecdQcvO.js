const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/CreateOrEditNoteDREr_kzC.js","js/components.globalSAVxUKYX.js","js/@vueC3Nhqlrl.js","js/vue3-toastifyDll2FbVh.js","assets/vue3-toastify.css","js/@capacitorCjBcbZvA.js","js/bootstrap-vue-nextDnMzdrWQ.js","assets/bootstrap-vue-next.css","assets/components.css","js/PopCollectionSelectorBo26MlBL.js","js/CreateCollectionC2CAQQ8x.js","js/TIIconDefaultBACySpee.js","assets/TIIconDefault.css","js/ai_lookup_utilszDX_hcwM.js","assets/CreateCollection.css","js/ItemImageB4O-XpFn.js","assets/PopCollectionSelector.css","js/textrenderDkJfJV6k.js","js/markedJKvyS0Pp.js","assets/CreateOrEditNote.css"])))=>i.map(i=>d[i]);
import{_ as ce}from"./@capacitorCjBcbZvA.js";import he from"./AddItemDVLAD9ud.js";import{A as pe}from"./AddItemFromLibraryCKssMWlc.js";import{T as fe}from"./TIIconDefaultBACySpee.js";import{O as ge,a as ve,I as Ie}from"./ItemListCatIJQ91.js";import{a as V,_ as R,p as be,E as ye,ax as ke,t as Ce,l as G,aj as we,aM as Ae,an as F,d as S}from"./components.globalSAVxUKYX.js";import{A as Pe,C as Te,P as Me}from"./CreateCollectionC2CAQQ8x.js";import{d as E,j as c,K as t,z as l,r as h,i as o,s as n,k as s,Q as a,R as v,m as u,l as Ue,aa as $e,ad as De,p as Y,L as I,F as D,P as q,ac as W,N as Se}from"./@vueC3Nhqlrl.js";import{U as Re}from"./UploadItemImageDZxv5p44.js";import{I as Ee}from"./ItemPermissionEditorB9DnwgvW.js";import{T as Oe,a as Le}from"../kindredapp.js";import{T as Ve}from"./TIFeedbackInfoDvSmkoIV.js";import{I as J}from"./ItemImageB4O-XpFn.js";import{i as ze,R as Fe}from"./subscription.storeCUkp4C6x.js";import{P as qe}from"./PlaceholderListBFhdM9uu.js";import{A as Ne}from"./AddItemFromLibraryResultsDW-vejij.js";import{B as He}from"./BuilderItemListYjXYy2iP.js";import Be from"./AddItemDefaultBaEIL249.js";import"./PopCollectionSelectorBo26MlBL.js";import"./ai_lookup_utilszDX_hcwM.js";import"./vue3-toastifyDll2FbVh.js";import"./bootstrap-vue-nextDnMzdrWQ.js";import"./CollectionButtonListCK1eTpTV.js";import"./ItemTypesLjCsMI_T.js";import"./browserTabsB_q3qWRv.js";import"./item.storeCE3z3Z6A.js";import"./vue-advanced-cropperDRfTlVFt.js";import"./vue-routerD_xVOTNt.js";import"./vue-plugin-load-scriptXwA-LyvJ.js";import"./bootstrapDQG5F40S.js";import"./@popperjsCCtJ9KiL.js";import"./@mozillaCDB2aYYy.js";import"./UploadAttachmentsToAddD7VVdjuv.js";import"./upload.mixinCR_CibH4.js";const Qe=E({name:"EditCollectionInfo",props:["collectionId"],mixins:[V],components:{AISuggester:Pe},data(){return{name:null,description:null,visibility:null,tags:null,encInfo:null,errorMessage:null,visibleToFamily:!1}},mounted(){},computed:{},methods:{updateWithSuggestions(e){console.log("updateWithSuggestions",e);try{this.name=e.name,this.description=e.description,this.tags=e.tags.join(", ")}catch(i){console.error(i)}},loadCollectionInfo(){this.sendReq("/client/collection/infoByUser",{collectionId:this.collectionId}).then(e=>{e.success?(this.name=e.result.name,this.description=e.result.description,this.visibility=e.result.visibility,this.visibility=="shared"&&(this.visibleToFamily=!0),this.encInfo=e.result.encInfo,e.result.tags&&(this.tags=e.result.tags.join(", ")),this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)})},save(){var i;const e=this.tags!=null?(i=this.tags)==null?void 0:i.split(",").map(m=>m.trim().toLowerCase()).filter(m=>!!m):null;this.sendReq("/client/item/update",{itemId:this.collectionId,data:{name:this.name,description:this.description,tags:e,visibility:this.visibleToFamily?"shared":"private",encInfo:this.encInfo},encInfo:this.encInfo}).then(m=>{m.success?(this.RefreshIndexQuick(),this.$emit("close",!0),this.errorMessage=null):(console.error("Error:",m.message),this.errorMessage=m.message)})},closeMe(){this.$emit("close",!1)}},created(){this.loadCollectionInfo()}}),je={key:0,class:"mb-3"},Ye={class:"d-flex flex-gap-1 align-items-center flex-wrap"};function We(e,i,m,f,b,w){const k=h("b-form-input"),p=h("b-form-group"),y=h("b-form-textarea"),d=h("AISuggester"),M=h("b-form-checkbox"),g=h("b-button"),U=h("b-form");return o(),c("div",null,[t(U,null,{default:l(()=>[t(p,{class:"form-group",label:"Collection Name"},{default:l(()=>[t(k,{id:"formName",modelValue:e.name,"onUpdate:modelValue":i[0]||(i[0]=P=>e.name=P),placeholder:"Collection Name"},null,8,["modelValue"])]),_:1}),t(p,{class:"form-group",label:"Description"},{default:l(()=>[t(y,{id:"formDescription",modelValue:e.description,"onUpdate:modelValue":i[1]||(i[1]=P=>e.description=P),placeholder:"Collection Description"},null,8,["modelValue"])]),_:1}),t(p,{class:"form-group mt-3",label:"Tags, comma separated"},{default:l(()=>[t(k,{id:"formTags",modelValue:e.tags,"onUpdate:modelValue":i[2]||(i[2]=P=>e.tags=P),placeholder:"Tags, comma seperated"},null,8,["modelValue"])]),_:1}),e.isAdminUser?(o(),c("div",je,[t(d,{customSuggest:"","valid-action-ids":["main_attr_improve_collection"],"confirm-update":!0,onUpdate:e.updateWithSuggestions,"context-data":{name:e.name,description:e.description,tags:e.tags,type:"collection"}},null,8,["onUpdate","context-data"])])):n("",!0),t(p,{class:"form-group mt-4"},{default:l(()=>[s("div",Ye,[t(M,{modelValue:e.visibleToFamily,"onUpdate:modelValue":i[3]||(i[3]=P=>e.visibleToFamily=P),switch:""},{default:l(()=>i[5]||(i[5]=[a(" Visible to all family members ")])),_:1},8,["modelValue"])]),i[6]||(i[6]=s("div",{class:"mt-1 text-muted small"}," Allow all family members see this collection, even when it's not in their library. ",-1))]),_:1}),i[8]||(i[8]=s("div",{class:"mb-4"},null,-1)),t(g,{variant:"primary",class:"float-right",onClick:i[4]||(i[4]=P=>e.save())},{default:l(()=>i[7]||(i[7]=[a("Save")])),_:1})]),_:1})])}const Ge=R(Qe,[["render",We]]),Je=E({name:"EditInCollectionDetails",props:["collectionId","itemId"],data(){return{loading:!1,errorMessage:null,details:{},meta:{},defaults:{name:null,description:null,comment:null},inCollectionDetails:{name:null,description:null,comment:null},publishedAvailableAt:null,publishedUpdatedAt:null,itemInfo:{}}},mounted(){},computed:{},methods:{prettyTimePast:be,dateToMDYFormat:ye,prettyDate:ke,clear(){this.inCollectionDetails=Object.fromEntries(Object.entries(this.inCollectionDetails).map(e=>[e[0],null]))},loadCollectionItemInfo(){this.sendReq("/client/collection/getItemRelInfo",{collectionId:this.collectionId,itemId:this.itemId}).then(e=>{if(e.success){if(e.result.details){for(const m of Object.keys(this.inCollectionDetails))this.inCollectionDetails[m]=e.result.details[m];let i=e.result.publishedAvailableAt;this.publishedAvailableAt=i?i.split("T")[0]:null,this.publishedUpdatedAt=e.result.publishedUpdatedAt}this.loadItemInfo(),this.errorMessage=null}else console.error("Error:",e.message),this.errorMessage=e.message})},loadItemInfo(){this.sendReq("/client/item/info",{itemId:this.itemId}).then(e=>{e.success?(this.itemInfo=e.result,this.itemInfo&&(this.details=this.itemInfo.details||{},this.meta=this.details.meta||{},this.defaults.name=this.details.name||this.meta.title,this.defaults.description=this.details.description||this.meta.description,this.inCollectionDetails.name||(this.inCollectionDetails.name=this.defaults.name),this.inCollectionDetails.description||(this.inCollectionDetails.description=this.defaults.description)),this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)})},save(){var e,i,m,f,b,w;this.loading=!0;try{this.inCollectionDetails.name==this.defaults.name&&(this.inCollectionDetails.name=null),this.inCollectionDetails.description==this.defaults.description&&(this.inCollectionDetails.description=null),this.inCollectionDetails.comment==this.defaults.comment&&(this.inCollectionDetails.comment=null),((i=(e=this.itemInfo)==null?void 0:e.details)==null?void 0:i.encInfo)!=null&&(this.inCollectionDetails.encInfo=(f=(m=this.itemInfo)==null?void 0:m.details)==null?void 0:f.encInfo);const k=((w=(b=this.itemInfo)==null?void 0:b.details)==null?void 0:w.encInfo)==null,p={collectionId:this.collectionId,itemId:this.itemId,details:{...this.inCollectionDetails},publishedAvailableAt:this.publishedAvailableAt,dontEncrypt:k};this.sendReq("/client/collection/itemDetails/save",p,{dontEncrypt:k}).then(y=>{y.success?(this.$emit("close",!0),this.errorMessage=null):(console.error("Error:",y.message),this.errorMessage=y.message),this.loading=!1})}catch(k){this.errorMessage=k,console.error(k),this.loading=!1}},closeMe(){this.$emit("close",!1)}},created(){this.loadCollectionItemInfo()}}),Ke={class:"text-muted p-2 mb-4"},Xe={key:0},Ze=["title"],_e={class:"d-flex justify-content-between mb-2 mt-5"};function xe(e,i,m,f,b,w){const k=h("b-icon"),p=h("b-form-input"),y=h("b-form-group"),d=h("b-form-textarea"),M=h("b-button"),g=h("b-spinner"),U=h("b-alert"),P=h("b-form");return o(),c("div",null,[s("div",Ke,[t(k,{icon:"info-circle",class:"mr-2"}),i[6]||(i[6]=a(" These values will only be visible while viewing from within the collection and will not affect the original. This will also be the case for Published Items. "))]),t(P,null,{default:l(()=>[i[11]||(i[11]=s("div",{class:"text-muted mt-3 mb-1"},"Name",-1)),t(y,{class:"form-group"},{default:l(()=>[t(p,{id:"formName",modelValue:e.inCollectionDetails.name,"onUpdate:modelValue":i[0]||(i[0]=T=>e.inCollectionDetails.name=T),placeholder:e.defaults.name},null,8,["modelValue","placeholder"])]),_:1}),i[12]||(i[12]=s("div",{class:"text-muted mt-3 mb-1"},"Description",-1)),t(y,{class:"form-group"},{default:l(()=>[t(d,{id:"formDescription",modelValue:e.inCollectionDetails.description,"onUpdate:modelValue":i[1]||(i[1]=T=>e.inCollectionDetails.description=T),placeholder:e.defaults.description,rows:"3","max-rows":"6"},null,8,["modelValue","placeholder"])]),_:1}),i[13]||(i[13]=s("div",{class:"text-muted mt-3 mb-1"},"Remark Comment",-1)),t(y,{class:"form-group"},{default:l(()=>[t(d,{id:"formComment",modelValue:e.inCollectionDetails.comment,"onUpdate:modelValue":i[2]||(i[2]=T=>e.inCollectionDetails.comment=T),placeholder:e.defaults.comment,rows:"3","max-rows":"6"},null,8,["modelValue","placeholder"])]),_:1}),i[14]||(i[14]=s("div",{class:"text-muted mt-3 mb-1"},"Published Availability Date",-1)),t(y,{class:"form-group"},{default:l(()=>[t(p,{id:"formPublishDate",modelValue:e.publishedAvailableAt,"onUpdate:modelValue":i[3]||(i[3]=T=>e.publishedAvailableAt=T),type:"date"},null,8,["modelValue"]),i[7]||(i[7]=s("div",{class:"text-muted mt-1 mb-1 small"}," Only used for publishing and not required. This will be the date when the item will be available for public viewing. ",-1))]),_:1}),e.publishedUpdatedAt?(o(),c("div",Xe,[i[8]||(i[8]=s("div",{class:"text-muted mt-3 mb-1"},"Last Publish Update",-1)),s("div",{class:"my-1",title:e.publishedUpdatedAt},v(e.prettyDate(e.publishedUpdatedAt))+" ("+v(e.prettyTimePast(e.publishedUpdatedAt))+" ago) ",9,Ze)])):n("",!0),s("div",_e,[t(M,{variant:"outline-danger",onClick:i[4]||(i[4]=T=>e.clear())},{default:l(()=>i[9]||(i[9]=[a(" Restore Detaults ")])),_:1}),t(M,{variant:"primary",class:"float-right",onClick:i[5]||(i[5]=T=>e.save()),disabled:e.loading},{default:l(()=>[e.loading?(o(),u(g,{key:0,small:"",type:"grow"})):n("",!0),i[10]||(i[10]=a(" Save "))]),_:1},8,["disabled"])]),e.errorMessage?(o(),u(U,{key:1,class:"m-4",variant:"danger","model-value":!!e.errorMessage,innerHTML:e.errorMessage},null,8,["model-value","innerHTML"])):n("",!0)]),_:1})])}const ei=R(Je,[["render",xe]]),ii=E({name:"TIPinToHome",mixins:[V],components:{},props:{itemId:{type:String,required:!0}},data(){return{pinnedToHome:!1}},computed:{},methods:{async changePinToHome(e,i){await this.updatePinToHome(e,i),await this.RefreshPinnedToHomeItems(!0),await this.load(),this.$emit("change",i),i?this.showToast("Pinned to home page"):this.showToast("Unpinned from home page")},async load(){var i,m;const e=((m=(i=this.userPrefs)==null?void 0:i.data)==null?void 0:m.pinnedToHome)||[];this.pinnedToHome=e.includes(this.itemId)}},created(){this.load()}});function ti(e,i,m,f,b,w){const k=h("b-icon");return o(),c("div",{title:"Pin/Unpin (items show on home page)",role:"button",onClick:i[0]||(i[0]=p=>e.changePinToHome(e.itemId,!e.pinnedToHome))},[e.pinnedToHome?(o(),u(k,{key:0,icon:"pin-fill"})):(o(),u(k,{key:1,icon:"pin"})),Ue(e.$slots,"default")])}const oi=R(ii,[["render",ti]]),si=E({name:"SuggestItemsFromLibrary",mixins:[V],components:{ItemImage:J,AddItemFromLibraryResults:Ne},emits:["selectExistingItem","close"],props:{collectionId:{type:String,required:!1}},data(){return{loading:!1,errorMessage:null,searchResults:null,requesterUser:{}}},mounted(){},computed:{},methods:{textTruncate:Ce,async _addItemToCollection(e){var m;const i=await this.sendReq("/item/addToCollections",{collectionIds:[this.collectionId],itemId:e,tempAuthToken:((m=this.permissionOverrideInfo)==null?void 0:m.tokenData)||null});i.success?this.showToast("Item Added",{variant:"success"}):(console.error("Error:",i.message),this.errorMessage=i.message,this.showToast(i.message,{variant:"danger",title:"Error",solid:!0}))},async selectExistingItem(e){this.collectionId&&await this._addItemToCollection(e),this.RefreshIndexQuick();for(let i=0;i<this.searchResults.length;i++)if(this.searchResults[i]._id==e){this.searchResults.splice(i,1);break}this.$emit("selectExistingItem")},async fetchSuggestions(){this.loading=!0,this.searchResults=null;const e=await this.sendReq("/client/getRelatedItemsForCollection",{collectionId:this.collectionId});e.success&&e.result?(this.searchResults=G(e.result,60,!1),this.errorMessage=null):(console.error("Error:",e?e.message:"Unknown"),this.errorMessage=e.message),this.loading=!1},closeMe(){this.$emit("close",!1)}},created(){this.fetchSuggestions()}}),li={class:"d-flex justify-content-end align-items-center"},ni={key:0,class:"text-center ani-fade-in-slow"},ri={class:"d-flex justify-content-end align-items-center mt-2"};function di(e,i,m,f,b,w){const k=h("b-icon"),p=h("b-button"),y=h("b-spinner"),d=h("AddItemFromLibraryResults");return o(),c("div",null,[s("div",li,[t(p,{variant:"link",onClick:i[0]||(i[0]=M=>e.fetchSuggestions()),class:"py-0 my-0",disabled:e.loading},{default:l(()=>[t(k,{icon:"arrow-clockwise"})]),_:1},8,["disabled"])]),e.loading?(o(),c("div",ni,[t(y,{variant:"primary",label:"Loading..."})])):n("",!0),e.searchResults?(o(),u(d,{key:1,searchResults:e.searchResults,onSelectExistingItem:e.selectExistingItem,loading:e.loading},null,8,["searchResults","onSelectExistingItem","loading"])):n("",!0),s("div",ri,[t(p,{variant:"primary",onClick:i[1]||(i[1]=M=>e.closeMe())},{default:l(()=>i[2]||(i[2]=[a("Done")])),_:1})]),i[3]||(i[3]=s("div",{class:"bottom-gap-mobile"},null,-1))])}const ai=R(si,[["render",di]]),mi=E({name:"CollectionView",mixins:[V],components:{CreateCollection:Te,AddItem:he,CreateOrEditNote:$e(()=>ce(()=>import("./CreateOrEditNoteDREr_kzC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))),AddItemFromLibrary:pe,ItemImage:J,TIIconDefault:fe,EditCollectionInfo:Ge,EditInCollectionDetails:ei,OrganizeItem:ge,UploadItemImage:Re,Permissions:Me,ItemPermissionEditor:Ee,ItemRow:ve,ItemList:Ie,TIPinToHome:oi,TIListViewOptions:Oe,TIFeedbackInfo:Ve,PlaceholderList:qe,SuggestItemsFromLibrary:ai,BuilderItemList:He,AddItemDefault:Be},data(){return{errorMessage:null,parents:null,parentId:null,navItems:null,pathTree:null,availConfig:{inc:1,varMin:0,startDate:null},deleteItems:!0,editItemId:null,collectionId:null,options:null,collection:null,selectedItemId:null,loadAmount:this.isMobile?5:30,imageRefresh:0,items:[],bulkAddValue:"",targetUser:null,owner:null,currentUserPermission:null,dragMode:!1,perms:[],itemIdFocused:null,loadingItems:!0,loadingCollection:!0,refreshingMeta:!1,pinnedToHome:!1,sourceItemOrder:null,aiSuggestionData:null,loadingAISuggestions:!1}},mounted(){},computed:{isHidden(){var e,i;return((i=(e=this.collection)==null?void 0:e.feedback)==null?void 0:i.isHidden)==!0},imageWidth(){return this.isMobile?"150":"375"},isSubscribed(){return this.collectionId&&ze(this.collectionId)},imageHeight(){return this.isMobile?"75px":"187px"},isDraggable(){return this.editPermission&&this.dragMode},isArchived(){var e;return!!((e=this.collection)!=null&&e.archived)},publishable(){return this.collection&&(this.collection.published||!this.collection.publishId)},isPublished(){return this.collection&&this.collection.published&&this.collection.publishId},isImported(){return this.collection&&!this.collection.published&&this.collection.publishId},isPublishedOrImported(){var e;return(e=this.collection)==null?void 0:e.publishId},outputResults(){return!this.items||this.items.length==0?[]:this.items.slice(0,this.loadAmount)},nonOwnerUsersSt(){return this.textTruncate(this.collectionNonOwnerUsers.map(e=>e.username).join(", "),20)},collectionNonOwnerUsers(){return this.perms?this.perms.filter(e=>e.permission!="owner"):[]},pathTreeItems(){return this.pathTree?this.pathTree:[]},parentOptions(){return this.parents?this.parents.filter(e=>e.type=="col"):[]},collectionIsPinned(){return!this.collection||!this.collection.users?[]:this.collection.users.filter(e=>e.userId==this.currentUserId&&e.pinned).length>0},isPrivate(){var e;return((e=this.collection)==null?void 0:e.visibility)=="private"},exportList(){return this.items.filter(e=>e.type=="link").map(e=>`${e.url}`).join(`
`)},isOwner(){return this.currentUserPermission=="owner"},editPermission(){return this.isAdminUser||this.currentUserPermission=="owner"||this.currentUserPermission=="editor"},sharedInAccount(){var e,i;return((e=this.collection)==null?void 0:e.visibility)=="shared"&&((i=this.collection)==null?void 0:i.accountId)==this.currentUser.accountId},blocked(){return!(this.viewPermission||this.isOwner||this.sharedInAccount)},inLibrary(){return this.currentUserPermission!=null},viewPermission(){return this.isAdminUser||this.currentUserPermission!=null},isQuickBar(){return this.currentUser&&this.currentUser.quickBarCollectionId==this.collectionId},isEncrypted(){var e;return((e=this.collection)==null?void 0:e.encInfo)!=null},encryptedItemCount(){return this.items?this.items.filter(e=>!!e.encInfo).length:null},decryptedItemCount(){return this.items?this.items.filter(e=>!e.encInfo).length:null}},watch:{},methods:{async organizeItem(e){this.selectedItemId=e,this.showModal("move-collection-modal")},toHostname(e){return new URL(e).hostname},prepareCollectionItems(e){return G(e,50,!1)},async removeCollectionFromLibrary(){await this.confirmModal("Remove from library?",{title:"Confirm",okVariant:"danger",okTitle:"Remove",cancelTitle:"Cancel"})&&this.sendReq("/collection/removeFromUserLibrary",{collectionIds:[this.collectionId]}).then(i=>{i.success?(this.$router.push("/library"),this.RefreshIndexQuick(),this.errorMessage=null):(console.error("Error:",i.message),this.errorMessage=i.message)})},async updateHidden(e){if(!await this.confirmModal(e?"Hide this item?  This item will no longer show up in search results.":"Unhide this item?  This item will show up in search results.",{title:"Confirm",okVariant:"primary",okTitle:e?"Hide":"Unhide",cancelTitle:"Cancel"}))return;const m=await this.sendReq("/item/feedback/value/update",{itemId:this.collectionId,attr:"isHidden",value:e});m.success?(this.loadCollection(),this.errorMessage=null):this.errorMessage=m.message},async removeCollection(){this.isQuickBar&&this.showToast("Quickbar cannot be deleted",{title:"Error",variant:"danger",solid:!0});let e=await this.sendReq("/collection/remove",{collectionId:this.collectionId,deleteItems:this.deleteItems});e.success?(this.$router.push("/library"),this.RefreshIndexQuick(),this.errorMessage=null):this.errorMessage=e.message},async toggleArchive(){if(this.isArchived){if(!await this.confirmModal(`Unarchive Collection: '${this.collection.name}'? `,{title:"Confirm",okVariant:"warning ",okTitle:"Unarchive",cancelTitle:"Cancel",hideHeaderClose:!1}))return}else if(!await this.confirmModal(`Archive Collection: '${this.collection.name}'? `,{title:"Confirm",okVariant:"warning ",okTitle:"Archive",cancelTitle:"Cancel",hideHeaderClose:!1}))return;const e=await this.sendReq("/item/archiveUpdate",{itemId:this.collectionId,value:!this.isArchived});e.success?(this.RefreshIndexQuick(),this.loadCollection(),this.errorMessage=null):this.errorMessage=e.message},async detachFromPublished(){this.loadingItems=!0;const e=await this.sendReq("/client/item/update",{itemId:this.collectionId,data:{publishId:null},encInfo:this.collection.encInfo});e.success?(await this.loadCollection(),await this.loadCollectionItems(),this.RefreshIndexQuick(),this.showToast("Detach Complete",{title:"Success",variant:"success",solid:!0})):this.showToast("Error updating collection"+e.message,{title:"Error",variant:"danger",solid:!0}),this.loadingItems=!1},async updateFromPublished(){this.loadingItems=!0;const e=await this.apiReq("/published/subscription/update",{publishId:this.collection.publishId,collectionId:this.collectionId});e.success?(await this.loadCollection(),await this.loadCollectionItems(),this.RefreshIndexQuick(),this.showToast("Collection updated",{title:"Success",variant:"success",solid:!0})):this.showToast("Error updating collection"+e.message,{title:"Error",variant:"danger",solid:!0}),this.loadingItems=!1},changeOrder(e){console.log(e);let{sourceId:i,targetId:m}=e;this.changeOrderWithIds(i,m),this.saveReordering()},dragStartOrder(e){this.sourceItemOrder=e},changeOrderNoSave(e){if(!this.editPermission)return;const{sourceId:i,targetId:m}=e;this.changeOrderWithIds(i,m)},dropItemOrder(e){this.trytochangeOrder(e),this.saveReordering()},trytochangeOrder(e){e._id!=this.sourceItemOrder._id&&this.editPermission&&this.changeOrderWithIds(this.sourceItemOrder._id,e._id)},closeFileModal(){this.closeModal("add-file-modal"),this.loadCollectionItems()},changeOrderWithIds(e,i){if(e==i||!e||!i)return;const m=this.items.findIndex(y=>y._id==i);if(m==-1)return;const f=this.items.find(y=>y._id==e),b=this.items.filter(y=>y._id!=e);let w=b.slice(0,m),k=b.slice(m);const p=[...w,f,...k];this.items=p},orderItems(){const e=this.items.sort(function(f,b){return we(f,b,"name")}),i=e.filter(f=>f.type!="col"),m=e.filter(f=>f.type=="col");this.items=[...m,...i],this.saveReordering()},moveCollectionsUp(){const e=this.items,i=e.filter(f=>f.type!="col"),m=e.filter(f=>f.type=="col");this.items=[...m,...i],this.saveReordering()},orderItemsByDate(){const e=Ae(this.items,"addedToCollectionAt"),i=e.filter(f=>f.type=="link"),m=e.filter(f=>f.type=="col");this.items=[...m,...i],this.saveReordering()},saveReordering(e=!1){const i=this.items.map(m=>m.collectionRelationId);this.sendReq("/collection/order/update",{collectionId:this.collectionId,itemIds:i.slice().reverse()}).then(()=>{e&&this.loadCollectionItems()})},async gotoPublishSettings(){if(await this.loadPublicProfile(),!this.isOwner||!this.isAdminUser){this.$router.push(`/v/${this.collection.publishId}`);return}this.publicProfile?this.$router.push(`/publishCollection/${this.collectionId}`):this.showModal("public-profile-required-modal")},async loadCollection(){this.loadingCollection=!0;const e=await this.sendReq("/client/collection/infoByUser",{collectionId:this.collectionId,includeUserPermissions:!0,includeFeedback:!0});e.success?(this.collection=e.result,this.updatePageTitle(this.collection.name)):(this.errorMessage=e.message,console.error(e.message)),this.loadingCollection=!1},async loadParents(){const e=await this.sendReq("/client/item/parents/bychildid",{itemId:this.collectionId,userId:this.targetUser?this.targetUser.userId:null});e.success&&(this.parents=e.result)},loadCollectionItems(){this.loadingItems=!0,this.sendReq("/client/collection/listItemsWithInfoByUser",{userId:this.targetUser?this.targetUser.userId:null,collectionId:this.collectionId}).then(e=>{e.success?(this.items=this.prepareCollectionItems(e.result),this.errorMessage=null):this.errorMessage=e.message,this.loadingItems=!1})},async applyAISuggestions(){if(this.aiSuggestionData){this.loadingCollection=!0,this.collection.name=this.aiSuggestionData.name,this.collection.description=this.aiSuggestionData.description,this.collection.tags=this.aiSuggestionData.tags;try{await this.apiReq("/client/item/update",{itemId:this.collectionId,data:{name:this.aiSuggestionData.name,description:this.aiSuggestionData.description,tags:this.aiSuggestionData.tags},encInfo:this.collection.encInfo}),this.closeModal("ai-suggestions-for-collection-modal"),this.RefreshIndexQuick(),await this.loadCollection()}catch(e){this.showToast("Error applying AI suggestions: "+e.message,{variant:"danger"})}this.loadingCollection=!1}},removeItemFromCollection(e){this.getRef("msgBoxConfirm").show(`Remove ${e.name}?`,{title:"Confirm",okVariant:"danger",okTitle:"Remove from collection",cancelTitle:"Cancel",hideHeaderClose:!1}).then(i=>{i&&this.sendReq("/item/remove",{itemId:e._id,collectionId:this.collectionId}).then(()=>{this.loadCollectionItems(),F()})}).catch(i=>{this.showToast("Error while removing item :"+i,{title:"Error",variant:"danger",solid:!0})})},async encryptCollection(){if(await this.confirmModal(`Encrypt Collection: '${this.collection.name}'? `,{title:"Confirm",okVariant:"warning ",okTitle:"Encrypt",cancelTitle:"Cancel",hideHeaderClose:!1}))try{this.uiStore.showLoadingOverlay=!0;const i=await this.sendReq("/client/collection/encrypt",{collectionId:this.collectionId});F(),this.loadEverything()}catch(i){this.showToast("Error while encrypting :"+i,{title:"Error",variant:"danger",solid:!0})}finally{this.uiStore.showLoadingOverlay=!1}},async decryptCollection(){try{if(await this.getRef("msgBoxConfirm").show("Decrypt this collection? This will decrypt all items within it as well.",{title:"Confirm",okVariant:"danger",okTitle:"Decrypt Entire Collection",cancelTitle:"Cancel",hideHeaderClose:!1})){this.uiStore.showLoadingOverlay=!0;const i=await this.sendReq("/client/collection/decrypt",{collectionId:this.collectionId});if(S("RESPONSE",i),i.success)F(),this.loadEverything();else throw new Error(i.message)}}catch(e){this.showToast("Error while decrypting :"+e,{title:"Error",variant:"danger",solid:!0})}finally{this.uiStore.showLoadingOverlay=!1}},async makeMyQuickbar(e){await this.sendReq("/item/quickbar/update",{itemId:e}),await this.RefreshAll(),this.loadCollection()},closeAddSite(e){e&&this.closeModal("add-item-incollection-modal"),this.loadCollectionItems()},closeAddExisting(e){e?this.loadCollectionItems():this.closeModal("add-existing-item-incollection-modal")},closeAddThing(e){e&&this.closeModal("add-thing-incollection-modal"),this.loadCollectionItems()},closeModalsAndReload(e=!0){e&&this.closeAllModals(),this.loadCollectionItems()},closeAddNote(e){e&&this.closeModal("add-note-incollection-modal"),this.loadCollectionItems()},async refreshMeta(){const e=this.items.map(m=>m._id);this.refreshingMeta=!0;const i=await this.sendReq("/client/refreshItemMeta",{itemIds:e,force:!0});i.success?(await this.RefreshAll(),await this.loadEverything(),this.errorMessage=null):this.errorMessage=i.message,this.refreshingMeta=!1},closeAddBulk(e){this.closeModal("add-bulk-modal"),this.loadCollectionItems()},closeEditCollectionInfo(e){this.closeModal("edit-info-modal"),this.loadCollection()},async generateYoutubePlaylistFromLinks(){let e=[];for(let m=0;m<this.items.length;m++){const f=this.items[m];if(f.type=="link"&&f.url.includes("youtube.com")){const w=new URL(f.url).searchParams.get("v");w&&e.push(w)}}let i=`https://www.youtube.com/watch_videos?video_ids=${e.join(",")}`;this.showToast("Youtube playlist link generated",{title:"Success",variant:"success",solid:!0}),window.open(i,"_blank")},async refreshImage(){this.closeModal("col-image-modal"),await this.loadEverything()},async closeAISuggester(){this.loadCollectionItems(),this.closeModal("ai-item-suggestions-modal")},async loadAISuggestion(){var e,i;try{this.loadingAISuggestions=!0;let m=[];this.items.length>5?m=this.items.sort(()=>Math.random()-Math.random()).slice(0,5):m=this.items;const f={name:this.collection.name,description:this.collection.description,tags:this.collection.tags,items:m.map(w=>({url:w.url,name:w.name,description:w.description,tags:w.tags}))},b=await this.apiReq("/usertask/request",{taskname:"collectionInfo",data:f});if(S("AI suggestion",b.result),!((i=(e=b.result)==null?void 0:e.message)!=null&&i.content)){this.showToast("No AI Suggestion found",{variant:"danger",title:"Error",solid:!0});return}this.aiSuggestionData=JSON.parse(b.result.message.content)}catch(m){console.error(m),this.showToast("Error loading AI Suggestion",{variant:"danger",title:"Error",solid:!0})}finally{this.loadingAISuggestions=!1}},async loadPathTree(){const e=await this.sendReq("/item/pathtree",{itemId:this.collectionId,userId:this.targetUser?this.targetUser.userId:null});e.success&&(this.pathTree=[...e.result].reverse())},tryToEdit(){this.editPermission&&this.showModal("edit-info-modal")},async createCollectionFinished(e){if(e)this.closeModal("new-collection-modal"),this.$router.push(`/collection/${e}`);else return},async loadPermissions(){var m,f;const e=await this.sendReq("/item/permissions/list",{itemId:this.collectionId});if(!e.success)return;S("LOAD PERM",e),this.perms=e.result||[],this.owner=this.perms.find(b=>b.permission=="owner");const i=this.perms.find(b=>b.userId==this.currentUserId);S("CurrentUser Permission data",i),this.currentUserPermission=i==null?void 0:i.permission,!this.currentUserPermission&&((f=(m=this.owner)==null?void 0:m.user)==null?void 0:f.type)=="restricted"&&this.isAdminUser&&(this.targetUser=this.owner)},async aiDiscuss(){let e={_id:this.collectionId,type:"collection",name:this.collection.name,description:this.collection.description,items:this.items.map(i=>({id:i._id,url:i.url,type:i.type,name:i.name,description:i.description}))};Le({type:"collection",collectionId:this.collectionId,data:e})},async editBannerImage(){this.editPermission?this.showModal("col-image-modal"):this.showToast("You don't have permission to edit this collection",{title:"Error",variant:"danger",solid:!0})},async loadEverything(){this.collection=null,this.collectionId=this.$route.params.collectionId,S("Loading everything",this.collectionId),this.loadCollection(),this.loadPathTree(),this.loadParents(),await this.loadPermissions(),this.RefreshUsers(!1),Fe(),this.loadCollectionItems(),this.$route.query.editBanner&&this.showModal("col-image-modal")}},created(){this.loadEverything(),this.logNewVisitForItem(this.collectionId)}}),ui={class:"my-2"},ci={class:"my-2"},hi={class:"alert alert-danger text-center danger-color"},pi={class:"larger"},fi={class:"mt-3"},gi={class:"divfit"},vi={class:"mt-5 d-flex justify-content-between"},Ii={class:"d-flex flex-gap-1 flex-wrap flex-column"},bi={class:"d-flex mt-3 flex-wrap flex-column"},yi={class:"modal-body"},ki={key:0,class:"mb-4"},Ci={key:1,class:"mb-2"},wi={class:"modal-body"},Ai={class:"text-center"},Pi={class:"mt-4 text-center"},Ti={key:0,class:"mt-2"},Mi={class:"my-2"},Ui={class:"modal-body"},$i={class:"text-center"},Di={key:0,class:"my-4"},Si={class:"text-muted small ms-2"},Ri={key:0,class:"divfit ms-2"},Ei={role:"button",class:"border pill px-2 hoverrow my-1 divfit"},Oi={class:"mb-4 d-flex flex-gap-1"},Li={class:"text-muted"},Vi={class:"mt-2"},zi=["onDragstart","onDrop"],Fi={class:"text-center"},qi={class:"alert alert-info"},Ni={key:0},Hi={class:"mb-1 container-fluid"},Bi={key:0,class:"container-fluid mt-3 tsFadeInAnimation"},Qi={key:1},ji={class:"container-fluid"},Yi={class:"flexcontainer"},Wi={class:"d-flex flex-column w-100"},Gi={class:"d-flex justify-content-between w-100"},Ji={class:"d-flex flex-gap-sm align-items-start justify-content-end"},Ki={key:0,class:"small py-2 px-1"},Xi={key:0,class:"text-muted mb-2"},Zi={class:"d-flex small align-items-center flex-wrap mt-2 flex-gap-1"},_i={key:2,class:"small",title:`Quick Bar will show up at the top of your home search page\r
                    `},xi={key:4,class:"rounded small px-1 text-muted fillrow border",role:"button",title:"Owner of this collection"},et={key:5,class:"rounded small px-1 text-muted fillrow border",title:"Your permission level"},it={key:0,title:"Owner of this collection",class:"rounded small px-1 text-muted fillrow border"},tt={key:1,class:"rounded small px-1 text-muted fillrow border",role:"button"},ot=["title"],st={key:1,class:"text-truncate rounded small px-1 text-muted fillrow border"},lt=["role"],nt={key:10},rt={key:12,class:""},dt={key:13,role:"button",class:"hoverrow larger rounded px-1"},at={key:2,class:"d-flex flex-wrap flex-gap-sm xsmall mt-3"},mt={key:0,class:"py-2 border-bottom"},ut={class:"d-flex flex-wrap justify-content-between my-1"},ct={class:"d-flex align-items-center flex-wrap flex-gap-sm"},ht={key:0,class:"small py-2 px-1"},pt={style:{"font-size":"large"}},ft={key:1,class:"d-flex flex-wrap align-items-center"},gt={key:0,class:"me-1"},vt=["title"],It={class:"ms-auto"},bt={class:"container-fluid-max2k nopadsm pb-5 mt-3"},yt={key:2},kt={key:0},Ct={key:0},wt={key:1},At={key:1,class:"m-3"};function Pt(e,i,m,f,b,w){var Q,j;const k=h("AddItemDefault"),p=h("b-modal"),y=h("BuilderItemList"),d=h("b-icon"),M=h("b-form-checkbox"),g=h("b-button"),U=h("b-form-input"),P=h("b-form-group"),T=h("b-spinner"),N=h("AddItem"),K=h("CreateCollection"),X=h("ItemPermissionEditor"),Z=h("UploadItemImage"),_=h("AddItemFromLibrary"),x=h("CreateOrEditNote"),ee=h("EditCollectionInfo"),ie=h("OrganizeItem"),te=h("EditInCollectionDetails"),oe=h("ItemImage"),A=h("b-dropdown-item"),O=h("b-dropdown-divider"),H=h("b-dropdown"),se=h("TIFeedbackInfo"),le=h("TIPinToHome"),L=h("router-link"),ne=h("b-badge"),re=h("b-link"),de=h("TIcon"),ae=h("TIListViewOptions"),me=h("ItemList"),B=h("b-alert"),C=W("b-modal"),z=W("b-popover");return o(),c("div",null,[t(p,{lazy:"true",id:"add-file-incollection-modal",title:"Add Item","hide-footer":"",size:"lg","no-close-on-esc":"","no-close-on-backdrop":""},{default:l(()=>[e.collectionId?(o(),u(k,{key:0,itemType:"thing",itemSubType:"file_group",onClose:e.closeFileModal,collectionIds:[e.collectionId]},null,8,["onClose","collectionIds"])):n("",!0)]),_:1}),t(p,{lazy:"true",id:"ai-item-suggestions-modal",title:"Creating with AI","hide-footer":"",size:"lg"},{default:l(()=>[s("div",ui,[t(y,{parentCollectionId:e.collectionId,onUpdate:e.closeAISuggester},null,8,["parentCollectionId","onUpdate"])])]),_:1}),t(p,{lazy:"true",id:"delete-collection-modal",title:"Delete Collection?","hide-footer":"",size:"md",variant:"danger","ok-text":"Delete Collection"},{default:l(()=>[s("div",ci,[s("div",hi,[s("div",pi,[t(d,{icon:"exclamation-triangle-fill",class:"me-1"}),i[39]||(i[39]=a(" You are about to delete this collection. "))]),s("div",fi,[s("div",gi,[t(M,{modelValue:e.deleteItems,"onUpdate:modelValue":i[0]||(i[0]=r=>e.deleteItems=r)},{default:l(()=>i[40]||(i[40]=[a(" Also delete collection items? ")])),_:1},8,["modelValue"])])])]),s("div",vi,[t(g,{onClick:i[1]||(i[1]=r=>e.closeModal("delete-collection-modal"))},{default:l(()=>i[41]||(i[41]=[a("Cancel")])),_:1}),t(g,{onClick:e.removeCollection,variant:"danger"},{default:l(()=>[a(" Delete Collection "+v(e.deleteItems?"and Items":"only"),1)]),_:1},8,["onClick"])])])]),_:1}),t(p,{lazy:"true",id:"advanced-options-modal",title:"Advanced Options","hide-footer":"",size:"md","no-close-on-esc":"","no-close-on-backdrop":""},{default:l(()=>[s("div",Ii,[!e.isPublishedOrImported&&e.editPermission&&e.isAdminUser&&e.encryptionEnabled?(o(),u(g,{key:0,class:"",onClick:i[2]||(i[2]=r=>e.encryptCollection())},{default:l(()=>[t(d,{icon:"lock"}),i[42]||(i[42]=a(" Encrypt "))]),_:1})):n("",!0),e.editPermission&&e.isAdminUser&&e.encryptionEnabled?(o(),u(g,{key:1,class:"",onClick:i[3]||(i[3]=r=>e.decryptCollection())},{default:l(()=>[t(d,{icon:"unlock"}),i[43]||(i[43]=a(" Decrypt "))]),_:1})):n("",!0),e.isImported&&e.isAdminUser?(o(),u(g,{key:2,class:"",onClick:i[4]||(i[4]=r=>e.updateFromPublished())},{default:l(()=>[t(d,{icon:"cloud-arrow-down"}),i[44]||(i[44]=a(" Update from Source"))]),_:1})):n("",!0),e.isAdminUser?(o(),u(g,{key:3,class:"",onClick:i[5]||(i[5]=r=>e.generateYoutubePlaylistFromLinks())},{default:l(()=>[t(d,{icon:"youtube"}),i[45]||(i[45]=a(" Create Youtube Playlist (only works with YT videos) "))]),_:1})):n("",!0),e.editPermission&&!e.isQuickBar?(o(),u(g,{key:4,class:"",onClick:i[6]||(i[6]=r=>e.makeMyQuickbar(e.collectionId))},{default:l(()=>[t(d,{icon:"lightning"}),i[46]||(i[46]=a(" Make My Quick Bar "))]),_:1})):n("",!0),e.isImported&&e.isAdminUser?(o(),u(g,{key:5,class:"",onClick:i[7]||(i[7]=r=>e.detachFromPublished())},{default:l(()=>[t(d,{icon:"cloud-arrow-down"}),i[47]||(i[47]=a(" Detach from Source"))]),_:1})):n("",!0),e.editPermission?I((o(),u(g,{key:6,class:""},{default:l(()=>[t(d,{icon:"arrow-clockwise"}),i[48]||(i[48]=a(" Refresh Metadata for Items "))]),_:1})),[[C,void 0,void 0,{"refreshMeta-modal":!0}]]):n("",!0),e.developerMode?I((o(),u(g,{key:7},{default:l(()=>[t(d,{icon:"code"}),i[49]||(i[49]=a(" Raw Info "))]),_:1})),[[C,void 0,void 0,{"dev-details-modal":!0}]]):n("",!0),e.isAdminUser&&e.inLibrary?(o(),u(g,{key:8,class:"",onClick:i[8]||(i[8]=r=>e.updateHidden(!e.isHidden))},{default:l(()=>[t(d,{icon:"eye-slash"}),a(" "+v(e.isHidden?"Unhide":"Hide"),1)]),_:1})):n("",!0)]),i[52]||(i[52]=s("div",{class:"mt-4 larger"},"Publishing Options",-1)),s("div",bi,[e.isAdminUser&&e.inLibrary?I((o(),u(g,{key:0,class:""},{default:l(()=>[t(d,{icon:"calendar"}),i[50]||(i[50]=a(" Change Publishing Availablity"))]),_:1})),[[C,void 0,void 0,{"publishingOptions-modal":!0}]]):n("",!0),i[51]||(i[51]=s("div",{class:"text-muted small mb-3"}," Change the dates when items are available to the public ",-1))])]),_:1}),t(p,{lazy:"true",id:"publishingOptions-modal",title:"Change Publishing Availablity","hide-footer":"",size:"lg","no-close-on-esc":"","no-close-on-backdrop":""},{default:l(()=>[s("div",null,[i[53]||(i[53]=s("div",null," Change all availability dates for items in this collection ",-1)),i[54]||(i[54]=s("div",{class:"text-muted mt-3 mb-1"},"First Date Available",-1)),t(P,{class:"form-group",description:" Start Date"},{default:l(()=>[t(U,{modelValue:e.availConfig.startDate,"onUpdate:modelValue":i[9]||(i[9]=r=>e.availConfig.startDate=r),type:"datetime-local"},null,8,["modelValue"])]),_:1}),i[55]||(i[55]=s("div",{class:"text-muted mt-3 mb-1"},"Increment",-1)),t(P,{class:"form-group",description:"How much to change consecutive items availablilty dates "},{default:l(()=>[t(U,{modelValue:e.availConfig.inc,"onUpdate:modelValue":i[10]||(i[10]=r=>e.availConfig.inc=r),type:"number"},null,8,["modelValue"])]),_:1}),i[56]||(i[56]=s("div",{class:"text-muted mt-3 mb-1"},"Variance in hours",-1)),t(P,{class:"form-group",description:"+/- X in minutes. 0 to release at exact same time every days"},{default:l(()=>[t(U,{modelValue:e.availConfig.varMin,"onUpdate:modelValue":i[11]||(i[11]=r=>e.availConfig.varMin=r),type:"number"},null,8,["modelValue"])]),_:1})])]),_:1}),t(p,{lazy:"true",id:"shareoptions-modal",title:"Share Options","hide-footer":""},{default:l(()=>[s("div",yi,[e.editPermission||e.isAdminUser?(o(),c("div",ki,[s("div",{class:"larger linklike",onClick:i[12]||(i[12]=r=>{e.showModal("permissions-modal"),e.closeModal("shareoptions-modal")}),role:"button",title:""},[t(d,{icon:"people"}),i[57]||(i[57]=a(" Permissions "))]),i[58]||(i[58]=s("div",{class:"text-muted small"},[a(" Modify access for "),s("b",null,"account members")],-1))])):n("",!0),e.isOwner&&e.isAdminUser&&e.publishable?(o(),c("div",Ci,[s("div",{class:"larger linklike",onClick:i[13]||(i[13]=r=>e.gotoPublishSettings()),role:"button",title:""},[t(d,{icon:"cloud-upload"}),i[59]||(i[59]=a(" Publish "))]),i[60]||(i[60]=s("div",{class:"text-muted small"},[a(" Make available to "),s("b",null,"public or friends")],-1))])):n("",!0)])]),_:1}),t(p,{id:"ai-suggestions-for-collection-modal",title:"AI Suggestions","hide-footer":""},{default:l(()=>[s("div",wi,[s("div",Ai,[t(g,{variant:"primary",disabled:e.loadingAISuggestions,onClick:i[14]||(i[14]=r=>e.loadAISuggestion())},{default:l(()=>i[61]||(i[61]=[s("span",{class:"me-1"},"Get Suggestions ",-1)])),_:1},8,["disabled"])]),s("div",Pi,[e.loadingAISuggestions?(o(),u(T,{key:0,class:"spinnerxl",label:"Loading..."})):n("",!0)]),e.aiSuggestionData?(o(),c("div",Ti,[s("div",null,[t(d,{icon:"info-circle"}),i[62]||(i[62]=a(" AI Suggestions for this collection "))]),s("div",Mi,[i[63]||(i[63]=s("div",{class:"mb-1 text-muted"},"Name:",-1)),s("div",null,v(e.aiSuggestionData.name),1),i[64]||(i[64]=s("div",{class:"mb-1 text-muted"},"Description:",-1)),s("div",null,v(e.aiSuggestionData.description),1),i[65]||(i[65]=s("div",{class:"mb-1 text-muted"},"Tags:",-1)),s("div",null,v(e.aiSuggestionData.tags.join(", ")),1)]),t(g,{class:"mt-2",onClick:i[15]||(i[15]=r=>e.applyAISuggestions())},{default:l(()=>i[66]||(i[66]=[a(" Apply")])),_:1})])):n("",!0)])]),_:1}),t(p,{lazy:"true",id:"public-profile-required-modal",title:"Public Profile Required","hide-footer":""},{default:l(()=>[s("div",Ui,[i[68]||(i[68]=s("div",{class:"text-muted"}," A public profile is required to publish a collection. Please create a public profile first. ",-1)),s("div",$i,[t(g,{class:"mt-4",variant:"primary",onClick:i[16]||(i[16]=r=>{e.closeModal("public-profile-required-modal"),e.$router.push("/settings/publicprofile")})},{default:l(()=>i[67]||(i[67]=[a(" Create Public Profile ")])),_:1})])])]),_:1}),t(p,{lazy:"true",id:"add-thing-incollection-modal",title:"Add Other","hide-footer":"",size:"lg","no-close-on-esc":"","no-close-on-backdrop":""},{default:l(()=>[t(N,{itemType:"thing",onClose:e.closeAddThing,collectionIds:[e.collectionId]},null,8,["onClose","collectionIds"])]),_:1}),t(p,{lazy:"true",id:"new-collection-modal",title:"New Collection","hide-footer":"","no-close-on-esc":"","no-close-on-backdrop":""},{default:l(()=>{var r;return[e.collection?(o(),u(K,{key:0,parentCollectionId:e.collectionId,onClose:e.createCollectionFinished,defaultVisibility:e.collection.visibility,targetUserId:e.isAdminUser?(r=e.targetUser)==null?void 0:r.userId:null},null,8,["parentCollectionId","onClose","defaultVisibility","targetUserId"])):n("",!0)]}),_:1}),t(p,{lazy:"true",id:"permissions-modal",title:"Library Membership and Permissions",size:"lg","hide-footer":"","no-close-on-esc":"","no-close-on-backdrop":""},{default:l(()=>{var r;return[t(X,{itemId:e.collectionId,onUpdate:e.loadPermissions},null,8,["itemId","onUpdate"]),((r=e.collection)==null?void 0:r.visibility)=="shared"?(o(),c("div",Di,[s("div",Si,[i[70]||(i[70]=a(" This collection is visible to all account family members. ")),e.editPermission?(o(),c("div",Ri,[I((o(),c("div",Ei,[t(d,{icon:"pencil"}),i[69]||(i[69]=a(" Change Visibility "))])),[[C,void 0,void 0,{"edit-info-modal":!0}]])])):n("",!0)])])):n("",!0)]}),_:1}),t(p,{lazy:"true",id:"dev-details-modal",title:"Raw Data",size:"lg","hide-footer":""},{default:l(()=>[s("pre",null,v(e.collection),1)]),_:1}),t(p,{lazy:"true",id:"col-image-modal",title:"Collection Banner Image",size:"lg","hide-footer":"","no-close-on-esc":"","no-close-on-backdrop":""},{default:l(()=>[t(Z,{itemId:e.collectionId,editPermission:e.editPermission,onClose:i[17]||(i[17]=r=>e.refreshImage())},null,8,["itemId","editPermission"])]),_:1}),t(p,{lazy:"true",id:"add-item-incollection-modal",title:"Add Item","hide-footer":"",size:"lg","no-close-on-esc":"","no-close-on-backdrop":""},{default:l(()=>[t(N,{onClose:e.closeAddSite,collectionIds:[e.collectionId],"disable-search":!0},null,8,["onClose","collectionIds"])]),_:1}),t(p,{lazy:"true",id:"add-existing-item-incollection-modal",title:"Add Existing Item to Collection","hide-footer":"",size:"lg","no-close-on-esc":"","no-close-on-backdrop":""},{default:l(()=>[t(_,{onSelectExistingItem:e.loadCollectionItems,onClose:e.closeAddExisting,collectionIds:[e.collectionId]},null,8,["onSelectExistingItem","onClose","collectionIds"])]),_:1}),t(p,{lazy:"true",id:"add-note-incollection-modal",title:"Add Note","hide-footer":"",size:"lg","no-close-on-esc":"","no-close-on-backdrop":""},{default:l(()=>[t(x,{onClose:e.closeAddNote,parentCollectionId:e.collectionId},null,8,["onClose","parentCollectionId"])]),_:1}),t(p,{lazy:"true",id:"edit-info-modal",title:"Edit Collection Info","hide-footer":"",size:"lg"},{default:l(()=>[t(ee,{collectionId:e.collectionId,onClose:e.closeEditCollectionInfo},null,8,["collectionId","onClose"])]),_:1}),t(p,{lazy:"true",id:"reorder-modal",size:"lg",title:"Sort Items","ok-only":""},{default:l(()=>[s("div",Oi,[e.editPermission?I((o(),u(g,{key:0,variant:"outline-secondary",onClick:i[18]||(i[18]=r=>e.moveCollectionsUp())},{default:l(()=>[t(d,{icon:"sort-alpha-down"}),i[71]||(i[71]=a(" Move Collections to top "))]),_:1})),[[z,"Sort items by type and name ",void 0,{hover:!0,right:!0}]]):n("",!0),e.editPermission?I((o(),u(g,{key:1,variant:"outline-secondary",onClick:i[19]||(i[19]=r=>e.orderItems())},{default:l(()=>[t(d,{icon:"sort-alpha-down"}),i[72]||(i[72]=a(" Order by type and name "))]),_:1})),[[z,"Sort items by type and name ",void 0,{hover:!0,right:!0}]]):n("",!0),e.editPermission?I((o(),u(g,{key:2,variant:"outline-secondary",onClick:i[20]||(i[20]=r=>e.orderItemsByDate())},{default:l(()=>[t(d,{icon:"sort-numeric-down"}),i[73]||(i[73]=a(" Order by time added "))]),_:1})),[[z,"Sort items by when added ",void 0,{hover:!0,right:!0}]]):n("",!0)]),s("div",Li,[t(d,{icon:"hand-index"}),i[74]||(i[74]=a(" Drag and drop items to reorder them. "))]),i[75]||(i[75]=s("hr",null,null,-1)),s("div",Vi,[(o(!0),c(D,null,q(e.items,(r,$)=>(o(),c("div",{key:$,draggable:!0,onDragstart:ue=>e.dragStartOrder(r),onDrop:ue=>e.dropItemOrder(r)},[s("div",{class:"m-1 my-2 handle d-flex align-items-center",onDragover:i[21]||(i[21]=Se(()=>{},["prevent"]))},[t(d,{icon:"grip-vertical"}),s("div",null,v(r.name),1)],32)],40,zi))),128))])]),_:1}),t(p,{lazy:"true",id:"move-collection-modal",size:"lg",title:"Move/Organize Collection","ok-only":"","ok-title":"Done",onOk:i[23]||(i[23]=r=>e.loadEverything())},{default:l(()=>[t(ie,{onClose:i[22]||(i[22]=r=>e.closeModal("move-collection-modal")),itemId:e.selectedItemId,item:e.collection},null,8,["itemId","item"])]),_:1}),t(p,{lazy:"true",id:"in-collection-details-modal",title:"Customize item details within collection",size:"lg","hide-footer":"","no-close-on-esc":"","no-close-on-backdrop":""},{default:l(()=>[e.editItemId?(o(),u(te,{key:0,itemId:e.editItemId,collectionId:e.collectionId,encInfo:e.collection.encInfo,onClose:i[24]||(i[24]=r=>{e.closeModal("in-collection-details-modal"),e.loadCollectionItems()})},null,8,["itemId","collectionId","encInfo"])):n("",!0)]),_:1}),t(p,{lazy:"true",id:"refreshMeta-modal",title:"Refresh Metadata",size:"lg","hide-footer":"","no-close-on-esc":"","no-close-on-backdrop":""},{default:l(()=>[s("div",Fi,[s("div",qi,[t(d,{icon:"info-circle"}),i[76]||(i[76]=a(" Refreshing metadata may take a while. Larger collections will take longer. "))]),t(g,{variant:"primary",onClick:e.refreshMeta,disabled:e.refreshingMeta},{default:l(()=>[e.refreshingMeta?(o(),u(T,{key:1,label:"Loading...",variant:"primary"})):(o(),c("div",Ni,[t(d,{icon:"arrow-clockwise"}),i[77]||(i[77]=a(" Refresh "))]))]),_:1},8,["onClick","disabled"])])]),_:1}),t(p,{lazy:"true",id:"export-list-modal",title:"Collection Link List",size:"lg","hide-footer":""},{default:l(()=>[s("pre",null,v(e.exportList),1)]),_:1}),s("div",Hi,[s("button",{class:"btn btn-link wb-color p-0 my-1",onClick:i[25]||(i[25]=r=>e.$router.go(-1))},[t(d,{icon:"chevron-left"})])]),!e.collection&&e.loadingCollection?(o(),c("div",Bi,i[78]||(i[78]=[De('<div class="flexcontainer" data-v-d0325acd><div data-v-d0325acd><div class="colImage rounded animated-background-ph rounded" data-v-d0325acd></div></div><div class="d-flex flex-column flex-gap-sm w-100" data-v-d0325acd><div class="d-flex w-50 animated-background-ph py-2 rounded" data-v-d0325acd></div><div class="d-flex w-50 animated-background-ph py-2 rounded" data-v-d0325acd></div><div class="d-flex w-50 animated-background-ph py-2 rounded" data-v-d0325acd></div></div></div>',1)]))):e.collection&&!e.blocked?(o(),c("div",Qi,[s("div",ji,[s("div",Yi,[s("div",{onClick:i[26]||(i[26]=(...r)=>e.editBannerImage&&e.editBannerImage(...r)),role:"button",class:"colImageContainer"},[t(oe,{class:"imgwithdefault rounded colImage",item:e.collection,alt:""},null,8,["item"])]),s("div",Wi,[e.isMobile?n("",!0):(o(),c("div",{key:0,role:"button",onClick:i[27]||(i[27]=r=>e.tryToEdit()),class:Y(["text-muted",e.isMobile?"small":"larger"])},[t(d,{icon:"collection"}),i[79]||(i[79]=a(" Collection "))],2)),s("div",Gi,[s("div",{class:Y([(e.isMobile,"h2"),""]),role:"button",onClick:i[28]||(i[28]=r=>e.tryToEdit())},v(e.collection.name),3),s("div",Ji,[e.aiChatEnabled?(o(),u(g,{key:0,title:"AI",variant:"link",class:"p-1",onClick:i[29]||(i[29]=r=>e.aiDiscuss())},{default:l(()=>[t(d,{icon:"robot"})]),_:1})):n("",!0),e.isAdminUser||e.editPermission||e.inLibrary?(o(),u(H,{key:1,variant:"link",toggleClass:"p-1 me-1","data-test-id":"collectionEditMenu","no-caret":""},{"button-content":l(()=>[s("div",null,[t(d,{icon:"three-dots-vertical"})])]),default:l(()=>[!e.isAdminUser&&!e.editPermission?(o(),c("div",Ki," You don't have permission to edit this collection ")):n("",!0),e.editPermission?I((o(),u(A,{key:1,class:""},{default:l(()=>[t(d,{icon:"pencil"}),i[80]||(i[80]=a(" Edit"))]),_:1})),[[C,void 0,void 0,{"edit-info-modal":!0}]]):n("",!0),e.viewPermission&&e.isAdminUser?(o(),u(A,{key:2,class:"",onClick:i[30]||(i[30]=r=>e.organizeItem(e.collectionId))},{default:l(()=>[t(d,{icon:"ui-radios-grid"}),i[81]||(i[81]=a(" Move/Organize"))]),_:1})):n("",!0),e.editPermission?I((o(),u(A,{key:3,class:""},{default:l(()=>[t(d,{icon:"sort-down"}),i[82]||(i[82]=a(" Sort "))]),_:1})),[[C,void 0,void 0,{"reorder-modal":!0}]]):n("",!0),e.editPermission?(o(),u(O,{key:4})):n("",!0),e.isOwner&&e.isAdminUser&&e.publishable?(o(),u(A,{key:5,class:"",onClick:e.gotoPublishSettings,title:`Only admin users with owner permission can publish a collection.  \r
                          Also, published collections which are subscriptions cannot be published.`},{default:l(()=>[t(d,{icon:"cloud-upload"}),a(" Publish "+v(e.isPublished?"Update":""),1)]),_:1},8,["onClick"])):n("",!0),e.editPermission?I((o(),u(A,{key:6,class:""},{default:l(()=>[t(d,{icon:"people"}),i[83]||(i[83]=a(" Permissions "))]),_:1})),[[C,void 0,void 0,{"permissions-modal":!0}]]):n("",!0),e.isAdminUser?I((o(),u(A,{key:7,class:""},{default:l(()=>[t(d,{icon:"gear"}),i[84]||(i[84]=a(" Advanced Options"))]),_:1})),[[C,void 0,void 0,{"advanced-options-modal":!0}]]):n("",!0),!e.isQuickBar&&e.editPermission&&e.inLibrary?(o(),u(A,{key:8,class:"",varient:"outline-secondary",title:"Archive or unarchive collection",onClick:i[31]||(i[31]=r=>e.toggleArchive())},{default:l(()=>[e.isArchived?(o(),u(d,{key:1,icon:"archive"})):(o(),u(d,{key:0,icon:"archive"})),a(" "+v(e.isArchived?"Unarchive":"Archive"),1)]),_:1})):n("",!0),!e.isQuickBar&&(e.isAdminUser||e.isOwner)?I((o(),u(A,{key:9,class:""},{default:l(()=>[t(d,{icon:"trash"}),i[85]||(i[85]=a(" Delete "))]),_:1})),[[C,void 0,void 0,{"delete-collection-modal":!0}]]):n("",!0)]),_:1})):n("",!0)])]),e.collection.description?(o(),c("div",{key:1,role:"button",onClick:i[32]||(i[32]=r=>e.tryToEdit())},[e.isMobile?n("",!0):(o(),c("div",Xi,v(e.collection.description),1))])):n("",!0),s("div",Zi,[e.inLibrary?(o(),u(se,{key:0,outerClass:"small",value:e.collection,"onUpdate:value":i[33]||(i[33]=r=>e.collection=r)},null,8,["value"])):n("",!0),e.viewPermission?(o(),u(le,{key:1,itemId:e.collectionId},null,8,["itemId"])):n("",!0),e.isQuickBar?(o(),c("div",_i,[t(d,{icon:"lightning"})])):n("",!0),e.isImported?(o(),u(L,{key:3,class:"p-1 default-text-color",variant:"info",to:`/v/${e.collection.publishId}`,title:"Imported Collection. Click to view published version"},{default:l(()=>[t(d,{icon:"cloud"})]),_:1},8,["to"])):n("",!0),e.isOwner?I((o(),c("div",xi,i[86]||(i[86]=[a(" owner ")]))),[[C,void 0,void 0,{"permissions-modal":!0}]]):e.currentUserPermission?(o(),c("div",et,v(e.currentUserPermission),1)):n("",!0),!e.isOwner&&e.owner?(o(),c(D,{key:6},[!e.isAdminUser||e.owner.user.type=="admin"?(o(),c("div",it," owned by "+v(e.owner.username),1)):I((o(),c("div",tt,[a(" owned by "+v(e.owner.username),1)])),[[C,void 0,void 0,{"permissions-modal":!0}]])],64)):n("",!0),e.collectionNonOwnerUsers.length>0?(o(),c(D,{key:7},[e.editPermission?I((o(),c("div",{key:0,title:`Available in libraries of ${e.collectionNonOwnerUsers.map(r=>r.username).join(", ")} and the owner`,role:"button",class:"text-truncate rounded small px-1 text-muted fillrow border"},[a(v(e.collectionNonOwnerUsers.length+1)+" ",1),t(d,{icon:"person-plus-fill"})],8,ot)),[[C,void 0,void 0,{"permissions-modal":!0}]]):(o(),c("div",st,[a(v(e.collectionNonOwnerUsers.length+1)+" ",1),t(d,{icon:"person-plus-fill"})]))],64)):n("",!0),e.isPrivate?n("",!0):(o(),c("div",{key:8,class:"px-1 border fillrow rounded py-0 small text-muted",role:e.editPermission?"button":"",onClick:i[34]||(i[34]=r=>e.tryToEdit()),title:`This collection can be seen by all family members\r
                    `},[t(d,{icon:"eye"}),i[87]||(i[87]=a()),t(d,{icon:"people"})],8,lt)),e.isArchived?(o(),u(ne,{key:9,role:"button",class:"text-muted",variant:"warning",title:"This collection is archived",onClick:i[35]||(i[35]=r=>e.toggleArchive())},{default:l(()=>i[88]||(i[88]=[a(" Archived ")])),_:1})):n("",!0),e.inLibrary?n("",!0):(o(),c("div",nt,[t(d,{icon:"exclamation-triangle-fill"}),i[89]||(i[89]=a(" Not in your library "))])),e.isHidden&&e.inLibrary?(o(),c("div",{key:11,role:"button",class:"rounded border px-2 fillrow warning3-color",title:"This collection is hidden. Click to unhide",onClick:i[36]||(i[36]=r=>e.updateHidden(!1))},[t(d,{icon:"eye-slash"}),i[90]||(i[90]=a(" Hidden from your library "))])):n("",!0),e.isPublished?(o(),c("div",rt,[s("div",{role:"button",class:"border rounded fillrow hoverrow px-1 divfit small",onClick:i[37]||(i[37]=(...r)=>e.gotoPublishSettings&&e.gotoPublishSettings(...r)),title:"This collection has been published. Click to view published version."},[t(d,{icon:"cloud-upload-fill"}),i[91]||(i[91]=a(" Published "))])])):n("",!0),e.editPermission||e.isAdminUser?I((o(),c("div",dt,[t(d,{icon:"share"})])),[[C,void 0,void 0,{"shareoptions-modal":!0}]]):n("",!0)]),(Q=e.collection)!=null&&Q.tags&&((j=e.collection)==null?void 0:j.tags.length)>0?(o(),c("div",at,[(o(!0),c(D,null,q(e.collection.tags,(r,$)=>(o(),c("div",{key:$,class:""},[r?(o(),u(re,{key:0,class:"rounded fillrow px-1 py-0 text-muted",to:`/?type=tags&value=${r}`},{default:l(()=>[a(v(r),1)]),_:2},1032,["to"])):n("",!0)]))),128))])):n("",!0)])]),e.collection?(o(),c("div",mt,[s("div",ut,[s("div",ct,[e.editPermission?(o(),u(H,{key:0,"no-caret":"",variant:"primary","data-test-id":"collectionAddMenu",toggleClass:"p-1  hoverrow circle border px-2 "},{"button-content":l(()=>[s("div",null,[t(d,{icon:"plus-lg"})])]),default:l(()=>[!e.isAdminUser&&!e.editPermission?(o(),c("div",ht," You don't have permission to edit this collection ")):n("",!0),e.editPermission?I((o(),u(A,{key:1,class:"","data-test-id":"optionNewLink"},{default:l(()=>[t(d,{icon:"link"}),i[92]||(i[92]=a(" Link "))]),_:1})),[[C,void 0,void 0,{"add-item-incollection-modal":!0}]]):n("",!0),e.editPermission?I((o(),u(A,{key:2,class:"","data-test-id":"optionNewNote"},{default:l(()=>[t(d,{icon:"journal-text"}),i[93]||(i[93]=a(" Note "))]),_:1})),[[C,void 0,void 0,{"add-note-incollection-modal":!0}]]):n("",!0),I((o(),u(A,{id:"newFileOption"},{default:l(()=>[t(d,{icon:"file"}),i[94]||(i[94]=s("span",{class:"ms-1"},"File / Other",-1))]),_:1})),[[C,void 0,void 0,{"add-file-incollection-modal":!0}]]),e.editPermission?I((o(),u(A,{key:3,class:""},{default:l(()=>[t(d,{icon:"search"}),i[95]||(i[95]=a(" Add from Library "))]),_:1})),[[C,void 0,void 0,{"add-existing-item-incollection-modal":!0}]]):n("",!0),e.editPermission?(o(),u(O,{key:4})):n("",!0),e.editPermission?I((o(),u(A,{key:5,class:"","data-test-id":"optionNewCollection"},{default:l(()=>[t(d,{icon:"collection"}),i[96]||(i[96]=a(" Collection "))]),_:1})),[[C,void 0,void 0,{"new-collection-modal":!0}]]):n("",!0),e.editPermission&&e.isAdminUser?(o(),u(O,{key:6})):n("",!0),e.editPermission&&e.isAdminUser?I((o(),u(A,{key:7,class:""},{default:l(()=>[t(d,{icon:"robot"}),i[97]||(i[97]=a(" Create with AI "))]),_:1})),[[C,void 0,void 0,{"ai-item-suggestions-modal":!0}]]):n("",!0)]),_:1})):n("",!0),s("div",null,[e.inLibrary?(o(),u(L,{key:0,to:"/library/collections",class:"d-flex align-items-center flex-gap-xs linklike-bw",title:"My Library (top level)"},{default:l(()=>[t(de,{name:"library",width:16}),s("span",pt,[t(d,{icon:"house-fill"})]),i[98]||(i[98]=s("span",{style:{"font-size":"large"}},"/",-1))]),_:1})):n("",!0),!e.inLibrary&&e.targetUser?(o(),u(L,{key:1,to:`/userLibrary/${e.targetUser.userId}`,class:"fillrow text-muted ms-1 d-flex align-items-center flex-gap-xs rounded border px-2 py-1",title:""},{default:l(()=>[s("span",null,v(e.targetUser.username)+"'s Library",1),i[99]||(i[99]=s("span",{style:{"font-size":"large"}},"/",-1))]),_:1},8,["to"])):n("",!0)]),e.loadingCollection?n("",!0):(o(),c("div",ft,[(o(!0),c(D,null,q(e.pathTreeItems,(r,$)=>(o(),u(L,{key:$,class:"text-muted",to:`/collection/${r.item._id}`},{default:l(()=>[r?(o(),c("span",gt,v(e.textTruncate(r.item.name,e.isMobile?10:15))+" / ",1)):n("",!0)]),_:2},1032,["to"]))),128)),s("div",null,[s("span",{title:e.collection.name},v(e.textTruncate(e.collection.name,25)),9,vt)])]))]),s("div",It,[t(ae)])])])):n("",!0)]),s("div",bt,[t(me,{loading:e.loadingItems,items:e.items,"allow-move-in-list":!0,onUpdate:i[38]||(i[38]=r=>e.loadEverything()),onChangeOrderAndSave:e.changeOrder,onChangeOrderNoSave:e.changeOrderNoSave,parentId:e.collectionId,itemViewOptions:{hideCollectionBadge:!0},loadAmount:e.loadAmount,readonly:!e.editPermission,hideFeedback:!e.inLibrary},{menu:l(r=>[e.editPermission?(o(),c(D,{key:0},[t(O),e.developerMode?(o(),u(A,{key:0,class:"",title:"Override details for viewing within collection",onClick:$=>{e.editItemId=r.item._id,e.showModal("in-collection-details-modal")}},{default:l(()=>[t(d,{icon:"pencil",class:"me-1"}),i[100]||(i[100]=a(" Edit Collection View"))]),_:2},1032,["onClick"])):n("",!0),t(A,{class:"",title:" remove",onClick:$=>e.removeItemFromCollection(r.item)},{default:l(()=>[t(d,{icon:"x",class:"me-1"}),i[101]||(i[101]=a(" Remove from collection "))]),_:2},1032,["onClick"])],64)):n("",!0)]),_:1},8,["loading","items","onChangeOrderAndSave","onChangeOrderNoSave","parentId","loadAmount","readonly","hideFeedback"])])])):(o(),c("div",yt,[!e.loadingItems&&e.blocked?(o(),c("div",kt,[t(B,{class:"mx-4",variant:"danger","model-value":!0},{default:l(()=>[i[104]||(i[104]=s("div",{class:"h4 alert-heading"},"Error :'(",-1)),e.collection?(o(),c("p",Ct,"Permission denied")):(o(),c("div",wt,[i[102]||(i[102]=a(" Sorry about this... an error occurred while loading this collection. ")),i[103]||(i[103]=s("br",null,null,-1)),s("pre",null,v(e.errorMessage),1)]))]),_:1})])):!e.loadingItems&&!e.blocked&&!e.loadingCollection?(o(),c("div",At,[t(B,{class:"mx-4",variant:"danger","model-value":!0},{default:l(()=>i[105]||(i[105]=[s("div",{class:"h4 alert-heading"},"Error :'(",-1),s("div",null," Sorry about this... an error occurred while loading this collection. ",-1)])),_:1})])):n("",!0)]))])}const no=R(mi,[["render",Pt],["__scopeId","data-v-d0325acd"]]);export{no as default};

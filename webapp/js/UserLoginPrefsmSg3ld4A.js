import{U as D}from"./UpdatePinDlIWZ4BD.js";import{U as N,P as C}from"./PluginsCLWZ87nP.js";import{_,a as S,aV as R,am as q,aW as $}from"./components.globalDizx_NTC.js";import{j as d,K as t,z as r,r as i,i as l,Q as n,d as z,k as o,s as g,R as y,L as c,m as P,ac as L}from"./@vueC3Nhqlrl.js";import{P as A}from"./TIIconDefaultB4jiNlod.js";import{P as B}from"./ProfileImageEditorDUcTiiTY.js";import{U as W}from"./UpdatePasswordBsdM44uH.js";import{O as F}from"./OptionsComponentDXUqmzr0.js";import{U as j}from"./UpdateUserInfoD8fGLxSq.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";import"./SelectImageB1vQtVs9.js";const K={data(){return{selectedRepeatOption:"daily",repeatOptions:[{text:"Daily",value:"daily"},{text:"Weekly",value:"weekly"},{text:"One Time",value:"one time"}],startTime:"",endTime:"",selectedDays:[],oneTimeDate:""}}};function Q(e,s,T,E,a,M){const I=i("b-form-select"),u=i("b-form-group"),h=i("b-form-input"),p=i("b-form-checkbox"),b=i("b-form-checkbox-group");return l(),d("div",null,[t(u,{class:"form-group"},{default:r(()=>[t(I,{modelValue:a.selectedRepeatOption,"onUpdate:modelValue":s[0]||(s[0]=m=>a.selectedRepeatOption=m),options:a.repeatOptions},null,8,["modelValue","options"])]),_:1}),t(u,{class:"form-group"},{default:r(()=>[t(h,{type:"time",modelValue:a.startTime,"onUpdate:modelValue":s[1]||(s[1]=m=>a.startTime=m)},null,8,["modelValue"])]),_:1}),t(u,{class:"form-group"},{default:r(()=>[t(h,{type:"time",modelValue:a.endTime,"onUpdate:modelValue":s[2]||(s[2]=m=>a.endTime=m)},null,8,["modelValue"])]),_:1}),t(u,{class:"form-group"},{default:r(()=>[t(b,{modelValue:a.selectedDays,"onUpdate:modelValue":s[3]||(s[3]=m=>a.selectedDays=m)},{default:r(()=>[t(p,{value:"Monday"},{default:r(()=>s[5]||(s[5]=[n("Monday")])),_:1}),t(p,{value:"Tuesday"},{default:r(()=>s[6]||(s[6]=[n("Tuesday")])),_:1}),t(p,{value:"Wednesday"},{default:r(()=>s[7]||(s[7]=[n("Wednesday")])),_:1}),t(p,{value:"Thursday"},{default:r(()=>s[8]||(s[8]=[n("Thursday")])),_:1}),t(p,{value:"Friday"},{default:r(()=>s[9]||(s[9]=[n("Friday")])),_:1}),t(p,{value:"Saturday"},{default:r(()=>s[10]||(s[10]=[n("Saturday")])),_:1}),t(p,{value:"Sunday"},{default:r(()=>s[11]||(s[11]=[n("Sunday")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(u,{class:"form-group"},{default:r(()=>[t(h,{type:"date",modelValue:a.oneTimeDate,"onUpdate:modelValue":s[4]||(s[4]=m=>a.oneTimeDate=m)},null,8,["modelValue"])]),_:1})])}const G=_(K,[["render",Q]]),H=z({name:"ManageUser",mixins:[S],components:{ProfileImage:A,UpdatePin:D,UpdateEmail:N,Plugins:C,UpdatePassword:W,SelectTimeRange:G,ProfileImageEditor:B,OptionsComponent:F,UpdateUserInfo:j},data(){return{userId:null,user:null,userEncStatus:null,options:null,allPlugins:null,userPlugins:null,selectedPluginIds:[],changeUserType:null,errorMessage:null}},mounted(){},computed:{userVerificationNeeded(){return R(this.user)},hasInternalLogin(){return this.user?!this.user.loginType||this.user.loginType=="internal":!1},pluginOptions(){return!this.allPlugins||!this.userPlugins?[]:this.allPlugins.map(s=>({value:s._id,text:s.name}))}},methods:{getPathString:q,deleteUser(){this.sendReq("/user/delete",{userId:this.userId}).then(e=>{e.success?(this.$router.push("/people"),this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)})},updatePlugins(){this.sendReq("/user/plugin/update",{userId:this.userId,pluginIds:this.selectedPluginIds}).then(e=>{e.success?(this.loadUserPlugins(),this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)})},updateUserType(){this.sendReq("/user/userType/update",{userId:this.userId,usertype:this.changeUserType}).then(e=>{e.success?(this.loadUser(),this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)})},async loadUserEncStatus(){const e=await this.apiReq("/client/encryption/status",{userId:this.userId});this.userEncStatus=e.result},enableAll(){this.options==null&&(this.options={}),this.options.whitelistingEnabled=!0,this.options.codeInjectionEnabled=!0,this.updateOptions()},loadUserPlugins(){this.sendReq("/user/plugin/list",{userId:this.userId}).then(e=>{e.success?(this.userPlugins=e.result,this.selectedPluginIds=this.userPlugins.map(s=>s._id),this.loadPlugins(),this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)})},loadPlugins(){this.sendReq("/plugin/list",{}).then(e=>{e.success?(this.allPlugins=e.result,this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)})},updateOptions(){this.sendReq("/user/options/update",{userId:this.userId,options:this.options}).then(e=>{e.success?(this.loadOptions(),this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)})},closeUserInfoUpdate(){this.loadUser(),this.closeModal("editDisplayedNameModal"),$(!0)},loadOptions(){this.sendReq("/user/options/get",{userId:this.userId}).then(e=>{e.success?(this.options=e.result,this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)})},loadUser(){this.sendReq("/user/info",{userId:this.userId}).then(e=>{e.success?(this.user=e.result,this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)})}},created(){this.userId=this.$route.params.userId,this.loadUser(),this.loadOptions(),this.loadUserEncStatus(),this.loadUserPlugins()}}),J={key:0},X={key:0,class:"my-3"},Y={class:"container-fluid-max1200"},Z={key:0},x={class:"d-flex"},ee={class:"my-2 border rounded"},se={class:"d-flex flex-wrap flex-gap-1 mt-3"},te={class:"mt-3"},oe={class:"mt-1"},re={class:"mt-2",role:"button"},ie={class:"mt-1"},le={class:"mt-3"},ne={class:"mt-2"},de={class:"mt-1"},ae={key:0,class:"mt-2"},ue={class:"mt-1"},me={class:"mt-3"},pe={class:"mt-2",role:"button",title:"Update Email"},fe={class:"mt-1"},ge={key:0,class:"small danger-color"},ye={key:1,class:"small success-color"},he={key:0,class:"my-2"},Ue={class:"mt-3"},ve={class:"btn btn-outline-primary",role:"button"},ce={class:"mt-3"},Ie={class:"btn btn-outline-primary",role:"button"},be={class:"mt-5"},Pe={class:"btn btn-danger",role:"button"};function _e(e,s,T,E,a,M){const I=i("UpdateUserInfo"),u=i("b-modal"),h=i("b-form-select-option"),p=i("b-form-select"),b=i("b-form"),m=i("UpdatePin"),V=i("UpdatePassword"),k=i("UpdateEmail"),w=i("ProfileImageEditor"),U=i("b-icon"),O=i("OptionsComponent"),v=L("b-modal");return e.user?(l(),d("div",J,[t(u,{lazy:"true",id:"editDisplayedNameModal",title:"Edit Displayed Name","hide-footer":""},{default:r(()=>[t(I,{"default-displayed-name":e.user.displayedName,userId:e.userId,onClose:s[0]||(s[0]=f=>e.closeUserInfoUpdate())},null,8,["default-displayed-name","userId"])]),_:1}),t(u,{lazy:"true",id:"confirm-delete-modal",title:"Delete this user?",onOk:s[1]||(s[1]=f=>e.deleteUser()),"ok-title":"Delete User","ok-variant":"danger"},{default:r(()=>s[8]||(s[8]=[n(" Are you sure you want to do this? This cannot be undone. ")])),_:1}),t(u,{lazy:"true",id:"change-usertype-modal",title:"Change User Type",onOk:s[3]||(s[3]=f=>e.updateUserType())},{default:r(()=>[e.user?(l(),d("div",X,"Current User Type: "+y(e.user.type),1)):g("",!0),t(b,null,{default:r(()=>[t(p,{modelValue:e.changeUserType,"onUpdate:modelValue":s[2]||(s[2]=f=>e.changeUserType=f),class:"mb-3"},{default:r(()=>[t(h,{value:"admin"},{default:r(()=>s[9]||(s[9]=[n("admin")])),_:1}),t(h,{value:"restricted"},{default:r(()=>s[10]||(s[10]=[n("restricted")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(u,{lazy:"true",id:"update-pin-modal",title:"Update PIN","hide-footer":""},{default:r(()=>[t(m,{onClose:s[4]||(s[4]=f=>{e.closeModal("update-pin-modal"),e.loadUser()}),userId:e.userId},null,8,["userId"])]),_:1}),t(u,{lazy:"true",id:"update-password-modal",title:"Update User Password","hide-footer":""},{default:r(()=>[e.userEncStatus?(l(),P(V,{key:0,needCurrentPassword:e.userEncStatus.userEncSetup,user:e.user,onClose:s[5]||(s[5]=f=>{e.closeModal("update-password-modal"),e.loadUser()})},null,8,["needCurrentPassword","user"])):g("",!0)]),_:1}),t(u,{lazy:"true",id:"update-email-modal",title:"Update Email Address","hide-footer":""},{default:r(()=>[t(k,{userId:e.userId,onClose:s[6]||(s[6]=f=>{e.closeModal("update-email-modal"),e.loadUser()})},null,8,["userId"])]),_:1}),o("div",Y,[s[21]||(s[21]=o("h2",{class:"my-3"},"Login Profile",-1)),o("div",null,[e.user?(l(),d("div",Z,[s[11]||(s[11]=o("div",{class:"large text-muted"},"Profile Image",-1)),o("div",x,[o("div",ee,[t(w,{userId:e.userId,profileImage:e.user.profileImage,onUpdated:s[7]||(s[7]=f=>e.loadUser())},null,8,["userId","profileImage"])])])])):g("",!0)]),o("div",se,[o("div",null,[o("div",te,[s[13]||(s[13]=o("div",{class:"mt-2 text-muted"},"Username:",-1)),o("div",oe,y(e.user.username),1),c((l(),d("div",re,[s[12]||(s[12]=o("div",{class:"mt-2 text-muted"},"Displayed Name:",-1)),o("div",ie,[n(y(e.user.displayedName)+" ",1),t(U,{icon:"pencil"})])])),[[v,void 0,void 0,{editDisplayedNameModal:!0}]])]),o("div",le,[o("div",ne,[s[14]||(s[14]=o("div",{class:"mt-2 text-muted"},"User Type:",-1)),o("div",de,y(e.user.type),1)]),e.hasInternalLogin?g("",!0):(l(),d("div",ae,[s[15]||(s[15]=o("div",{class:"mt-2 text-muted"},"Login Type:",-1)),o("div",ue,y(e.user.loginType),1)]))]),o("div",me,[c((l(),d("div",pe,[s[16]||(s[16]=o("div",{class:"mt-2 text-muted"},"Email:",-1)),o("div",fe,[n(y(e.user.email||"N/A")+" ",1),t(U,{icon:"pencil"})])])),[[v,void 0,void 0,{"update-email-modal":!0}]]),e.userVerificationNeeded?(l(),d("div",ge," email not verified. This user can request a new verification email by visiting their login settings. ")):e.user.email?(l(),d("div",ye," Verified ")):g("",!0)]),e.options?(l(),d("div",he,[e.isAdminUser?(l(),P(O,{key:0,user:e.user,onUpdateOptions:e.loadOptions,selectedOptions:["whitelistingEnabled","aiChatEnabled"]},null,8,["user","onUpdateOptions"])):g("",!0),o("div",null,[o("div",Ue,[c((l(),d("div",ve,[t(U,{icon:"pencil"}),n(" "+y(e.user.hasPassword?"Update":"Set")+" Password ",1)])),[[v,void 0,void 0,{"update-password-modal":!0}]]),s[17]||(s[17]=o("div",{class:"mt-1 text-muted small"}," Password is used for encrypting data and login. ",-1))]),o("div",ce,[c((l(),d("div",Ie,[t(U,{icon:"pencil"}),n(" "+y(e.user.hasPin?"Update":"Set")+" PIN ",1)])),[[v,void 0,void 0,{"update-pin-modal":!0}]]),s[18]||(s[18]=o("div",{class:"mt-1 text-muted small"},"Pin is used to switch between users.",-1))]),s[20]||(s[20]=o("hr",null,null,-1)),o("div",be,[c((l(),d("div",Pe,[t(U,{icon:"trash"}),s[19]||(s[19]=n(" Delete User "))])),[[v,void 0,void 0,{"confirm-delete-modal":!0}]])])])])):g("",!0)])])])])):g("",!0)}const $e=_(H,[["render",_e]]);export{$e as default};

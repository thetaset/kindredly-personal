import{a as k,_ as w}from"./components.global5n24RCIC.js";import{d as C,j as m,k as n,K as o,z as l,s as u,r as s,i as a,Q as i,R as d,m as h}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";const V=C({name:"UserMigration",mixins:[k],components:{},data(){return{accountInvitationCode:null,inviteInfo:null,page:0,email:null,confirmText:null,errorMessage:null,loading:!1}},mounted(){},computed:{},methods:{validationError(t){this.errorMessage=t},rejectInvitation(){window.location.replace(this.appPrefix)},migrate(){if(!this.email||!this.confirmText){this.validationError("Invalid email");return}this.loading=!0,this.sendReq("/user/migrate",{email:this.email,inviteVerification:{code:this.accountInvitationCode}}).then(t=>{t.success?(this.page=1,this.showToast("Account migrated successfully",{variant:"success",title:"",autoHideDelay:5e3,appendToast:!0}),this.signout()(),this.errorMessage=null):(console.error("Error:",t.message),this.errorMessage=t.message),this.loading=!1})},signout(){this.sendReq("/signout",{}).then(t=>{t.success?(this.LogOut(!0),window.location.href=this.homeURL,this.errorMessage=null):(console.error("Error:",t.message),this.errorMessage=t.message)})},loadInviteInfo(){this.sendReq("/invite/getInfo",{code:this.accountInvitationCode}).then(t=>{t.success?(this.page=0,this.inviteInfo=t.result,this.errorMessage=null):(console.error("Error:",t.message),this.errorMessage=t.message)})}},created(){this.$route.query.accountInvitationCode&&this.isAdminUser&&(this.accountInvitationCode=this.$route.query.accountInvitationCode,this.loadInviteInfo())}}),N={key:0,class:"text-center d-flex justify-content-center"},T={key:0},$={key:0},E={class:"text-left"},U={class:"mt-3 text-center"},j={class:"d-flex flex-column justify-content-center mt-5"},A={key:1},R=["href"];function q(t,e,B,D,z,P){const f=s("b-alert"),g=s("b-form-input"),v=s("b-form-group"),y=s("b-spinner"),c=s("b-button"),I=s("b-card"),M=s("b-container");return t.inviteInfo?(a(),m("div",N,[n("div",null,[o(M,{class:"d-flex flex-column justify-content-center"},{default:l(()=>[e[21]||(e[21]=n("div",{class:"my-3"},[n("h2",null,"Kindredly User Account Migration")],-1)),o(I,{style:{"max-width":"600px"}},{default:l(()=>{var p,b;return[(a(),m("div",T,[t.page==0?(a(),m("div",$,[n("h4",null,[e[6]||(e[6]=i(" You are migrating your account to ")),n("b",null,d((p=t.inviteInfo)==null?void 0:p.inviterName)+"'s",1),e[7]||(e[7]=i(" family account. "))]),e[17]||(e[17]=n("br",null,null,-1)),o(f,{"model-value":!0,variant:"danger"},{default:l(()=>e[8]||(e[8]=[n("p",null,[n("b",null,"WARNING:"),i(" Any data (including your collections and preferences) in your current account will be lost. This cannot be undone. ")],-1),n("p",null,[i(" We appologize for the inconvinience and plan to have this limitation resolved in the near future. "),n("br"),n("br"),n("b",null,"Again all your existing data will be lost"),i(". ")],-1)])),_:1}),n("div",null,[e[11]||(e[11]=n("br",null,null,-1)),e[12]||(e[12]=n("b",null,"Please confirm the following are accurate before continuing",-1)),e[13]||(e[13]=n("br",null,null,-1)),n("ul",E,[n("li",null,[e[9]||(e[9]=i("The email address associated with the account you wish to migrate is ")),n("b",null,d(t.currentUser.email),1),e[10]||(e[10]=i(" and belongs to you. "))]),n("li",null,d((b=t.inviteInfo)==null?void 0:b.inviterName)+" with email "+d(t.inviteInfo.inviterEmail||"*Email is missing * ")+" is someone you know and trust. ",1)]),e[14]||(e[14]=n("br",null,null,-1))]),n("div",U,[o(v,{class:"form-group mt-4","label-for":"emailDiv"},{default:l(()=>[o(g,{onClick:e[0]||(e[0]=r=>t.errorMessage=null),id:"emailDiv",modelValue:t.email,"onUpdate:modelValue":e[1]||(e[1]=r=>t.email=r),placeholder:"your email address",required:""},null,8,["modelValue"])]),_:1}),o(v,{class:"form-group mt-4"},{default:l(()=>[o(g,{onClick:e[2]||(e[2]=r=>t.errorMessage=null),id:"confirm",modelValue:t.confirmText,"onUpdate:modelValue":e[3]||(e[3]=r=>t.confirmText=r),placeholder:"type 'delete and migrate' to confirm",required:""},null,8,["modelValue"])]),_:1}),n("div",j,[n("div",null,[o(c,{size:"lg",disabled:t.loading||t.confirmText!="delete and migrate"||!t.email,variant:"danger",onClick:e[4]||(e[4]=r=>t.migrate())},{default:l(()=>[e[15]||(e[15]=i(" Migrate My Account ")),t.loading?(a(),h(y,{key:0,small:"",label:"Loading..."})):u("",!0)]),_:1},8,["disabled"])]),n("div",null,[o(c,{class:"mt-5",size:"sm",disabled:t.loading,variant:"secondary",onClick:e[5]||(e[5]=r=>t.rejectInvitation())},{default:l(()=>e[16]||(e[16]=[i(" Reject Invitation/ Abort Migration ")])),_:1},8,["disabled"])])])])])):u("",!0),t.page==1?(a(),m("div",A,[e[18]||(e[18]=i(" Migration Successful ")),e[19]||(e[19]=n("br",null,null,-1)),n("a",{class:"mt-4",href:t.appPrefix},"Refresh Page",8,R)])):u("",!0),t.errorMessage?(a(),h(f,{key:2,class:"m-4",variant:"danger","model-value":!0},{default:l(()=>[i(d(t.errorMessage),1)]),_:1})):u("",!0)]))]}),_:1})]),_:1})])])):u("",!0)}const G=w(V,[["render",q]]);export{G as default};

import{_ as w,a as C,aj as A}from"./components.globalDizx_NTC.js";import{j as i,k as a,m as v,z as u,s as n,K as l,Q as g,R as c,r as d,i as t,d as B,F,P as U,L as E,ac as R}from"./@vueC3Nhqlrl.js";import{U as D}from"./UsersListCqGOth3O.js";import{P as T}from"./TIIconDefaultB4jiNlod.js";const V={name:"AddFriends",props:{targetUser:{type:Object,default:null,required:!1}},data(){return{emailInvite:null,requestData:{inviterName:null,email:null,message:null},errorMessage:null,loading:!1}},mounted(){},computed:{additionalMessage(){return this.targetUser?`NOTE: This request was created by ${this.currentUser.username} on behalf of ${this.targetUser.username}.`:null}},methods:{displayError(){this.showToast(this.errorMessage,{variant:"danger",title:"error",solid:!0})},sendInvite(){var s;if(this.errorMessage=null,this.requestData.email==null){this.errorMessage="email missing",this.displayError();return}if(this.requestData.inviterName==null||this.requestData.inviterName.length<4){this.errorMessage="Invalid inviter name, must be at least 4 characters long",this.displayError();return}this.loading=!0,this.additionalMessage&&(this.requestData.message+="<br/>"+this.additionalMessage),this.sendReq("/user/friend/request",{requestData:this.requestData,userId:(s=this.targetUser)==null?void 0:s._id}).then(e=>{e.success?(this.errorMessage=null,this.showToast(`Friend invite sent to ${this.requestData.email}.`,{variant:"info",title:"Invite Sent",solid:!0}),this.$emit("close",!0)):(console.error("Error:",e.message),this.errorMessage=e.message),this.loading=!1})}},created(){}},O={key:1},$={class:"border p-2 m-1"};function N(s,e,r,M,m,q){const k=d("b-icon"),y=d("b-alert"),b=d("b-form-input"),h=d("b-form-group"),I=d("b-form-textarea"),_=d("b-spinner"),o=d("b-button"),p=d("b-button-toolbar");return t(),i("div",null,[a("div",null,[r.targetUser?(t(),v(y,{key:0,class:"my-4","model-value":!0,variant:"danger"},{default:u(()=>[l(k,{icon:"exclamation-triangle-fill"}),g(" You are making a friends request on behalf of "+c(r.targetUser.username)+". ",1)]),_:1})):n("",!0),l(h,{class:"form-group","label-for":"formEmail",description:""},{default:u(()=>[l(b,{type:"email",id:"formEmail",modelValue:m.requestData.email,"onUpdate:modelValue":e[0]||(e[0]=f=>m.requestData.email=f),placeholder:"Email or Username",required:""},null,8,["modelValue"])]),_:1}),l(h,{class:"form-group",label:"Enter your name","label-for":"formYourname",description:""},{default:u(()=>[l(b,{id:"formYourname",autocorrect:"off",autocapitalize:"off",modelValue:m.requestData.inviterName,"onUpdate:modelValue":e[1]||(e[1]=f=>m.requestData.inviterName=f),placeholder:"Your name",required:""},null,8,["modelValue"])]),_:1}),l(h,{class:"form-group",label:"Invite Message","label-for":"forMessage",description:"A message to include in the invite"},{default:u(()=>[l(I,{id:"forMessage",modelValue:m.requestData.message,"onUpdate:modelValue":e[2]||(e[2]=f=>m.requestData.message=f),placeholder:"Message to include"},null,8,["modelValue"])]),_:1}),r.targetUser?(t(),i("div",O,[e[4]||(e[4]=g(" The following will be included in the invite message: ")),a("div",$,c(q.additionalMessage),1)])):n("",!0),m.errorMessage?(t(),v(y,{key:2,class:"m-4",variant:"danger","model-value":!0,innerHTML:m.errorMessage},null,8,["innerHTML"])):n("",!0),l(p,{class:"mt-4"},{default:u(()=>[l(o,{variant:"primary",class:"ms-auto",disabled:m.loading,onClick:e[3]||(e[3]=f=>q.sendInvite())},{default:u(()=>[e[5]||(e[5]=g("Send Friend Request")),m.loading?(t(),v(_,{key:0,small:"",label:"Loading..."})):n("",!0)]),_:1},8,["disabled"])]),_:1})])])}const S=w(V,[["render",N]]),P=B({name:"FriendManager",mixins:[C],components:{ProfileImage:T,AddFriend:S,UsersList:D},props:{targetUser:{type:Object,default:null,required:!1}},data(){return{errorMessage:null,loading:!1,loadingFriends:!0,tabIndex:null,friends:null,requestedInBound:null,requestedOutBound:null,enableFriends:!0,userFields:[{key:"id",sortable:!0,label:""}]}},mounted(){},computed:{maxFriends(){const s=this.targetUser||this.currentUser;return(s==null?void 0:s.type)=="admin"?12:8},editAllowed(){var s;return((s=this.currentUser)==null?void 0:s.type)!="restricted"},userList(){return this.users?[...this.users].sort(function(s,e){return A(s,e,"username")}):[]},friendCount(){let s=0;return s+=this.friends?this.friends.length:0,s+=this.requestedOutBound?this.requestedOutBound.length:0,s+=this.requestedInBound?this.requestedInBound.length:0,s}},methods:{viewUser(s){let e=null;this.targetUser&&(e=this.targetUser._id),this.$router.push({name:"UserProfile",params:{userId:s},query:{viewAsUserId:e}})},confirmRequest(s){var e;this.loading=!0,this.sendReq("/user/friend/takeAction",{action:"confirm",friendUserId:s.userId,userId:(e=this.targetUser)==null?void 0:e._id}).then(r=>{r.success?(this.errorMessage=null,this.showToast("Ok",{variant:"info",title:"Accepted",solid:!0}),this.loadFriends()):(console.error("Error:",r.message),this.errorMessage=r.message),this.loading=!1})},declineRequestExec(s){var e;this.loading=!0,this.sendReq("/user/friend/takeAction",{action:"confirm",friendUserId:s.userId,userId:(e=this.targetUser)==null?void 0:e._id}).then(r=>{r.success?(this.errorMessage=null,this.showToast("Successful",{variant:"info",title:"Friend Confirmation",solid:!0}),this.loadFriends()):(console.error("Error:",r.message),this.errorMessage=r.message),this.loading=!1})},declineRequest(s){this.getRef("msgBoxConfirm").show("Are you sure you want to decline this friend invite?").then(e=>{e&&this.declineRequestExec(s)}).catch(e=>{})},cancelInviteExec(s){var e;this.loading=!0,this.sendReq("/user/friend/takeAction",{action:"cancel",friendUserId:s.userId,userId:(e=this.targetUser)==null?void 0:e._id}).then(r=>{r.success?(this.errorMessage=null,this.showToast("Successful",{variant:"info",title:"Cancellation",solid:!0}),this.loadFriends()):(console.error("Error:",r.message),this.errorMessage=r.message),this.loading=!1})},cancelInvite(s){this.getRef("msgBoxConfirm").show("Are you sure you want to cancel this friend invite?").then(e=>{e&&this.cancelInviteExec(s)}).catch(e=>{})},removeFriendExec(s){var e;this.loading=!0,this.sendReq("/user/friend/takeAction",{action:"remove",friendUserId:s.userId,userId:(e=this.targetUser)==null?void 0:e._id}).then(r=>{r.success?(this.errorMessage=null,this.showToast("Successful",{variant:"info",title:"Remove from friendlist",solid:!0}),this.loadFriends()):(console.error("Error:",r.message),this.errorMessage=r.message),this.loading=!1})},removeFriend(s){this.getRef("msgBoxConfirm").show(`Are you sure you want remove ${s.username} from your friend list?`).then(e=>{e&&this.removeFriendExec(s)}).catch(e=>{})},loadFriends(){var s;this.loadingFriends=!0,this.sendReq("/user/friend/list",{userId:(s=this.targetUser)==null?void 0:s._id}).then(e=>{e.success?(this.friends=e.result.friends,this.requestedInBound=e.result.requestedInBound,this.requestedOutBound=e.result.requestedOutBound,this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message),this.loadingFriends=!1})}},created(){this.$route.query.show=="friends"&&(this.tabIndex=1),this.RefreshUsers(),this.loadFriends()}}),L={key:0,class:"alert alert-warning"},j={key:1,class:"mb-4"},Y={class:"mt-3"},z={class:"me-2"},K={key:0},H={key:2,class:"d-flex align-items-center flex-gap-1"},Q=["title"],x={key:3,class:"alert alert-info"},G={class:"mt-3"},J={key:0},W={key:0},X={key:4},Z={class:"mt-3"},ee={class:"ms-2"};function se(s,e,r,M,m,q){const k=d("AddFriend"),y=d("b-modal"),b=d("b-icon"),h=d("b-button"),I=d("ProfileImage"),_=R("b-modal");return t(),i("div",null,[l(y,{lazy:"true",id:"add-friend-modal",title:"Add a Friend","hide-footer":"",size:"lg","no-close-on-backdrop":""},{default:u(()=>[l(k,{targetUser:s.targetUser,onClose:e[0]||(e[0]=o=>{s.loadFriends(),s.closeModal("add-friend-modal")})},null,8,["targetUser"])]),_:1}),s.isCustomServer?(t(),i("div",L,[l(b,{icon:"exclamation-triangle-fill"}),e[1]||(e[1]=g(" Personal Server Edition does not support friends, yet "))])):n("",!0),s.requestedInBound&&s.requestedInBound.length>0?(t(),i("div",j,[e[4]||(e[4]=a("div",{class:"larger"}," You have pending friend requests!",-1)),a("div",Y,[a("div",null,[(t(!0),i(F,null,U(s.requestedInBound,(o,p)=>(t(),i("div",{key:p,class:"d-flex flex-wrap align-items-center mb-1"},[a("div",z,[g(c(o.username)+" ",1),o.email?(t(),i("span",K,"("+c(o.email)+")",1)):n("",!0)]),s.editAllowed&&s.friendCount<=s.maxFriends?(t(),v(h,{key:0,variant:"primary",onClick:f=>s.confirmRequest(o),class:"me-1"},{default:u(()=>[l(b,{icon:"person-plus-fill"}),e[2]||(e[2]=g(" Accept "))]),_:2},1032,["onClick"])):n("",!0),s.editAllowed?(t(),v(h,{key:1,variant:"danger",onClick:f=>s.declineRequest(o)},{default:u(()=>e[3]||(e[3]=[g(" Decline ")])),_:2},1032,["onClick"])):n("",!0)]))),128))])]),e[5]||(e[5]=a("hr",null,null,-1))])):n("",!0),s.isCustomServer?n("",!0):(t(),i("div",H,[s.isAdminUser?E((t(),v(h,{key:0,variant:"primary",disabled:s.loadingFriends||s.friendCount>s.maxFriends},{default:u(()=>[l(b,{icon:"plus"}),e[6]||(e[6]=g(" Add Friend "))]),_:1},8,["disabled"])),[[_,void 0,void 0,{"add-friend-modal":!0}]]):n("",!0),s.loadingFriends?n("",!0):(t(),i("div",{key:1,class:"ms-auto",title:`Kindredly currently limits the number of friends a user can have to ${s.maxFriends}.  In the future, this will change based on your age and how long you've used Kindredly.`}," Total: "+c(s.friendCount)+" (limit="+c(s.maxFriends)+")",9,Q))])),e[11]||(e[11]=a("div",{class:"mt-4"},null,-1)),e[12]||(e[12]=a("hr",null,null,-1)),s.editAllowed?n("",!0):(t(),i("div",x," Restricted users cannot add friends. Please ask your guardian to add friends for you. ")),a("div",G,[s.friends?(t(),i("div",J,[(t(!0),i(F,null,U(s.friends,(o,p)=>(t(),i("div",{key:p,class:"d-flex flex-wrap justify-content-between align-items-center mb-2"},[l(h,{variant:"link",onClick:f=>s.viewUser(o._id)},{default:u(()=>[l(I,{profileImage:o.profileImage,width:40,class:"me-2"},null,8,["profileImage"]),g(" "+c(o.username),1)]),_:2},1032,["onClick"]),s.editAllowed?(t(),v(h,{key:0,variant:"danger",onClick:f=>s.removeFriend(o)},{default:u(()=>e[7]||(e[7]=[g(" Remove Friend ")])),_:2},1032,["onClick"])):n("",!0)]))),128)),s.friends.length==0?(t(),i("div",W,"None")):n("",!0)])):n("",!0)]),s.requestedOutBound&&s.requestedOutBound.length>0?(t(),i("div",X,[e[9]||(e[9]=a("hr",null,null,-1)),e[10]||(e[10]=a("h6",null,"Pending invites you've sent",-1)),a("div",Z,[a("div",null,[(t(!0),i(F,null,U(s.requestedOutBound,(o,p)=>(t(),i("div",{key:p,class:"mb-2"},[s.editAllowed?(t(),v(h,{key:0,variant:"outline-secondary",onClick:f=>s.cancelInvite(o)},{default:u(()=>e[8]||(e[8]=[g(" Cancel ")])),_:2},1032,["onClick"])):n("",!0),a("span",ee,c(o.email||o.userId),1)]))),128))])])])):n("",!0)])}const oe=w(P,[["render",se]]);export{S as A,oe as F};

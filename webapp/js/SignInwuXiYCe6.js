import{j as B}from"./jwt-decodeVWaDGczM.js";import{a as R,d as p,w as A,_ as U}from"./components.global5n24RCIC.js";import{P as D}from"./ProviderSigninButtonBw5WL7mf.js";import H from"./VersionInfoBoQVATYo.js";import{d as q,j as n,K as t,z as l,k as o,p as y,m as c,s as d,L as f,M as b,Q as u,r,ac as j,i,R as z,N,X as G}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";const F=q({name:"Signin",mixins:[R],components:{ProviderSigninButton:D,VersionInfo:H},data(){return{username:null,password:null,errorMessage:null,loading:!1,loginType:"internal",loginPayload:null,renderedButton:!1,usingExternalLogin:!1,versionInfoLoaded:!1}},mounted(){this.isBrowserMode&&!this.isCustomServer&&!this.isNativeClient&&(this.$loadScript("https://accounts.google.com/gsi/client").then(()=>{p("Script load successful (Google ID)"),this.setupClientGoogle()}).catch(e=>{console.error("Script load error",e)}),this.$loadScript("https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js").then(()=>{p("Script load successful (Apple ID)"),this.setupClientApple()}).catch(e=>{console.error("Script load error",e)}))},computed:{},methods:{setupClientGoogle(){google.accounts.id.initialize({client_id:this.config.googleClientId,callback:e=>{p("Google ID initialized",e);const s=B(e.credential);p("User info from google:",s),this.loginType="google",this.loginPayload=e,this.submitSignIn()}}),google.accounts.id.renderButton(document.getElementById("google-signin-button"),{theme:"outline",size:"large"}),google.accounts.id.prompt()},setupClientApple(){AppleID.auth.init({clientId:this.config.appleClientId,scope:this.config.appleSigninScope,redirectURI:this.config.appleSigninRedirectURI,state:"authType=sign-in",usePopup:!1})},async submitSignIn(){var s;if(!this.loginType||this.loginType=="internal"){if(this.username==null||this.username.length<1){this.errorMessage="Invalid Username";return}else if(this.password==null||this.password.length<1){this.errorMessage="Invalid Password";return}}this.loading=!0;const e=await this.sendReq("/client/signin",{username:this.username,password:this.password,loginType:this.loginType||"internal",loginPayload:this.loginPayload});if(e.success){p("Login successful"),await this.Signin(!0),this.RefreshAll(!0,!1,!1,!0),this.$emit("updateData",null),p("Redirecting now");let m=((s=this.$route.query)==null?void 0:s.redirect)||"";m.length>5?(p("Redirecting to:",m),location.replace(this.appPrefix+"#"+m)):location.replace(this.appPrefix),this.errorMessage=null}else console.error("Error:",e),this.errorMessage=e.message,this.loading=!1},async loadPage(){if(A(!0),this.loginType=="apple"){const e=this.$route.query.access_token;this.loginPayload={accessToken:e},this.submitSignIn()}},async loadVersionInfo(){this.versionInfoLoaded=!1;try{await this.LoadVersionSummary(!0)}catch(e){console.error("Error:",e)}finally{this.versionInfoLoaded=!0}},async externalLoginFailed(e){this.usingExternalLogin=!1,this.errorMessage="Login failed: "+e,this.loading=!1,this.showToast(e,{title:"Error",variant:"danger",solid:!0})}},created(){if(this.loadVersionInfo(),this.$route.query.forceSignout){const e=this.$route.query.forceSignoutMessage||"";this.showToast("You have been signed out. "+e,{title:"Session Expired",variant:"danger",solid:!0})}this.errorMessage=this.$route.query.errorMessage||null,this.loginType=this.$route.query.loginType||"internal",this.loadPage()}}),x={style:{"min-height":"600px"},class:"p-2 d-flex justify-content-center align-items-center"},K={class:""},O={key:0,href:"/"},Y=["href"],Q={class:"container-box-sm"},W={key:0,class:"my-4 text-center"},X={key:1,class:"larger"},J={class:""},Z={key:0,class:"mt-3"},ee={class:"mt-5"},se={key:1},oe={key:2,class:"text-center"},ie={class:"d-flex justify-content-between mt-4"},te={class:"py-2"},ne={class:"my-4"},re={key:3,class:"text-center my-4"},le=["innerHTML"],ae={key:0},de={class:"mt-5 text-center"},ue={class:"my-3"},pe={class:"my-3"},ge={class:"my-3 small"},me=["href"],ce={key:1,class:"text-center"},fe=["href"],he=["href"],ve={key:2,class:"mx-1 text-center small"},ye={key:0},be={key:0,class:"my-4 py-2 px-3 divfit rounded fillrow border"},Se=["href"],we={key:1,class:"my-4 py-2 px-3 divfit rounded fillrow border"},ke=["href"];function _e(e,s,m,Ce,Ie,Le){var I,L,$,M;const P=r("b-modal"),S=r("AppLogo"),g=r("b-icon"),h=r("router-link"),w=r("ProviderSigninButton"),k=r("b-form-input"),_=r("b-form-group"),C=r("b-button"),v=r("b-spinner"),T=r("b-alert"),E=r("b-link"),V=j("b-modal");return i(),n("div",x,[t(P,{id:"external-login-modal",title:"External Login","hide-footer":""},{default:l(()=>s[8]||(s[8]=[o("div",{class:"container-sm"}," A browser window should have opened for you to sign-in ",-1)])),_:1}),o("div",K,[o("div",{class:y(["text-center mb-4",e.isMobile?"mt-3":"mt-5"])},[e.isBrowserMode?(i(),n("a",O,[t(S)])):(i(),n("a",{key:1,href:e.appPrefix},[t(S)],8,Y))],2),o("div",Q,[e.isCustomServer?(i(),n("div",W,[e.isExtension?(i(),c(h,{key:0,to:"/settings/server"},{default:l(()=>[t(g,{icon:"database-fill-gear"}),u(" Using custom server : "+z(e.serverAPIURL),1)]),_:1})):(i(),n("div",X," Personal Edition "))])):d("",!0),f(o("div",J,[e.isBrowserMode&&!e.isNativeClient&&!e.isCustomServer?(i(),n("div",Z,s[9]||(s[9]=[o("div",{class:"gbuttonwrapper"},[o("div",{class:"g-signin2",id:"google-signin-button"})],-1),o("div",{class:"appleid-signin-container mt-3"},[o("div",{id:"appleid-signin","data-color":"white","data-border":"true","data-type":"sign in","data-border-radius":"10","data-width":"180","data-height":"40"})],-1)]))):d("",!0),f(o("div",ee,[t(w,{onClick:s[0]||(s[0]=a=>e.usingExternalLogin=!0),onHadError:e.externalLoginFailed,loginType:"google"},null,8,["onHadError"]),s[10]||(s[10]=o("div",{class:"mt-3"},null,-1)),t(w,{onClick:s[1]||(s[1]=a=>e.usingExternalLogin=!0),onHadError:e.externalLoginFailed,loginType:"apple"},null,8,["onHadError"])],512),[[b,!e.isCustomServer]]),e.isCustomServer?d("",!0):(i(),n("div",se,s[11]||(s[11]=[o("div",{class:"text-center py-4"},[o("div",{class:"separator text-muted"},"or")],-1)]))),t(_,{class:"form-group"},{default:l(()=>[t(k,{onClick:s[2]||(s[2]=a=>e.errorMessage=null),id:"username",autofocus:"",autocorrect:"off",autocapitalize:"off",modelValue:e.username,"onUpdate:modelValue":s[3]||(s[3]=a=>e.username=a),placeholder:"Username/Email",required:""},null,8,["modelValue"])]),_:1}),t(_,{class:"form-gr oup"},{default:l(()=>[t(k,{onSubmit:N(e.submitSignIn,["prevent"]),onKeyup:s[4]||(s[4]=G(a=>e.submitSignIn(),["enter"])),onClick:s[5]||(s[5]=a=>e.errorMessage=null),id:"password",modelValue:e.password,"onUpdate:modelValue":s[6]||(s[6]=a=>e.password=a),type:"password",placeholder:"Password",required:""},null,8,["onSubmit","modelValue"])]),_:1}),e.loading?(i(),n("div",re,[t(v,{class:"spinnerxl",label:"Loading..."})])):(i(),n("div",oe,[o("div",ie,[o("div",te,[t(h,{class:"text-muted",to:"/forgotPassword"},{default:l(()=>s[12]||(s[12]=[u("Forgot password?")])),_:1})]),t(C,{variant:"primary",size:"lg",onClick:s[7]||(s[7]=a=>e.submitSignIn()),id:"signin_btn"},{default:l(()=>s[13]||(s[13]=[u("Sign-In")])),_:1})]),o("hr",{class:y(e.isMobile?"mt-3":"mt-5")},null,2),o("div",ne,[t(C,{id:"register_btn",variant:"outline-primary",size:"lg",to:"/register"},{default:l(()=>s[14]||(s[14]=[u("Register")])),_:1})])])),e.errorMessage?(i(),c(T,{key:4,class:"m-4 text-center",variant:"danger","model-value":!0},{default:l(()=>[o("p",{innerHTML:e.errorMessage},null,8,le),e.isOnline?d("",!0):(i(),n("p",ae," You don't seem to be online. Please check your internet connection "))]),_:1})):d("",!0)],512),[[b,!e.usingExternalLogin&&!e.loading]]),f(o("div",de,[o("div",null,[o("div",ue,[o("div",null,[s[16]||(s[16]=u(" Resume sign-in using other window")),f((i(),c(E,null,{default:l(()=>s[15]||(s[15]=[u("?")])),_:1})),[[V,void 0,void 0,{"external-login-modal":!0}]])]),o("div",pe,[t(v,{class:"spinnerxl",label:"Loading..."})])]),o("div",ge,[o("a",{href:e.homeURL},"cancel",8,me)]),s[17]||(s[17]=o("div",{class:"my-3"},null,-1))])],512),[[b,e.usingExternalLogin]]),e.loading?(i(),n("div",ce,[t(v,{class:"spinnerxl",label:"Loading..."})])):d("",!0),o("div",{class:y(["mx-1 text-center small",e.isMobile?"pt-2":"py-2 "])},[!e.isWebOnly||!e.isCustomServer?(i(),n("a",{key:0,href:`${e.config.serverHostname}`,target:"_blank"},"kindredly.ai",8,fe)):(i(),n("a",{key:1,href:`${e.config.sourceCodePath}`,target:"_blank"},[t(g,{icon:"github"}),s[18]||(s[18]=u(" GitHub "))],8,he))],2),(i(),n("div",ve,[e.versionInfoLoaded?(i(),n("div",ye,[(I=e.versionSummary)!=null&&I.success&&!((L=e.versionSummary)!=null&&L.clientSupportedByServer)?(i(),n("div",be,[t(g,{icon:"exclamation-triangle-fill",class:"text-warning me-2"}),s[19]||(s[19]=u(" Your client is needs to be updated. ")),s[20]||(s[20]=o("br",null,null,-1)),o("a",{target:"_blank",href:`${e.config.serverHostname}/helpdocs/updateClient?appType=${e.appType}`},"Please update your client.",8,Se)])):($=e.versionSummary)!=null&&$.success&&((M=e.versionSummary)!=null&&M.newerClientVersionAvailable)?(i(),n("div",we,[t(g,{icon:"exclamation-triangle-fill",class:"text-warning me-2"}),o("a",{target:"_blank",href:`${e.config.serverHostname}/helpdocs/updateClient?appType=${e.appType}`},"An update is available.",8,ke)])):d("",!0)])):d("",!0),e.isExtension?(i(),c(h,{key:1,to:"/settings/server"},{default:l(()=>[t(g,{icon:"database-fill-gear"}),s[21]||(s[21]=u(" Custom Server Settings "))]),_:1})):d("",!0)]))])])])}const Ae=U(F,[["render",_e]]);export{Ae as default};

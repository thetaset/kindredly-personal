const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/PopCollectionSelectorDtsi0cBR.js","js/CreateCollectionCvnp9GSK.js","js/components.global5n24RCIC.js","js/@vueC3Nhqlrl.js","js/vue3-toastifyDll2FbVh.js","assets/vue3-toastify.css","js/@capacitorCjBcbZvA.js","js/bootstrap-vue-nextDnMzdrWQ.js","assets/bootstrap-vue-next.css","assets/components.css","js/TIIconDefaultDZ-9wHcm.js","assets/TIIconDefault.css","js/ai_lookup_utilszDX_hcwM.js","assets/CreateCollection.css","js/ItemImageBounipmB.js","assets/PopCollectionSelector.css"])))=>i.map(i=>d[i]);
import{_ as $}from"./@capacitorCjBcbZvA.js";import{a as _,t as z,p as D,l as A,_ as V}from"./components.global5n24RCIC.js";import{I as M}from"./ItemImageBounipmB.js";import{T as S}from"./TIFeedbackInfoB-5_RUVQ.js";import{d as L,aa as P,j as u,l as w,k as n,K as o,s as l,F as x,P as Q,z as i,Q as r,r as c,i as a,p as I,R as g,m as k}from"./@vueC3Nhqlrl.js";const U={7:"7 days",30:"30 days",90:"90 days",365:"1 year"},B=L({name:"RediscoverFeed",mixins:[_],props:{asComponent:{type:Boolean,default:!1}},components:{ItemImage:M,TIFeedbackInfo:S,PopCollectionSelector:P(()=>$(()=>import("./PopCollectionSelectorDtsi0cBR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])))},data(){return{showDebug:!1,matchLookup:{},loading:!1,saving:!1,items:[],results:[],renderedItems:[],logs:[],dismissedLinks:new Set,currentItem:null,currentlySelectedCollectionId:null,itemsToRender:this.asComponent?3:10,selectedTimeFrameId:7,showReadLater:!0,showCollections:!1,errorMessage:null}},mounted(){},computed:{hasMoreItems(){return this.results.length>this.itemsToRender},selectedTimeFrame(){return U[this.selectedTimeFrameId]+" or longer"}},methods:{textTruncate:z,prettyTimePast:D,setTimeFrame(e){this.selectedTimeFrameId=e,this.loadData()},async removeItemFromResults(e){e.removing=!0,await this.$nextTick();const t=e._id;setTimeout(()=>{this.results=this.results.filter(v=>v._id!=t),this.updateRenderedItems()},200)},async checkURLPermission(e){return(await this.sendReq("/client/checkIfPermitted",{url:e})).result},async openPage(e){this.$router.push(e)},async visitItem(e){const t=e._id;t&&this.openPage(`/item/${t}`)},async setReadLater(e){const t=e._id;await this.updateFeedbackValue(t,"isReadLater",!0),await this.removeItemFromResults(e)},async setArchive(e){if(!await this.getRef("msgBoxConfirm").show(`Archive '${e.name}' for all account members? `,{title:"Archive for all account members?",okVariant:"danger ",okTitle:"Archive",cancelTitle:"Cancel",hideHeaderClose:!1}))return;const v=e._id;await this.sendReq("/item/archiveUpdate",{itemId:v,value:!0}),await this.removeItemFromResults(e),this.RefreshIndexQuick()},async deleteItem(e){await this.getRef("msgBoxConfirm").show(`Delete '${e.name}'? `,{title:"Confirm",okVariant:"danger ",okTitle:"Delete Permanently",cancelTitle:"Cancel",hideHeaderClose:!1})&&(await this.sendReq("/item/delete",{itemId:e._id}),this.RefreshIndexQuick(),this.removeItemFromResults(e))},async visitAndRemove(e){this.visit(e)},async setKeep(e){const t=e._id;await this.updateFeedbackValue(t,"neverRemindDate",new Date().getTime()),await this.removeItemFromResults(e),this.RefreshIndexQuick()},async setSnooze(e,t){const v=new Date().getTime()+t*60*60*1e3,h=e._id;await this.updateFeedbackValue(h,"snoozeUntilDate",v),await this.removeItemFromResults(e)},async updateFeedbackValue(e,t,v){const h=await this.sendReq("/item/feedback/value/update",{itemId:e,attr:t,value:v});if(h.success)this.RefreshIndexQuick();else{this.errorMessage=h.message,console.error(this.errorMessage);return}},async updateItemViaFeedInfo(e){},async loadRevisitQueue(){this.loading=!0;let e=await this.sendReq("/client/library/rediscoverQueue",{timeFrameDays:this.selectedTimeFrameId,showReadLater:this.showReadLater,showCollections:this.showCollections});e!=null&&e.success?(this.results=A(e.result,50,!1),this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message),this.loading=!1},async updateRenderedItems(){this.renderedItems=this.results.slice(0,this.itemsToRender)},async loadMore(){this.itemsToRender+=10,await this.updateRenderedItems()},async loadData(){await this.loadRevisitQueue(),await this.updateRenderedItems()}},created(){this.loadData()}}),H={key:0,class:"d-flex flex-gap-xs align-items-center justify-content-end small"},q={class:"d-flex align-items-center flex-gap-sm"},E={key:1},N=["onClick"],O={key:0,class:"feedImageContainer"},j={class:"larger mt-2 linklike"},K={key:0,class:"small text-muted truncatetext mt-1"},G=["onClick"],J={key:1,class:"small text-muted truncatetext mt-1"},W={class:"mt-1"},X={class:"d-flex align-items-center flex-gap-1 mb-2 mt-2"},Y={class:"d-flex align-items-center flex-gap-1"},Z={key:0,title:"Published"},ee={key:0,class:"small text-muted truncatetext"},te={title:"Time added"},se={class:"borderOnHover rounded"},oe={key:0,class:"d-flex align-items-center flex-gap-1"},ne={key:0,class:"d-flex align-items-center justify-content-center py-3 my-3 ms-1"},ie={key:1,class:"mx-2"},ae={class:"mt-4 text-muted"},le={key:2},re={class:"text-center tsFadeInAnimationMed mt-5"};function de(e,t,v,h,ue,me){const C=c("b-form-checkbox"),b=c("ItemImage"),p=c("b-icon"),R=c("TruncateExpand"),T=c("TIFeedbackInfo"),f=c("b-button"),m=c("b-dropdown-item"),y=c("b-dropdown"),F=c("b-spinner");return a(),u("div",null,[w(e.$slots,"header",{renderedItems:e.renderedItems},void 0,!0),e.asComponent?l("",!0):(a(),u("div",H,[t[4]||(t[4]=n("div",null,null,-1)),n("div",q,[t[3]||(t[3]=n("div",{class:"text-muted"},"Show Collections",-1)),n("div",null,[o(C,{size:"sm",switch:"",modelValue:e.showCollections,"onUpdate:modelValue":t[0]||(t[0]=s=>e.showCollections=s),onChange:t[1]||(t[1]=s=>e.loadData())},null,8,["modelValue"])])])])),e.loading?(a(),u("div",le,[n("div",re,[o(F,{label:"Loading..."})])])):(a(),u("div",E,[(a(!0),u(x,null,Q(e.renderedItems,s=>(a(),u("div",{key:s._id,class:I(["hoverrow border-bottom",e.isMobile?"py-2 mx-2":"p-3"])},[n("div",{class:I([s!=null&&s.removing?"fade-out-leave-active":"","fade-out"])},[n("div",null,[n("div",{role:"button",onClick:d=>e.visitAndRemove(s)},[s.defaultImage?(a(),u("div",O,[o(b,{item:s,alt:"",class:I([e.isMobile?" my-1 ":"","feedImage rounded ani-fade-in-fast"]),"icon-size":3},null,8,["item","class"])])):l("",!0),n("div",j,g(s.title||s.name),1)],8,N),s.url?(a(),u("div",K,[n("div",{role:"button",onClick:d=>e.visitAndRemove(s),class:"text-muted truncatetext"},g(s.url),9,G)])):l("",!0),s.type=="col"?(a(),u("div",J,[o(p,{icon:"collection",class:"me-1"}),t[5]||(t[5]=r(" Collection "))])):l("",!0),n("div",W,[o(R,{content:s.description,class:"mt-1 wwrap"},{default:i(()=>t[6]||(t[6]=[n("span",{class:"linklike ms-1",role:"button"},"more",-1)])),_:2},1032,["content"])]),n("div",X,[n("div",Y,[o(T,{value:s,onInput:d=>e.updateItemViaFeedInfo(s)},null,8,["value","onInput"]),s.publishId?(a(),u("div",Z,[o(p,{icon:"cloud"})])):l("",!0)]),s.createdAt?(a(),u("div",ee,[n("span",te,"added "+g(e.prettyTimePast(s.createdAt))+" ago",1)])):l("",!0)]),n("div",{class:I(["d-flex align-items-center flex-wrap flex-gap-1",e.isMobile?"justify-content-between":""])},[n("span",se,[o(f,{size:"sm",variant:"link",onClick:d=>e.setSnooze(s,24*7),class:"nowrap default-text-color m-0 pe-0"},{default:i(()=>t[7]||(t[7]=[r(" Snooze ")])),_:2},1032,["onClick"]),o(y,{variant:"link",size:"sm","toggle-class":"default-text-color nowrap hoverborder ",lazy:!0},{"button-content":i(()=>t[8]||(t[8]=[])),default:i(()=>[o(m,{onClick:d=>e.setSnooze(s,24)},{default:i(()=>t[9]||(t[9]=[r("until tomorrow")])),_:2},1032,["onClick"]),o(m,{onClick:d=>e.setSnooze(s,24*7)},{default:i(()=>t[10]||(t[10]=[r("7 days")])),_:2},1032,["onClick"]),o(m,{onClick:d=>e.setSnooze(s,24*7*28)},{default:i(()=>t[11]||(t[11]=[r("1 month")])),_:2},1032,["onClick"]),o(m,{onClick:d=>e.setSnooze(s,24*7*30*3)},{default:i(()=>t[12]||(t[12]=[r("3 months")])),_:2},1032,["onClick"]),o(m,{onClick:d=>e.setSnooze(s,24*7*30*9)},{default:i(()=>t[13]||(t[13]=[r("1 year")])),_:2},1032,["onClick"]),o(m,{onClick:d=>e.setKeep(s)},{default:i(()=>t[14]||(t[14]=[r("Don't show in Rediscover")])),_:2},1032,["onClick"])]),_:2},1024)]),o(f,{size:"sm",variant:"link",class:"nowrap borderOnHover default-text-color",onClick:d=>e.setKeep(s),title:"Don't show in Rediscover"},{default:i(()=>t[15]||(t[15]=[n("span",null," Don't show",-1)])),_:2},1032,["onClick"]),e.isMobile?l("",!0):(a(),u("div",oe,[s.type!="col"?(a(),k(f,{key:0,size:"sm",variant:"link",to:"/item/"+s._id,class:"nowrap borderOnHover default-text-color"},{default:i(()=>t[16]||(t[16]=[r(" Details ")])),_:2},1032,["to"])):l("",!0),e.isAdminUser?(a(),k(f,{key:1,size:"sm",variant:"link",class:"nowrap borderOnHover warning-color",onClick:d=>e.setArchive(s)},{default:i(()=>t[17]||(t[17]=[r(" Archive ")])),_:2},1032,["onClick"])):l("",!0),e.isAdminUser?(a(),k(f,{key:2,size:"sm",variant:"link",class:"nowrap borderOnHover danger-color",onClick:d=>e.deleteItem(s)},{default:i(()=>t[18]||(t[18]=[n("span",null,"Delete",-1)])),_:2},1032,["onClick"])):l("",!0)])),o(y,{variant:"link",size:"sm","toggle-class":"default-text-color nowrap  ",lazy:!0,"no-caret":""},{"button-content":i(()=>[o(p,{icon:"three-dots-vertical"})]),default:i(()=>[s.type!="col"?(a(),k(m,{key:0,to:"/item/"+s._id},{default:i(()=>[o(p,{icon:"info-square"}),t[19]||(t[19]=r(" Details "))]),_:2},1032,["to"])):l("",!0),e.isAdminUser?(a(),k(m,{key:1,onClick:d=>e.setArchive(s)},{default:i(()=>[o(p,{icon:"archive"}),t[20]||(t[20]=r(" Archive "))]),_:2},1032,["onClick"])):l("",!0),e.isAdminUser?(a(),k(m,{key:2,onClick:d=>e.deleteItem(s)},{default:i(()=>[o(p,{icon:"trash"}),t[21]||(t[21]=r(" Delete "))]),_:2},1032,["onClick"])):l("",!0)]),_:2},1024)],2)])],2)],2))),128)),!e.loading&&e.hasMoreItems&&!e.asComponent?(a(),u("div",ne,[o(f,{variant:"primary",onClick:t[2]||(t[2]=s=>e.loadMore())},{default:i(()=>t[22]||(t[22]=[r("Load More")])),_:1})])):l("",!0),!e.loading&&e.results&&e.results.length==0?(a(),u("div",ie,[t[24]||(t[24]=n("div",null,"No items to rediscover at this time.",-1)),n("div",ae,[o(p,{icon:"lightbulb"}),t[23]||(t[23]=r(" Read later items and older items that haven't been visited in a while will show up here. "))])])):l("",!0)])),w(e.$slots,"footer",{renderedItems:e.renderedItems},void 0,!0)])}const he=V(B,[["render",de],["__scopeId","data-v-7cbb0d16"]]);export{he as R};

import{A as R}from"./AddUserDUrSTgbk.js";import{P as z}from"./TIIconDefaultCMdnLD-P.js";import{a as w,p as I,H as $,aH as C,ax as k,Q as j,_ as U,aI as B,aJ as N,aK as E,aj as D}from"./components.globalBic2x0kT.js";import{d as A,j as r,K as i,z as c,k as s,F as T,P as L,s as y,r as o,i as n,R as m,Q as h,m as g,L as V,p as F,ac as S}from"./@vueC3Nhqlrl.js";const q=A({name:"AccountInvites",components:{},mixins:[w],data(){return{errorMessage:null,inviteList:null,selectedInvite:null}},mounted(){},computed:{},methods:{prettyTimePast:I,prettyTime:$,prettyTimeLeft:C,prettyDate:k,async listInvites(){try{const e=await j("/account/invites/list");this.inviteList=e.result}catch(e){console.error(e)}},async viewInviteCode(e){this.selectedInvite=e,this.showModal("view-code-modal")},async copyToClipboard(e){try{await navigator.clipboard.writeText(e),this.showToast("Copied to clipboard")}catch(t){console.error(t)}},async cancelInvite(e){if(this.confirmModal("Cancel Invite"))try{await j("/account/invites/cancel",{code:e._id}),this.listInvites()}catch(_){console.error(_)}}},created(){this.listInvites()}}),G={class:"container"},H={class:"mb-3"},O={class:"text-muted"},Q={class:"mt-3 d-flex align-items-center justify-content-between"},J={class:"text-center border rounded p-2 shadow-sm mt-1 wwrap"},W={class:"text-muted"},X={class:"text-muted"},Y={key:0},Z={class:"d-flex align-items-center flex-gap-1 justify-content-between"},ee=["onClick"],te={class:"d-flex align-items-center justify-content-between px-2 xsmall text-muted flex-gap-1 mt-1"};function se(e,t,_,x,M,P){const u=o("b-icon"),p=o("b-button"),v=o("b-modal"),l=o("b-dropdown-item"),f=o("b-dropdown");return n(),r("div",null,[i(v,{lazy:"true",id:"view-code-modal",title:"Invite","hide-footer":"",size:"lg"},{default:c(()=>[s("div",G,[s("div",H,[t[2]||(t[2]=s("div",{class:"larger mb-1"},"User Email",-1)),s("div",O,m(e.selectedInvite.data.email),1),s("div",Q,[t[1]||(t[1]=s("div",{class:"larger"},"Invite Code",-1)),i(p,{onClick:t[0]||(t[0]=a=>e.copyToClipboard(e.selectedInvite._id)),size:"sm",variant:"link"},{default:c(()=>[i(u,{icon:"copy"})]),_:1})]),s("div",J,m(e.selectedInvite._id),1)]),s("div",null,[t[3]||(t[3]=s("div",{class:"larger"},"Invite created",-1)),s("div",W,m(e.prettyTime(e.selectedInvite.createdAt)),1),t[4]||(t[4]=s("div",{class:"larger mt-3"},"Invite expires",-1)),s("div",X,m(e.prettyTime(e.selectedInvite.expiresAt)),1)])])]),_:1}),e.inviteList&&e.inviteList.length>0?(n(),r("div",Y,[t[8]||(t[8]=s("div",{class:"mb-3"},[s("h5",{class:"text-muted"},"Invites sent"),s("div",{class:"text-muted small"}," Invites sent to users who have not yet joined the family. ")],-1)),(n(!0),r(T,null,L(e.inviteList,(a,b)=>(n(),r("div",{key:b,class:"border rounded my-2 py-2 shadow-sm"},[s("div",Z,[s("div",{class:"ps-2",role:"button",onClick:d=>e.viewInviteCode(a)},m(a.data.email),9,ee),s("div",null,[i(f,{variant:"link",size:"sm","no-caret":"",right:"",class:"text-muted"},{"button-content":c(()=>[i(u,{icon:"three-dots-vertical"})]),default:c(()=>[i(l,{onClick:d=>e.viewInviteCode(a)},{default:c(()=>t[5]||(t[5]=[h(" View invite code ")])),_:2},1032,["onClick"]),i(l,{onClick:d=>e.copyToClipboard(a._id)},{default:c(()=>t[6]||(t[6]=[h(" Copy invite code to clipboard ")])),_:2},1032,["onClick"]),i(l,{onClick:d=>e.cancelInvite(a)},{default:c(()=>t[7]||(t[7]=[h(" Cancel Invite ")])),_:2},1032,["onClick"])]),_:2},1024)])]),s("div",te,[s("div",null,"created "+m(e.prettyTimePast(a.createdAt))+" ago",1),s("div",null,"expires in "+m(e.prettyTimeLeft(a.expiresAt)),1)])]))),128))])):y("",!0)])}const ne=U(q,[["render",se]]),oe=A({name:"AccountEncryption",components:{},mixins:[w],data(){return{errorMessage:null,inviteList:null,selectedInvite:null}},mounted(){},computed:{...B},methods:{prettyTimePast:I,prettyTime:$,prettyTimeLeft:C,async shareKey(e){await N(e._id)&&this.showToast("Key shared with user")},prettyDate:k,async loadPage(){E()}},created(){this.loadPage()}}),ie={key:0},re={class:"d-flex flex-gap-1"},ae={class:"d-flex align-items-center flex-gap-1"},de={class:"larger"},le={class:"mt-3"};function ce(e,t,_,x,M,P){const u=o("b-icon"),p=o("b-spinner"),v=o("b-button");return e.usersReadyForKey&&e.usersReadyForKey.length>0?(n(),r("div",ie,[t[2]||(t[2]=s("div",{class:"mb-3"},[s("h5",{class:"text-muted"},"Pending Requests")],-1)),s("div",re,[(n(!0),r(T,null,L(e.usersReadyForKey,(l,f)=>(n(),r("div",{key:f,class:"my-2 p-3 rounded border shadow-sm card-container"},[s("div",ae,[s("div",de,m(e.textTruncate(l.displayedName||l.username,14)),1)]),t[1]||(t[1]=s("div",{class:"mt-1"}," Click grant to share your account key with this user. This is required to share your account with this user. ",-1)),s("div",le,[i(v,{disabled:e.encLoading,onClick:a=>e.shareKey(l),variant:"primary",class:"text-muted w-100"},{default:c(()=>[e.encLoading?(n(),g(p,{key:1,small:""})):(n(),g(u,{key:0,icon:"key"})),t[0]||(t[0]=h(" Grant "))]),_:2},1032,["disabled","onClick"])])]))),128))])])):y("",!0)}const me=U(oe,[["render",ce]]),ue=A({name:"UsersList",mixins:[w],components:{AddUser:R,ProfileImage:z,AccountInvites:ne,AccountEncryptionActions:me},props:{inlineComponent:{type:Boolean,default:!1},isManageMode:{type:Boolean,default:!1}},data(){return{errorMessage:null,refreshId:0}},mounted(){},computed:{userList(){return this.users?[...this.users].sort(function(e,t){return D(e,t,"username")}):[]}},methods:{prettyTimePast:I,prettyTime:$,prettyTimeLeft:C,prettyDate:k,clickOnUser(e){this.isManageMode&&(e==null?void 0:e.type)!="admin"?e._id==this.currentUserId?this.navigateTo("/settings/loginprefs"):this.navigateTo(`/manage/user/${e._id}/loginprefs`):this.navigateTo(`/user/profile/${e._id}`)},navigateTo(e){return this.$router.push(e)},async newUserCreated(e){await this.RefreshUsers(),this.closeModal("add-user-modal"),this.inlineComponent||this.$router.push(`/manage/user/${e._id}/loginprefs`)}},created(){this.RefreshUsers()}}),pe=["onClick"],ve={class:"t-user-card-sm d-flex shadow justify-content-center align-items-center m-1 p-1 border rounded colItem bottom-offset-container",title:"View User Profile"},fe={class:"text-center imageContainer"},ye={key:0,class:"mt-1 px-1"},he={key:1,style:{"max-width":"155px"},class:"mt-1 px-1"},_e={key:0,class:"t-user-card-sm d-flex justify-content-center align-items-center m-1 p-1 border-dotted rounded colItem bottom-offset-container shadow primary-color",title:"Add User",id:"addUserButton",role:"button"};function ge(e,t,_,x,M,P){const u=o("AddUser"),p=o("b-modal"),v=o("ProfileImage"),l=o("b-icon"),f=o("AccountEncryptionActions"),a=o("AccountInvites"),b=S("b-modal");return n(),r("div",null,[i(p,{lazy:"true",id:"add-user-modal",title:"","hide-footer":"","hide-header":"",size:"lg"},{default:c(()=>[i(u,{class:"my-3",onNewUserCreated:e.newUserCreated,onClose:t[0]||(t[0]=d=>{e.RefreshUsers(),e.closeModal("add-user-modal"),e.refreshId++})},null,8,["onNewUserCreated"])]),_:1}),s("div",{class:F(["d-flex align-items-center flex-wrap mt-3 flex-gap-1",e.isMobile?"justify-content-center":"justify-content-left"])},[(n(!0),r(T,null,L(e.userList,(d,K)=>(n(),r("div",{key:K,onClick:be=>e.clickOnUser(d),role:"button"},[s("div",ve,[s("div",null,[s("div",fe,[i(v,{profileImage:d.profileImage,width:40},null,8,["profileImage"])]),d._id==e.currentUserId?(n(),r("div",ye,t[1]||(t[1]=[s("b",null,"*you",-1)]))):(n(),r("div",he,m(e.textTruncate(d.displayedName||d.username,14)),1))])])],8,pe))),128)),e.isAdminUser?V((n(),r("div",_e,[i(l,{icon:"plus-lg"}),t[2]||(t[2]=h(" Add User "))])),[[b,void 0,void 0,{"add-user-modal":!0}]]):y("",!0)],2),e.isAdminUser?(n(),g(f,{key:e.refreshId,class:"mt-5"})):y("",!0),e.isAdminUser?(n(),g(a,{key:e.refreshId,class:"mt-5"})):y("",!0)])}const ke=U(ue,[["render",ge]]);export{ke as U};

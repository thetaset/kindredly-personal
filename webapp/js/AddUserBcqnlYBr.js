import{P as A}from"./ProfileImageEditorDUcTiiTY.js";import{U as E}from"./UsageLimitsComponentDuaQTkYh.js";import{a as T,_ as N}from"./components.globalDizx_NTC.js";import{d as q,j as a,K as i,z as r,k as t,Q as l,R as b,s as m,m as p,r as d,i as n}from"./@vueC3Nhqlrl.js";const B=q({name:"AddUser",mixins:[T],components:{ProfileImageEditor:A,UsageLimitsComponent:E},data(){return{page:"selectType",userType:null,emailInvite:null,age:null,loadingPage:!0,inviteForm:{inviterName:null,email:null,message:null},addUserForm:{username:null,displayedName:null,email:null,type:"restricted",loginType:"internal",otherSettings:{birthMonth:null,birthYear:null}},user:null,errorMessage:null,loading:!1,accountStats:null}},mounted(){},computed:{canAddUser(){return this.accountStats&&this.accountStats.userCount<=this.accountStats.maxUsers}},methods:{updateBirthYear(){const s=new Date,e=s.getFullYear();this.addUserForm.otherSettings.birthYear=e-this.age,this.addUserForm.otherSettings.birthMonth>=s.getMonth()+1&&this.addUserForm.otherSettings.birthYear--},async saveProfile(){this.page="usageLimits"},async saveUsageLimits(){this.page="userDone"},async finished(){this.$emit("new-user-created",this.user)},async addUser(){if(this.errorMessage=null,!this.addUserForm.username){this.errorMessage="Username is required";return}this.loading=!0,(!this.addUserForm.email||this.addUserForm.email.trim()=="")&&(this.addUserForm.email=null);let s={...this.addUserForm};try{const e=await this.apiReq("/client/auth/createUser",s);this.user=e.result,this.page="selectProfileImage"}catch(e){console.error("Error:",e.message),this.errorMessage=e.message}finally{this.loading=!1}},async sendInvite(){if(this.inviteForm.email==null||this.inviteForm.email.trim()==""||!this.inviteForm.email.includes("@")){this.errorMessage="Email is required",this.showToast("Email is required",{variant:"danger",title:"Error",solid:!0});return}else if(this.inviteForm.inviterName==null||this.inviteForm.inviterName.trim()==""){this.errorMessage="Your name is required",this.showToast("Your name is required",{variant:"danger",title:"Error",solid:!0});return}this.errorMessage=null,this.loading=!0;const s=await this.sendReq("/invite/create",{inviteData:this.inviteForm});s.success?(this.errorMessage=null,this.showToast(`Account Invite Sent to ${this.inviteForm.email}.`,{variant:"info",title:"Invite Sent",solid:!0}),this.$emit("close",!0)):(console.error("Error:",s.message),this.errorMessage=s.message),this.loading=!1},loadUser(){this.sendReq("/user/info",{userId:this.user._id}).then(s=>{s.success?(this.user=s.result,this.errorMessage=null):(console.error("Error:",s.message),this.errorMessage=s.message)})},loadPageData(){this.loadingPage=!0,this.sendReq("/account/stats").then(s=>{s.success?(this.accountStats=s.result,this.errorMessage=null):(console.error("Error:",s.message),this.errorMessage=s.message),this.loadingPage=!1})}},created(){this.loadPageData()}}),P={key:0,class:"m-2"},Y={class:"d-flex flex-column justify-content-between"},D={class:"my-3 larger"},R={class:"d-flex justify-content-end"},H={key:0,class:"alert alert-danger my-3 text-center"},z={key:0},K=["href"],O={key:2},j=["href"],J={key:1},G={class:""},Q={class:"h5"},W={class:"mt-4"},X={class:""},Z={class:"h5"},x={class:"mt-4"},c={key:2},_={class:"mt-4 ms-1 small"},ee=["href"],se={class:"d-flex flex-gap-1 align-items-center flex-warp"},te={class:"d-flex align-items-center flex-gap-1 flex-wrap"},ie={class:"d-flex align-items-center flex-gap-1 flex-wrap"},le={key:1},re={key:3},oe={key:0,class:"text-muted mt-4 ms-1 text-center"},ne={class:"text-muted mb-4"},ae={class:"rounded border p-3 divfit"},de={key:1},ue={key:4},me={key:0,class:"text-muted mt-4 ms-1"},ge={class:"text-muted mb-4"},pe={key:1},fe={key:5},ve={class:"mt-4 ms-1"},be={class:"mt-3"},ye={key:6},Ue={key:1};function ke(s,e,he,Me,we,Fe){var M,w;const f=d("b-icon"),F=d("b-modal"),g=d("b-button"),y=d("b-form-input"),v=d("b-form-group"),V=d("b-form-spinbutton"),u=d("b-form-select-option"),S=d("b-form-select"),h=d("b-alert"),k=d("b-spinner"),U=d("b-button-toolbar"),C=d("ProfileImageEditor"),L=d("UsageLimitsComponent"),$=d("b-link"),I=d("b-form-textarea");return s.loadingPage?m("",!0):(n(),a("div",P,[i(F,{id:"kindredLimitationsModal",title:"Limitations","hide-header":"",size:"md",onOk:s.addUser,"ok-only":"","ok-title":"Continue"},{default:r(()=>[t("div",Y,[t("div",null,[t("div",D,[i(f,{icon:"exclamation-triangle",class:"me-1"}),e[19]||(e[19]=l(" Kindredly is not a substitute for parental supervision. "))]),e[20]||(e[20]=t("div",null,[t("hr"),l(" Kindredly (at this time) does "),t("b",null,"not"),l(" disable icognito mode, prevent users from uninstalling the extension, filter profanity, filter mature content, prevent users from using other software on your computer, or block ads. "),t("br"),t("br"),l(" Kindredly "),t("b",null,"restricts users to content within their library"),l(" but only when the extension is enabled. "),t("br"),t("br"),l(" Future releases will address these limitations. "),t("br")],-1)),e[21]||(e[21]=t("br",null,null,-1))])])]),_:1},8,["onOk"]),t("div",R,[t("div",{role:"button",class:"",onClick:e[0]||(e[0]=o=>s.$emit("close"))},[i(f,{icon:"x",class:"largerx"})])]),!s.canAddUser&&s.accountStats?(n(),a("div",H,[e[22]||(e[22]=t("b",null,"Account limit reached",-1)),e[23]||(e[23]=t("br",null,null,-1)),e[24]||(e[24]=l(" You have reached the limit for the number of users in your account. ")),e[25]||(e[25]=t("br",null,null,-1)),l(" You have "+b(s.accountStats.userCount)+" users and your ",1),s.config.distMarketplace=="apple"?(n(),a("span",z,"plan")):(n(),a("a",{key:1,href:`${s.config.serverHostname}/support`},"plan",8,K)),l(" is limited to "+b(s.accountStats.maxUsers)+". ",1),e[26]||(e[26]=t("br",null,null,-1)),e[27]||(e[27]=l(" Please upgrade your ")),s.config.distMarketplace=="apple"?(n(),a("span",O,"plan")):(n(),a("a",{key:3,href:`${s.config.serverHostname}/support`},"plan",8,j)),e[28]||(e[28]=l(" to add more users. "))])):m("",!0),s.page=="selectType"?(n(),a("div",J,[t("div",null,[t("div",G,[t("div",null,[t("div",Q,[i(f,{class:"ms-1",icon:"person-fill",style:{"font-size":"36px"}}),e[29]||(e[29]=t("div",{class:"mt-2"},"Guardian or Trusted Adult",-1))])]),e[30]||(e[30]=t("div",{class:"text-muted"},"admin user",-1)),e[31]||(e[31]=t("div",{class:"ms-4 my-3"},[t("ul",{class:"ps-0"},[t("li",null,[l(" Suggested for "),t("b",null,"parent, guardian or other trusted adults"),l(" within the household. ")]),t("li",null," Have ability to modify restricted user settings and permissions, add users, etc. "),t("li",null,"Requires a valid email address.")])],-1)),t("div",W,[i(g,{variant:"primary",class:"mt-auto float-right",size:"lg",disabled:!s.canAddUser,onClick:e[1]||(e[1]=o=>{s.userType="admin",s.page="inviteAdmin"})},{default:r(()=>[l(b(s.canAddUser?"Select":"Unavailable: User limit reached"),1)]),_:1},8,["disabled"])])]),e[35]||(e[35]=t("hr",{class:"mt-5"},null,-1)),t("div",X,[t("div",null,[t("div",Z,[i(f,{class:"ms-1",icon:"person-fill-lock",style:{"font-size":"36px"}}),e[32]||(e[32]=t("div",{class:"mt-2"},"Restricted User or Child",-1))])]),e[33]||(e[33]=t("div",{class:"text-muted"},"restricted user",-1)),e[34]||(e[34]=t("div",{class:"ms-4 my-3"},[t("ul",{class:"ps-0"},[t("li",null,[l(" For "),t("b",null,"children"),l(" and users who should have limited web access. ")]),t("li",null,"Do not have complete control over their own settings."),t("li",null," Limits access when using the browser extension or mobile app. ")])],-1)),t("div",x,[i(g,{id:"addUserRestrictedButton",variant:"primary",size:"lg",class:"mt-auto float-right",onClick:e[2]||(e[2]=o=>{s.userType="restricted",s.page="createRestricted"}),disabled:!s.canAddUser},{default:r(()=>[l(b(s.canAddUser?"Select":"Unavailable: User limit reached"),1)]),_:1},8,["disabled"])])])])])):m("",!0),s.page=="createRestricted"?(n(),a("div",c,[e[61]||(e[61]=t("h3",null,"New Restricted or Child User",-1)),t("div",_,[e[36]||(e[36]=l(" When using our ")),t("a",{target:"_blank",href:`https://${s.config.serverHostname}/download`},"Kindredly Browser Extension",8,ee),e[37]||(e[37]=l(", restricted users will ")),e[38]||(e[38]=t("br",null,null,-1)),i(f,{icon:"check"}),e[39]||(e[39]=l(" only be able to view website and content that are in their library. ")),e[40]||(e[40]=t("br",null,null,-1)),i(f,{icon:"check"}),e[41]||(e[41]=l(" have Youtube comments, recommendations and search bar hidden "))]),e[62]||(e[62]=t("div",{class:"mb-4"},null,-1)),i(v,{class:"form-group mt-3"},{default:r(()=>[i(y,{autocorrect:"off",autocapitalize:"off",id:"formUsername",modelValue:s.addUserForm.username,"onUpdate:modelValue":e[3]||(e[3]=o=>s.addUserForm.username=o),placeholder:"Username",required:""},null,8,["modelValue"]),e[42]||(e[42]=t("div",{class:"text-muted small"},"(required) Username used to login.",-1))]),_:1}),i(v,{class:"form-group mt-3"},{default:r(()=>[i(y,{type:"email",id:"formEmail",modelValue:s.addUserForm.email,"onUpdate:modelValue":e[4]||(e[4]=o=>s.addUserForm.email=o),placeholder:"Email",required:""},null,8,["modelValue"]),e[43]||(e[43]=t("div",{class:"text-muted small"},"(optional) User email.",-1))]),_:1}),i(v,{class:"form-group mt-3"},{default:r(()=>[i(y,{autocorrect:"off",autocapitalize:"off",id:"formDisplayedName",modelValue:s.addUserForm.displayedName,"onUpdate:modelValue":e[5]||(e[5]=o=>s.addUserForm.displayedName=o),placeholder:"Displayed Username",required:""},null,8,["modelValue"]),e[44]||(e[44]=t("div",{class:"text-muted small"}," (optional) Name displayed to other users within account. Example, a nickname or first name. ",-1))]),_:1}),t("div",se,[t("div",te,[e[45]||(e[45]=t("div",{class:"text-muted"},"Age",-1)),t("div",null,[i(V,{modelValue:s.age,"onUpdate:modelValue":e[6]||(e[6]=o=>s.age=o),min:"0",max:"150",onChange:s.updateBirthYear},null,8,["modelValue","onChange"])])]),t("div",ie,[e[59]||(e[59]=t("div",{class:"text-muted"},"Birth Month",-1)),t("div",null,[i(S,{modelValue:s.addUserForm.otherSettings.birthMonth,"onUpdate:modelValue":e[7]||(e[7]=o=>s.addUserForm.otherSettings.birthMonth=o),onInput:s.updateBirthYear},{default:r(()=>[i(u,{value:null},{default:r(()=>e[46]||(e[46]=[l("Select")])),_:1}),i(u,{value:1},{default:r(()=>e[47]||(e[47]=[l("1 - January")])),_:1}),i(u,{value:2},{default:r(()=>e[48]||(e[48]=[l("2 - Feburary")])),_:1}),i(u,{value:3},{default:r(()=>e[49]||(e[49]=[l("3 - March")])),_:1}),i(u,{value:4},{default:r(()=>e[50]||(e[50]=[l("4 - April")])),_:1}),i(u,{value:5},{default:r(()=>e[51]||(e[51]=[l("5 - May")])),_:1}),i(u,{value:6},{default:r(()=>e[52]||(e[52]=[l("6 - June")])),_:1}),i(u,{value:7},{default:r(()=>e[53]||(e[53]=[l("7 - July")])),_:1}),i(u,{value:8},{default:r(()=>e[54]||(e[54]=[l("8 - August")])),_:1}),i(u,{value:9},{default:r(()=>e[55]||(e[55]=[l("9 - September")])),_:1}),i(u,{value:10},{default:r(()=>e[56]||(e[56]=[l("10 - October")])),_:1}),i(u,{value:11},{default:r(()=>e[57]||(e[57]=[l("11 - November")])),_:1}),i(u,{value:12},{default:r(()=>e[58]||(e[58]=[l("12 - December")])),_:1})]),_:1},8,["modelValue","onInput"])])])]),e[63]||(e[63]=t("div",{class:"text-muted small mt-1"}," (optional) User's Age and Birth Month ",-1)),s.errorMessage?(n(),p(h,{key:0,class:"m-4",variant:"danger","model-value":!0,innerHTML:s.errorMessage},null,8,["innerHTML"])):m("",!0),i(U,{class:"mt-5"},{default:r(()=>[i(g,{onClick:e[8]||(e[8]=o=>s.page="selectType")},{default:r(()=>e[60]||(e[60]=[l("Back ")])),_:1}),i(g,{id:"createUserButton",variant:"primary",class:"ms-auto",disabled:s.loading,onClick:e[9]||(e[9]=o=>s.showModal("kindredLimitationsModal"))},{default:r(()=>[s.loading?(n(),p(k,{key:0,label:"Loading..."})):(n(),a("span",le,"Create"))]),_:1},8,["disabled"])]),_:1})])):m("",!0),s.page=="selectProfileImage"?(n(),a("div",re,[e[65]||(e[65]=t("h3",null,"User Profile Image",-1)),s.user?(n(),a("div",oe,[t("div",ne," Select a profile image for "+b((M=s.user)==null?void 0:M.username),1),t("div",ae,[i(C,{userId:s.user._id,"profile-image":s.user.profileImage,onUpdated:e[10]||(e[10]=o=>s.loadUser())},null,8,["userId","profile-image"])]),e[64]||(e[64]=t("div",{class:"mb-4"},null,-1))])):m("",!0),s.errorMessage?(n(),p(h,{key:1,class:"m-4",variant:"danger","model-value":!0,innerHTML:s.errorMessage},null,8,["innerHTML"])):m("",!0),i(U,{class:"mt-5 align-items-between"},{default:r(()=>[i(g,{variant:"primary",class:"ms-auto","data-test-id":"saveProfileButton",disabled:s.loading,onClick:e[11]||(e[11]=o=>s.saveProfile())},{default:r(()=>[s.loading?(n(),p(k,{key:0,label:"Loading..."})):(n(),a("span",de,"Next"))]),_:1},8,["disabled"])]),_:1})])):m("",!0),s.page=="usageLimits"?(n(),a("div",ue,[e[66]||(e[66]=t("h3",null,"Usage Limits",-1)),s.user?(n(),a("div",me,[t("div",ge," Set usage limits for "+b((w=s.user)==null?void 0:w.username),1)])):m("",!0),e[67]||(e[67]=t("hr",null,null,-1)),i(L,{userId:s.user._id},null,8,["userId"]),i(U,{class:"mt-5 align-items-between"},{default:r(()=>[i(g,{variant:"primary",class:"ms-auto","data-test-id":"saveUsageLimit",disabled:s.loading,onClick:e[12]||(e[12]=o=>s.saveUsageLimits())},{default:r(()=>[s.loading?(n(),p(k,{key:0,label:"Loading..."})):(n(),a("span",pe,"Next"))]),_:1},8,["disabled"])]),_:1})])):m("",!0),s.page=="userDone"?(n(),a("div",fe,[e[73]||(e[73]=t("h3",null,"Done",-1)),t("div",ve,[e[71]||(e[71]=l(' You may switch to this user at any time by clicking "Switch User" in your menu. ')),t("div",be,[e[69]||(e[69]=l(" Optionally, you can set a password or change settings by visiting the ")),i($,{to:`/manage/user/${s.user._id}/loginprefs`},{default:r(()=>e[68]||(e[68]=[l("user's settings page")])),_:1},8,["to"]),e[70]||(e[70]=l(" at any time. "))])]),i(U,{class:"mt-5 align-items-between"},{default:r(()=>[i(g,{variant:"primary",class:"ms-auto","data-test-id":"finishedButton",onClick:e[13]||(e[13]=o=>s.finished())},{default:r(()=>e[72]||(e[72]=[l(" Finish ")])),_:1})]),_:1})])):m("",!0),s.page=="inviteAdmin"?(n(),a("div",ye,[e[75]||(e[75]=t("h4",null,"Invite Admin User",-1)),e[76]||(e[76]=t("div",{class:"text-muted mt-2 small"}," Admins should be a guardian or trusted adult and can make account changes such as add/invite users, modify restricticted users settings, etc. ",-1)),e[77]||(e[77]=t("div",{class:"mb-4"},null,-1)),i(v,{class:"form-group",label:"","label-for":"formEmail",description:""},{default:r(()=>[i(y,{id:"formEmail",type:"email",modelValue:s.inviteForm.email,"onUpdate:modelValue":e[14]||(e[14]=o=>s.inviteForm.email=o),placeholder:"Email of person you are inviting.",required:""},null,8,["modelValue"])]),_:1}),i(v,{class:"form-group"},{default:r(()=>[i(y,{id:"formYourname",autocapitalize:"off",modelValue:s.inviteForm.inviterName,"onUpdate:modelValue":e[15]||(e[15]=o=>s.inviteForm.inviterName=o),placeholder:"Your name",required:""},null,8,["modelValue"])]),_:1}),i(v,{class:"form-group"},{default:r(()=>[i(I,{id:"forMessage",modelValue:s.inviteForm.message,"onUpdate:modelValue":e[16]||(e[16]=o=>s.inviteForm.message=o),placeholder:"Optional included message"},null,8,["modelValue"])]),_:1}),s.errorMessage?(n(),p(h,{key:0,class:"m-4",variant:"danger","model-value":!0,innerHTML:s.errorMessage},null,8,["innerHTML"])):m("",!0),i(U,{class:"mt-4"},{default:r(()=>[i(g,{onClick:e[17]||(e[17]=o=>s.page="selectType")},{default:r(()=>e[74]||(e[74]=[l("Back ")])),_:1}),i(g,{id:"sendInviteButton",variant:"primary",class:"ms-auto",disabled:s.loading,onClick:e[18]||(e[18]=o=>s.sendInvite())},{default:r(()=>[s.loading?(n(),p(k,{key:0,label:"Loading..."})):(n(),a("span",Ue,"Send Invite"))]),_:1},8,["disabled"])]),_:1})])):m("",!0)]))}const $e=N(B,[["render",ke]]);export{$e as A};

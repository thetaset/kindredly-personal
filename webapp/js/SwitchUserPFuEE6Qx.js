import{P as b}from"./TIIconDefaultCMdnLD-P.js";import{U as k}from"./UpdatePinCsCDl-EF.js";import{a as P,_ as S}from"./components.globalBic2x0kT.js";import{d as M,r as n,i as t,j as i,k as a,K as o,z as l,X as I,Q as d,N as $,F as N,P as C,R as m,s as u,m as V}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";const q=M({name:"SwitchUser",mixins:[P],components:{UpdatePin:k,ProfileImage:b},data(){return{loading:!1,errorMessage:null,pinpass:null,requestPass:!1,selectedUser:null,loginType:null,loginPayload:null}},computed:{otherUsers(){return!this.users||!this.currentUser?[]:this.users.filter(e=>e._id!=this.currentUserId)}},methods:{switchUser(e){var s;this.pinpass=null,this.errorMessage=null,e&&(this.selectedUser=e,((s=this.currentUser)==null?void 0:s.type)=="admin"&&this.selectedUser&&this.selectedUser.type!="admin"?this.executeSwitch():this.requestPass=!0)},resetSwitchModal(){this.requestPass=!1,this.loading=!1,this.selectedUser=null,this.pinpass=null,this.errorMessage=null,this.RefreshUsers()},async executeSwitch(){this.loading=!0;try{if(!this.selectedUser){this.errorMessage="Please select a user";return}await this.SwitchUserWithPin(this.selectedUser._id,this.pinpass),await this.RefreshAll(!1,!1,!1,!1,!0),this.loading=!1,this.closeModal("switch-user-modal"),location.replace(this.appPrefix)}catch(e){this.loading=!1,console.error("Error:",e==null?void 0:e.message),this.requestPass=!1,this.errorMessage=e==null?void 0:e.message;return}}},created(){this.resetSwitchModal()}}),A={key:0},B={key:1},E={key:0},F={key:0},K={key:1},R={key:0},T={key:1},D={key:2},L={class:"mx-3"},j=["onClick","data-test-id","title"],z={class:"text-center"},O={key:3,class:"py-5 text-center"},Q={key:1,class:"text-center m-4"};function W(e,s,X,G,H,J){const p=n("UpdatePin"),h=n("b-form-input"),c=n("b-button"),f=n("b-form"),g=n("ProfileImage"),y=n("b-icon"),w=n("b-link"),U=n("b-spinner"),_=n("b-alert");return t(),i("div",null,[e.currentUser&&e.isAdminUser&&!e.currentUser.hasPin?(t(),i("div",A,[s[5]||(s[5]=a("div",{class:"alert alert-info"}," A PIN is required to switch between users. Please set a PIN between 4 and 10 digits long. ",-1)),o(p,{onClick:s[0]||(s[0]=r=>e.resetSwitchModal())})])):(t(),i("div",B,[e.loading?(t(),i("div",Q,[o(U,{style:{width:"3rem",height:"3rem"},label:"Loading...",variant:"primary"})])):(t(),i("div",E,[e.requestPass&&e.selectedUser?(t(),i("div",F,[o(f,{onSubmit:$(e.executeSwitch,["prevent"])},{default:l(()=>[o(h,{autofocus:"",type:"password",modelValue:e.pinpass,"onUpdate:modelValue":s[1]||(s[1]=r=>e.pinpass=r),placeholder:"Enter PIN or Password",onKeyup:s[2]||(s[2]=I(r=>e.executeSwitch(),["enter"]))},null,8,["modelValue"]),o(c,{variant:"outline-primary",class:"mt-4 float-right",onClick:s[3]||(s[3]=r=>e.executeSwitch())},{default:l(()=>s[6]||(s[6]=[d("Sign In")])),_:1})]),_:1},8,["onSubmit"])])):(t(),i("div",K,[e.loadingUsers?(t(),i("div",R)):!e.users||e.users.length<=1?(t(),i("div",T," No other family members exist. ")):(t(),i("div",D,[a("div",L,[(t(!0),i(N,null,C(e.otherUsers,(r,v)=>(t(),i("div",{onClick:Y=>e.switchUser(r),role:"button",key:v,"data-test-id":`switch${r.username}Option`,title:r.username,class:"d-flex align-items-center flex-gap-2 p-3 border rounded my-3 ps-4 fillrow hoverrow"},[a("div",null,[o(g,{profileImage:r.profileImage,width:40},null,8,["profileImage"])]),a("div",z,m(e.textTruncate(r.displayedName||r.username,20)),1)],8,j))),128))])])),e.isAdminUser?(t(),i("div",O,[o(w,{class:"btn btn-primary",to:"/settings/manageusers",onClick:s[4]||(s[4]=r=>e.$emit("close"))},{default:l(()=>[o(y,{icon:"people"}),s[7]||(s[7]=d(" Manage Family Members "))]),_:1})])):u("",!0)]))]))])),e.errorMessage?(t(),V(_,{key:2,class:"m-4",variant:"danger","model-value":!0},{default:l(()=>[d(m(e.errorMessage),1)]),_:1})):u("",!0)])}const ne=S(q,[["render",W]]);export{ne as default};

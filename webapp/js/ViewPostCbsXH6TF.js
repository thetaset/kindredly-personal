import{a as V,_ as U,Q as B,aF as J,aG as X,p as Z,t as x,o as ee}from"./components.globalBic2x0kT.js";import{E as L,a as W}from"./EmojiPickerCAyg7tug.js";import{d as S,j as n,K as a,z as l,s as r,r as d,i as o,m as h,F as _,P as C,k as i,R as p,p as $,q as E,N as te,L as se,ac as oe,Q as y}from"./@vueC3Nhqlrl.js";import{I as ne}from"./@iconifyDLzQZ07j.js";import{d as ie}from"./@iconify-iconsCsSCFVIT.js";import{P as N,T as O}from"./TIIconDefaultCMdnLD-P.js";import{S as ae}from"./SelectUsersClji3Z4d.js";import{I as re}from"./ItemImagelPteIRA_.js";const le=S({mixins:[V],components:{EmojiPicker:L,EmojiIcon:W},emits:["selected"],props:{reactions:{type:Array,default:()=>[]}},data(){return{showPicker:!1,lookup:null}},computed:{myReaction(){let e=this.reactions.find(t=>t.userId===this.currentUserId);return e?e.reaction:null}},methods:{selectEmoji(e){this.showPicker=!1,this.$emit("selected",e)}},created(){}}),de={class:"emoji-container"},me={key:0,class:"emoji-box"};function ue(e,t,c,g,k,j){const m=d("EmojiIcon"),I=d("b-icon"),b=d("b-button"),u=d("EmojiPicker");return o(),n("div",de,[a(b,{variant:"link",class:"text-muted littleRoundButton",onClick:t[0]||(t[0]=R=>e.showPicker=!e.showPicker)},{default:l(()=>[e.myReaction?(o(),h(m,{key:0,emoji:e.myReaction,class:"largerxx"},null,8,["emoji"])):(o(),h(I,{key:1,icon:"hand-thumbs-up"}))]),_:1}),e.showPicker?(o(),n("div",me,[a(u,{show_arrow:!1,onSelected:e.selectEmoji},null,8,["onSelected"])])):r("",!0)])}const ce=U(le,[["render",ue]]),pe=S({mixins:[V],components:{EmojiPicker:L,Icon:ne,EmojiIcon:W,ProfileImage:N},emits:["selected"],props:{reactions:{type:Array,default:()=>[]}},data(){return{beatingHeartIcon:ie,showPicker:!1,lookup:null}},computed:{reactionList(){return this.reactions.filter(e=>e.userId!==this.currentUserId)},myReaction(){let e=this.reactions.find(t=>t.userId===this.currentUserId);return e==null?void 0:e.reaction}},methods:{},created(){}}),he={class:"emoji-container"},fe={class:"d-flex flex-gap-1"};function ye(e,t,c,g,k,j){const m=d("ProfileImage"),I=d("EmojiIcon"),b=d("b-button");return o(),n("div",he,[e.reactionList.length>0?(o(),h(b,{key:0,variant:"link",class:"pill p-0 hoverrow mt-2",onClick:t[0]||(t[0]=u=>e.showPicker=!e.showPicker)},{default:l(()=>[(o(!0),n(_,null,C(e.reactionList,u=>(o(),n("span",{key:u.userId,class:"me-1"},[a(m,{"profile-image":u.profileImage,class:"",width:16},null,8,["profile-image"]),a(I,{emoji:u.reaction,class:"largerxx overlap-left"},null,8,["emoji"])]))),128))]),_:1})):r("",!0),e.showPicker?(o(),n("div",{key:1,class:"emoji-view-box shadow",onClick:t[1]||(t[1]=u=>e.showPicker=!1)},[(o(!0),n(_,null,C(e.reactions,u=>(o(),n("div",{key:u.userId,class:"d-flex flex-gap-1 justify-content-between my-2"},[i("div",fe,[a(m,{profileImage:u.profileImage,class:"",width:24},null,8,["profileImage"]),i("div",null,p(u.displayName||u.username),1)]),a(I,{emoji:u.reaction,class:"largerx"},null,8,["emoji"])]))),128))])):r("",!0)])}const ge=U(pe,[["render",ye],["__scopeId","data-v-fa6020a7"]]),ve=S({name:"EImage",components:{TIIconDefault:O},props:{fileId:{type:String,required:!0},previewId:{type:String,required:!1},class:{type:String,required:!1},style:{type:Object,required:!1}},data(){return{src:null}},watch:{item(){this.loadImage()}},methods:{async loadImage(){let t=(await B("/client/userfile/getById",{id:this.fileId,previewId:this.previewId},{defaultPrefix:"data:image/jpeg;base64,"})).result;t.startsWith("data:video")&&(t="data:image/jpeg;base64,"+t.split(",")[1]),this.src=t}},created(){this.loadImage()}}),ke=["src"];function Ie(e,t,c,g,k,j){return e.src?(o(),n("img",{key:0,src:e.src,class:$(e.class),style:E(e.style)},null,14,ke)):(o(),n("div",{key:1,class:$(e.class),style:E(e.style)},null,6))}const we=U(ve,[["render",Ie]]),_e=S({name:"EVideo",components:{TIIconDefault:O},props:{fileId:{type:String,required:!0},fileType:{type:String,required:!1},class:{type:String,required:!1},style:{type:Object,required:!1}},data(){return{src:null}},watch:{item(){this.loadImage()}},methods:{async loadImage(){let t=(await B("/client/userfile/getById",{id:this.fileId},{defaultPrefix:"video/mp4"})).result;this.src=t}},created(){this.loadImage()}}),Ce=["src"];function $e(e,t,c,g,k,j){return e.src?(o(),n("video",{key:0,src:e.src,class:$(e.class),style:E(e.style)},null,14,Ce)):(o(),n("div",{key:1,class:$(e.class),style:E(e.style)},null,6))}const be=U(_e,[["render",$e]]),Re=/(https?:\/\/[^\s]+)/g,Te=S({name:"ViewPost",mixins:[V],components:{ItemImage:re,ProfileImage:N,SelectUsers:ae,ReactionPicker:ce,ReactionViewer:ge,EImage:we,EVideo:be},props:{targetUser:{type:Object,default:null},post:{type:Object,required:!0},pageView:{type:Boolean,default:!1},feedEntry:{type:Object,default:null,required:!0}},data(){return{commentText:null,comments:[],errorMessage:null,feed:null,reactions:[],showComments:!1,startReply:!1,showPicker:!1,showPickerReaction:!1,selectedCommentId:null,largeItemData:null,largeItemType:null}},mounted(){},computed:{unReadCommentIds(){var e,t;return new Set(((t=(e=this.feedEntry)==null?void 0:e.feedInfo)==null?void 0:t.unReadCommentIds)||[])},postData(){var e;return((e=this.post)==null?void 0:e.data)||{}},attachments(){var e;return((e=this.post)==null?void 0:e.attachedItems)||[]},isCurrentUser(){return!this.targetUser||this.targetUser._id===this.currentUser._id},sharedWithUsers(){const e=[...this.post.sharedWithUsers];if(!e)return[];if(e.length>0){const t=e.findIndex(c=>c._id===this.currentUserId);if(t>-1){const c=e.splice(t,1);e.unshift(c[0])}}return e.filter(t=>t._id!==this.post.userId).map(t=>(t.displayedName=J(t._id,t.username),t))}},methods:{imageDataToBase64URL:X,async showSecureFile(e,t,c){if(!e)throw this.showToast("Something wrong, no fileId was provided",{variant:"danger"}),new Error("fileId is required");this.uiStore.showLoadingOverlay=!0;try{let k=(await this.apiReq("/client/userfile/getById",{id:e})).result;this.largeItemType=t,this.largeItemData=k}catch(g){console.error(g),this.showToast("Error loading file",{variant:"danger"})}finally{this.uiStore.showLoadingOverlay=!1}},showLargeImage(e){this.largeItemData=e,this.largeItemType="imageFile"},formatText(e){return e?e.replace(Re,'<a href="$1" target="_blank">$1</a>'):""},prettyTimePast:Z,textTruncate:x,selectEmoji(e){e&&(this.commentText=(this.commentText||"")+e),this.showPicker=!1},async selectEmojiReaction(e){e&&(this.commentText=(this.commentText||"")+e),this.showPickerReaction=!1,await this.postComment(null),this.runShowComments()},editSharedWith(){this.showModal("editSharedWithModal"+this.post._id)},async updateSharedWith(e){await this.apiReq("/post/updateSharedWith",{postId:this.post._id,sharedWith:e}),this.closeModal("editSharedWithModal"+this.post._id),this.$emit("update")},openPost(e){var t;this.pageView||(this.targetUser?this.$router.push({name:"ViewPostPage",params:{id:e},query:{targetUserId:(t=this.targetUser)==null?void 0:t._id}}):this.$router.push({name:"ViewPostPage",params:{id:e}}))},async openAttachment(e,t=!1){var c;this.currentUser&&e.data.accountId==((c=this.currentUser)==null?void 0:c.accountId)?this.visit(e.data,{type:"post"},t):e.data.type=="link"?await ee(e.data.url,"_blank"):e.data.type=="col"?this.$router.push("/collection/"+e.data._id):e.data._id&&this.$router.push("/item/"+e.data._id)},async listComments(){const e=await this.sendReq("/client/comment/list",{refType:"post",refId:this.post._id});e.success&&(this.comments=e.result.records)},async listReactions(){const e=await this.sendReq("/reaction/list",{refType:"post",refId:this.post._id});e.success&&(this.reactions=e.result)},async runHideComments(){this.showComments=!1,this.startReply=!1},async runShowComments(){this.showComments=!0,this.startReply=!0,this.updateReadStatus(!0)},runStartReply(){this.runShowComments(),this.$nextTick(()=>{this.$refs.addCommentToPost.focus()})},async deletePost(){if(!await this.getRef("msgBoxConfirm").show("Are you sure you want to delete this post?",{title:"Confirm",okVariant:"danger",okTitle:"Delete Post?",cancelTitle:"Cancel",hideHeaderClose:!1}))return;(await this.sendReq("/post/delete",{postId:this.post._id})).success&&(this.pageView?this.$router.push({name:"MyFeed"}):this.$emit("update"))},async removeFromFeed(){if(!await this.getRef("msgBoxConfirm").show("Are you sure you want to remove this from your feed?",{title:"Confirm",okVariant:"danger",okTitle:"Remove from feed?",cancelTitle:"Cancel",hideHeaderClose:!1}))return;(await this.sendReq("/feed/removePost",{type:"post",postId:this.post._id})).success&&(this.pageView?this.$router.push({name:"MyFeed"}):this.$emit("update"))},async deleteComment(e){if(!await this.getRef("msgBoxConfirm").show("Are you sure you want to delete this comment?",{title:"Confirm",okVariant:"danger",okTitle:"Delete Comment?",cancelTitle:"Cancel",hideHeaderClose:!1}))return;(await this.sendReq("/comment/delete",{commentId:e})).success&&this.listComments()},async updateReadStatus(e){const t=this.comments.map(g=>g._id);(await this.sendReq("/feed/updateReadStatus",{postId:this.post._id,isRead:e,commentIds:t})).success&&(this.feed.isRead=e),this.RefreshStats()},async saveReaction(e){(await this.sendReq("/reaction/save",{refType:"post",refId:this.post._id,reaction:e})).success&&this.listReactions()},async postComment(e){if(!this.commentText){this.errorMessage="Please enter a comment";return}(await this.sendReq("/client/comment/create",{refType:"post",refId:this.post._id,parentId:e,encInfo:this.post.encInfo,data:{text:this.commentText}})).success&&(this.commentText=null,this.listComments())},async updateReaction(e){(await this.sendReq("/feedback/reaction/save",{refType:"post",refId:this.post._id,reaction:e})).success&&this.listReactions()},async loadPage(){var e,t;this.postData.deletedAt||(this.comments=(e=this.post)==null?void 0:e.comments,this.reactions=(t=this.post)==null?void 0:t.reactions,this.feed=this.feedEntry,this.pageView&&(this.showComments=!0,this.startReply=!0,await this.updateReadStatus(!0)))}},created(){this.selectedCommentId=this.$route.query.commentId,this.loadPage()}}),Pe={class:"fsModalClose"},Ue=["src"],Se=["src"],je={key:0,class:"text-muted small mb-3"},Ee={key:1},Ve={class:"d-flex"},qe={class:"w-100 ms-1 t-postcontent"},De={class:"mt-2 d-flex"},Fe={class:"d-flex align-items-center flex-wrap flex-gap-sm"},Me={key:0,class:"me-1 font-weight-bold"},Ae={key:0},Be={key:1},Le={key:0},We={key:1},Ne={key:2},Oe={key:3},He={class:"d-flex flex-wrap mt-1"},ze=["title"],Qe={class:"ms-auto"},Ge={class:"d-flex"},Ke={key:1,class:"my-1 p-1 mx-1"},Ye={key:2,class:"my-1 p-1 mx-1 danger-color"},Je=["role","innerHTML"],Xe={key:0},Ze={key:0,class:"mt-2"},xe=["src"],et={key:1,class:"mt-2"},tt=["onClick"],st=["src","onClick"],ot={key:2,class:"mt-2"},nt=["onClick"],it={class:"centeredIconOverlay"},at={class:"larger rounded px-4"},rt={key:0,class:"d-flex flex-gap-sm align-items-center flex-wrap"},lt=["onClick"],dt=["title"],mt=["onClick"],ut={class:"d-flex flex-gap-sm align-items-center"},ct=["href"],pt={key:1,class:"text-muted"},ht={key:2,class:"text-muted"},ft=["onClick"],yt={class:"d-flex justify-content-between py-1"},gt={key:0},vt={key:0,class:"font-weight-bold"},kt={key:0},It={key:1},wt={key:0},_t={class:"t-commentcontent"},Ct={key:0,class:"mt-2"},$t={class:"t-comments ms-2"},bt={class:"w-100 ms-2"},Rt={class:"d-flex align-items-center"},Tt={class:"d-flex"},Pt={key:0,class:"d-flex"},Ut={key:1,class:"me-1 d-flex"},St=["title"],jt={key:0},Et={key:1,class:"text-muted"},Vt={key:0,class:"ms-auto d-flex align-items-center"},qt=["innerHTML"],Dt={key:1,class:"mt-1 t-replybox mx-1"},Ft={class:"input-group"},Mt={key:2,class:"p-1"};function At(e,t,c,g,k,j){var F;const m=d("b-icon"),I=d("SelectUsers"),b=d("b-modal"),u=d("ProfileImage"),R=d("router-link"),T=d("b-button"),P=d("b-dropdown-item"),q=d("b-dropdown"),D=d("EImage"),H=d("ItemImage"),z=d("ReactionViewer"),Q=d("ReactionPicker"),G=d("BFormTextarea"),K=d("b-alert"),Y=oe("b-popover");return o(),n("div",null,[e.largeItemData?(o(),n("div",{key:0,class:"fsModal",onClick:t[1]||(t[1]=s=>e.largeItemData=null)},[i("div",Pe,[a(m,{icon:"x-lg",class:"fsModalCloseIcon"})]),e.largeItemType=="imageFile"?(o(),n("img",{key:0,src:e.largeItemData,class:"rounded fsImage"},null,8,Ue)):e.largeItemType=="videoFile"?(o(),n("video",{key:1,onClick:t[0]||(t[0]=te(()=>{},["stop"])),src:e.largeItemData,controls:"",class:"rounded fsImage"},null,8,Se)):r("",!0)])):r("",!0),a(b,{lazy:"true",id:"editSharedWithModal"+e.post._id,title:"Edit Shared with","hide-footer":""},{default:l(()=>{var s,f;return[((s=e.post)==null?void 0:s.encInfo)!=null?(o(),n("div",je,[a(m,{icon:"lock",class:"me-1"}),t[14]||(t[14]=y(" This post is encrypted. You can only add family members. Only new posts can be shared with both friends and family. *This limitation will be addressed in the future. "))])):r("",!0),a(I,{userIds:e.post.sharedWith,onUpdate:e.updateSharedWith,nofriends:((f=e.post)==null?void 0:f.encInfo)!=null},null,8,["userIds","onUpdate","nofriends"])]}),_:1},8,["id"]),e.post&&!e.post.deletedAt?(o(),n("div",Ee,[i("div",Ve,[i("div",qe,[i("div",De,[a(R,{class:"p-1",to:`/user/profile/${e.post.userId}`},{default:l(()=>[a(u,{showCircleIcon:!0,class:"me-2",width:50,profileImage:e.post.profileImage},null,8,["profileImage"])]),_:1},8,["to"]),i("div",null,[i("div",Fe,[e.post.userId===e.currentUser._id?(o(),n("div",Me," (you) ")):(o(),h(R,{key:1,to:`/user/profile/${e.post.userId}`,class:"me-1 font-weight-bold notlinktext"},{default:l(()=>[e.isFamilyMemberId(e.post.userId)?(o(),n("div",Ae,p(e.post.displayedName||e.post.username),1)):(o(),n("div",Be,p(e.post.username),1))]),_:1},8,["to"])),t[15]||(t[15]=i("div",{class:""},"·",-1)),e.sharedWithUsers.length>0?(o(!0),n(_,{key:2},C(e.sharedWithUsers,(s,f)=>(o(),h(R,{key:f,class:"d-flex align-items-center",to:`/user/profile/${s._id}`},{default:l(()=>[a(u,{class:"me-1",width:18,profileImage:s.profileImage},null,8,["profileImage"]),s._id===e.currentUserId?(o(),n("div",Le,"(you)")):(o(),n("div",We,p(s.displayedName),1)),f!=e.sharedWithUsers.length-1?(o(),n("span",Ne,", ")):r("",!0)]),_:2},1032,["to"]))),128)):(o(),n("div",Oe,"no one"))]),i("div",He,[i("div",{class:"text-muted small",title:e.post.createdAt,onClick:t[2]||(t[2]=s=>e.openPost(e.post._id))},p(e.prettyTimePast(e.post.createdAt))+" ago ",9,ze)])]),i("div",Qe,[i("div",Ge,[e.feed&&e.isCurrentUser?se((o(),h(T,{key:0,class:"p-1 mx-1 linklike-bw",variant:"link",onClick:t[3]||(t[3]=s=>e.updateReadStatus(!e.feed.isRead))},{default:l(()=>[e.feed&&e.feed.isRead?(o(),h(m,{key:0,icon:"envelope-open"})):r("",!0),e.feed&&!e.feed.isRead?(o(),h(m,{key:1,icon:"envelope-fill"})):r("",!0)]),_:1})),[[Y,`${e.feed.isRead?"Read":"Unread"}`,void 0,{hover:!0,top:!0}]]):r("",!0),e.post.encInfo?r("",!0):(o(),n("div",Ke,[a(m,{icon:"unlock",title:"No encrypted"})])),((F=e.post)==null?void 0:F.decrypted)===!1?(o(),n("div",Ye,[a(m,{icon:"exclamation-triangle",title:"Decryption failed for unknown reason"})])):r("",!0),a(q,{"toggle-class":"m-1 py-0 px-1 linklike-bw","no-caret":"",variant:"link",right:""},{"button-content":l(()=>[a(m,{icon:"three-dots-vertical"})]),default:l(()=>[e.pageView?r("",!0):(o(),h(P,{key:0,to:`/p/${e.post._id}`},{default:l(()=>t[16]||(t[16]=[y("Open")])),_:1},8,["to"])),e.post.userId===e.currentUser._id?(o(),h(P,{key:1,onClick:t[4]||(t[4]=s=>e.editSharedWith())},{default:l(()=>t[17]||(t[17]=[y("Edit shared with")])),_:1})):r("",!0),e.post.userId===e.currentUser._id?(o(),h(P,{key:2,onClick:t[5]||(t[5]=s=>e.deletePost())},{default:l(()=>t[18]||(t[18]=[y("Delete Post")])),_:1})):r("",!0),e.post.userId!==e.currentUser._id?(o(),h(P,{key:3,onClick:t[6]||(t[6]=s=>e.removeFromFeed())},{default:l(()=>t[19]||(t[19]=[y("Remove from Feed")])),_:1})):r("",!0)]),_:1})])])]),i("div",null,[i("div",{class:$(["pt-2 pb-1 t-posttext",e.pageView?"":"t-hoverlikelink"]),role:e.pageView?"":"button",innerHTML:e.formatText(e.postData.text),onClick:t[7]||(t[7]=s=>e.openPost(e.post._id))},null,10,Je),e.attachments&&e.attachments.length>0?(o(),n("div",Xe,[i("div",null,[(o(!0),n(_,null,C(e.attachments,s=>{var f,v;return o(),n("div",{key:s._id,class:"mt-2 d-flex"},[s.type=="image"?(o(),n("div",Ze,[i("img",{src:e.imageDataToBase64URL(s.data),class:"rounded",style:{width:"300px","max-width":"100%"}},null,8,xe)])):r("",!0),s.type=="imageFile"?(o(),n("div",et,[(f=s.data)!=null&&f.fileId?(o(),n("div",{key:0,role:"button",onClick:w=>e.showSecureFile(s.data.fileId,s.type,s.data.imageType),class:"postImageContainer"},[a(D,{fileId:s.data.fileId,previewId:"0",class:"rounded fade-in-fast postImage"},null,8,["fileId"])],8,tt)):(o(),n("img",{key:1,src:`${e.serverAPIURL}/content/post/${e.post._id}/${s.data.imageId}_pre.${s.data.imageType}`,class:"rounded fade-in-fast",style:{"max-width":"90%"},onClick:w=>e.showLargeImage(`${e.serverAPIURL}/content/post/${e.post._id}/${s.data.imageId}.${s.data.imageType}`)},null,8,st))])):r("",!0),s.type=="videoFile"?(o(),n("div",ot,[(v=s.data)!=null&&v.fileId?(o(),n("div",{key:0,role:"button",onClick:w=>e.showSecureFile(s.data.fileId,s.type,s.data.fileType),class:"postImageContainer iconOverlayContainer"},[a(D,{fileId:s.data.fileId,previewId:"0",class:"rounded fade-in-fast postImage"},null,8,["fileId"]),i("div",it,[i("div",at,[a(m,{icon:"play-fill",class:"shadow rounded"})])])],8,nt)):r("",!0)])):r("",!0)])}),128)),i("div",null,[(o(!0),n(_,null,C(e.attachments,s=>{var f,v,w,M;return o(),n("div",{key:s._id,class:"mt-2 link"},[s.type=="libItem"&&(s!=null&&s.data)?(o(),n("div",rt,[i("div",{class:"attachment-image-container rounded",onClick:A=>e.openAttachment(s)},[a(H,{class:"rounded",defaultIconClass:"rounded px-2",item:s.data},null,8,["item"])],8,lt),t[20]||(t[20]=i("div",{class:"ms-1"},null,-1)),i("div",{title:(f=s.data)==null?void 0:f.name,class:"wwrap"},[((v=s.data)==null?void 0:v.url)!=((w=s.data)==null?void 0:w.name)?(o(),n("div",{key:0,onClick:A=>e.openAttachment(s),role:"button",class:""},p(e.textTruncate((M=s.data)==null?void 0:M.name,e.isMobile?30:60)),9,mt)):r("",!0),i("div",ut,[s.data.url?(o(),n("a",{key:0,class:"text-muted",href:s.data.url},p(e.textTruncate(s.data.url,e.isMobile?30:60)),9,ct)):r("",!0),s.data.type=="col"?(o(),n("div",pt," Collection ")):s.data.type=="note"?(o(),n("div",ht," Note ")):s.data.type=="link"?(o(),n("div",{key:3,onClick:A=>e.openAttachment(s,!0),class:"linklike-bw",role:"button"},[a(m,{icon:"info-square"})],8,ft)):r("",!0)])],8,dt)])):r("",!0)])}),128))])])])):r("",!0),i("div",null,[a(z,{reactions:e.reactions},null,8,["reactions"])]),i("div",{class:$(["d-flex flex-gap-1 align-items-center mt-3 mb-1",e.isMobile?"justify-content-between":""])},[a(Q,{reactions:e.reactions,onSelected:e.saveReaction},null,8,["reactions","onSelected"]),i("div",null,[e.startReply?r("",!0):(o(),h(T,{key:0,class:"text-muted littleRoundButton",variant:"link",title:"Reply/Add Comment",onClick:t[8]||(t[8]=s=>e.runStartReply())},{default:l(()=>[a(m,{icon:"chat-left"})]),_:1}))])],2)])])]),i("div",yt,[!e.showComments&&e.comments&&e.comments.length>0?(o(),n("div",gt,[a(T,{size:"sm",variant:"link",onClick:t[9]||(t[9]=s=>e.runShowComments())},{default:l(()=>[a(m,{icon:"chevron-down"}),e.unReadCommentIds.size>0?(o(),n("span",vt,[a(m,{icon:"bell-fill"}),y(" "+p(e.unReadCommentIds.size)+" new comment",1),e.unReadCommentIds.size>1?(o(),n("span",kt,"s")):r("",!0),y(" (out of "+p(e.comments.length)+") ",1)])):(o(),n("span",It,[t[21]||(t[21]=y(" show comment")),e.comments.length>1?(o(),n("span",wt,"s")):r("",!0),y(" ("+p(e.comments.length)+") ",1)]))]),_:1})])):r("",!0)]),i("div",_t,[e.showComments&&e.comments&&e.comments.length>0?(o(),n("div",Ct,[e.pageView?r("",!0):(o(),h(T,{key:0,variant:"link",onClick:t[10]||(t[10]=s=>e.runHideComments())},{default:l(()=>[a(m,{icon:"chevron-up"})]),_:1})),t[24]||(t[24]=i("span",{class:"text-muted small"}," Comments ",-1)),i("div",$t,[(o(!0),n(_,null,C(e.comments,(s,f)=>{var v;return o(),n("div",{key:f,class:"mb-2 d-flex pb-2"},[a(R,{class:"btn",to:`/user/profile/${s.userId}`},{default:l(()=>[a(u,{class:"me-1",showCircle:!1,width:30,profileImage:s.profileImage},null,8,["profileImage"])]),_:2},1032,["to"]),i("div",bt,[i("div",Rt,[i("div",Tt,[s.userId===e.currentUser._id?(o(),n("div",Pt," (you) ")):(o(),n("div",Ut,p(s.displayedName||s.username),1)),t[22]||(t[22]=i("div",{class:"mx-1"},"·",-1)),i("div",{title:s.createdAt},[e.unReadCommentIds.has(s._id)?(o(),n("span",jt,[i("b",null,p(e.prettyTimePast(s.createdAt))+" ago",1)])):(o(),n("span",Et,p(e.prettyTimePast(s.createdAt))+" ago ",1))],8,St)]),s.userId===e.currentUser._id?(o(),n("div",Vt,[a(q,{"toggle-class":"my-0 py-0","no-caret":"",variant:"link",right:""},{"button-content":l(()=>[a(m,{icon:"three-dots-vertical"})]),default:l(()=>[a(P,{onClick:w=>e.deleteComment(s._id)},{default:l(()=>t[23]||(t[23]=[y("Delete ")])),_:2},1032,["onClick"])]),_:2},1024)])):r("",!0)]),i("div",{class:"t-posttext",innerHTML:e.formatText((v=s.data)==null?void 0:v.text)},null,8,qt)])])}),128))])])):r("",!0),e.startReply?(o(),n("div",Dt,[i("div",Ft,[a(G,{ref:"addCommentToPost",class:"me-1",modelValue:e.commentText,"onUpdate:modelValue":t[11]||(t[11]=s=>e.commentText=s),placeholder:"Enter your comment"},null,8,["modelValue"]),a(T,{variant:"primary",class:"",onClick:t[12]||(t[12]=s=>e.postComment(null))},{default:l(()=>t[25]||(t[25]=[y(" Post ")])),_:1})]),a(K,{variant:"danger",show:e.errorMessage,dismissible:"",onDismissed:t[13]||(t[13]=s=>e.errorMessage=null)},{default:l(()=>[y(p(e.errorMessage),1)]),_:1},8,["show"])])):r("",!0)])])):r("",!0),e.post&&e.post.deletedAt?(o(),n("div",Mt," This post has been deleted. ")):r("",!0)])}const Gt=U(Te,[["render",At],["__scopeId","data-v-d1e69060"]]);export{Gt as V};

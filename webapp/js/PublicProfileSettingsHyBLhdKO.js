import{P as k}from"./PublicProfileEditBQPXtV-L.js";import{S as w}from"./SelectImageC6eE4eIL.js";import{a as M,M as C,_ as S}from"./components.global5n24RCIC.js";import{d as U,j as l,K as o,z as a,k as t,Q as n,L as m,R as P,m as h,s as v,r,ac as E,i as s}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";const D="/user/public/update",N={username:null,about:null,enabled:!1,blockedAt:null,blockedContext:{}},$=U({name:"PublicProfileSettings",components:{PublicProfileEdit:k,SelectImage:w},mixins:[M],data(){return{publicId:null,errorMessage:null,cacheUpdate:""}},mounted(){},computed:{hasPublicProfileImage(){var e,i;return((i=(e=this.publicProfile)==null?void 0:e.profileImage)==null?void 0:i.filename)!=null},profileImageFilename(){var i,u;const e=Math.floor(Math.random()*1e6);return((u=(i=this.publicProfile)==null?void 0:i.profileImage)==null?void 0:u.filename)+"?i="+e}},methods:{updateImage(){this.cacheUpdate="?i="+Math.floor(Math.random()*1e6),this.closeModal("public-profile-modal"),this.loadPublicProfile()},getImagePath:C,async createPublicProfile(){if(!this.currentUser){console.log("No user");return}const e=await this.sendReq("/user/public/update",{data:N});e.success?(this.publicId=e.result,await this.RefreshCurrentUser(!0),await this.loadPublicProfile(),this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)},async loadPage(){await this.loadPublicProfile()},async saveImage(e){if(!e||!this.publicProfile){this.errorMessage="error";return}this.closeModal("select-image-modal");const i=await this.sendReq("/user/publicProfileImage/upload",{imageData:e});if(i.success){const u=i.result;await this.updatePublicProfileImage(u),await this.loadPublicProfile()}},async updatePublicProfileImage(e){this.sendReq(D,{data:{profileImage:{type:"file",filename:e}}})}},created(){var e;this.publicId=(e=this.currentUser)==null?void 0:e.publicId,this.loadPage()}}),A={class:"container-fluid-max1200"},R={class:"row"},z={class:"col"},B={class:"h2 my-3"},V={key:0},q={class:"d-flex flex-gap-xs align-items-center mt-4"},x={role:"button"},j=["src"],F={key:1},L={class:"profileImageContainer d-flex align-items-center justify-content-center text-center"},T={role:"button"},W={class:"mt-4"},Y={class:"mt-3"},K={class:"mt-3"},Q={key:0},G={key:1},H={class:"d-flex flex-gap-1 mt-4"},J={key:1},O={key:0},X={class:"my-2"},Z={key:1,class:"alert alert-warning my-2"};function ee(e,i,u,ie,te,oe){const _=r("SelectImage"),p=r("b-modal"),I=r("PublicProfileEdit"),d=r("b-icon"),f=r("b-badge"),b=r("b-button"),y=r("b-link"),c=E("b-modal");return s(),l("div",A,[o(p,{lazy:"true",id:"select-image-modal",title:"Select Image",size:"lg","hide-footer":"","no-close-on-backdrop":"","no-fade":""},{default:a(()=>[o(_,{onSelectImage:e.saveImage,"max-size":400,keepAspectRatio:!0,onClose:i[0]||(i[0]=g=>e.closeModal("select-image-modal"))},null,8,["onSelectImage"])]),_:1}),o(p,{lazy:"true",id:"public-profile-modal",title:"Edit Public Profile Details","hide-footer":""},{default:a(()=>[o(I,{onClose:i[1]||(i[1]=g=>e.updateImage())})]),_:1}),t("div",R,[t("div",z,[t("div",B,[o(d,{icon:"person-square"}),i[3]||(i[3]=n(" Public Profile Settings "))])])]),e.publicProfile?(s(),l("div",V,[t("div",null,[t("div",null,[t("div",q,[m((s(),l("div",x,[e.hasPublicProfileImage?(s(),l("img",{key:0,class:"profileImageContainer",src:e.getImagePathWithDefault(e.profileImageFilename)+e.cacheUpdate},null,8,j)):(s(),l("div",F,[t("div",L,[o(d,{class:"h1",icon:"person"})])]))])),[[c,void 0,void 0,{"select-image-modal":!0}]])])]),m((s(),l("div",T,[t("div",W,[i[4]||(i[4]=t("div",{class:"text-muted"},"Public Username",-1)),t("div",null,P(e.publicProfile.username?e.publicProfile.username:"Not set"),1)]),t("div",Y,[i[5]||(i[5]=t("div",{class:"text-muted"},"About Me",-1)),t("div",null,P(e.publicProfile.about?e.publicProfile.about:"N/A"),1)]),t("div",K,[e.publicProfile.enabled?(s(),l("div",Q,[o(f,{variant:"success"},{default:a(()=>[o(d,{icon:"check-lg"}),i[6]||(i[6]=n(" Enabled "))]),_:1})])):(s(),l("div",G,[o(f,{variant:"secondary"},{default:a(()=>[o(d,{icon:"x-lg"}),i[7]||(i[7]=n(" Disabled "))]),_:1})]))])])),[[c,void 0,void 0,{"public-profile-modal":!0}]]),t("div",H,[e.isAdminUser?m((s(),h(b,{key:0,variant:"outline-primary"},{default:a(()=>[o(d,{icon:"pencil"}),i[8]||(i[8]=n(" Edit "))]),_:1})),[[c,void 0,void 0,{"public-profile-modal":!0}]]):v("",!0),e.publicId&&e.publicProfile&&e.publicProfile.enabled?(s(),h(y,{key:1,to:`/profile/${e.publicId}`,target:"_blank",class:"btn btn-primary d-flex flex-gap-sm align-items-center"},{default:a(()=>[o(d,{icon:"box-arrow-up-right"}),i[9]||(i[9]=n(" View "))]),_:1},8,["to"])):v("",!0)])])])):(s(),l("div",J,[e.isAdminUser?(s(),l("div",O,[t("div",X,[i[11]||(i[11]=n(" You do not have a public profile. Would you like to create a one? ")),i[12]||(i[12]=t("div",{class:"mt-3"},null,-1)),o(b,{variant:"primary",onClick:i[2]||(i[2]=g=>e.createPublicProfile())},{default:a(()=>i[10]||(i[10]=[n("Yes, create a public profile")])),_:1})])])):(s(),l("div",Z," Restircted users cannot publish publicly. "))]))])}const ce=S($,[["render",ee]]);export{ce as default};

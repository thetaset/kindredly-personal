import{a as U,aU as L,_ as T}from"./components.globalSAVxUKYX.js";import{U as k}from"./UsageSummaryGpPi6jO-.js";import{B as w}from"./BonusTimeComponentUJ8yEcTQ.js";import{s as p,f as C,t as D}from"./usageBVbzi9Go.js";import{d as B,j as o,K as a,z as d,m as f,s as r,F as E,P as S,r as n,ac as $,i as t,L as A,Q as g,R as m,k as h}from"./@vueC3Nhqlrl.js";const N=B({name:"UsageLogComponent",mixins:[U],components:{UsageSummary:k,BonusTimeComponent:w},props:{userId:{type:String,default:null,required:!1},refreshInc:{type:Number,required:!1,default:0},hideDetails:{type:Boolean,required:!1,default:!1}},data(){return{loadingUsageLog:!0,usageLog:[],totalDurationTime:-1,timeLeftInfo:null,timeExceeded:!1,startDate:null,intervalTimer:null}},mounted(){},computed:{isCurrentUser(){return!this.userId||this.currentUserId==this.userId}},methods:{prettyTimeLength:L,async loadCurrentUsageInfo(){const e=await this.sendReq("/client/activity/getCurrentUsageSummary",{userId:this.userId});this.timeLeftInfo=e.result.timeLeftInfo,this.timeExceeded=e.result.timeExceeded},async loadActivityLog(){this.loadingUsageLog=!0,this.startDate=p(0);const e=p(1),s=await this.apiReq("/client/activity/getUsageSince",{userId:this.userId,createdAt:e.getTime()}),l=C((s==null?void 0:s.result)||[],this.startDate.getTime(),null);this.totalDurationTime=D(l),this.usageLog=l.reverse(),this.$nextTick(()=>{this.loadingUsageLog=!1})},updateExtraTime(){this.showToast("Extra time updated",{title:"Success",variant:"success",solid:!0}),this.closeModal("modal-edit-extra-time"),this.loadCurrentUsageInfo()}},created(){this.loadCurrentUsageInfo(),this.loadActivityLog()},beforeUnmount(){}}),q={key:0},x={key:1,class:"small border fillrow btn btn-sm p-1 px-2 btn-link",role:"button"},R={key:1,class:"mb-2 mt-4 small"},V={class:"row d-flex align-items-center border-top py-2"},z={class:"wwrap col-2"},F={class:"wwrap col-4"},j={key:0,class:"border-top py-2"},K={key:2};function M(e,s,l,O,P,Q){const y=n("BonusTimeComponent"),I=n("b-modal"),u=n("b-icon"),c=n("b-link"),_=n("UsageSummary"),b=n("b-spinner"),v=$("b-modal");return t(),o("div",null,[a(I,{lazy:"true",id:"modal-edit-extra-time",title:`
  Extra time
      `,"hide-footer":""},{default:d(()=>[a(y,{userId:e.userId,onUpdated:s[0]||(s[0]=i=>e.updateExtraTime())},null,8,["userId"])]),_:1}),e.isAdminUser&&e.isCurrentUser?r("",!0):(t(),o("div",q,[e.timeLeftInfo?(t(),f(_,{key:0,timeLeftInfo:e.timeLeftInfo,userId:e.userId},{default:d(()=>[e.isAdminUser&&e.userId?(t(),f(c,{key:0,class:"btn btn-sm border fillrow p-1 px-2 btn-link",to:`/manage/user/${e.userId}/usagelimits`},{default:d(()=>[a(u,{icon:"sliders"})]),_:1},8,["to"])):r("",!0),e.isAdminUser&&e.userId?A((t(),o("div",x,[a(u,{icon:"plus-lg"}),s[1]||(s[1]=g(" Extra time "))])),[[v,void 0,void 0,{"modal-edit-extra-time":!0}]]):r("",!0)]),_:1},8,["timeLeftInfo","userId"])):r("",!0)])),!e.loadingUsageLog&&!e.hideDetails?(t(),o("div",R,[(t(!0),o(E,null,S(e.usageLog,i=>(t(),o("div",V,[a(c,{class:"wwrap col-6 linklike",title:`${i.contextId}:${i.url}`,href:i.url,target:"_blank"},{default:d(()=>[g(m(e.textTruncate(i.url,50)),1)]),_:2},1032,["title","href"]),h("div",z,m(e.prettyTimeLength(i.endTime-i.startTime,!1,!0)),1),h("div",F,m(new Date(i.startTime).toLocaleString()),1)]))),256)),e.usageLog.length==0?(t(),o("div",j," No activity logged. ")):r("",!0)])):e.hideDetails?r("",!0):(t(),o("div",K,[a(b)]))])}const Y=T(N,[["render",M]]);export{Y as U};

import{a as I,p as g,H as A,t as R,d as C,_ as P}from"./components.globalBic2x0kT.js";import{P as w}from"./PermissionOverrideBlbHpvsG.js";import{A as N}from"./AccessRequestApproverCSZ61EJX.js";import{d as O,r as i,ac as $,i as o,j as n,K as a,z as d,m as v,s as l,k as r,F as D,P as T,R as c,Q as h,L as S}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";import"./TIIconDefaultCMdnLD-P.js";import"./UpdatePinCsCDl-EF.js";import"./PopCollectionSelectorCwff-9C9.js";import"./CreateCollectionDxlS16jr.js";import"./ai_lookup_utilszDX_hcwM.js";import"./ItemImagelPteIRA_.js";const z=O({name:"UserAccessRequests",components:{PermissionOverride:w,AccessRequestApprover:N},props:["userId"],mixins:[I],data(){return{selectedItem:null,loading:!0,requests:[],fields:[{label:"Request Item Key",key:"key",sortable:!1},{key:"status",sortable:!0},{key:"updatedAt",sortable:!0},{label:"",key:"options",sortable:!1}]}},mounted(){},computed:{items(){return this.requests==null?[]:this.requests}},methods:{prettyTimePast:g,prettyTime:A,textTruncate:R,cancelRequest(e){this.sendReq("/access_request/remove",{id:e}).then(t=>{this.loadAccessRequests()})},async openAddItem(){C("openAddItem"),this.closeModal("permission-override-modal"),this.showModal("add-item-accessrequest-modal")},loadAccessRequests(){this.loading=!0,this.sendReq("/access_request/listForUser",{userId:this.userId}).then(e=>{this.requests=e.result,this.loading=!1})},async approverDone(e){this.closeModal("add-item-accessrequest-modal"),await this.loadAccessRequests(),await this.RefreshIndexQuick()}},created(){this.loadAccessRequests(),this.clearPermissionOverrideInfo()}}),B={class:"mb-1"},F=["title"],U={class:"small"},V={key:0},L={class:"d-flex flex-gap-sm"},M={key:0,class:"w-100"},j={key:0},K={key:1};function Q(e,t,E,G,H,Y){const f=i("AccessRequestApprover"),u=i("b-modal"),_=i("PermissionOverride"),m=i("b-button"),q=i("b-icon"),y=i("b-container"),k=$("b-modal");return o(),n("div",null,[a(u,{lazy:"true",id:"add-item-accessrequest-modal",title:"Grant Permission","hide-footer":"",onClose:t[0]||(t[0]=s=>e.clearPermissionOverrideInfo()),size:"lg"},{default:d(()=>[e.selectedItem?(o(),v(f,{key:0,url:e.selectedItem.key,userId:e.currentUserId,onClose:e.approverDone,requestId:e.selectedItem._id},null,8,["url","userId","onClose","requestId"])):l("",!0)]),_:1}),a(u,{lazy:"true",id:"permission-override-modal",title:"Permission Override","hide-footer":""},{default:d(()=>[a(_,{onSuccess:e.openAddItem},null,8,["onSuccess"])]),_:1}),t[3]||(t[3]=r("hr",null,null,-1)),a(y,{class:"container-fluid small"},{default:d(()=>[(o(!0),n(D,null,T(e.items,(s,p)=>(o(),n("div",{key:p,class:"my-2 d-flex align-items-center flex-wrap justify-content-between"},[r("div",null,[r("div",B,[r("div",{class:"larger",title:s.key},c(e.textTruncate(s.key,50)),9,F),r("div",U,c(s.requesterNote),1)]),r("div",null,"Status: "+c(s.status),1),r("div",null,"Submitted "+c(e.prettyTimePast(s.createdAt))+" ago",1),s.approverNote?(o(),n("div",V,"Response: "+c(s.approverNote),1)):l("",!0)]),r("div",L,[a(m,{onClick:b=>e.cancelRequest(s._id),variant:"danger"},{default:d(()=>t[1]||(t[1]=[h("Cancel")])),_:2},1032,["onClick"]),S((o(),v(m,{onClick:b=>e.selectedItem=s,variant:"warning"},{default:d(()=>[a(q,{icon:"shield-lock"}),t[2]||(t[2]=h(" Override"))]),_:2},1032,["onClick"])),[[k,void 0,void 0,{"permission-override-modal":!0}]])]),p<e.items.length-1?(o(),n("hr",M)):l("",!0)]))),128)),e.loading?(o(),n("div",j,"Loading...")):l("",!0),!e.loading&&e.items.length==0?(o(),n("div",K,"You have no pending access requests.")):l("",!0)]),_:1})])}const de=P(z,[["render",Q]]);export{de as default};

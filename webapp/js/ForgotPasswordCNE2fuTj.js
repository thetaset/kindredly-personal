import{_ as C}from"./components.globalDizx_NTC.js";import{j as l,k as o,p as c,K as t,z as a,s as m,Q as d,R as h,m as b,r as p,i as n}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";const P={name:"Register",components:{},data(){return{page:0,uEmail:null,verificationCode:null,password:null,passwordConfirm:null,errorMessage:null,recoveredPassword:null,passwordNotRecoverable:!1}},mounted(){},computed:{},methods:{validationError(s){this.errorMessage=s},resetPasswordRequest(){this.sendReq("/auth/resetPasswordRequest",{uEmail:this.uEmail}).then(s=>{s.success?(this.page=1,this.errorMessage=null):(console.error("Error:",s.message),this.errorMessage=s.message)})},async recoverPassword(){const s=await this.sendReq("/auth/recoverPassword",{verificationCode:this.verificationCode});if(!s.success){this.showToast(s.message,{variant:"danger",title:"Error",solid:!0});return}this.recoveredPassword=s.result,this.recoveredPassword==null&&(this.passwordNotRecoverable=!0)},resetPassword(){if(!this.password||this.password.length<6){this.validationError("Invalid Password. Password should be 6 or more characters and contain at least one number and uppercase letter");return}if(this.password!=this.passwordConfirm){this.validationError("Passwords don't match");return}this.sendReq("/client/resetPassword",{verificationCode:this.verificationCode,password:this.password}).then(s=>{s.success?(this.page=2,this.errorMessage=null):(console.error("Error:",s.message),this.errorMessage=s.message)})}},created(){this.$route.query.verificationCode&&(this.verificationCode=this.$route.query.verificationCode,this.page=1)}},x={style:{"min-height":"600px"},class:"d-flex justify-content-center align-items-center h100"},k={class:"container-box-sm"},E={class:"my-2 text-center"},M={key:0,href:"/"},V=["href"],R={key:0},q={key:1},N={key:0,class:"d-flex flex-column mt-4"},_={class:"mx-2 mt-3"},z={class:"d-flex justify-content-around mt-5"},T={key:1,class:""},U={class:"my-4 text-center"},B={key:0},S={class:"mt-4"},j={class:"d-flex justify-content-around mt-5"},L={key:2,class:"text-center"};function A(s,e,D,H,r,w){const g=p("AppLogo"),f=p("b-form-input"),u=p("b-button"),v=p("b-form-group"),y=p("b-alert");return n(),l("div",x,[o("div",k,[o("div",E,[o("div",{class:c(["text-center",s.isMobile?"mt-3":"mt-5"])},[s.isBrowserMode?(n(),l("a",M,[t(g)])):(n(),l("a",{key:1,href:s.appPrefix},[t(g)],8,V))],2),o("div",{class:c(s.isMobile?"mb-2":"mb-4")},null,2),e[10]||(e[10]=o("h3",null,"Reset Password",-1))]),s.isCustomServer?(n(),l("div",R,e[11]||(e[11]=[o("div",{class:"text-center mt-4"},[o("div",{variant:"warning",show:""}," TODO: Not implemented for personal edition ")],-1)]))):(n(),l("div",q,[r.page==0?(n(),l("div",N,[e[14]||(e[14]=o("br",null,null,-1)),e[15]||(e[15]=o("div",{class:"text-muted my-2 text-center"}," Enter your username or email address to receive a verification code to reset your password ",-1)),o("div",null,[o("div",_,[t(f,{type:"email",onClick:e[0]||(e[0]=i=>r.errorMessage=null),id:"uemail",modelValue:r.uEmail,"onUpdate:modelValue":e[1]||(e[1]=i=>r.uEmail=i),placeholder:"Username or Email",required:""},null,8,["modelValue"])])]),o("div",z,[t(u,{size:"lg",variant:"outline-secondary",href:s.appPrefix},{default:a(()=>e[12]||(e[12]=[d("Cancel")])),_:1},8,["href"]),t(u,{size:"lg",variant:"info",onClick:e[2]||(e[2]=i=>w.resetPasswordRequest())},{default:a(()=>e[13]||(e[13]=[d("Submit")])),_:1})])])):m("",!0),r.page==1?(n(),l("div",T,[o("div",U,[e[16]||(e[16]=d(" Username or Email ")),e[17]||(e[17]=o("br",null,null,-1)),d(" "+h(r.uEmail),1)]),!r.passwordNotRecoverable&&r.recoveredPassword==null?(n(),l("div",B,[e[21]||(e[21]=o("div",{class:"my-4 text-center"}," The verification code was sent to the user's email address. This request will expire in 10 minutes. ",-1)),t(v,{class:"form-group"},{default:a(()=>[t(f,{autocorrect:"off",autocapitalize:"off",onClick:e[3]||(e[3]=i=>r.errorMessage=null),id:"vcode",modelValue:r.verificationCode,"onUpdate:modelValue":e[4]||(e[4]=i=>r.verificationCode=i),placeholder:"Verification Code",required:""},null,8,["modelValue"])]),_:1}),o("div",S,[e[18]||(e[18]=o("div",{class:"text-muted my-2 text-center"}," Enter a new password. Password should be 8 or more characters and contain at least one number and uppercase letter ",-1)),t(v,{class:"form-group"},{default:a(()=>[t(f,{onClick:e[5]||(e[5]=i=>r.errorMessage=null),id:"password",modelValue:r.password,"onUpdate:modelValue":e[6]||(e[6]=i=>r.password=i),type:"password",placeholder:"password",required:""},null,8,["modelValue"])]),_:1}),t(v,{class:"form-group"},{default:a(()=>[t(f,{onClick:e[7]||(e[7]=i=>r.errorMessage=null),id:"passwordConfirm",modelValue:r.passwordConfirm,"onUpdate:modelValue":e[8]||(e[8]=i=>r.passwordConfirm=i),type:"password",placeholder:"confirm password",required:""},null,8,["modelValue"])]),_:1})]),o("div",j,[t(u,{size:"lg",variant:"outline-secondary",href:s.appPrefix},{default:a(()=>e[19]||(e[19]=[d("Cancel")])),_:1},8,["href"]),t(u,{size:"lg",variant:"danger",onClick:e[9]||(e[9]=i=>w.resetPassword())},{default:a(()=>e[20]||(e[20]=[d("Reset Password")])),_:1})])])):m("",!0)])):m("",!0),r.page==2?(n(),l("div",L,[e[23]||(e[23]=d(" Password Reset Successful ")),e[24]||(e[24]=o("br",null,null,-1)),t(u,{class:"m-4",variant:"primary",to:"/"},{default:a(()=>e[22]||(e[22]=[d("Sign in")])),_:1})])):m("",!0),r.errorMessage?(n(),b(y,{key:3,class:"m-4",variant:"danger","model-value":!0,innerHTML:r.errorMessage},null,8,["innerHTML"])):m("",!0)]))])])}const G=C(P,[["render",A]]);export{G as default};

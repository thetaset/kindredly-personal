import{A as z}from"./AddPublishedToLibrarygmjpNrfX.js";import{a as N,F as y,G as j,t as q,C as E,D as _,p as K,E as Y,_ as x}from"./components.globalDizx_NTC.js";import{a2 as Q,d as W,a7 as h,r as n,ac as X,i as r,j as a,K as o,z as i,k as l,R as v,m,p as w,Q as f,s as u,L as $,X as H,ab as J,F as P,P as D,M as Z}from"./@vueC3Nhqlrl.js";import{i as ee,T as te,R as se}from"./subscription.storeBbBC37AO.js";import"./PopCollectionSelectorBW6dnAeB.js";import"./CreateCollectionBbjx_AkR.js";import"./TIIconDefaultB4jiNlod.js";import"./ai_lookup_utilszDX_hcwM.js";import"./ItemImageDmIqiyLE.js";import"./SelectAccountUsers1I4pmgqf.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";const M=Q({publishedSearchFilters:void 0}),oe={publishedSearchFilters:()=>M.publishedSearchFilters},L={setPublishedSearchFilters:e=>{M.publishedSearchFilters=e}},le=W({name:"SearchPublished",mixins:[N],components:{AddPublishedToLibrary:z},data(){return{readySearch:!1,publishedList:[],showFilter:!0,errorMessage:null,loading:!0,categories:null,galleryId:"explorehome",curatedValue:!0,curated:!0,searchValue:null,targetAudiences:[],minAgeGroup:[],eduValue:[],category:null,itemTypes:[],ads:[],cost:[],costDetails:[],content:[],moreAvailable:!1,selectedItemId:null,contentOptions:y().content.map(e=>({value:e.key,text:e.name})),costOptions:y().cost.map(e=>({value:e.key,text:e.name})),adsOptions:y().ads.map(e=>({value:e.key,text:e.name})),costDetailsOptions:y().costDetails.map(e=>({value:e.key,text:e.name})),minAgeGroupOptions:y().minAgeGroup.map(e=>({value:e.key,text:e.name})),targetAudiencesOptions:y().targetAudiences.map(e=>({value:e.key,text:e.name})),eduValueOptions:y().eduValue.map(e=>({value:e.key,text:e.name})),pageNum:0,perPage:10,showBack:!1}},computed:{filtersUsed(){return this.searchValue||this.eduValue.length>0||this.targetAudiences.length>0||this.minAgeGroup.length>0||this.category||this.itemTypes.length>0||this.ads.length>0||this.cost.length>0||this.costDetails.length>0||this.content.length>0},items(){return!this.publishedList||this.publishedList.length==0?[]:(this.publishedList.forEach(e=>{e.isSubscribed=ee(e._id)}),j(this.publishedList))},categoriesMain(){return this.categories?this.categories:[]}},methods:{textTruncate:q,tagName:E,partitionTags:_,prettyTimePast:K,dateToMDYFormat:Y,async toggleSubscribePress(e){this.currentUser?(await te("pub_col",e._id),e.isSubscribed=!e.isSubscribed):this.showModal("please-modal")},saveFilters(){L.setPublishedSearchFilters({curated:this.curated,searchValue:this.searchValue,targetAudiences:this.targetAudiences,minAgeGroup:this.minAgeGroup,eduValue:this.eduValue,category:this.category,itemTypes:this.itemTypes,ads:this.ads,cost:this.cost,costDetails:this.costDetails,content:this.content})},loadFilters(){const e=h(oe.publishedSearchFilters());e&&(this.curated=e.curated,this.searchValue=e.searchValue,this.targetAudiences=e.targetAudiences,this.minAgeGroup=e.minAgeGroup,this.eduValue=e.eduValue,this.category=e.category,this.itemTypes=e.itemTypes,this.ads=e.ads,this.cost=e.cost,this.costDetails=e.costDetails,this.content=e.content)},async resetFilters(){L.setPublishedSearchFilters(null),this.curated=!0,this.curatedValue=!0,this.searchValue=null,this.targetAudiences=[],this.minAgeGroup=[],this.eduValue=[],this.category=null,this.itemTypes=[],this.ads=[],this.cost=[],this.costDetails=[],this.content=[],this.moreAvailable=!1,this.onFilteredSearch()},searchAnyCategory(){this.searchValue=null,this.category=null,this.loadPublished()},loadPublished(){this.onFilteredSearch(0)},showGalleryRowVersion(){return this.items.map(e=>e._id)},async loadCategories(){const e=await this.sendReq("/categories",{availOnly:!0});e.success?(this.categories=e.result,this.categories.sort((t,p)=>t<p?-1:t>p?1:0),this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)},toggleCurated(){if(this.currentUser){if(this.currentUser.type=="restricted"){this.getRef("msgBoxConfirm").show("Restricted users can only view curated items"),this.curated=!0,this.curatedValue=!0;return}}else{this.getRef("msgBoxConfirm").show("You must be logged in to view uncurated items"),this.curated=!0,this.curatedValue=!0;return}this.curated=this.curatedValue,this.onFilteredSearch()},searchCategory(e){this.category==e?this.category=null:this.category=e,this.searchValue=null,this.onFilteredSearch()},searchText(e){e&&e.preventDefault(),this.onFilteredSearch()},onFilteredSearch(e=0){this.loading=!0,this.moreAvailable=!1;const t={searchValue:h(this.searchValue),eduValue:h(this.eduValue),targetAudiences:h(this.targetAudiences),minAgeGroup:h(this.minAgeGroup),category:h(this.category),itemTypes:h(this.itemTypes),ads:h(this.ads),cost:h(this.cost),costDetails:h(this.costDetails),content:h(this.content),curated:h(this.curated)};console.log("searchData",t),this.sendReq("/published/filteredSearch",{searchData:t,pageInfo:{pageNum:e,perPage:this.perPage}}).then(p=>{p.success?(this.saveFilters(),this.pageNum=e,this.moreAvailable=p.result.moreAvailable,this.pageNum==0?this.publishedList=p.result.rows:this.publishedList.push(...p.result.rows),this.errorMessage=null,this.loading=!1):(console.error("Error:",p.message),this.errorMessage=p.message,this.loading=!1)})},loadMore(){this.onFilteredSearch(this.pageNum+1)},addToLibrary(e){this.currentUser?(this.selectedItemId=e,this.showModal("addtolib-modal")):this.showModal("please-modal")},review(e){this.currentUser?window.location.href=`${this.appPrefix}#/review/${e}`:this.showModal("please-modal")},toggleFilter(){const e=document.querySelector("#searchFilter");if(!e){console.error("filter element not found");return}window.getComputedStyle(e).display=="none"||!this.showFilter?(e.style.display="block",this.showFilter=!0):(e.style.display="none",this.showFilter=!1)},hideFilter(){const e=document.querySelector("#searchFilter");if(!e){console.error("filter element not found");return}e.style.display="none",this.showFilter=!1},updatePage(){this.$forceUpdate()},async loadPage(){this.searchValue=this.$route.query.q,this.loadFilters(),se(),this.category=this.$route.query.category,this.showBack=this.$route.query.showBack=="true",this.searchValue?this.searchText(null):this.category?this.onFilteredSearch():this.loadPublished(),this.loadCategories()}},mounted(){this.isMobile&&this.hideFilter()},created(){this.loadPage()}}),ie={class:"text-center m-4"},re=["href"],ne=["href"],ae={class:"text-center m-4"},de={key:0,class:"container mt-4"},ue={class:"alert alert-danger"},he={class:"d-flex justify-content-center align-items-center mb-4"},me={class:"m-1"},pe={class:"d-flex rounded-pill shadow-sm px-3 border py-1"},ce={class:"d-flex align-items-center flex-gap-sm ms-2"},ge={key:0,class:"ms-1 linklike-bw"},fe={class:"d-flex flex-wrap justify-content-center flex-gap-sm mb-4"},be=["onClick"],ye={key:0},ve={class:"mb-3 mx-2 d-flex justify-content-between align-items-center"},ke={class:"ms-3 small"},we={class:"me-2 mt-2"},Ve={key:0,class:"text-center my-3"},Fe={class:"row wwrap"},Ce=["src"],Se={class:"d-flex justify-content-between"},Ae={class:"h5"},$e={class:"d-flex small align-items-center justify-content-end"},Te={class:"text-muted d-flex align-items-center mb-1"},Pe={key:0},De={key:1,class:"small wwrap2"},Le={class:"d-flex mb-2"},Me=["onClick"],Oe={title:"number of ratings",class:"small"},Ie={key:0,class:"small mb-2"},Ue={key:2,class:"mt-3 ms-4 text-muted"};function Ge(e,t,p,Re,Be,ze){const V=n("b-modal"),O=n("AddPublishedToLibrary"),d=n("b-icon"),c=n("b-button"),F=n("b-form-checkbox"),g=n("b-form-group"),b=n("b-form-checkbox-group"),k=n("b-col"),I=n("b-spinner"),C=n("router-link"),U=n("b-rating"),G=n("TruncateExpand"),T=n("b-row"),R=n("b-container"),B=X("b-modal");return r(),a("div",null,[o(V,{lazy:"true",id:"please-modal",title:"Please sign-in or register.","hide-footer":""},{default:i(()=>[l("div",ie,[l("a",{class:"btn btn-lg btn-primary my-4 mx-2",href:`${e.appPrefix}#/register`}," Register ",8,re),l("a",{class:"btn btn-lg btn-outline-primary my-4 mx-2",href:e.appPrefix}," Sign-In ",8,ne)])]),_:1}),o(V,{lazy:"true",id:"addtolib-modal",size:"lg",title:"Add/Import to Library","hide-footer":""},{default:i(()=>[o(O,{itemId:e.selectedItemId,onClose:t[0]||(t[0]=s=>e.updatePage())},null,8,["itemId"])]),_:1}),o(V,{lazy:"true",id:"curator-options-modal",title:"Curator Options","ok-only":""},{default:i(()=>[l("div",ae,[l("pre",null,v(e.showGalleryRowVersion()),1)])]),_:1}),e.isCustomServer?(r(),a("div",de,[l("div",ue,[o(d,{icon:"exclamation-triangle"}),t[28]||(t[28]=l("span",{class:"ms-2"}," TODO: Not yet supported in Personal Server Edition ",-1))])])):(r(),m(R,{key:1,fluid:""},{default:i(()=>[e.showBack?(r(),m(c,{key:0,variant:"link",class:w(["p-1 larger d-flex align-items-center flex-gap-sm",e.isMobile?"justify-content-center mb-1":"justify-content-start"]),title:"Back",to:"/setup/account"},{default:i(()=>[o(d,{icon:"chevron-left"}),t[29]||(t[29]=f(" Back to Setup "))]),_:1},8,["class"])):u("",!0),l("div",he,[l("div",me,[l("div",pe,[t[30]||(t[30]=l("div",{class:"d-flex align-items-center"},null,-1)),$(l("input",{class:"form-control form-control-lg border-0 box-shadow-none nobackground",placeholder:"Search Published",style:{width:"100%"},onKeyup:t[1]||(t[1]=H((...s)=>e.searchText&&e.searchText(...s),["enter"])),"onUpdate:modelValue":t[2]||(t[2]=s=>e.searchValue=s)},null,544),[[J,e.searchValue]]),l("div",ce,[l("div",null,[e.searchValue?(r(),m(c,{key:0,title:"Reset search",variant:"link",class:"m-0 p-0 text-muted hoverrow",onClick:t[3]||(t[3]=s=>e.resetFilters())},{default:i(()=>[o(d,{icon:"x-lg"})]),_:1})):u("",!0)]),o(c,{variant:"link",title:"run search",onClick:t[4]||(t[4]=s=>{e.onFilteredSearch(),e.readySearch=!0}),class:"px-2 py-1 d-flex align-items-center linklike-bw rounded hoverrow"},{default:i(()=>[o(d,{icon:"search"})]),_:1}),l("div",{role:"button",title:"Filters",class:w(["px-2 py-1 d-flex align-items-center linklike-bw rounded hoverrow",(e.showFilter,"")]),onClick:t[5]||(t[5]=s=>e.toggleFilter())},[o(d,{icon:"filter"})],2)])])]),e.showBack?u("",!0):(r(),m(c,{key:0,variant:"link",class:"p-1 px-2 ms-2 larger hoverrow rounded",title:"Featured",to:"/explore"},{default:i(()=>[o(d,{icon:"stars"}),e.isMobile?u("",!0):(r(),a("span",ge,"Featured"))]),_:1}))]),l("div",fe,[(r(!0),a(P,null,D(e.categoriesMain,(s,S)=>(r(),a("div",{role:"button",class:w(["px-2 py-1 rounded border",s==e.category?"fillrow bw-color":"   text-muted"]),key:S,onClick:A=>e.searchCategory(s)},v(s),11,be))),128))]),t[41]||(t[41]=l("hr",null,null,-1)),o(T,{class:"row"},{default:i(()=>[$(o(k,{md:"3",id:"searchFilter",style:{width:"300px"},class:w(["mb-4",e.isMobile?"":" border-end"])},{default:i(()=>[e.publicProfile&&e.publicProfile.curator?(r(),a("div",ye,[$((r(),m(c,{size:"sm",variant:"link"},{default:i(()=>t[31]||(t[31]=[f(" Curator Options ")])),_:1})),[[B,void 0,void 0,{"curator-options-modal":!0}]])])):u("",!0),l("div",ve,[l("div",null,[e.filtersUsed?(r(),a("button",{key:0,class:"btn btn-link btn-sm rounded border",onClick:t[6]||(t[6]=s=>e.resetFilters())}," Clear ")):u("",!0)]),l("div",{role:"button",onClick:t[7]||(t[7]=s=>e.toggleFilter())},[o(d,{icon:"x-lg"})])]),l("div",ke,[o(g,{class:"form-group"},{default:i(()=>[o(F,{onChange:e.toggleCurated,switch:"",modelValue:e.curatedValue,"onUpdate:modelValue":t[8]||(t[8]=s=>e.curatedValue=s)},{default:i(()=>t[32]||(t[32]=[f("Curated Only")])),_:1},8,["onChange","modelValue"])]),_:1}),o(g,{class:"form-group"},{default:i(()=>[o(b,{stacked:"",modelValue:e.itemTypes,"onUpdate:modelValue":t[11]||(t[11]=s=>e.itemTypes=s)},{default:i(()=>[o(F,{onChange:t[9]||(t[9]=s=>e.onFilteredSearch()),value:"link"},{default:i(()=>t[33]||(t[33]=[f("Links")])),_:1}),o(F,{onChange:t[10]||(t[10]=s=>e.onFilteredSearch()),value:"col"},{default:i(()=>t[34]||(t[34]=[f("Collections")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t[35]||(t[35]=l("hr",null,null,-1)),o(g,{class:"form-group"},{default:i(()=>[o(b,{onChange:t[12]||(t[12]=s=>e.onFilteredSearch()),stacked:"",modelValue:e.eduValue,"onUpdate:modelValue":t[13]||(t[13]=s=>e.eduValue=s),options:e.eduValueOptions},null,8,["modelValue","options"])]),_:1}),o(g,{class:"form-group"},{default:i(()=>[o(b,{onChange:t[14]||(t[14]=s=>e.onFilteredSearch()),stacked:"",modelValue:e.minAgeGroup,"onUpdate:modelValue":t[15]||(t[15]=s=>e.minAgeGroup=s),options:e.minAgeGroupOptions},null,8,["modelValue","options"])]),_:1}),o(g,{class:"form-group"},{default:i(()=>[o(b,{onChange:t[16]||(t[16]=s=>e.onFilteredSearch()),stacked:"",modelValue:e.targetAudiences,"onUpdate:modelValue":t[17]||(t[17]=s=>e.targetAudiences=s),options:e.targetAudiencesOptions},null,8,["modelValue","options"])]),_:1}),t[36]||(t[36]=l("hr",null,null,-1)),o(g,{class:"form-group"},{default:i(()=>[o(b,{onChange:t[18]||(t[18]=s=>e.onFilteredSearch()),stacked:"",modelValue:e.cost,"onUpdate:modelValue":t[19]||(t[19]=s=>e.cost=s),options:e.costOptions},null,8,["modelValue","options"])]),_:1}),o(g,{class:"form-group"},{default:i(()=>[o(b,{onChange:t[20]||(t[20]=s=>e.onFilteredSearch()),stacked:"",modelValue:e.ads,"onUpdate:modelValue":t[21]||(t[21]=s=>e.ads=s),options:e.adsOptions},null,8,["modelValue","options"])]),_:1}),o(g,{class:"form-group"},{default:i(()=>[o(b,{onChange:t[22]||(t[22]=s=>e.onFilteredSearch()),stacked:"",modelValue:e.costDetails,"onUpdate:modelValue":t[23]||(t[23]=s=>e.costDetails=s),options:e.costDetailsOptions},null,8,["modelValue","options"])]),_:1}),t[37]||(t[37]=l("hr",null,null,-1)),o(g,{class:"form-group"},{default:i(()=>[o(b,{onChange:t[24]||(t[24]=s=>e.onFilteredSearch()),stacked:"",modelValue:e.content,"onUpdate:modelValue":t[25]||(t[25]=s=>e.content=s),options:e.contentOptions},null,8,["modelValue","options"])]),_:1}),l("div",we,[l("button",{class:"btn btn-link ms-auto",onClick:t[26]||(t[26]=s=>e.resetFilters())}," reset filter ")])])]),_:1},8,["class"]),[[Z,e.showFilter]]),o(k,{class:"col mt-3"},{default:i(()=>[e.loading?(r(),a("div",Ve,[o(I,{label:"Loading...",variant:"primary"})])):(r(!0),a(P,{key:1},D(e.items,(s,S)=>(r(),a("div",{class:"mb-1",key:S},[l("div",Fe,[o(k,{md:"3",class:"d-flex justify-content-center mb-3"},{default:i(()=>[o(C,{to:`/v/${s._id}`,class:"itemImageContainer"},{default:i(()=>[l("img",{class:"rounded itemImage",src:s.imageFilename,alt:""},null,8,Ce)]),_:2},1032,["to"])]),_:2},1024),o(k,{class:"col"},{default:i(()=>[l("div",Se,[l("span",Ae,[o(C,{class:"wwrap2",to:`/v/${s._id}`},{default:i(()=>[f(v(s.name||s.url),1)]),_:2},1032,["to"])]),l("div",$e,[s.type=="col"&&!s.inLibrary?(r(),m(c,{key:0,size:"sm",class:"px-sm",title:s.isSubscribed?"subscribed":"subscribe",variant:"link",onClick:A=>e.toggleSubscribePress(s)},{default:i(()=>[s.isSubscribed?(r(),m(d,{key:0,icon:"bookmark-fill"})):(r(),m(d,{key:1,icon:"bookmark"}))]),_:2},1032,["title","onClick"])):u("",!0),!s.inLibrary&&s.publishType!="feed"?(r(),m(c,{key:1,class:"px-sm",size:"sm",title:"Add/Import to library",variant:"link",onClick:A=>e.addToLibrary(s._id)},{default:i(()=>[o(d,{icon:"save"})]),_:2},1032,["onClick"])):(r(),m(c,{key:2,class:"px-sm",size:"sm",variant:"link",title:"In Library",to:`/v/${s._id}`},{default:i(()=>[o(d,{icon:"check"})]),_:2},1032,["to"]))])]),l("div",Te,[s.type=="col"?(r(),m(C,{key:0,to:`/profile/${s.publicUserId}`,class:"small white-color rounded px-2 blue-bg shadow-sm"},{default:i(()=>[s.type=="col"?(r(),a("span",Pe,[o(d,{icon:`${s.publishType=="feed"?"rss":"collection"}`},null,8,["icon"]),f(" "+v(s.publishType=="feed"?"Collection Feed":"Collection")+" by "+v(s.username),1)])):u("",!0)]),_:2},1032,["to"])):u("",!0),s.type=="link"?(r(),a("span",De,[o(d,{icon:"link"}),f(" "+v(s.url),1)])):u("",!0)]),l("div",Le,[l("div",{onClick:A=>e.review(s._id),role:"button"},[o(U,{class:"ps-0 pe-1","no-border":"",readonly:"",size:"sm",inline:"",value:s.overallRating},null,8,["value"])],8,Me),l("div",Oe,v(s.numRatings||"no ratings yet"),1)]),s.description?(r(),a("div",Ie,[o(G,{content:s.description,class:"wwrap"},{default:i(()=>t[38]||(t[38]=[l("span",{class:"linklike ms-1",role:"button"},"more",-1)])),_:2},1032,["content"])])):u("",!0)]),_:2},1024)]),t[39]||(t[39]=l("hr",null,null,-1))]))),128)),!e.loading&&e.publishedList.length==0?(r(),a("div",Ue," No items found ")):u("",!0)]),_:1})]),_:1}),e.moreAvailable?(r(),m(T,{key:1},{default:i(()=>[o(k,{class:"text-center my-4"},{default:i(()=>[o(c,{variant:"primary",onClick:t[27]||(t[27]=s=>e.loadMore())},{default:i(()=>t[40]||(t[40]=[f("Load More")])),_:1})]),_:1})]),_:1})):u("",!0)]),_:1})),t[42]||(t[42]=l("div",{class:"bottom-gap"},null,-1))])}const Ze=x(le,[["render",Ge],["__scopeId","data-v-a9bbaebd"]]);export{Ze as default};

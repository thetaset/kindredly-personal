import{a as y,t as R,l as m,_ as b}from"./components.globalSAVxUKYX.js";import{I as k}from"./ItemImageB4O-XpFn.js";import{A as v}from"./AddItemFromLibraryResultsDW-vejij.js";import{d as M,j as a,k as n,K as l,X as S,z as c,m as g,s as r,R as C,r as d,i,Q as T}from"./@vueC3Nhqlrl.js";const w=M({name:"AddItemFromLibrary",mixins:[y],components:{ItemImage:k,AddItemFromLibraryResults:v},emits:["selectExistingItem","selectExistingItemWithDetails","close"],props:{userId:{type:String,required:!1},targetUserId:{type:String,required:!1},collectionIds:{type:Array,required:!1,default:()=>[]},excludeAllCollections:{type:Boolean,required:!1,default:!1},hideButtons:{type:Boolean,required:!1,default:!1}},data(){return{loading:!1,errorMessage:null,searchText:null,searchResults:null,mode:"search",collections:null,itemInfo:null,requesterUser:{},requesterCollectionIds:[],resultMessage:null}},mounted(){this.$nextTick(()=>{const e=this.$refs.itemSearchBox;e&&e.focus()})},computed:{},methods:{textTruncate:R,async selectExistingItem(e){this.collectionIds&&this.collectionIds.length>0&&await this._addItemToCollection(e);let s=this.searchResults.find(t=>t._id==e);this.RefreshIndexQuick();for(let t=0;t<this.searchResults.length;t++)if(this.searchResults[t]._id==e){this.searchResults.splice(t,1);break}this.$emit("selectExistingItem",e),this.$emit("selectExistingItemWithDetails",s)},async _addItemToCollection(e){var t;const s=await this.sendReq("/item/addToCollections",{collectionIds:this.collectionIds,itemId:e,tempAuthToken:((t=this.permissionOverrideInfo)==null?void 0:t.tokenData)||null});s.success?this.showToast("Item Added",{variant:"success"}):(console.error("Error:",s.message),this.errorMessage=s.message,this.showToast(s.message,{variant:"danger",title:"Error",solid:!0}))},async fetchSuggestions(e=!1){if(this.collectionIds.length==0)return;this.loading=!0,this.resultMessage=null,this.searchText=null,this.mode="suggestions",this.searchResults=null;let s=this.collectionIds[0];const t=await this.sendReq("/client/getRelatedItemsForCollection",{collectionId:s});t.success&&t.result?(this.searchResults=m(t.result,60,!1),this.errorMessage=null):(console.error("Error:",t?t.message:"Unknown"),this.errorMessage=t.message),e&&this.searchResults&&this.searchResults.length==0&&(this.resultMessage="No suggestions found."),this.loading=!1},async runSearch(){this.loading=!0,this.searchResults=null,this.resultMessage=null,this.mode="search";const e=await this.sendReq("/client/searchMain",{searchType:"text",searchLookupValue:this.searchText});e.success&&e.result?(this.searchResults=m(e.result,60,!1),this.excludeAllCollections&&(this.searchResults=this.searchResults.filter(s=>s.type!="col")),this.errorMessage=null):(console.error("Error:",e?e.message:"Unknown"),this.errorMessage=e.message),this.searchResults&&this.searchResults.length==0&&(this.resultMessage="No results found."),this.loading=!1},closeMe(){this.$emit("close",!1)}},created(){this.fetchSuggestions()}}),$={class:"ani-fade-in-fast mt-2"},E={class:"d-flex flex-gap-1 align-items-center mb-3"},A={class:"d-flex flex-gap-1 align-items-center"},B={key:0,class:"d-flex justify-content-between align-items-center mt-2 mb-4"},q={key:1,class:"text-center ani-fade-in-slow mt-3"},x={key:3,class:"mt-2 d-flex"},F={class:"text-muted small ms-2 mt-1 mb-4"},L={key:4,class:"mt-2 d-flex justify-content-end"};function V(e,s,t,D,N,U){const f=d("BFormInput"),h=d("b-icon"),u=d("b-button"),p=d("b-spinner"),I=d("AddItemFromLibraryResults");return i(),a("div",null,[n("div",$,[n("div",E,[l(f,{class:"rounded",ref:"itemSearchBox",modelValue:e.searchText,"onUpdate:modelValue":s[0]||(s[0]=o=>e.searchText=o),placeholder:"Search Library",onKeyup:s[1]||(s[1]=S(o=>e.runSearch(),["enter"])),autofocus:""},null,8,["modelValue"]),n("div",A,[l(u,{disabled:e.loading,onClick:s[2]||(s[2]=o=>e.runSearch()),variant:"link"},{default:c(()=>[l(h,{icon:"search"})]),_:1},8,["disabled"]),e.collectionIds&&e.collectionIds.length>0?(i(),g(u,{key:0,variant:"link",onClick:s[3]||(s[3]=o=>e.fetchSuggestions(!0)),class:"py-0 my-0",disabled:e.loading,title:"Get suggestions from the collection"},{default:c(()=>[l(h,{icon:"stars"})]),_:1},8,["disabled"])):r("",!0)])]),e.mode=="suggestions"&&e.searchResults&&e.searchResults.length>0&&!e.loading?(i(),a("div",B,[s[6]||(s[6]=n("div",{class:"text-muted larger ms-2"}," Suggestions ",-1)),l(u,{variant:"link",onClick:s[4]||(s[4]=o=>e.fetchSuggestions(!0)),class:"py-0 my-0",disabled:e.loading},{default:c(()=>[l(h,{icon:"arrow-clockwise"})]),_:1},8,["disabled"])])):r("",!0),e.loading?(i(),a("div",q,[l(p,{variant:"primary",label:"Loading..."})])):r("",!0),e.searchResults?(i(),g(I,{key:2,searchResults:e.searchResults,onSelectExistingItem:e.selectExistingItem,loading:e.loading},null,8,["searchResults","onSelectExistingItem","loading"])):r("",!0),e.searchResults&&e.searchResults.length==0&&!e.loading&&e.resultMessage?(i(),a("div",x,[n("div",F,C(e.resultMessage),1)])):r("",!0),e.searchResults&&!e.hideButtons?(i(),a("div",L,[l(u,{variant:"primary",disabled:e.loading,onClick:s[5]||(s[5]=o=>e.closeMe())},{default:c(()=>s[7]||(s[7]=[T(" Done ")])),_:1},8,["disabled"])])):r("",!0)]),s[8]||(s[8]=n("div",{class:"bottom-gap-mobile"},null,-1))])}const z=b(w,[["render",V]]);export{z as A};

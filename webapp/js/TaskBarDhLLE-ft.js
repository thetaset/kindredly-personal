import{a as L,o as T,_ as x}from"./components.globalBic2x0kT.js";import{d as G,j as n,k as a,F as g,P as _,s as u,K as h,z as I,r as $,i,Q as y,R as b,m}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";let v=window.browser||window.chrome;const U=G({name:"TaskBar",mixins:[L],props:{counter:{type:Number,default:0}},data(){return{email:null,errorMessage:null,taskButtons:[],tabGroups:[],clickedButton:null,tabs:[],currentTabId:void 0,windowHeight:0,windowWidth:0,timeout:null,finishedLoading:!1}},mounted(){document.addEventListener("click",this.deselectMenu)},computed:{maxItems(){const e=Math.floor(this.windowHeight/50);return e<=1?0:e>6?e-3:e-1},btnList(){return this.taskButtons?this.taskButtons.filter(e=>e.enabled&&e.itemCache.length>0):[]},tabGroupList(){return this.tabGroups?this.tabGroups.length+this.btnList.length>this.maxItems?[]:[...this.tabGroups].sort((e,s)=>e.name<s.name?-1:e.name>s.name?1:0):[]}},methods:{onDebounceResize(){},resizeHandler(e){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.windowHeight=window.innerHeight,this.windowWidth=window.innerWidth,this.onDebounceResize()},500)},deselectMenu(e){e.target.closest(".t-taskbar")||(this.clickedButton=null)},async closeTab(e,s){e.tabs=e.tabs.filter(o=>o.id!==s.id),await v.tabs.remove(s.id),this.loadTaskBar(!1)},async closeGroup(e){for(const s of e.tabs)await v.tabs.remove(s.id);await this.loadTaskBar()},async openItem(e,s){e==="tab"?s.id!=this.currentTabId&&this.openTab(s):e==="item"&&await T(s.url)},async loadTabs(e=!1){let s={};if(this.tabs=await v.tabs.query(s),this.tabs==null&&(this.tabs=[]),e){let o=this.tabs.find(r=>r.active);o&&(o.isCurrentTab=!0,this.currentTabId=o.id)}},async loadTabGroups(){const e={};for(const o of this.tabs){if(!o||o.isCurrentTab||!o.url)continue;const r=new URL(o.url);let d="TAB:"+r.hostname,f=r.hostname,c=!1,p=null;(r.protocol==="chrome:"||r.protocol==="about:"||r.protocol==="moz-extension:"||r.protocol==="chrome-extension:"||r.protocol==="edge:")&&(d="TABzz:tools",c=!0,p="caret-down-fill");let k=e[d];k||(k={name:d,label:f,protocol:r.protocol,tabs:[],useIcon:c,iconName:p,favIconUrl:o.favIconUrl}),k.tabs.push(o),e[d]=k}this.clickedButton=null;let s=Object.values(e);this.tabGroups=s.filter(o=>!(o.tabs.length==1&&o.tabs[0].isCurrentTab))},async clickButton(e,s){if(this.clickedButton===s){this.clickedButton=null;return}if(this.clickedButton=s,e=="item"){const o=this.taskButtons.find(r=>r.name===s);if(o&&o.itemCache.length===1&&o.tabs.length==0){const d=o.itemCache[0].url;await T(d)}}},async openButtonLink(e){const s=`${e.protocol}//${e.label}`;await T(s)},openTab(e){v.windows.update(e.windowId,{focused:!0}),v.tabs.highlight({tabs:[e.index],windowId:e.windowId})},matchUrl(e,s){try{for(const o of s)if(o.test(e))return!0}catch{}return!1},async showTabPreview(e){},async loadTaskBar(e=!0){let s=[];if(this.userPrefs.data.taskbar&&(s=[...this.userPrefs.data.taskbar.filter(o=>o&&o.enabled&&o.itemCache&&o.itemCache.length>0)]),s.forEach(o=>{o.tabs=[]}),!this.isBrowserMode){await this.loadTabs(e),await this.loadTabGroups();for(const o of this.tabs)for(const r of s)for(const d of r.itemCache)try{d&&!d.patternReg&&(d.patternReg=d.patterns.map(c=>new RegExp(`${c.replace("*",".*")}`))),this.matchUrl(o.url,d.patternReg)&&(r.tabs||(r.tabs=[]),r.tabs.push(o))}catch(f){console.log("Error in matchUrl when loading task bar",f)}}this.taskButtons=s},addHook(){window.onfocus=()=>{this.loadTaskBar(!1)}},async load(){await this.loadTaskBar(),this.addHook()}},destroyed(){window.removeEventListener("resize",this.resizeHandler)},created(){this.resizeHandler(),window.addEventListener("resize",this.resizeHandler),this.load()}}),z={key:0,class:"hoverToolContainer t-taskbarcontainer"},E={class:"t-taskbar"},H={class:"d-flex flex-column"},M=["onClick","title"],R={class:"taskButtonImageContainer"},j={key:0,class:"taskButtonBadge"},N={key:0,class:"t-taskbar-sub"},O={class:"d-flex flex-column"},P=["onClick","title"],D=["src"],F={class:"ms-1 subTaskTitle d-flex justify-content-between"},V={class:"text-muted"},q=["title"],W=["onClick"],A=["src"],K={class:"ms-1 subTaskTitle"},Q={key:0,title:"this tab"},S=["onClick"],J={key:0},X={title:"close group",class:"subtaskButtonContainer d-flex align-items-center"},Y=["onClick"],Z={key:0,class:"tabsContainer"},ee={key:0,class:"border-bottom mb-1 mt-1"},te=["onClick","title"],se={class:"taskButtonImageContainer"},ie=["src"],oe={key:3,class:"taskButtonBadge"},ne={key:0,class:"t-taskbar-sub"},ae={key:0,class:"d-flex flex-column"},le={class:"subtaskButtonContainer d-flex align-items-center flex-gap-sm fillrow rounded p-1"},re=["src"],ce={class:"subTaskTitle d-flex justify-content-between"},de={class:"text-muted"},ue=["onClick","title"],he=["title","onMouseover"],me=["onClick"],ke=["src"],be={class:"ms-1 subTaskTitle"},fe={key:0,title:"this tab"},pe=["onClick"],ge={key:0},ve={title:"close group",class:"subtaskButtonContainer d-flex align-items-center"},we=["onClick"],_e={class:"d-flex justify-content-center align-items-center",style:{position:"relative",height:"30px"}};function ye(e,s,o,r,d,f){const c=$("b-icon"),p=$("b-badge"),k=$("router-link");return!e.isMobile&&(e.btnList.length>0||e.tabGroupList.length>0)?(i(),n("div",z,[a("div",E,[a("div",H,[(i(!0),n(g,null,_(e.btnList,(t,B)=>(i(),n("div",{key:`${B}Taskbtn`,class:"taskButtonContainer"},[a("div",{class:"taskButton",role:"button",onClick:l=>e.clickButton("item",t.name),title:t.label},[a("div",R,[h(c,{icon:t.icon},null,8,["icon"]),!e.isBrowserMode&&t.tabs&&t.tabs.length>0?(i(),n("div",j,[h(p,{variant:"primary"},{default:I(()=>[y(b(t.tabs.length),1)]),_:2},1024)])):u("",!0)])],8,M),e.clickedButton==t.name&&t.itemCache.length>0&&t.tabs.length>0?(i(),n("div",N,[a("div",O,[a("div",{role:"button",class:"subtaskButtonContainer d-flex align-items-center fillrow rounded p-1",onClick:l=>e.openItem("item",t.itemCache[0]),title:`Open new: ${t.itemCache[0].url}`},[t.itemCache[0].imageFilename?(i(),n("img",{key:0,src:t.itemCache[0].imageFilename,class:"subTaskImage"},null,8,D)):(i(),m(c,{key:1,icon:"window"})),a("div",F,[a("div",V,b(t.itemCache[0].name),1),h(c,{class:"ms-auto",icon:"box-arrow-up-right"})])],8,P),t.tabs&&t.tabs.length>0?(i(),n(g,{key:0},[s[2]||(s[2]=a("div",{class:"mb-2 mt-1"},null,-1)),(i(!0),n(g,null,_(t.tabs,(l,C)=>(i(),n("div",{title:l.url,key:`${C}subtab`,class:"subtaskButtonContainer d-flex align-items-center justify-content-between p-1"},[a("div",{role:"button",onClick:w=>e.openItem("tab",l),class:"d-flex align-items-center"},[l.favIconUrl?(i(),n("img",{key:0,src:l.favIconUrl,class:"subTaskImage"},null,8,A)):(i(),m(c,{key:1,icon:"window"})),a("div",K,b(l.title),1)],8,W),e.currentTabId==l.id?(i(),n("div",Q," (current) ")):(i(),n("div",{key:1,role:"button",onClick:w=>e.closeTab(t,l),title:"closeTab"},[h(c,{icon:"x-lg"})],8,S))],8,q))),128)),t.tabs.length>0?(i(),n("div",J,[s[1]||(s[1]=a("div",{class:"border-bottom mb-2 mt-1"},null,-1)),a("div",X,[a("div",{role:"button",onClick:l=>e.closeGroup(t),title:"closeTab"},[h(c,{icon:"x-lg"}),s[0]||(s[0]=y(" Close all "))],8,Y)])])):u("",!0)],64)):u("",!0)])])):u("",!0)]))),128)),!e.isBrowserMode&&e.tabGroupList.length>0?(i(),n("div",Z,[e.tabGroupList.length>0&&e.btnList.length>0?(i(),n("div",ee)):u("",!0),(i(!0),n(g,null,_(e.tabGroupList,(t,B)=>(i(),n("div",{key:`${B}tab`,class:"taskButtonContainer"},[a("div",{class:"taskButton",role:"button",onClick:l=>e.clickButton("tabgroup",t.name),title:`${t.label}`},[a("div",se,[t.useIcon?(i(),m(c,{key:0,icon:t.iconName},null,8,["icon"])):t.favIconUrl?(i(),n("img",{key:1,src:t.favIconUrl,class:"taskImage"},null,8,ie)):(i(),m(c,{key:2,icon:"window"})),t.tabs.length>0?(i(),n("div",oe,[h(p,{variant:"primary"},{default:I(()=>[y(b(t.tabs.length),1)]),_:2},1024)])):u("",!0)])],8,te),e.clickedButton==t.name&&t.tabs.length>0?(i(),n("div",ne,[t.tabs&&t.tabs.length>0?(i(),n("div",ae,[a("div",le,[t.favIconUrl?(i(),n("img",{key:0,class:"subTaskImage",src:t.favIconUrl},null,8,re)):(i(),m(c,{key:1,icon:"window"})),a("div",ce,[a("div",de,b(t.label),1),a("div",{onClick:l=>e.openButtonLink(t),title:`Open new: ${t.label}`,role:"button"},[t.label!="newtab"?(i(),m(c,{key:0,icon:"plus-lg"})):u("",!0)],8,ue)])]),s[5]||(s[5]=a("div",{class:"mb-2 mt-1"},null,-1)),(i(!0),n(g,null,_(t.tabs,(l,C)=>(i(),n("div",{title:l.url,key:`${C}subtab`,class:"subtaskButtonContainer d-flex align-items-center p-1 justify-content-between",onMouseover:w=>e.showTabPreview(l)},[a("div",{role:"button",onClick:w=>e.openItem("tab",l),class:"d-flex align-items-center"},[t.favIconUrl?(i(),n("img",{key:0,src:t.favIconUrl,class:"subTaskImage"},null,8,ke)):(i(),m(c,{key:1,icon:"window"})),a("div",be,b(l.title),1)],8,me),e.currentTabId==l.id?(i(),n("div",fe," (current) ")):(i(),n("div",{key:1,role:"button",onClick:w=>e.closeTab(t,l),title:"closeTab",class:""},[h(c,{icon:"x-lg"})],8,pe))],40,he))),128)),t.tabs.length>1?(i(),n("div",ge,[s[4]||(s[4]=a("div",{class:"border-bottom mb-2 mt-1"},null,-1)),a("div",ve,[a("div",{role:"button",onClick:l=>e.closeGroup(t),title:"closeTab"},[h(c,{icon:"x-lg"}),s[3]||(s[3]=y(" Close all "))],8,we)])])):u("",!0)])):u("",!0)])):u("",!0)]))),128))])):u("",!0)])]),a("div",_e,[h(k,{title:"Edit TaskBar",class:"toolBtn text-muted",to:"/settings/taskbar"},{default:I(()=>[h(c,{icon:"pencil-square"})]),_:1})])])):u("",!0)}const Le=x(U,[["render",ye]]);export{Le as default};

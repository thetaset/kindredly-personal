import{a as b,p as w,t as x,_ as I}from"./components.global5n24RCIC.js";import{S as R}from"./SelectUsersB1nJ5zhc.js";import{P as $}from"./TIIconDefaultDZ-9wHcm.js";import{d as P,j as n,k as o,F as V,P as S,s as p,K as r,z as i,r as l,i as a,R as d,Q as m}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";const B=/(https?:\/\/[^\s]+)/g,M=P({name:"ViewComments",mixins:[b],components:{ProfileImage:$,SelectUsers:R},props:{targetUser:{type:Object,default:null},refId:{type:String,required:!0},refType:{type:String,required:!0},isFocused:{type:Boolean,default:!1},refEncInfo:{type:Object,default:null}},data(){return{commentText:null,comments:[],errorMessage:null,startReply:!1}},mounted(){},computed:{},methods:{formatText(e){return e?e.replace(B,'<a href="$1" target="_blank">$1</a>'):""},prettyTimePast:w,textTruncate:x,async listComments(){const e=await this.sendReq("/client/comment/list",{refType:this.refType,refId:this.refId});e.success&&(this.comments=e.result.records)},async runHideComments(){this.startReply=!1},async runShowComments(){this.startReply=!0},runStartReply(){this.runShowComments(),this.$nextTick(()=>{this.$refs.addCommentToPost.focus()})},async deleteComment(e){if(!await this.getRef("msgBoxConfirm").show("Are you sure you want to delete this comment?",{title:"Confirm",okVariant:"danger",okTitle:"Delete Comment?",cancelTitle:"Cancel",hideHeaderClose:!1}))return;(await this.sendReq("/comment/delete",{commentId:e})).success&&this.listComments()},async postComment(e=null){if(!this.commentText){this.errorMessage="Please enter a comment";return}(await this.sendReq("/client/comment/create",{refType:this.refType,refId:this.refId,parentId:e,data:{text:this.commentText},encInfo:this.refEncInfo})).success&&(this.commentText=null,this.listComments())},async loadPage(){this.listComments()}},created(){this.loadPage(),this.startReply=!1}}),F={class:"t-commentcontent"},q={key:0,class:"mt-2"},A={class:"t-comments ms-2"},D={class:"w-100 ms-2"},U={class:"d-flex align-items-center"},E={class:"d-flex"},H={key:0,class:"small d-flex"},N={key:1,class:"me-1 d-flex"},j=["title"],L={class:"text-muted"},z={key:0,class:"ms-auto d-flex align-items-center"},O=["innerHTML"],K={key:1,class:"mt-1 t-replybox ms-1"},Q={class:"d-flex"},G={class:"d-flex w-100"},J={key:2};function W(e,t,f,X,Y,Z){const _=l("ProfileImage"),y=l("router-link"),h=l("b-icon"),g=l("b-dropdown-item"),v=l("b-dropdown"),C=l("BFormTextarea"),c=l("b-button"),T=l("b-alert");return a(),n("div",F,[e.comments&&e.comments.length>0?(a(),n("div",q,[o("div",A,[(a(!0),n(V,null,S(e.comments,(s,k)=>{var u;return a(),n("div",{key:k,class:"mb-2 d-flex pb-2"},[r(y,{to:`/user/profile/${s.userId}`},{default:i(()=>[r(_,{class:"me-1",showCircle:!1,width:30,profileImage:s.profileImage},null,8,["profileImage"])]),_:2},1032,["to"]),o("div",D,[o("div",U,[o("div",E,[s.userId===e.currentUser._id?(a(),n("div",H,"(you)")):(a(),n("div",N,d(s.username),1)),t[4]||(t[4]=o("div",{class:"mx-1"},"Â·",-1)),o("div",{class:"small",title:s.createdAt},[o("span",L,d(e.prettyTimePast(s.createdAt))+" ago ",1)],8,j)]),s.userId===e.currentUser._id?(a(),n("div",z,[r(v,{class:"small","toggle-class":"my-0 py-0","no-caret":"",variant:"link",right:""},{"button-content":i(()=>[r(h,{icon:"caret-down"})]),default:i(()=>[r(g,{onClick:ee=>e.deleteComment(s._id)},{default:i(()=>t[5]||(t[5]=[m("Delete ")])),_:2},1032,["onClick"])]),_:2},1024)])):p("",!0)]),o("div",{class:"t-posttext small",innerHTML:e.formatText((u=s.data)==null?void 0:u.text)},null,8,O)])])}),128))])])):p("",!0),e.startReply?(a(),n("div",K,[o("div",Q,[o("div",G,[r(C,{autofocus:e.isFocused,ref:"addCommentToPost",class:"form-control",modelValue:e.commentText,"onUpdate:modelValue":t[0]||(t[0]=s=>e.commentText=s),placeholder:"Enter a comment"},null,8,["autofocus","modelValue"])]),r(c,{variant:"outline-primary",class:"mx-1 small",onClick:t[1]||(t[1]=s=>e.postComment(null))},{default:i(()=>t[6]||(t[6]=[m(" Add ")])),_:1})]),r(T,{variant:"danger","model-value":!!e.errorMessage,dismissible:"",onDismissed:t[2]||(t[2]=s=>e.errorMessage=null)},{default:i(()=>[m(d(e.errorMessage),1)]),_:1},8,["model-value"])])):(a(),n("div",J,[r(c,{variant:"link",size:"sm",class:"fillrow hoverborder pill px-3 py-1",onClick:t[3]||(t[3]=s=>e.runStartReply())},{default:i(()=>t[7]||(t[7]=[m(" Add Comment ")])),_:1})]))])}const ie=I(M,[["render",W],["__scopeId","data-v-08efc788"]]);export{ie as default};

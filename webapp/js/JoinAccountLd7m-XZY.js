import{P as C}from"./ProviderSigninButtonQ-yv_h1x.js";import{a as I,d as y,_ as b}from"./components.globalSAVxUKYX.js";import{d as k,j as s,k as e,K as i,p as $,L as w,M as _,Q as o,R as d,z as l,r as u,i as a}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";const A=k({name:"JoinAccount",mixins:[I],components:{ProviderSigninButton:C},data(){return{accountInvitationCode:null,inviteInfo:null,alreadyHasAccount:null,loginType:"internal",loginPayload:null,loginUserDetails:null,page:-1,email:void 0,username:void 0,password:void 0,passwordConfirm:void 0,inviteCode:null,errorMessage:null,loading:!0,loadingPage:!0,usingExternalLogin:!1}},mounted(){},computed:{},methods:{async checkSystemStatus(){const t=await this.sendReq("/systemStatus");t.success&&(t.result.underAccountLimit?this.page=1:this.page=0),this.loadingPage=!1},async startMigration(){this.$router.push("/userMigration?accountInvitationCode="+this.accountInvitationCode)},async registerAndJoin(){this.$router.push("/register?accountInvitationCode="+this.accountInvitationCode)},async cancel(){this.$router.push("/")},signout(){this.sendReq("/signout",{}).then(t=>{t.success?(this.LogOut(!0),this.$router.push("/register?accountInvitationCode="+this.accountInvitationCode),this.errorMessage=null):(console.error("Error:",t.message),this.errorMessage=t.message)})},async loadInviteInfo(){this.loading=!0;try{const t=await this.sendReq("/invite/getInfo",{code:this.accountInvitationCode});t.success?(this.inviteInfo=t.result,this.alreadyHasAccount=this.inviteInfo.alreadyHasAccount,this.email=this.inviteInfo.email,y("inviteInfo",this.inviteInfo),this.errorMessage=null):(console.error("Error:",t.message),this.errorMessage=t.message)}finally{this.loading=!1}},async loadPage(){await this.checkSystemStatus(),y("Current appName",this.appName,this.$route.query),this.$route.query.accountInvitationCode&&(this.accountInvitationCode=this.$route.query.accountInvitationCode,await this.loadInviteInfo())}},destroyed(){},created(){this.loadPage()}}),M={style:{"min-height":"600px"},class:"p-2"},P={class:"mt-3 text-center"},L={key:0,href:"/"},S=["href"],N={class:"container d-flex justify-content-center"},j={key:0,class:"my-5 rounded border p-4"},q={key:0,class:"text-center"},E={class:"d-flex mt-5 justify-content-center flex-gap-1 align-items-center"},x={key:1},B={class:"d-flex mt-5 justify-content-center flex-gap-1 align-items-center"},J={key:1},D={class:"text-center"},H={key:2},R={class:"text-center"},V={class:"mt-3 danger-color"},Y={class:"mt-3"},z={class:"mt-2 py-2 mx-1 text-center small"},T=["href"];function U(t,n,K,O,Q,F){var v,f,g,p;const m=u("AppLogo"),c=u("b-icon"),r=u("b-button"),h=u("b-spinner");return a(),s("div",M,[e("div",null,[e("div",P,[t.isBrowserMode?(a(),s("a",L,[i(m)])):(a(),s("a",{key:1,href:t.appPrefix},[i(m)],8,S))]),e("div",{class:$(t.isMobile?"mb-2":"mb-4")},null,2),w(e("div",N,[e("div",null,[t.inviteInfo?(a(),s("div",j,[t.currentUser?(a(),s("div",q,[e("div",null,[i(c,{icon:"info-circle",variant:"info"}),n[1]||(n[1]=o(" You have been invite to join a family account by ")),e("strong",null,d((v=t.inviteInfo)==null?void 0:v.inviterName)+" ("+d((f=t.inviteInfo)==null?void 0:f.inviterEmail)+")",1),n[2]||(n[2]=o(", but you already have an account. ")),n[3]||(n[3]=e("br",null,null,-1)),n[4]||(n[4]=e("br",null,null,-1)),n[5]||(n[5]=e("div",null," You cannot use the same email address for multiple accounts. ",-1))]),n[8]||(n[8]=e("br",null,null,-1)),e("div",E,[i(r,{variant:"primary",onClick:t.signout},{default:l(()=>n[6]||(n[6]=[o("Join with different email")])),_:1},8,["onClick"]),i(r,{variant:"outline-danger",onClick:t.cancel},{default:l(()=>n[7]||(n[7]=[o("Cancel")])),_:1},8,["onClick"])])])):(a(),s("div",x,[i(c,{icon:"info-circle",variant:"info"}),n[11]||(n[11]=o(" You have been invite to join a family account by ")),e("strong",null,d((g=t.inviteInfo)==null?void 0:g.inviterName)+" ("+d((p=t.inviteInfo)==null?void 0:p.inviterEmail)+")",1),n[12]||(n[12]=o(" . ")),n[13]||(n[13]=e("br",null,null,-1)),e("div",B,[i(r,{variant:"primary",onClick:n[0]||(n[0]=G=>t.registerAndJoin())},{default:l(()=>n[9]||(n[9]=[o("Continue")])),_:1}),i(r,{variant:"outline-danger",onClick:t.cancel},{default:l(()=>n[10]||(n[10]=[o("Cancel")])),_:1},8,["onClick"])])]))])):t.loading?(a(),s("div",J,[e("div",D,[i(h,{label:"Loading...",variant:"primary"})])])):(a(),s("div",H,[e("div",R,[e("div",V,[i(c,{icon:"exclamation-triangle",variant:"danger"}),n[14]||(n[14]=o(" Invalid or missing invitation code. "))]),e("div",Y,[i(r,{variant:"outline-primary",onClick:t.cancel},{default:l(()=>n[15]||(n[15]=[o("Cancel")])),_:1},8,["onClick"])])])]))])],512),[[_,!t.loadingPage]])]),e("div",z,[n[16]||(n[16]=o(" Learn more at ")),e("a",{href:`${t.config.serverHostname}`,target:"_blank"},"kindredly.ai",8,T)])])}const on=b(A,[["render",U]]);export{on as default};

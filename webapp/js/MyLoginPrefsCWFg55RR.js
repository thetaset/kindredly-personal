import{_ as P,d as k,a as V,m as z}from"./components.global5n24RCIC.js";import{j as N}from"./jwt-decodeVWaDGczM.js";import{j as a,k as t,R as y,s as u,i,d as L,K as o,z as n,Q as r,L as g,m as v,r as d,ac as B}from"./@vueC3Nhqlrl.js";import{P as j}from"./ProfileImageEditorB55qGTg6.js";import{U as q}from"./UpdatePinCoScHNft.js";import{U as F}from"./UpdatePasswordDdJ5QkqZ.js";import{U as G,P as H}from"./PluginsDiJqh-E-.js";import{P as Y}from"./PublicProfileEditBQPXtV-L.js";import{U as K}from"./UpdateUserInfoDFAreybg.js";import{S as Q}from"./SelectImageC6eE4eIL.js";import{U as W}from"./UpdateUsernameBE-HL23f.js";import{O as J}from"./OptionsComponentCQ7miA5c.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";import"./TIIconDefaultDZ-9wHcm.js";const X={name:"UserSigninLink",components:{},data(){return{user:null,loginType:"internal",loginPlayload:null,loginUserDetails:null,errorMessage:null,loading:!1,loadingPage:!0}},mounted(){this.$loadScript("https://accounts.google.com/gsi/client").then(()=>{this.setupClient()}).catch(s=>{console.error("Error loading script",s)})},computed:{isLinked(){return this.user&&this.user.loginType=="google"}},methods:{setupClient(){google.accounts.id.initialize({client_id:this.config.googleClientId,callback:async s=>{k("Google ID initialized",s);const e=N(s.credential);k(e),this.loginType="google",this.loginPayload=s,this.loginUserDetails=e,this.linkAccount()}}),google.accounts.id.renderButton(document.getElementById("google-button"),{theme:"outline",size:"large",text:"continue_with"}),google.accounts.id.prompt()},linkAccount(){this.errorMessage=null,this.loadingPage=!0,this.sendReq("/auth/linkAuthAccount",{loginType:this.loginType,loginPayload:this.loginPayload,loginUserDetails:this.loginUserDetails}).then(s=>{s.success?(this.$emit("linked"),this.errorMessage=null):(console.error("Error:",s.message),this.errorMessage=s.message),this.loadingPage=!1})}},created(){}},Z={key:0,class:"alert-danger text-center mt-3 alert"};function _(s,e,b,C,h,M){return i(),a("div",null,[e[0]||(e[0]=t("div",{class:"gbuttonwrapper d-flex justify-content-center"},[t("div",{class:"g-signin2",id:"google-button"})],-1)),h.errorMessage?(i(),a("div",Z," Error: "+y(h.errorMessage),1)):u("",!0)])}const x=P(X,[["render",_]]),ee=L({name:"MyLoginPrefs",mixins:[V,z],components:{UpdatePin:q,UpdatePassword:F,UpdateEmail:G,Plugins:H,PublicProfileEdit:Y,UserSigninLink:x,ProfileImageEditor:j,SelectImage:Q,UpdateUserInfo:K,UpdateUsername:W,OptionsComponent:J},data(){return{loading:!1,password:null,errorMessage:null}},mounted(){},computed:{hasInteralLogin(){return this.currentUser&&(!this.currentUser.loginType||this.currentUser.loginType=="internal")},publicId(){var s;return(s=this.currentUser)==null?void 0:s.publicId}},methods:{setCustomBackground(s){this.updateClientSetting("customBackground",s),this.changeToCustomBackground(),this.closeModal("select-image-modal")},deleteUser(){this.sendReq("/user/currentUser/delete",{userId:this.currentUserId}).then(s=>{s.success?(this.showToast("User Deleted",{variant:"success",title:"Success",solid:!0}),this.LogOut(),this.$router.push("/signin"),this.errorMessage=null):(console.error("Error:",s.message),this.errorMessage=s.message,this.showToast(this.errorMessage||"Error",{variant:"danger",title:"Error",solid:!0}))})},async showPassword(){const s=await this.apiReq("/auth/showStoredPassword",{});s.success?this.confirmModal(s.result,{title:"Password",okTitle:"Ok",cancelTitle:"Close",okVariant:"primary",hideHeaderClose:!1},!0):this.showToast("Error: "+s.message,{variant:"danger"})},async sendEmailVerification(){if(!await this.confirmModal("Resend the verification email ?"))return;const e=await this.apiReq("/user/sendEmailVerification");e.success?this.showToast("Verification email sent",{variant:"success"}):this.showToast("Error: "+e.message,{variant:"danger"})},async forcePasswordReset(){try{if(!await this.confirmModal("Force Reset password should only be used if you cannot remember your old password'?",{title:"Reset Password?",okVariant:"danger ",okTitle:"Force Reset Password",cancelTitle:"Cancel",hideHeaderClose:!1}))return;this.loading=!0,await this.apiReq("/auth/forceResetPassword"),this.password=null,await this.RefreshCurrentUser(!0)}catch(s){this.showToast("Error: "+s.message,{variant:"danger"})}this.loading=!1},async verifyAndClearStoredPassword(){this.loading=!0;try{await this.apiReq("/client/auth/clearStoredPassword",{password:this.password}),this.password=null,await this.RefreshCurrentUser(!0)}catch(s){this.showToast("Error: "+s.message,{variant:"danger"})}this.loading=!1},async executeRefreshAll(s=!1){this.loading=!0;try{s?await this.RefreshIndexQuick():await this.RefreshAll(!0,!1,!0),await this.UpdateTaskBar()}catch(e){console.error(e)}finally{this.loading=!1}},closeUserInfoUpdate(){this.RefreshCurrentUser(!0),this.closeModal("editDisplayedNameModal"),this.closeModal("editUsernameModal")},async verifyAndStorePassword(){this.loading=!0;try{await this.apiReq("/client/auth/setStoredPassword",{password:this.password}),this.password=null,await this.RefreshCurrentUser(!0)}catch(s){this.showToast("Error: "+s.message,{variant:"danger"})}this.loading=!1},async storePasswordOnServer(){this.verifyAndStorePassword(),this.closeModal("store-on-server-modal")},async clearPasswordFromServer(){this.verifyAndClearStoredPassword(),this.closeModal("clear-from-server-modal")},async loadPage(){this.checkDarkMode()}},created(){this.loadPage()}}),se={class:"t-viewpage"},te={class:"text-muted mb-3"},oe={class:"alert alert-danger"},re={class:"d-flex justify-content-end mt-4"},ie={class:"d-flex justify-content-end mt-4"},ne={key:0},ae={key:1},le={class:"alert alert-info"},de=["href"],ue={class:"container-fluid-max2k"},me={class:"d-flex flex-wrap flex-gap-1 justify-content-between"},pe={class:"d-flex"},fe={class:"my-2 border rounded"},ce={key:0},ge={class:"mt-3"},ye={class:"mt-3"},ve={key:0,role:"button",class:"linklike small"},he={class:"mt-3"},we={key:0,role:"button",class:"linklike small"},Ue={class:"mt-3"},ke={class:"d-flex flex-gap-sm align-items-center"},Pe={key:0,role:"button",class:"linklike small"},be={key:0},Ce={key:0,class:"small success-color"},Me={key:1,class:"small danger-color mt-2"},Re={key:0,class:"flex-gap-sm d-flex align-items-center"},Te={key:1},Ee={class:"my-2"},Se={class:"mt-1 small text-muted"},Ie={key:0,class:"mt-1"},$e={class:"mt-3"},Ae={key:1,class:"mt-3"},De={key:2,class:"mt-3"},Oe={class:"success-color"},Ve={key:3,class:"mt-3"},ze={class:"success-color"},Ne={key:4,class:"mt-3"},Le={class:"d-flex"},Be={class:"mt-2 d-flex flex-gap-sm"},je={role:"button",class:"rounded border fillrow px-2 py-1 small danger-color"},qe={key:5,class:"mt-3"},Fe={class:"mt-4"};function Ge(s,e,b,C,h,M){const R=d("UpdateUserInfo"),m=d("b-modal"),T=d("UpdateUsername"),E=d("SelectImage"),p=d("b-icon"),S=d("UpdatePin"),w=d("b-form-input"),f=d("b-button"),I=d("UpdatePassword"),U=d("b-alert"),$=d("UserSigninLink"),A=d("UpdateEmail"),D=d("ProfileImageEditor"),O=d("OptionsComponent"),c=B("b-modal");return i(),a("div",se,[o(m,{lazy:"true",id:"editDisplayedNameModal",title:"Edit Displayed Name","hide-footer":""},{default:n(()=>[o(R,{"default-displayed-name":s.currentUser.displayedName,onClose:e[0]||(e[0]=l=>s.closeUserInfoUpdate())},null,8,["default-displayed-name"])]),_:1}),o(m,{lazy:"true",id:"editUsernameModal",title:"Edit Username","hide-footer":""},{default:n(()=>[o(T,{"default-value":s.currentUser.username,onClose:e[1]||(e[1]=l=>s.closeUserInfoUpdate())},null,8,["default-value"])]),_:1}),o(m,{lazy:"true",id:"select-image-modal",title:"Select Image",size:"lg","hide-footer":"","no-close-on-backdrop":""},{default:n(()=>[o(E,{onSelectImage:s.setCustomBackground,"max-size":4e3,keepAspectRatio:!0},null,8,["onSelectImage"])]),_:1}),o(m,{lazy:"true",id:"update-pin-modal",title:"Update PIN","hide-footer":""},{default:n(()=>[t("div",te,[o(p,{icon:"info-circle"}),e[18]||(e[18]=r(" Your pin can be used when switching between accounts. "))]),o(S,{onClose:e[2]||(e[2]=l=>{s.RefreshCurrentUser(),s.closeModal("update-pin-modal")})})]),_:1}),o(m,{lazy:"true",id:"store-on-server-modal",title:"Store password on server?","hide-footer":""},{default:n(()=>[t("div",oe,[o(p,{icon:"exclamation-triangle"}),e[19]||(e[19]=r(" Storing your password on the server is less secure. "))]),o(w,{modelValue:s.password,"onUpdate:modelValue":e[3]||(e[3]=l=>s.password=l),class:"",small:"",placeholder:"Confirm current password",type:"password"},null,8,["modelValue"]),t("div",re,[o(f,{variant:"primary",onClick:e[4]||(e[4]=l=>s.storePasswordOnServer())},{default:n(()=>e[20]||(e[20]=[r("Confirm")])),_:1})])]),_:1}),o(m,{lazy:"true",id:"clear-from-server-modal",title:"Remove password from server?","hide-footer":""},{default:n(()=>[o(w,{modelValue:s.password,"onUpdate:modelValue":e[5]||(e[5]=l=>s.password=l),class:"",small:"",placeholder:"Confirm current password",type:"password"},null,8,["modelValue"]),t("div",ie,[o(f,{variant:"primary",onClick:e[6]||(e[6]=l=>s.clearPasswordFromServer())},{default:n(()=>e[21]||(e[21]=[r("Confirm")])),_:1})])]),_:1}),o(m,{lazy:"true",id:"update-password-modal",title:"Update Password","hide-footer":""},{default:n(()=>[o(I,{onClose:e[7]||(e[7]=l=>{s.RefreshCurrentUser(),s.closeModal("update-password-modal")})})]),_:1}),o(m,{lazy:"true",id:"confirm-delete-modal",title:"Delete this user?",onOk:e[8]||(e[8]=l=>s.deleteUser()),"ok-title":"Delete User (DANGER)","ok-variant":"danger"},{default:n(()=>e[22]||(e[22]=[r(" Are you sure you want to do this?"),t("br",null,null,-1),t("br",null,null,-1),t("b",null,"This cannot be undone!",-1),r(" You will lose all your data. ")])),_:1}),o(m,{lazy:"true",id:"link-account-modal",title:"Link Account",onOk:e[10]||(e[10]=l=>s.deleteUser()),"hide-footer":"","ok-variant":"info"},{default:n(()=>[s.isBrowserMode?(i(),a("div",ne,[o(U,{"model-value":!0,class:"m-3"},{default:n(()=>e[23]||(e[23]=[r(" Warning: Linking your account may impact your ability to login.")])),_:1}),t("div",null,[o($,{onLinked:e[9]||(e[9]=l=>{s.RefreshCurrentUser(),s.closeModal("link-account-modal")})})])])):(i(),a("div",ae,[t("div",le,[e[24]||(e[24]=r(" This cannot be done from the Browser extension. Please login at ")),t("a",{href:s.config.serverHostname},"Kindredly.ai",8,de),e[25]||(e[25]=r(" to link your account. "))])]))]),_:1}),o(m,{lazy:"true",id:"update-email-modal",title:"Update Email Address","hide-footer":""},{default:n(()=>[o(U,{"model-value":!0,class:"m-3"},{default:n(()=>e[26]||(e[26]=[r(" Warning: Changing your email address may impact your ability to login or recover your password. Please be sure you have access to the new email address before changing it. ")])),_:1}),o(A,{onClose:e[11]||(e[11]=l=>{s.closeModal("update-email-modal"),s.RefreshCurrentUser()})})]),_:1}),t("div",ue,[e[50]||(e[50]=t("h2",{class:"my-3"},"Login Profile",-1)),t("div",me,[t("div",null,[t("div",pe,[t("div",fe,[o(D,{onUpdated:e[12]||(e[12]=l=>s.loadPage())})])]),s.currentUser?(i(),a("div",ce,[t("div",ge,[e[27]||(e[27]=t("div",{class:"text-muted"},"User Type:",-1)),t("div",null,y(s.currentUser.type),1)]),t("div",ye,[e[29]||(e[29]=t("div",{class:"text-muted"},"Username:",-1)),t("div",null,[r(y(s.currentUser.username)+" ",1),s.isAdminUser?g((i(),a("span",ve,e[28]||(e[28]=[r(" (edit) ")]))),[[c,void 0,void 0,{editUsernameModal:!0}]]):u("",!0)])]),t("div",he,[e[31]||(e[31]=t("div",{class:"text-muted"},"Displayed Name:",-1)),t("div",null,[r(y(s.currentUser.displayedName)+" ",1),s.isAdminUser?g((i(),a("span",we,e[30]||(e[30]=[r(" (edit) ")]))),[[c,void 0,void 0,{editDisplayedNameModal:!0}]]):u("",!0)])]),t("div",Ue,[e[35]||(e[35]=t("div",{class:"text-muted"},"Email:",-1)),t("div",ke,[r(y(s.currentUser.email||"no email provided")+" ",1),s.isAdminUser?g((i(),a("span",Pe,e[32]||(e[32]=[r(" (edit) ")]))),[[c,void 0,void 0,{"update-email-modal":!0}]]):u("",!0)]),s.needCurrentUserVerification?(i(),a("div",Me,[s.currentUser.email?(i(),a("div",Re,[e[34]||(e[34]=r(" email not verified ")),o(f,{variant:"link",class:"pill border",size:"sm",onClick:e[13]||(e[13]=l=>s.sendEmailVerification())},{default:n(()=>e[33]||(e[33]=[r("Resend Verification Email")])),_:1}),o(f,{variant:"outline-secondary",class:"pill",size:"sm",title:"refresh",onClick:e[14]||(e[14]=l=>s.RefreshCurrentUser(!0))},{default:n(()=>[o(p,{icon:"arrow-clockwise"})]),_:1})])):(i(),a("div",Te,"No email provided. Email is required for your user type."))])):(i(),a("div",be,[s.currentUser.email?(i(),a("div",Ce,"Verified")):u("",!0)])),s.isAdminUser&&s.currentUser?(i(),v(O,{key:2,onUpdateOptions:e[15]||(e[15]=l=>s.RefreshCurrentUser(!0)),selectedOptions:["aiChatEnabled"]})):u("",!0)])])):u("",!0),e[48]||(e[48]=t("hr",null,null,-1)),t("div",Ee,[g((i(),v(f,{variant:"primary"},{default:n(()=>[o(p,{icon:"file-lock"}),r(" "+y(s.currentUser.hasPassword?"Update":"Create ")+" password ",1)]),_:1})),[[c,void 0,void 0,{"update-password-modal":!0}]]),t("div",Se,[e[36]||(e[36]=r(" Password is used to login (when not using Google/Apple signin) and to view or create encrypted data. ")),s.isAdminUser?u("",!0):(i(),a("div",Ie,"(optional for restricted users)"))])]),t("div",$e,[g((i(),v(f,{variant:"primary"},{default:n(()=>[o(p,{icon:"file-lock"}),r(" "+y(s.currentUser.hasPin?"Update your":"Create")+" PIN ",1)]),_:1})),[[c,void 0,void 0,{"update-pin-modal":!0}]]),e[37]||(e[37]=t("div",{class:"mt-1 small text-muted"},"Pins are needed to switch between users within the same account.",-1))]),s.developerMode&&s.currentUser.hasPassword&&!s.currentUser.hasInternalLogin?(i(),a("div",Ae,[o(f,{variant:"danger",onClick:e[16]||(e[16]=l=>s.forcePasswordReset())},{default:n(()=>e[38]||(e[38]=[r("Force Password Reset")])),_:1}),e[39]||(e[39]=t("div",{class:"text-muted mt-2"}," (TODO: deprecate - use recovery key instead) This should only be used if you cannot remember your old password and are NOT using encryption. ",-1))])):u("",!0),e[49]||(e[49]=t("hr",null,null,-1)),s.currentUser&&s.currentUser.loginType=="google"?(i(),a("div",De,[t("span",Oe,[o(p,{icon:"check"}),e[40]||(e[40]=r(" Account is linked to your Google account. "))])])):u("",!0),s.currentUser&&s.currentUser.loginType=="apple"?(i(),a("div",Ve,[t("span",ze,[o(p,{icon:"check"}),e[41]||(e[41]=r(" Account is linked to your Apple account. "))])])):u("",!0),s.developerMode&&s.currentUser.hasPasswordCopy?(i(),a("div",Ne,[t("div",Le,[o(p,{icon:"shield"}),e[42]||(e[42]=t("div",{class:"ms-1"},"Password is stored on server. (TODO: deprecate - use recovery key instead)",-1))]),e[44]||(e[44]=t("div",{class:"d-flex text-muted small"}," This allows you to recover your password if you forget it. Since your password is used for data encryption, you cannot access your data without it. ",-1)),t("div",Be,[t("div",{role:"button",class:"rounded border fillrow px-2 py-1 small",onClick:e[17]||(e[17]=(...l)=>s.showPassword&&s.showPassword(...l))}," View Password "),g((i(),a("div",je,e[43]||(e[43]=[r(" Remove password from server ")]))),[[c,void 0,void 0,{"clear-from-server-modal":!0}]])])])):s.developerMode&&s.currentUser.hasPassword?(i(),a("div",qe,[t("div",null,[g((i(),v(f,{variant:"outline-danger"},{default:n(()=>e[45]||(e[45]=[r(" Store password on server ")])),_:1})),[[c,void 0,void 0,{"store-on-server-modal":!0}]])]),e[46]||(e[46]=t("div",{class:"d-flex text-muted small mt-2"}," (TODO: deprecate - use recovery key instead) Your password is currently not stored on the server. If you lose your password, you will not be able to recover your data. However, storing your password on the server is less secure. ",-1))])):u("",!0),t("div",Fe,[s.isAdminUser?g((i(),v(f,{key:0,id:"deleteUserButton",variant:"danger"},{default:n(()=>[o(p,{icon:"trash"}),e[47]||(e[47]=r(" Delete User "))]),_:1})),[[c,void 0,void 0,{"confirm-delete-modal":!0}]]):u("",!0)])])])])])}const ns=P(ee,[["render",Ge]]);export{ns as default};

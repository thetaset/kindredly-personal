import{a as E,_ as S}from"./components.globalSAVxUKYX.js";import{B as P}from"./BonusTimeComponentUJ8yEcTQ.js";import{d as $,j as a,K as o,z as y,k as i,R as f,s as L,m as k,Q as r,F as U,P as b,r as p,i as s,p as T}from"./@vueC3Nhqlrl.js";const A=$({name:"UsageLimitsComponent",mixins:[E],components:{BonusTimeComponent:P},props:{userId:{type:String,default:null,required:!1},hideExtraTime:{type:Boolean,default:!1,required:!1}},data(){return{defaultUsageLimits:void 0,contentUsageLimits:void 0,usageLimitType:void 0,usageLimitHours:1.5,usageLimitdaysOfWeek:[1,2,3,4,5],usageLimitdaysOfWeekOptions:[{abr:"Sun",text:"Sunday",value:0},{abr:"Mon",text:"Monday",value:1},{abr:"Tue",text:"Tuesday",value:2},{abr:"Wed",text:"Wednesday",value:3},{abr:"Thu",text:"Thursday",value:4},{abr:"Fri",text:"Friday",value:5},{abr:"Sat",text:"Saturday",value:6}],usageLimitUrlPattern:"",timeLimitSettings:null}},mounted(){},computed:{usageLimitUrlPatternOptions(){var e;return(e=this.contentUsageLimits)==null?void 0:e.map(t=>({text:t.data.patterns.join(", "),value:t.data.patterns.join(", ")}))}},methods:{editExtraTime(){this.isAdminUser&&this.showModal("modal-edit-extra-time")},async toggleWeekday(e){const t=this.usageLimitdaysOfWeek.indexOf(e.value);t===-1?(this.usageLimitdaysOfWeek.push(e.value),this.usageLimitdaysOfWeek.sort((m,d)=>m-d)):this.usageLimitdaysOfWeek.splice(t,1)},async loadUsageLimits(){var m;const e=await this.apiReq("/user/options/get",{userId:this.userId,refresh:!0}),t=e.result.usageLimitsData||{};(t==null?void 0:t.version)!=2,this.defaultUsageLimits=t.defaultUsageLimits||[],this.contentUsageLimits=t.contentUsageLimits||[],this.timeLimitSettings=e.result.timeLimitSettings||null,(!((m=this.timeLimitSettings)!=null&&m.extraTimeExpires)||this.timeLimitSettings.extraTimeExpires<Date.now())&&(this.timeLimitSettings=null)},updateExtraTime(){this.closeModal("modal-edit-extra-time"),this.loadUsageLimits()},async saveUsageLimits(){try{const e={version:2,defaultUsageLimits:this.defaultUsageLimits||[],contentUsageLimits:this.contentUsageLimits||[]};await this.apiReq("/user/options/update",{userId:this.userId,options:{usageLimitsData:e}})}catch(e){console.error(e),this.showToast("Error: Failed to save changes",{title:"Error",variant:"danger",solid:!0})}},listURLs(){const e=this.usageLimitUrlPattern.split(","),t=[];for(const m of e){const d=m.trim();if(d.length==0)continue;const u=d.startsWith("http")?d.split("://")[1]:d;if(u.match(/^[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?$/))t.push(u);else throw this.showToast(`Invalid URL: ${d}`,{title:"Error",variant:"danger",solid:!0}),new Error("Invalid URL")}return t},async removeUsageLimit(e,t){var m,d;e=="default"?(m=this.defaultUsageLimits)==null||m.splice(t,1):(d=this.contentUsageLimits)==null||d.splice(t,1),this.saveUsageLimits()},async editUsageLimit(e,t){e=="default"?(this.usageLimitType="default",this.usageLimitHours=this.defaultUsageLimits[t].timeLimit.hours,this.usageLimitdaysOfWeek=[...this.defaultUsageLimits[t].timeLimit.daysOfWeek]):(this.usageLimitType="urlPatterns",this.usageLimitHours=this.contentUsageLimits[t].timeLimit.hours,this.usageLimitdaysOfWeek=[...this.contentUsageLimits[t].timeLimit.daysOfWeek],this.usageLimitUrlPattern=this.contentUsageLimits[t].data.patterns.join(", ")),this.removeUsageLimit(e,t),this.$nextTick(()=>{this.showModal("modal-add-usage-limit")})},async addUsageLimit(){if(!this.usageLimitdaysOfWeek.length){this.showToast("Please select at least one day of the week",{title:"Error",variant:"danger",solid:!0});return}this.usageLimitType&&(this.usageLimitType=="default"?await this.addDefaultUsageLimit():await this.addContentUsageLimit(),this.saveUsageLimits())},async addContentUsageLimit(){if(this.contentUsageLimits=this.contentUsageLimits||[],!this.usageLimitdaysOfWeek.length){this.showToast("Please select at least one day of the week",{title:"Error",variant:"danger",solid:!0});return}if(!this.usageLimitType)return;let e=null;const t=this.listURLs();if(!t||t.length==0){this.showToast("Please enter valid URL(s).",{title:"Error",variant:"danger",solid:!0});return}if(t.length>10){this.showToast("Please enter a maximum of 10 URLs",{title:"Error",variant:"danger",solid:!0});return}e={patterns:[...t]};const m=[...this.contentUsageLimits];this.contentUsageLimits=[];for(const[d,u]of m.entries())u.type=="urlPatterns"&&u.data.patterns.some(c=>t.includes(c))&&(u.timeLimit.daysOfWeek=u.timeLimit.daysOfWeek.filter(c=>!this.usageLimitdaysOfWeek.includes(c)),u.timeLimit.daysOfWeek.length==0)||this.contentUsageLimits.push(u);this.contentUsageLimits.push({type:this.usageLimitType,data:e,timeLimit:{hours:this.usageLimitHours,daysOfWeek:[...this.usageLimitdaysOfWeek]}}),this.closeModal("modal-add-usage-limit")},async addDefaultUsageLimit(){if(this.defaultUsageLimits=this.defaultUsageLimits||[],!this.usageLimitdaysOfWeek.length){this.showToast("Please select at least one day of the week",{title:"Error",variant:"danger",solid:!0});return}if(!this.usageLimitType)return;let e=null;if(this.usageLimitType=="default"){const t=[...this.defaultUsageLimits];this.defaultUsageLimits=[];for(const[m,d]of t.entries())d.type=="default"&&(d.timeLimit.daysOfWeek=d.timeLimit.daysOfWeek.filter(u=>!this.usageLimitdaysOfWeek.includes(u)),d.timeLimit.daysOfWeek.length==0)||this.defaultUsageLimits.push(d)}this.defaultUsageLimits.push({type:this.usageLimitType,data:e,timeLimit:{hours:this.usageLimitHours,daysOfWeek:[...this.usageLimitdaysOfWeek]}}),this.closeModal("modal-add-usage-limit")}},created(){this.loadUsageLimits()}}),D={class:"d-flex flex-column"},I={key:0},j={class:"mb-3"},R={key:1},V={class:"mb-3 d-flex align-items-center flex-gap-sm justify-content-center"},B={class:"mb-3 d-flex flex-gap-sm flex-wrap justify-content-center"},M=["onClick"],H={key:2,class:"mt-2 ms-auto"},z={key:0,class:"my-4"},N={class:"larger mb-1 d-flex flex-gap-sm"},F=["role"],q={class:"rounded border py-1 px-2 hoverrow"},Z={class:"mt-3"},K={class:"mb-4 mt-5"},Q={class:"larger mb-1"},G={class:"my-3"},J={key:0},X={key:1},Y={key:0},tt={key:1},et={class:"d-flex align-items-center flex-wrap flex-gap-sm"},it={style:{"min-width":"6rem"}},st=["onClick"],at={key:1},nt={style:{"min-width":"15rem"}},ot={key:0,style:{"min-width":"3rem"}},dt=["onClick"],lt={class:"d-flex flex-gap-1"},rt={class:"mb-4 mt-5"},mt={class:"larger"},ut={class:"my-3"},gt={key:0},ft={key:1},ht={key:0},Lt={key:1},yt={class:"d-flex align-items-center flex-gap-sm flex-wrap"},pt={style:{"min-width":"6rem"}},ct={style:{"min-width":"15rem"}},vt={style:{"min-width":"5rem"}},kt=["onClick"],Ut={key:1},bt={style:{"min-width":"1rem"}},Tt=["onClick"],_t={class:"d-flex flex-gap-1"};function wt(e,t,m,d,u,O){var w;const c=p("BonusTimeComponent"),_=p("b-modal"),W=p("b-form-textarea"),C=p("b-form-group"),x=p("b-form-input"),v=p("b-button"),l=p("b-icon");return s(),a("div",null,[o(_,{lazy:"true",id:"modal-edit-extra-time",title:`
  Extra time
      `,"hide-footer":""},{default:y(()=>[o(c,{userId:e.userId,onUpdated:t[0]||(t[0]=n=>e.updateExtraTime())},null,8,["userId"])]),_:1}),o(_,{lazy:"true",id:"modal-add-usage-limit",title:e.usageLimitType=="default"?"Set Default daily limit":"Set Content daily limit","hide-footer":""},{default:y(()=>[i("div",D,[e.usageLimitType==="urlPatterns"?(s(),a("div",I,[i("div",j,[o(C,{class:"form-group",label:"URL(s)",description:"A comma separated list of domain names or websites, eg: youtube.com, google.com, ..."},{default:y(()=>[o(W,{modelValue:e.usageLimitUrlPattern,"onUpdate:modelValue":t[1]||(t[1]=n=>e.usageLimitUrlPattern=n),placeholder:"eg: youtube.com, ..."},null,8,["modelValue"])]),_:1})])])):(s(),a("div",R)),i("div",null,[i("div",V,[t[8]||(t[8]=i("div",null,"Daily Time Limit (hours):",-1)),o(x,{type:"number",style:{width:"4rem"},modelValue:e.usageLimitHours,"onUpdate:modelValue":t[2]||(t[2]=n=>e.usageLimitHours=n)},null,8,["modelValue"])]),i("div",B,[(s(!0),a(U,null,b(e.usageLimitdaysOfWeekOptions,(n,g)=>(s(),a("div",{role:"button",key:g,onClick:h=>e.toggleWeekday(n),class:T(["border rounded p-1",e.usageLimitdaysOfWeek.includes(n.value)?" btn-color":""])},f(n.abr),11,M))),128))])]),e.isAdminUser?(s(),a("div",H,[o(v,{onClick:t[3]||(t[3]=n=>e.addUsageLimit()),variant:"primary"},{default:y(()=>t[9]||(t[9]=[r("Save ")])),_:1})])):L("",!0)])]),_:1},8,["title"]),e.hideExtraTime?L("",!0):(s(),a("div",z,[i("div",N,[o(l,{icon:"gift"}),t[10]||(t[10]=i("div",null,"Extra time (today only)",-1))]),t[12]||(t[12]=i("div",{class:"text-muted small"}," Extra time (or bonus time) is added to daily limits and expires at the end of the day. ",-1)),(w=e.timeLimitSettings)!=null&&w.extraTimeDefault?(s(),a("div",{key:0,class:"d-flex align-items-center flex-gap-sm warning3-coxlor my-3",role:e.isAdminUser?"button":"",onClick:t[4]||(t[4]=n=>e.editExtraTime())},[i("div",q,f(e.timeLimitSettings.extraTimeDefault)+" min ",1)],8,F)):L("",!0),i("div",Z,[e.isAdminUser?(s(),k(v,{key:0,variant:"primary",onClick:t[5]||(t[5]=n=>e.editExtraTime())},{default:y(()=>[o(l,{icon:"plus-lg"}),t[11]||(t[11]=r(" Extra time"))]),_:1})):L("",!0)])])),i("div",K,[i("div",Q,[o(l,{icon:"sun"}),t[13]||(t[13]=r(" Default Daily Limit Schedule "))]),t[16]||(t[16]=i("div",{class:"text-muted mt-1 small"}," Default daily limits apply to all content excluding limits set for specific content below. ",-1)),i("div",G,[e.defaultUsageLimits===void 0?(s(),a("div",J," ")):(s(),a("div",X,[e.defaultUsageLimits.length===0?(s(),a("div",Y,[o(l,{icon:"exclamation-triangle"}),t[14]||(t[14]=r(" No usage limits set. "))])):(s(),a("div",tt,[(s(!0),a(U,null,b(e.defaultUsageLimits,(n,g)=>(s(),a("div",null,[i("div",{class:T(["d-flex align-items-center flex-gap-sm border-top py-1 small",g==e.defaultUsageLimits.length-1?"border-bottom":""])},[i("div",et,[i("div",it,[e.isAdminUser?(s(),a("button",{key:0,class:"btn btn-link btn-sm px-0",onClick:h=>e.editUsageLimit(n.type,g)},[o(l,{icon:"clock"}),r(" "+f(n.timeLimit.hours)+" hrs ",1)],8,st)):(s(),a("div",at,[o(l,{icon:"clock"}),r(" "+f(n.timeLimit.hours)+" hrs ",1)]))]),i("div",nt,[o(l,{icon:"calendar"}),r(" "+f(n.timeLimit.daysOfWeek.map(h=>e.usageLimitdaysOfWeekOptions[h].abr).join(", ")),1)])]),e.isAdminUser?(s(),a("div",ot,[i("button",{class:"btn btn-link dangercolor",onClick:h=>e.removeUsageLimit("default",g)},[o(l,{icon:"x-lg"})],8,dt)])):L("",!0)],2)]))),256))]))]))]),i("div",lt,[e.isAdminUser?(s(),k(v,{key:0,variant:"primary",onClick:t[6]||(t[6]=n=>{e.usageLimitType="default",e.showModal("modal-add-usage-limit")})},{default:y(()=>t[15]||(t[15]=[r("Add Schedule")])),_:1})):L("",!0)])]),i("div",rt,[i("div",mt,[o(l,{icon:"grid-3x3"}),t[17]||(t[17]=r(" Content Limit Schedule "))]),t[20]||(t[20]=i("div",{class:"text-muted mt-1 small"}," Limits for specific content. This will override the default daily limit if set. ",-1)),i("div",ut,[e.contentUsageLimits===void 0?(s(),a("div",gt," ")):(s(),a("div",ft,[e.contentUsageLimits.length===0?(s(),a("div",ht,[o(l,{icon:"exclamation-triangle"}),t[18]||(t[18]=r(" No usage limits set. "))])):(s(),a("div",Lt,[(s(!0),a(U,null,b(e.contentUsageLimits,(n,g)=>(s(),a("div",null,[i("div",{class:T(["d-flex align-items-center flex-gap-sm border-top py-1 small",g==e.contentUsageLimits.length-1?"border-bottom":""])},[i("div",yt,[i("div",pt,[o(l,{icon:"clock"}),r(" "+f(n.timeLimit.hours)+" hrs ",1)]),i("div",ct,[o(l,{icon:"calendar"}),r(" "+f(n.timeLimit.daysOfWeek.map(h=>e.usageLimitdaysOfWeekOptions[h].abr).join(", ")),1)]),i("div",vt,[e.isAdminUser?(s(),a("button",{key:0,class:"p-0 btn btn-link btn-sm",onClick:h=>e.editUsageLimit(n.type,g)},[o(l,{icon:"check"}),r(" "+f(n.data.patterns.join(", ")),1)],8,kt)):(s(),a("div",Ut,f(n.data.patterns.join(", ")),1))])]),i("div",bt,[e.isAdminUser?(s(),a("button",{key:0,class:"btn btn-link dangercolor",onClick:h=>e.removeUsageLimit(n.type,g)},[o(l,{icon:"x-lg"})],8,Tt)):L("",!0)])],2)]))),256))]))]))]),i("div",_t,[e.isAdminUser?(s(),k(v,{key:0,variant:"primary",onClick:t[7]||(t[7]=n=>{e.usageLimitType="urlPatterns",e.showModal("modal-add-usage-limit")})},{default:y(()=>t[19]||(t[19]=[r("Add Schedule")])),_:1})):L("",!0)])])])}const xt=S(A,[["render",wt],["__scopeId","data-v-15046b6a"]]);export{xt as U};

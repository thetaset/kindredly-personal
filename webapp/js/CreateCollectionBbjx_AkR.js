import{a as L,_ as D,t as M,d as U,aj as E}from"./components.globalDizx_NTC.js";import{P as N}from"./TIIconDefaultB4jiNlod.js";import{d as F,j as o,K as n,z as m,k as s,F as A,P as $,s as p,r as u,i,R as v,L as T,U as j,Q as S,m as C,p as R,ac as q}from"./@vueC3Nhqlrl.js";import{g as B}from"./ai_lookup_utilszDX_hcwM.js";const O=F({name:"Permissions",mixins:[L],props:{permList:{type:Array,required:!0}},components:{ProfileImage:N},emits:["update:permList"],data(){return{selectedUsers:[],selectedPermission:"editor"}},mounted(){},computed:{notInLibrary(){return this.permList.filter(e=>e.permission==null)},inLibrary(){return this.permList.filter(e=>e.permission!=null)}},methods:{selectToggleUser(e){this.selectedUsers.includes(e)?this.selectedUsers=this.selectedUsers.filter(t=>t!=e):this.selectedUsers.push(e)},selectUsers(){this.selectedUsers.forEach(e=>{this.addUser(e)}),this.selectedUsers=[]},addUser(e){e.permission=this.selectedPermission,this.replaceUserInPermlist(e)},removeUser(e){e.permission!="owner"&&(e.permission=null,this.replaceUserInPermlist(e))},replaceUserInPermlist(e){const t=this.permList.map(c=>c.userId==e.userId?e:c);this.$emit("update:permList",t)}},created(){}}),W={key:0},K={class:"d-flex justify-content-center align-items-center flex-gap-1 flex-wrap my-4"},z=["onClick"],G={class:"mt-1"},H={key:0,class:"font-weight-bold"},J={key:1},Q={key:0,class:"success-color"},Y={key:1},x={key:1},X={class:"my-2"},Z={class:"d-flex flex-gap-1 align-items-center"},ee={key:0},te={class:"ms-1 text-muted"},se={key:1},ie={class:"d-flex justify-content-end align-items-center"},oe={class:"small pill fillrow px-2 py-0"},ne=["onClick"],re={key:1,class:"p-1 text-muted",title:"Owner cannot be removed"};function le(e,t,c,a,f,I){const d=u("ProfileImage"),l=u("b-icon"),h=u("b-modal");return i(),o("div",null,[n(h,{id:"add-user",onOk:t[1]||(t[1]=r=>e.selectUsers()),"ok-title":"Done","cancel-title":"Cancel"},{default:m(()=>[s("div",null,[e.notInLibrary.length>0?(i(),o("div",W,[t[6]||(t[6]=s("label",null,"Select users",-1)),s("div",K,[(i(!0),o(A,null,$(e.notInLibrary,(r,b)=>(i(),o("div",{role:"button",style:{width:"150px",height:"140px"},key:b,class:"card d-flex justify-content-center align-items-center border hoverrow",onClick:_=>e.selectToggleUser(r)},[n(d,{profileImage:r.profileImage,width:50,showCircle:!1},null,8,["profileImage"]),s("div",G,[r._id==e.currentUserId?(i(),o("span",H,t[3]||(t[3]=[s("b",null,"you",-1)]))):(i(),o("span",J,v(r.username),1))]),e.selectedUsers.includes(r)?(i(),o("div",Q,[n(l,{icon:"check-lg"})])):(i(),o("div",Y,[n(l,{icon:"square"})]))],8,z))),128))]),s("div",null,[t[5]||(t[5]=s("label",null,"Permission",-1)),T(s("select",{class:"form-control small mt-2","onUpdate:modelValue":t[0]||(t[0]=r=>e.selectedPermission=r)},t[4]||(t[4]=[s("option",{value:"viewer"},"viewer",-1),s("option",{value:"editor"},"editor",-1)]),512),[[j,e.selectedPermission]])])])):p("",!0),e.notInLibrary.length==0?(i(),o("div",x,"All users have access to this library.")):p("",!0)])]),_:1}),s("div",X,[(i(!0),o(A,null,$(e.inLibrary,(r,b)=>(i(),o("div",{key:b,class:"rounded border p-2 d-flex align-items-center justify-content-between userCard"},[s("div",Z,[n(d,{profileImage:r.profileImage,width:30,showCircle:!1},null,8,["profileImage"]),r.displayedName?(i(),o("div",ee,[S(v(r.displayedName)+" ",1),s("span",te,"("+v(r.username)+")",1)])):(i(),o("div",se,v(r.username),1))]),s("div",ie,[s("div",oe,v(r.permission),1),s("div",null,[r.permission!="owner"?(i(),o("div",{key:0,role:"button",class:"p-1",onClick:_=>e.removeUser(r),title:"Remove from users library"},[n(l,{icon:"x"})],8,ne)):(i(),o("div",re,[n(l,{icon:"lock-fill"})]))])])]))),128)),e.notInLibrary.length>0?(i(),o("div",{key:0,class:"p-2 d-flex align-items-center justify-content-center flex-gap-sm userCard rounded hoverrow",role:"button",onClick:t[2]||(t[2]=()=>e.showModal("add-user"))},[n(l,{icon:"plus-lg"}),t[7]||(t[7]=s("div",null,"Add",-1))])):p("",!0)])])}const ae=D(O,[["render",le],["__scopeId","data-v-aeb965e9"]]),de=F({name:"ItemPage",mixins:[L],components:{},props:{item:{type:Object,required:!1},parent:{type:Object,required:!1},contextData:{type:Object,required:!1},validActionIds:{type:Array,required:!0},customSuggest:{type:Boolean,required:!1,default:!1},wrapperClass:{type:String,required:!1},confirmUpdate:{type:Boolean,required:!1,default:!1}},data(){return{loadingAISuggestions:!1,aiSuggestInstructions:"",aiSuggestionData:null,aiSuggestActionId:null,aiSuggestActions:B(),loading:!1}},mounted(){},computed:{actionIdOptions(){return this.validActionIds?this.aiSuggestActions.filter(e=>{var t;return(t=this.validActionIds)==null?void 0:t.includes(e.value)}):this.aiSuggestActions}},methods:{getKeyName(e){return e.charAt(0).toUpperCase()+e.slice(1)},getItemDataByKey(e,t){var c;return t=="name"?e.name:t=="description"?e.description:t=="tags"?this.formatTags(e.tags):t=="textContent"?(c=e==null?void 0:e.info)==null?void 0:c.value:e[t]},getSuggestedDataByKey(e,t){return t=="tags"?this.formatTags(e.tags):e[t]},formatTags(e){return e?e.map(t=>t.toLowerCase()).join(", "):""},textTruncate:M,async applyAISuggestions(){U("Applying AI Suggestions",this.aiSuggestionData),this.$emit("update",this.aiSuggestionData),this.closeModal("aiquicksuggestconfirm-modal"),this.closeModal("aisuggestcustom-modal")},isEmptyText(e){return e==null||e==""},async quickApplySuggestions(e){this.aiSuggestActionId=e,await this.loadAISuggestion(),this.confirmUpdate?this.showModal("aiquicksuggestconfirm-modal"):this.$emit("update",this.aiSuggestionData)},async loadAISuggestion(){var e,t,c,a,f,I,d;try{this.loadingAISuggestions=!0;const l={type:(e=this.item)==null?void 0:e.type,name:(t=this.item)==null?void 0:t.name,description:(c=this.item)==null?void 0:c.description,tags:(a=this.item)==null?void 0:a.tags,url:(f=this.item)==null?void 0:f.url,textContent:(d=(I=this.item)==null?void 0:I.info)==null?void 0:d.value,parent:null};this.parent&&(l.parent={type:"collection",name:this.parent.name,description:this.parent.description,tags:this.parent.tags}),this.contextData&&!this.item&&(l.type=this.contextData.type,l.name=this.contextData.name,l.description=this.contextData.description,l.tags=this.contextData.tags,l.url=this.contextData.url,l.textContent=this.contextData.textContent);const h=await this.apiReq("/client/ai/itemUpdateGenerator",{actionId:this.aiSuggestActionId,itemDetails:l,instructions:this.aiSuggestInstructions});if(U("AI suggestion",h.result),!(h!=null&&h.result)){this.showToast("No AI Suggestion found",{variant:"danger",title:"Error",solid:!0});return}let r=h.result;typeof r=="string"&&(r=JSON.parse(r)),this.aiSuggestionData=r}catch(l){console.error(l),this.showToast("Error loading AI Suggestion",{variant:"danger",title:"Error",solid:!0})}finally{this.loadingAISuggestions=!1}}},created(){this.aiSuggestActionId=this.validActionIds[0]}}),ue={class:"container text-center"},me={key:0,class:""},ce={class:"my-2"},pe={class:"row mb-2"},ge={class:"mb-2"},fe={class:"larger"},he={class:"mb-2"},ye={class:"mt-5 d-flex justify-content-between"},ve={class:"container"},be={key:0},Ie={class:""},Se={class:"d-flex justify-content-end"},Ce={class:"mt-2 text-center"},_e={key:1,class:"mt-5"},ke={class:"my-2"},Ae={class:"row mb-2"},$e={class:"mb-2"},we={class:"larger"},Pe={key:0,class:"mb-2"},Ue={class:"mb-2"},Le={class:"mt-5 d-flex justify-content-between"};function De(e,t,c,a,f,I){const d=u("b-spinner"),l=u("b-button"),h=u("b-modal"),r=u("b-form-select"),b=u("b-form-group"),_=u("b-form-textarea"),k=u("b-icon"),P=q("b-modal");return i(),o("div",null,[n(h,{id:"aiquicksuggestconfirm-modal",size:"lg","hide-footer":"",title:"AI Suggestion"},{default:m(()=>[s("div",ue,[e.loadingAISuggestions?(i(),C(d,{key:0})):p("",!0)]),e.aiSuggestionData?(i(),o("div",me,[s("div",ce,[(i(!0),o(A,null,$(Object.entries(e.aiSuggestionData),(g,w)=>(i(),o("div",pe,[s("div",ge,[s("div",fe,v(e.getKeyName(g[0])),1)]),s("div",he,[s("p",null,v(e.getSuggestedDataByKey(e.aiSuggestionData,g[0])),1)])]))),256))]),s("div",ye,[t[6]||(t[6]=s("div",null,null,-1)),n(l,{variant:"primary",class:"mt-2",onClick:t[0]||(t[0]=g=>e.applyAISuggestions())},{default:m(()=>t[5]||(t[5]=[S(" Use Suggestions")])),_:1})])])):p("",!0)]),_:1}),n(h,{id:"aisuggestcustom-modal",size:"lg","hide-footer":"",title:"AI Suggestion "},{default:m(()=>[s("div",ve,[e.validActionIds.length>1?(i(),o("div",be,[n(b,{label:"Select an action",class:"mb-4"},{default:m(()=>[n(r,{modelValue:e.aiSuggestActionId,"onUpdate:modelValue":t[1]||(t[1]=g=>e.aiSuggestActionId=g),options:e.actionIdOptions},null,8,["modelValue","options"])]),_:1})])):p("",!0),s("div",Ie,[n(b,{label:"",class:"mb-4"},{default:m(()=>[n(_,{modelValue:e.aiSuggestInstructions,"onUpdate:modelValue":t[2]||(t[2]=g=>e.aiSuggestInstructions=g),placeholder:"Enter custom suggestion instructions (optional)"},null,8,["modelValue"])]),_:1}),s("div",Se,[n(l,{variant:"secondary",disabled:e.loadingAISuggestions,onClick:t[3]||(t[3]=g=>e.loadAISuggestion())},{default:m(()=>[n(k,{icon:"magic"}),t[7]||(t[7]=s("span",{class:"ms-1"},"Get Suggestions ",-1))]),_:1},8,["disabled"])])]),s("div",Ce,[e.loadingAISuggestions?(i(),C(d,{key:0})):p("",!0)]),e.aiSuggestionData?(i(),o("div",_e,[s("div",ke,[t[10]||(t[10]=s("hr",{class:"my-2"},null,-1)),(i(!0),o(A,null,$(Object.entries(e.aiSuggestionData),(g,w)=>(i(),o("div",Ae,[s("div",$e,[s("div",we,v(e.getKeyName(g[0])),1)]),e.item?(i(),o("div",Pe,[t[8]||(t[8]=s("div",{class:"text-muted small"},"Original",-1)),s("div",null,v(e.getItemDataByKey(e.item,g[0])),1)])):p("",!0),s("div",Ue,[t[9]||(t[9]=s("div",{class:"text-muted small"},"Suggested",-1)),s("div",null,v(e.getSuggestedDataByKey(e.aiSuggestionData,g[0])),1)])]))),256))]),s("div",Le,[t[12]||(t[12]=s("div",null,null,-1)),n(l,{variant:"primary",class:"mt-2",onClick:t[4]||(t[4]=g=>e.applyAISuggestions())},{default:m(()=>t[11]||(t[11]=[S(" Use Suggestions")])),_:1})])])):p("",!0)])]),_:1}),s("div",{class:R(e.wrapperClass||"d-flex flex-gap-sm align-items-center justify-content-end")},[(i(!0),o(A,null,$(e.actionIdOptions,g=>(i(),C(l,{variant:"link",class:"d-flex flex-gap-sm align-items-center px-2 pill border py-0 hoverrow",size:"sm",onClick:w=>e.quickApplySuggestions(g.value),disabled:e.loadingAISuggestions},{default:m(()=>[n(k,{icon:"magic"}),t[13]||(t[13]=S(" Suggest ")),e.loadingAISuggestions?(i(),C(d,{key:0,small:""})):p("",!0)]),_:2},1032,["onClick","disabled"]))),256)),e.customSuggest?T((i(),C(l,{key:0,class:"d-flex flex-gap-sm align-items-center px-1 pill border hoverrow linklike-bw py-0 px-2",variant:"link",size:"sm"},{default:m(()=>[n(k,{icon:"pencil-fill"})]),_:1})),[[P,void 0,void 0,{"aisuggestcustom-modal":!0}]]):p("",!0)],2)])}const Fe=D(de,[["render",De]]),Ve=F({name:"CreateCollection",components:{Permissions:ae,AISuggester:Fe},props:["parentCollectionId","defaultVisibility","targetUserId","allowChangeParent"],mixins:[L],data(){return{page:"main",submitting:!1,inheritPermissions:!0,autoCompleteStyle:{vueSimpleSuggest:"position-relative",inputWrapper:"form-control",defaultInput:"form-control",suggestions:"position-absolute list-group z-1000",suggestItem:"list-group-item"},createCollectionForm:{name:null,description:null,visibility:"private",tags:null},tags:null,errorMessage:null,parent:null,visibleToFamily:!0,_parentCollectionId:null,permList:[]}},mounted(){setTimeout(()=>{this.$nextTick(()=>{this.$refs.inputRef2.focus()})},200)},computed:{numRestrictedUsersWithAccess(){return this.permList.filter(e=>e.type=="restricted"&&!!e.permission).length},numRestrictedEditors(){return this.permList.filter(e=>e.type=="restricted"&&e.permission=="editor").length}},methods:{updateWithSuggestions(e){var t;U("updateWithSuggestions",e),e&&(this.createCollectionForm.name=e.name,this.createCollectionForm.description=e.description,this.tags=(t=e.tags)==null?void 0:t.join(", "))},selectCollection(e){this.page="main",e&&(this._parentCollectionId=e),this.loadParentInfo()},changeCollection(){this.page="selectCollection"},async loadParentInfo(){if(!this._parentCollectionId)return;const e=await this.sendReq("/client/collection/infoByUser",{collectionId:this._parentCollectionId,includeUserPermissions:!0});e.success?this.parent=e.result:(this.errorMessage=e.message,console.error(e.message))},suggest(){},suggestList(){return this._parentCollectionId?[]:["Agriculture","Animals","Anthropology","Archeology","Architecture","Art","Astronomy","Automotive","Beauty","Biology","Blogs","Books","Business","Cars","Chemistry","Children","Coding","Comedy","Computer Science","Computers","Cooking","Crafts","Culture","Data Science","Design","DIY","Documents","Economics","Education","Educational Resources","Engineering","English","Entertainment","Environment","Environmental Conservation","Environmental Science","Fashion","Favorite Apps","Favorite Books","Favorite Games","Favorite Movies","Favorite Podcasts","Favorite Products","Favorite Quotes","Favorite Restaurants","Favorite TV Shows","Favorite Websites","Film","Finance","Fitness","Foreign Languages","Funny Videos","Gaming","Gardening","Geography","Geology","Graphic Design","Health","History","Hobbies and Interests","Hobbies","Home Improvement","Human Resources","Ideas","Inspirational","Interior Design","Journalism","Law","Learning","Lifestyle","Linguistics","Marketing","Math","Mathematics","Medicine","Mindfulness and Meditation","Miscellaneous","Museums","Music","Nature and Wildlife","Neuroscience","News","Online Courses","Parenting","Personal Development","Pets","Philosophy","Photography","Photos","Physics","Plants","Poetry","Political Science","Politics","Pop Culture","Productivity","Psychology","Public Speaking","Recipes","Reference and Learning","Religion","Religious","Renewable Energy","School","Science","Self-Care","Shopping","Social Justice","Social Media","Sociology","Software","Software Development","Software Engineering","Space","Spiritual","Sports","Statistics","STEM","Sustainability","Technology","Technology Trends","Technology and Science","Time Management","Travel","Videos","Web Development","Work-related","Work","World News","Writing Prompts","Writing","Yoga and Meditation"].sort()},async createCollection(){var f,I;if(this.errorMessage=null,!((f=this.createCollectionForm)!=null&&f.name)){this.errorMessage="Invalid collection name";return}this.submitting=!0;const e=this._parentCollectionId?[this._parentCollectionId]:[],t=this.tags!=null?(I=this.tags)==null?void 0:I.split(",").map(d=>d.trim()).filter(d=>!!d):null;this.createCollectionForm.tags=t,this.createCollectionForm.visibility=this.visibleToFamily?"shared":"private";let c=[];(!this.inheritPermissions||!this.parentCollectionId)&&(c=this.permList.map(d=>({userId:d.userId,permission:d.permission})).filter(d=>!!d.permission));const a=await this.sendReq("/client/collection/create",{userId:this.targetUserId||void 0,data:{...this.createCollectionForm},collectionIds:e,permList:c,customPermissions:!!c&&c.length>0});a.success?(this.RefreshIndexQuick(),this.$emit("close",a.result)):(this.showToast(a.message,{variant:"danger"}),this.submitting=!1)},loadPermList(){let e=null;this.targetUserId?e=this.users.find(a=>a._id==this.targetUserId):e=this.currentUser,this.permList=[];let t=null;this.parentCollectionId||(t={userId:e._id,username:e.username,displayedName:e.displayedName,type:e.type,profileImage:e.profileImage,permission:"owner"});const c=this.parent?Object.fromEntries(this.parent.users.map(a=>[a.userId,a.permission])):{};for(const a of this.users){const f={userId:a._id,username:a.username,displayedName:a.displayedName,type:a.type,profileImage:a.profileImage,permission:c[a._id]||null};(t==null?void 0:t.userId)!=f.userId&&(f.permission=="owner"&&t==null?t=f:this.permList.push(f))}this.permList=this.permList.sort(function(a,f){return E(a,f,"username")}),t&&this.permList.unshift(t)},async loadPage(){await this.loadParentInfo(),this.loadPermList()}},created(){this._parentCollectionId=this.parentCollectionId,this.defaultVisibility&&(this.createCollectionForm.visibility=this.defaultVisibility),this.createCollectionForm.visibility=="shared"&&(this.visibleToFamily=!0),this.loadPage()}}),Te={key:0},Me={class:"my-2 d-flex flex-gap-sm align-items-centerflex-wrap"},Ee={key:0,class:"larger mb-2"},Ne={key:1},je={key:0,class:"mb-3"},Re={class:"createCollectionContainer"},qe={class:"d-flex flex-gap-1 align-items-center flex-wrap"},Be={key:1,class:"mt-4"},Oe={key:1,class:"mt-3"},We={key:0,class:"mt-3 mx-2 alert alert-danger"},Ke={key:2,class:"my-2 alert alert-danger"};function ze(e,t,c,a,f,I){var V;const d=u("AISuggester"),l=u("b-form-input"),h=u("b-form-group"),r=u("b-form-textarea"),b=u("b-form-checkbox"),_=u("b-form"),k=u("Permissions"),P=u("b-icon"),g=u("b-button"),w=u("b-button-toolbar");return i(),o("div",null,[e.page=="main"?(i(),o("div",Te,[s("div",Me,[e.parent?(i(),o("div",Ee,[t[7]||(t[7]=s("div",{class:"text-muted small mb-1"},"Parent Collection",-1)),s("div",null,"/"+v(e.parent.name),1)])):(i(),o("div",Ne))]),e.isAdminUser&&e.parent?(i(),o("div",je,[n(d,{customSuggest:"","valid-action-ids":["main_attr_improve_collection"],"confirm-update":!0,onUpdate:e.updateWithSuggestions,parent:e.parent,"context-data":{name:e.createCollectionForm.name,parentCollectionName:(V=e.parent)==null?void 0:V.name,description:e.createCollectionForm.description,type:"collection"}},null,8,["onUpdate","parent","context-data"])])):p("",!0),n(_,null,{default:m(()=>[n(h,{class:"form-group"},{default:m(()=>[s("div",Re,[n(l,{id:"formName",ref:"inputRef2",modelValue:e.createCollectionForm.name,"onUpdate:modelValue":t[0]||(t[0]=y=>e.createCollectionForm.name=y),required:"",placeholder:"Collection Name"},null,8,["modelValue"])])]),_:1}),n(h,{class:"form-group"},{default:m(()=>[n(r,{id:"formDesc",modelValue:e.createCollectionForm.description,"onUpdate:modelValue":t[1]||(t[1]=y=>e.createCollectionForm.description=y),placeholder:"Enter Description",required:""},null,8,["modelValue"])]),_:1}),n(h,{class:"form-group mt-3"},{default:m(()=>[n(l,{id:"formTags",modelValue:e.tags,"onUpdate:modelValue":t[2]||(t[2]=y=>e.tags=y),placeholder:"Tags, comma seperated"},null,8,["modelValue"])]),_:1}),n(h,{class:"form-group mt-4"},{default:m(()=>[s("div",qe,[n(b,{modelValue:e.visibleToFamily,"onUpdate:modelValue":t[3]||(t[3]=y=>e.visibleToFamily=y),switch:""},{default:m(()=>t[8]||(t[8]=[S(" Visible to all family members ")])),_:1},8,["modelValue"])]),t[9]||(t[9]=s("div",{class:"mt-1 text-muted small"}," Allow all family members see this collection, even when it's not in their library. ",-1))]),_:1})]),_:1}),e.isAdminUser?(i(),o("div",Be,[e.parentCollectionId?(i(),C(b,{key:0,switch:"",modelValue:e.inheritPermissions,"onUpdate:modelValue":t[4]||(t[4]=y=>e.inheritPermissions=y)},{default:m(()=>t[10]||(t[10]=[S(" Inherit Library Permissions")])),_:1},8,["modelValue"])):p("",!0),!e.inheritPermissions||!e.parentCollectionId?(i(),o("div",Oe,[t[12]||(t[12]=s("label",null,"Library Permissions",-1)),n(k,{"perm-list":e.permList,"onUpdate:permList":t[5]||(t[5]=y=>e.permList=y)},null,8,["perm-list"]),e.isAdminUser&&e.numRestrictedEditors>0&&e.numRestrictedUsersWithAccess>1?(i(),o("div",We,[n(P,{icon:"exclamation-triangle"}),t[11]||(t[11]=S(" Having restricted users with edit access to a collection that contains other restricted users is not recommended. This would allow a restricted user to share content with other restricted users that they might not have access to. "))])):p("",!0)])):p("",!0),e.errorMessage?(i(),o("div",Ke,v(e.errorMessage),1)):p("",!0)])):p("",!0),n(w,{class:"mt-4"},{default:m(()=>[n(g,{class:"ms-auto",variant:"primary",onClick:t[6]||(t[6]=y=>e.createCollection()),disabled:e.submitting},{default:m(()=>t[13]||(t[13]=[S("Create")])),_:1},8,["disabled"])]),_:1})])):p("",!0)])}const Ge=D(Ve,[["render",ze]]),xe=Object.freeze(Object.defineProperty({__proto__:null,default:Ge},Symbol.toStringTag,{value:"Module"}));export{Fe as A,Ge as C,ae as P,xe as a};

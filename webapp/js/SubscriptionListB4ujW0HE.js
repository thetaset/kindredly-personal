import{a as R,p as N,_ as C}from"./components.globalBic2x0kT.js";import{c as g}from"./subscription.storeBRgRghO8.js";import{d as L,j as r,K as i,z as n,k as o,R as y,s as u,Q as f,L as U,m as S,F as M,P as T,r as b,ac as $,i as l}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";const D=L({name:"SubscriptionList",mixins:[R],components:{},data(){return{viewAsUserId:void 0,viewAsUser:null,loading:!0,entries:[],errorMessage:null,selectedSub:null,newSubName:"",newSubForm:{feedURL:"",url:"",title:"",description:""}}},mounted(){},computed:{},methods:{prettyTimePast:N,prettySubName(e){return e=="rss"?"RSS Feed":e=="ai_feed"?"AI Feed":e=="pub_col"?"Published Collection":e=="item_feed"?"Item Feed":"Custom"},prepareSubscription(e){var t,d,w,h,v,a;return e.data||(e.data={}),e.refType=="custom"||e.refType=="item_feed"?{...e,...e.data,title:((t=e.data)==null?void 0:t.title)||((d=e==null?void 0:e.item)==null?void 0:d.name)||"NA",type:((w=e.data)==null?void 0:w.type)||((h=e.data)==null?void 0:h.sourceType),_id:e._id,data:e.data}:{...e,title:((v=e.data)==null?void 0:v.title)||e.item.name||"NA",description:(a=e.item)==null?void 0:a.description,type:e.refType,_id:e._id,data:e.data}},async addNewCustomSub(){await g("custom",null,{feedURL:this.newSubForm.feedURL,url:this.newSubForm.url,title:this.newSubForm.title,description:this.newSubForm.description,type:"rss",imageUrl:null}),this.newSubForm={feedURL:"",url:"",title:"",description:""},this.closeModal("new-sub-modal")},async addAISub(){await g("custom",null,{title:this.newSubForm.title,description:this.newSubForm.description,type:"ai_feed"}),this.closeModal("add-subscriptions-modal"),this.closeModal("new-ai-sub-modal"),this.loadData()},async loadViewAsUser(){if(!this.viewAsUserId)return;const e=await this.apiReq("/user/profile/get",{userProfileId:this.viewAsUserId});this.viewAsUser=e.result},async loadData(){this.loading=!0;try{const t=(await this.apiReq("/client/subscription/listForUser",{userId:this.viewAsUserId})).result;this.entries=t.map(this.prepareSubscription).sort((d,w)=>d.title.localeCompare(w.title))}catch(e){this.errorMessage=e.message,console.error("Error:",e.message)}this.loading=!1},async renameSubscriptionModal(e){this.newSubName=e.title,this.selectedSub=e,this.showModal("rename-sub-modal")},async renameSubscription(){if((await this.sendReq("/client/subscription/edit",{subscriptionId:this.selectedSub._id,data:{...this.selectedSub.data,title:this.newSubName},encInfo:this.selectedSub.encInfo})).success)this.selectedSub=null,this.newSubName="",await this.loadData();else{this.showToast("Error renaming subscription",{variant:"danger",title:"Error",solid:!0});return}},async unsubscribe(e){if(!await this.confirmModal("Are you sure you want to unsubscribe?"))return;const d=await this.sendReq("/subscription/removeById",{subscriptionId:e._id});if(d.success)await this.loadData();else{this.errorMessage=d.message,console.error(this.errorMessage);return}}},created(){this.viewAsUserId=this.$route.params.userId,this.loadViewAsUser(),this.loadData(),this.$route.query.action=="addSub"&&this.$nextTick(()=>{this.showModal("add-subscriptions-modal")})}}),E={class:"container-fluid-max1200"},z={class:"ms-3"},q={role:"button",class:"linklike"},B={key:0,role:"button",class:"linklike"},P={class:"mb-2"},O={class:"mb-2"},j={class:"mb-2"},G={class:"mb-2"},K={class:"mb-3"},Q={class:"mb-2"},H={class:"mb-2"},I={class:"my-3"},J={key:0},W={class:"text-muted mb-4 small"},X={key:0},Y={class:"mb-3"},Z={key:0},x={class:"d-flex align-items-center"},ee={class:"larger me-2"},te={class:"xsmall text-muted"},se={key:0,class:"d-flex flex-gap-sm"},ie={key:1},oe={key:2};function le(e,t,d,w,h,v){const a=b("b-link"),m=b("b-modal"),p=b("b-form-input"),F=b("b-form-textarea"),c=b("b-icon"),_=b("b-button"),k=$("b-modal");return l(),r("div",E,[i(m,{id:"add-subscriptions-modal","hide-footer":"",title:"Add Subscription"},{default:n(()=>[o("div",z,[t[13]||(t[13]=o("div",{class:"mb-2"}," Subscriptions can be added from: ",-1)),o("ul",null,[o("li",null,[i(a,{to:"/explore"},{default:n(()=>t[10]||(t[10]=[f(" Published Items and Collections")])),_:1})]),U((l(),r("li",q,t[11]||(t[11]=[f("Custom RSS Feed")]))),[[k,void 0,void 0,{"new-sub-modal":!0}]]),e.developerMode?U((l(),r("li",B,t[12]||(t[12]=[f("AI Generated Feed")]))),[[k,void 0,void 0,{"new-ai-sub-modal":!0}]]):u("",!0)])])]),_:1}),i(m,{id:"new-sub-modal",title:"Add Subscription",size:"lg",onOk:t[4]||(t[4]=s=>e.addNewCustomSub()),"ok-title":"Add"},{default:n(()=>[o("div",null,[o("div",P,[i(p,{modelValue:e.newSubForm.url,"onUpdate:modelValue":t[0]||(t[0]=s=>e.newSubForm.url=s),placeholder:"Enter RSS Feed URL"},null,8,["modelValue"])]),o("div",O,[i(p,{autocorrect:"off",autocapitalize:"off",modelValue:e.newSubForm.feedURL,"onUpdate:modelValue":t[1]||(t[1]=s=>e.newSubForm.feedURL=s),placeholder:"Enter Feed URL"},null,8,["modelValue"])]),o("div",j,[i(p,{modelValue:e.newSubForm.title,"onUpdate:modelValue":t[2]||(t[2]=s=>e.newSubForm.title=s),placeholder:"Enter Title"},null,8,["modelValue"])]),o("div",G,[i(p,{modelValue:e.newSubForm.description,"onUpdate:modelValue":t[3]||(t[3]=s=>e.newSubForm.description=s),placeholder:"Enter Description"},null,8,["modelValue"])])])]),_:1}),i(m,{id:"new-ai-sub-modal",title:"Add AI Generated Feed - Subscription",size:"lg",onOk:t[7]||(t[7]=s=>e.addAISub()),"ok-title":"Add"},{default:n(()=>[o("div",null,[o("div",K,[i(p,{modelValue:e.newSubForm.title,"onUpdate:modelValue":t[5]||(t[5]=s=>e.newSubForm.title=s),placeholder:"Enter Title"},null,8,["modelValue"])]),o("div",Q,[i(F,{rows:"10",modelValue:e.newSubForm.description,"onUpdate:modelValue":t[6]||(t[6]=s=>e.newSubForm.description=s),placeholder:"Enter Description"},null,8,["modelValue"])])])]),_:1}),i(m,{id:"rename-sub-modal",onOk:t[9]||(t[9]=s=>e.renameSubscription()),title:"Rename Subscription","ok-title":"Rename"},{default:n(()=>[o("div",H,[i(p,{modelValue:e.newSubName,"onUpdate:modelValue":t[8]||(t[8]=s=>e.newSubName=s),placeholder:"Enter Subscription Name"},null,8,["modelValue"])])]),_:1}),o("h2",I,[e.viewAsUser?(l(),r("span",J,y(e.viewAsUser.username)+"'s",1)):u("",!0),t[14]||(t[14]=f(" Subscriptions "))]),o("div",W,[e.viewAsUser?u("",!0):(l(),r("div",X))]),o("div",Y,[e.isAdminUser?U((l(),S(_,{key:0,variant:"primary"},{default:n(()=>[i(c,{icon:"plus"}),t[15]||(t[15]=f(" Add Subscription "))]),_:1})),[[k,void 0,void 0,{"add-subscriptions-modal":!0}]]):u("",!0)]),!e.loading&&e.entries.length>0?(l(),r("div",Z,[(l(!0),r(M,null,T(e.entries,(s,A)=>(l(),r("div",{key:A,class:"d-flex flex-gap-1 border-top py-1 align-items-center justify-content-between my-2"},[o("div",null,[o("div",x,[o("span",ee,y(s.title),1),s.refType=="item_feed"?(l(),S(a,{key:0,class:"text-muted small",to:"/item/"+s.refId},{default:n(()=>[i(c,{icon:"info-circle"})]),_:2},1032,["to"])):s.refType=="pub_col"?(l(),S(a,{key:1,class:"text-muted small",to:"/v/"+s.refId},{default:n(()=>[i(c,{icon:"info-circle"})]),_:2},1032,["to"])):s.refType=="custom"&&s.type=="rss"?(l(),S(a,{key:2,class:"text-muted small",href:s.feedURL},{default:n(()=>[i(c,{icon:"info-circle"})]),_:2},1032,["href"])):u("",!0)]),o("div",te,y(e.prettySubName(s.type)),1)]),e.isAdminUser?(l(),r("div",se,[i(_,{onClick:V=>e.renameSubscriptionModal(s),size:"sm",variant:"link"},{default:n(()=>[i(c,{icon:"pencil"})]),_:2},1032,["onClick"]),i(_,{onClick:V=>e.unsubscribe(s),variant:"link",size:"sm",class:"danger-color"},{default:n(()=>[i(c,{icon:"x-lg"})]),_:2},1032,["onClick"])])):u("",!0)]))),128))])):!e.loading&&e.entries.length==0?(l(),r("div",ie,"No collections in follow list.")):e.loading?(l(),r("div",oe,"Loading...")):u("",!0)])}const pe=C(D,[["render",le]]);export{pe as default};

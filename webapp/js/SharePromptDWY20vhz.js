import{a as C,ao as T,t as F,p as $,x,ap as L,d as B,_ as M}from"./components.globalDizx_NTC.js";import{S as P,U as N}from"./UploadAttachmentsToAddDKgyIDOW.js";import{c as U}from"./item.storeCI0d-UrP.js";import{A as z}from"./AddItemFromLibraryx4UGQJre.js";import{u as E}from"./upload.mixinCs4F8zrX.js";import{d as V,j as d,K as o,z as s,k as a,L as v,m as I,s as _,r as i,ac as G,i as l,Q as h}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";import"./ItemImageDmIqiyLE.js";import"./TIIconDefaultB4jiNlod.js";import"./AddItemFromLibraryResultsBWbIwWSk.js";const H=V({name:"SharePrompt",mixins:[C,E],components:{ShareItemList:P,AddItemFromLibrary:z,UploadAttachmentsToAdd:N},data(){return{showDebug:!1,loading:!1,errorMessage:null,selectedItem:null}},mounted(){},computed:{},methods:{removeShareData:T,textTruncate:F,prettyTimePast:$,clearTempShareData:x,async cancelAndGoHome(){this.clearTempShareData(),this.$router.push("/")},async createPost(){this.$router.push("/post/create")},async addToLibrary(){this.$router.push("/item/add")},async doneAddingFiles(){this.loadPage(),this.closeModal("addFile")},async attachToItem(t){t||(this.selectedItem=null),this.closeModal("selectItem");let e=t==null?void 0:t._id;if(t.type=="col"){this.$router.push("/collection/"+e+"?editBanner=true");return}console.log("Item ID: ",e),this.selectedItem=await U({itemId:e}),this.$router.push("/item/attach/"+e)},async filterToLarge(){var c,u;let t=[],e=[];for(let n of this.tempShareData){let m=(((c=n==null?void 0:n.preppedData)==null?void 0:c.fileData)||((u=n==null?void 0:n.data)==null?void 0:u.data)).length;m>0&&m>this.config.maxUploadSizeMB*1024*1024?e.push(n):t.push(n)}return e.length>0&&(this.tempShareData=t,this.showToast("Some files were too large and were not attached.  Files should be less than "+this.config.maxUploadSizeMB+" MB.")),!0},async loadPage(){this.loading=!0;try{await L()}catch(t){this.showToast("Error loading data"),B(t)}this.loading=!1}},watch:{},created(){this.loadPage()}}),j={class:"container-fluid-max1200 mt-2"},W={key:0},K={class:"mb-4 d-flex flex-gap-1 flex-wrap"},Q={key:0},R={key:1},q={class:"mt-5 d-flex flex-gap-1 flex-wrap justify-content-start"},J={key:0},O={key:2},X={class:"text-center ani-fade-in-slow"};function Y(t,e,c,u,n,S){const m=i("UploadAttachmentsToAdd"),f=i("b-modal"),w=i("AddItemFromLibrary"),r=i("b-icon"),p=i("b-button"),g=i("b-dropdown-item"),D=i("b-dropdown"),A=i("ShareItemList"),k=i("b-spinner"),b=G("b-modal");return l(),d("div",j,[o(f,{id:"addFile","hide-footer":""},{default:s(()=>[o(m,{onUpdate:e[0]||(e[0]=y=>t.doneAddingFiles())})]),_:1}),o(f,{id:"selectItem",lazy:"true","hide-footer":"",size:"lg",title:"Select a library item"},{default:s(()=>[o(w,{excludeAllCollections:!1,onSelectExistingItemWithDetails:t.attachToItem,onClose:e[1]||(e[1]=y=>t.closeModal("selectItem")),"hide-buttons":!0},null,8,["onSelectExistingItemWithDetails"])]),_:1}),e[12]||(e[12]=a("div",{class:"mt-4"},null,-1)),!t.loading&&t.tempShareData&&t.tempShareData.length>0?(l(),d("div",W,[a("div",K,[o(p,{variant:"primary",class:"nowrap",onClick:t.createPost,disabled:t.processingFiles},{default:s(()=>[o(r,{icon:"share"}),e[3]||(e[3]=a("span",{class:"ms-1"}," Share",-1))]),_:1},8,["onClick","disabled"]),o(D,{variant:"primary"},{"button-content":s(()=>[o(r,{icon:"plus-lg",class:"me-1"}),e[4]||(e[4]=h("Add to library "))]),default:s(()=>[o(g,{onClick:t.addToLibrary},{default:s(()=>[o(r,{icon:"save",class:"me-1"}),e[5]||(e[5]=h()),e[6]||(e[6]=a("span",null," New item",-1))]),_:1},8,["onClick"]),v((l(),I(g,null,{default:s(()=>[o(r,{icon:"paperclip",class:"me-1"}),e[7]||(e[7]=a("span",null,"Existing item",-1))]),_:1})),[[b,void 0,void 0,{selectItem:!0}]])]),_:1}),o(p,{variant:"outline-secondary",class:"nowrap",onClick:e[2]||(e[2]=y=>t.cancelAndGoHome())},{default:s(()=>[o(r,{icon:"x-lg"}),t.isMobile?_("",!0):(l(),d("span",Q," Cancel"))]),_:1})]),e[9]||(e[9]=a("hr",null,null,-1)),o(A),e[10]||(e[10]=a("hr",null,null,-1)),v((l(),I(p,{variant:"secondary"},{default:s(()=>e[8]||(e[8]=[h("Add File")])),_:1})),[[b,void 0,void 0,{addFile:!0}]])])):!t.loading&&(!t.tempShareData||t.tempShareData.length==0)?(l(),d("div",R,[e[11]||(e[11]=a("div",{class:"text-muted mt-4 small"},"No files selected",-1)),a("div",q,[o(p,{variant:"primary",class:"nowrap",onClick:t.cancelAndGoHome},{default:s(()=>[o(r,{icon:"x-lg"}),(l(),d("span",J," Close"))]),_:1},8,["onClick"])])])):t.loading?(l(),d("div",O,[a("div",X,[o(k,{variant:"primary",label:"Loading..."})])])):_("",!0),e[13]||(e[13]=a("div",{class:"bottom-gap"},null,-1))])}const pe=M(H,[["render",Y],["__scopeId","data-v-0367531c"]]);export{pe as default};

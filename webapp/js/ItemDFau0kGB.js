const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/CreateOrEditNoteCTLeJkc5.js","js/components.globalBic2x0kT.js","js/@vueC3Nhqlrl.js","js/vue3-toastifyDll2FbVh.js","assets/vue3-toastify.css","js/@capacitorCjBcbZvA.js","js/bootstrap-vue-nextDnMzdrWQ.js","assets/bootstrap-vue-next.css","assets/components.css","js/PopCollectionSelectorCwff-9C9.js","js/CreateCollectionDxlS16jr.js","js/TIIconDefaultCMdnLD-P.js","assets/TIIconDefault.css","js/ai_lookup_utilszDX_hcwM.js","assets/CreateCollection.css","js/ItemImagelPteIRA_.js","assets/PopCollectionSelector.css","js/textrenderCbOBgGbr.js","js/markedJKvyS0Pp.js","assets/CreateOrEditNote.css"])))=>i.map(i=>d[i]);
import{_ as de}from"./@capacitorCjBcbZvA.js";import{T as me,P as ue}from"./TIIconDefaultCMdnLD-P.js";import{a as Z,ak as _,t as J,p as he,a4 as X,aY as fe,_ as H,j as te,aZ as pe,d as D,D as ce,a0 as ge,n as ve,l as ie,a8 as ye,J as Ie}from"./components.globalBic2x0kT.js";import{U as be}from"./UpdateSubscribersBdPh3sjI.js";import{T as ke}from"./TIFeedbackInfoC6PM9-5H.js";import{I as x}from"./ItemImagelPteIRA_.js";import{I as we}from"./ItemAttachmentViewer7SSKfvG4.js";import{a as Ce}from"./subscription.storeBRgRghO8.js";import{p as $e}from"./textrenderCbOBgGbr.js";import{d as ee,j as l,X as Te,k as i,K as s,s as a,z as n,p as K,R as c,l as Ae,Q as f,F as R,P as M,m as p,r as u,i as o,ac as le,L as A,U as Re,O as Me,ab as Ue,aa as Pe}from"./@vueC3Nhqlrl.js";import{U as ae}from"./UploadItemImageC760GSns.js";import{I as Le,a as Se,b as Ee}from"./ItemTargetAudiences9FGA2Ccd.js";import{I as Ve,a as Fe}from"./ItemContentTypeDG2vpO9H.js";import{I as De}from"./ItemCategoriesDqpWIyb-.js";import{I as Ne}from"./ItemTypesCr9cej62.js";import{A as ze,P as je}from"./CreateCollectionDxlS16jr.js";import Be from"./PopCollectionSelectorCwff-9C9.js";import{P as qe}from"./PublicProfileEditD4B_jFiw.js";import{I as Oe}from"./ItemPermissionEditorJhGvTOav.js";import Ke from"./ViewComments9m8ULuQ5.js";import{I as We}from"./ItemAttachmentsLDTgShM6.js";import{c as Ge}from"./item.storeDRTqnxm_.js";import{g as se}from"./ai_lookup_utilszDX_hcwM.js";import{a as _e}from"../kindredapp.js";import"./vue3-toastifyDll2FbVh.js";import"./bootstrap-vue-nextDnMzdrWQ.js";import"./SelectAccountUsersBAeUorit.js";import"./markedJKvyS0Pp.js";import"./vue-advanced-cropperDRfTlVFt.js";import"./SelectUsersClji3Z4d.js";import"./upload.mixinCdGnd8mT.js";import"./@mozillaCDB2aYYy.js";import"./vue-routerB6Jsgi62.js";import"./browserTabsB3WsZHRs.js";import"./vue-plugin-load-scriptXwA-LyvJ.js";import"./bootstrapDQG5F40S.js";import"./@popperjsCCtJ9KiL.js";const He=ee({name:"ItemInfo",components:{TIFeedbackInfo:ke,ItemImage:x,ItemAttachmentViewer:we,UpdateSubscribers:be},mixins:[Z],props:["item","numRatings","overallRating","inLibrary"],data(){return{showFS:!1,useCriteria:null,showDetails:!1,selectedFeed:null,subscriptionTitle:"",subLookups:null}},computed:{isPublished(){var e,t;return((e=this.item)==null?void 0:e.published)&&((t=this.item)==null?void 0:t.publishId)},isArchived(){var e;return!!((e=this.item)!=null&&e.archived)},categories(){var e;return(e=this.item)==null?void 0:e.categories},tags(){var e,t,r;return(e=this.item)!=null&&e.tags&&Array.isArray((t=this.item)==null?void 0:t.tags)?(r=this.item)==null?void 0:r.tags.join(", "):null},noteText(){var t,r;return(r=(t=this.item)==null?void 0:t.info)==null?void 0:r.value},itemIcon(){var e,t,r,h,y;if(((e=this.item)==null?void 0:e.type)=="link")return"link";if(((t=this.item)==null?void 0:t.type)=="note")return"journal-text";if(((r=this.item)==null?void 0:r.type)=="thing")return((y=_()[(h=this.item)==null?void 0:h.subType])==null?void 0:y.icon)||null},itemType(){var e,t,r,h,y,w,g;return(e=this.item)!=null&&e.type?((t=this.item)==null?void 0:t.type)!="thing"?((r=this.item)==null?void 0:r.type.charAt(0).toUpperCase())+((h=this.item)==null?void 0:h.type.slice(1)):((w=_()[(y=this.item)==null?void 0:y.subType])==null?void 0:w.name)||((g=this.item)==null?void 0:g.subType):null},additionalLinks(){var t,r,h,y;const e=[];return(r=(t=this.item)==null?void 0:t.info)!=null&&r.additionalLinks&&e.push(...(y=(h=this.item)==null?void 0:h.info)==null?void 0:y.additionalLinks.filter(w=>w.type!="rss_feed")),e},isYoutubeChannel(){var e,t;return((t=(e=this.item)==null?void 0:e.meta)==null?void 0:t.THETASET_PAGE_TYPE)=="YOUTUBE_CHANNEL"},itemFeeds(){var r,h,y,w,g;let e=[];if(this.isYoutubeChannel){const v=(y=(h=(r=this.item)==null?void 0:r.meta)==null?void 0:h.tsExtractedInfo)==null?void 0:y.youtubeChannelIds;v&&v.length>0&&e.push({id:"main",title:"Channel Feed",url:this.item.url,feedURL:"https://www.youtube.com/feeds/videos.xml?channel_id="+v[0]})}const t=((g=(w=this==null?void 0:this.item)==null?void 0:w.info)==null?void 0:g.additionalLinks)||[];if(t.length>0)for(const v of t)v.type=="rss_feed"&&e.push({id:v.id,title:v.title,url:this.item.url,feedURL:v.url});return e},hasEditPermission(){var e;return this.hasEditPermissionToItemId((e=this.item)==null?void 0:e._id)}},methods:{textTruncate:J,prettyTimePast:he,parseMarkdown:$e,patterns(e=30){var r,h;const t=(r=this.item)!=null&&r.patterns&&Array.isArray((h=this.item)==null?void 0:h.patterns)?this.item.patterns.join(", "):null;return e?J(t,e):t},async toggleSubscribe(e){this.selectedFeed=e,this.showModal("subscribe-to-modal")},async loadSubLookup(){const e=this.itemFeeds.map(t=>X(t.feedURL));this.subLookups=await Ce.getSubscriptionsMap(e)},isSubscribedToFeed(e){return this.subLookups?this.subLookups[X(e.feedURL)]!=null:!1},reviewClick(){this.$emit("select","review")},noteEdit(){this.hasEditPermission&&this.$emit("select","editNote")},tryToEdit(){this.hasEditPermission&&["note","link","thing"].includes(this.item.type)&&this.$emit("select","edit")},handleLinkClick(e){e.target.tagName==="A"&&e.stopPropagation()},addPropListener(){try{const e=this.$refs.noteTextBox;if(!e)return;e.removeEventListener("click",this.handleLinkClick),e.addEventListener("click",this.handleLinkClick)}catch(e){console.log(e)}}},mounted(){this.addPropListener()},beforeUnmount(){const e=this.$refs.noteTextBox;if(e)try{e.removeEventListener("click",this.handleLinkClick)}catch(t){console.log(t)}},watch:{noteText(){this.$nextTick(()=>{this.addPropListener()})}},created(){this.useCriteria=fe(this.item.useCriteria),this.loadSubLookup()}}),Qe={key:0},Ye={class:"text-center fsImageContainer"},Je={class:"col-md"},Xe={class:"d-flex align-items-center flex-gap-xs justify-content-between"},Ze={class:"ms-auto"},xe={key:0,class:"small cleanWrap my-1"},et=["href"],tt={key:1,class:"d-flex flex-gap-sm text-muted small my-1"},it={key:2,class:"small text-muted"},st=["role"],ot=["innerHTML"],nt={key:4,class:"d-flex flex-wrap my-2 small"},lt={key:0},at={key:5,class:"d-flex my-1 d-flex align-items-center small",title:"Rating are public"},rt={title:"number of ratings",class:"small"},dt={class:"d-flex align-items-center flex-gap-sm flex-wrap mt-2"},mt={key:3,class:"d-flex flex-wrap flex-gap-sm xsmall flex-wrap"},ut={class:"small"},ht={key:0,class:"alert alert-warning my-2"},ft={key:1,class:"d-flex flex-wrap my-2 flex-gap-sm"},pt={key:0,class:"fillrow text-muted rounded px-2",title:"Educational Value"},ct={key:1,class:"fillrow text-muted rounded px-2"},gt={key:2,class:"fillrow text-muted rounded px-2"},vt={key:3,class:"fillrow text-muted rounded px-2"},yt={key:4,class:"fillrow text-muted rounded px-2"},It={key:5,class:"fillrow text-muted rounded px-2"},bt={key:6,class:"d-flex flex-wrap fillrow text-muted rounded px-2"},kt={key:2},wt={class:"divfit py-1 px-2 my-2 rounded border",title:"remark comment"},Ct={class:"small text-muted"},$t={key:3,class:"mt-2"},Tt={class:"d-flex flex-gap-sm align-items-center flex-wrap"},At=["title","onClick"],Rt={key:4,class:"mt-2"},Mt={class:"d-flex flex-wrap flex-gap-sm"},Ut=["href"],Pt=["href"],Lt={class:"d-flex justify-content-between flex-gap-1 text-muted mt-2"},St={key:0,class:"xsmall text-muted-extra"},Et={key:1,class:"xsmall text-muted-extra"};function Vt(e,t,r,h,y,w){var k,P,L,q,j;const g=u("b-icon"),v=u("ItemAttachmentViewer"),N=u("UpdateSubscribers"),C=u("b-modal"),U=u("TruncateExpand"),V=u("router-link"),B=u("b-rating"),O=u("TIFeedbackInfo"),b=u("b-link");return e.item?(o(),l("div",Qe,[e.showFS?(o(),l("div",{key:0,class:"fsModal",onKeydown:t[2]||(t[2]=Te(I=>e.showFS=!1,["esc"]))},[i("div",{class:"fsModalClose",role:"button",onClick:t[0]||(t[0]=I=>e.showFS=!1)},[s(g,{icon:"x-lg",class:"fsModalCloseIcon"})]),i("div",Ye,[s(v,{item:e.item,isPub:!1,isFS:!0,onClose:t[1]||(t[1]=I=>e.showFS=!1)},null,8,["item"])])],32)):a("",!0),s(C,{id:"subscribe-to-modal",title:"Manage Subscribers","hide-footer":"",size:"xl"},{default:n(()=>[s(N,{item:e.item,refId:e.item._id,refType:"item_feed",onUpdate:t[3]||(t[3]=I=>{e.closeModal("subscribe-to-modal"),e.loadSubLookup()}),subInfo:e.selectedFeed},null,8,["item","refId","subInfo"])]),_:1}),i("div",{class:K(["row mt-1 d-flex flex-gap-1 flex-wrap",e.isMobile?"":" "])},[e.item.defaultImage?(o(),l("div",{key:0,class:K(["col-md-6 d-flex justify-content-center",e.isMobile?" ":""])},[s(v,{item:e.item,onClick:t[4]||(t[4]=I=>e.showFS=!0)},null,8,["item"])],2)):a("",!0),i("div",Je,[i("div",null,[i("div",null,[i("div",Xe,[i("div",{class:"h4 my-0 py-0",onClick:t[5]||(t[5]=I=>e.tryToEdit()),role:"button","data-test-id":"tryToEditItemButton"},c(e.item.name),1),i("div",Ze,[Ae(e.$slots,"default")])]),e.item.type=="link"?(o(),l("div",xe,[i("a",{target:"_blank",href:e.item.url},c(e.textTruncate(e.item.url,50)),9,et)])):a("",!0),e.item&&((k=e.item)==null?void 0:k.subType)!="default"?(o(),l("div",tt,[s(g,{icon:e.itemIcon},null,8,["icon"]),f(" "+c(e.itemType),1)])):a("",!0),e.item.type!="note"?(o(),l("div",it,[s(U,{content:e.item.description,class:"wwrap"},{default:n(()=>t[10]||(t[10]=[i("span",{class:"linklike ms-1",role:"button"},"more",-1)])),_:1},8,["content"])])):a("",!0),e.item&&e.noteText?(o(),l("div",{key:3,class:K(["mt-2 mb-3",e.isMobile?"d-flex justify-content-center ":""]),role:e.hasEditPermission?"button":"",onClick:t[6]||(t[6]=(...I)=>e.noteEdit&&e.noteEdit(...I))},[i("div",{class:K(["my-1 noteTextBox",(e.isMobile,"")]),ref:"noteTextBox",innerHTML:e.parseMarkdown(e.noteText)},null,10,ot)],10,st)):a("",!0),e.categories&&e.categories.length>0?(o(),l("div",nt,[(o(!0),l(R,null,M(e.categories,(I,S)=>(o(),l("div",{key:S,class:"me-1"},[s(V,{to:`/searchPublished?category=${I}`},{default:n(()=>[f(c(I),1)]),_:2},1032,["to"]),S<e.categories.length-1?(o(),l("span",lt,",")):a("",!0)]))),128))])):a("",!0),e.item.type=="link"?(o(),l("div",at,[i("span",{onClick:t[7]||(t[7]=I=>e.reviewClick()),role:"button"},[s(B,{class:"ps-0 pe-1","no-border":"",readonly:"",size:"sm",inline:"",value:e.overallRating},null,8,["value"])]),i("div",rt,c(e.numRatings||"no ratings yet"),1)])):a("",!0),i("div",dt,[e.isAdminUser||e.inLibrary?(o(),p(O,{key:0,value:e.item,"onUpdate:value":t[8]||(t[8]=I=>e.item=I),class:"rounded hoverrow py-1 px-1"},null,8,["value"])):a("",!0),e.item.publishId?(o(),p(b,{key:1,class:"small text-muted",to:`/v/${e.item.publishId}`,title:"Linked with Published Item. Click to view."},{default:n(()=>[s(g,{icon:"cloud"})]),_:1},8,["to"])):a("",!0),(P=e.item.attachments)!=null&&P.entries&&e.item.attachments.entries.length>0?(o(),l("div",{key:2,class:"small p-1 text-muted",role:"button",onClick:t[9]||(t[9]=I=>e.$emit("viewAttachments"))},[s(g,{icon:"paperclip"})])):a("",!0),e.item.tags&&e.item.tags.length>0?(o(),l("div",mt,[(o(!0),l(R,null,M(e.item.tags,(I,S)=>(o(),l("div",{key:S},[I?(o(),p(b,{key:0,class:"rounded fillrow px-2 py-1 text-muted",to:`/?type=tags&value=${I}`},{default:n(()=>[f(c(I),1)]),_:2},1032,["to"])):a("",!0)]))),128))])):a("",!0)])]),i("div",ut,[e.isArchived?(o(),l("div",ht,[s(g,{icon:"exclamation-triangle"}),t[11]||(t[11]=f(" This item is archived. "))])):a("",!0),e.item.useCriteria&&e.item.useCriteria.length>0?(o(),l("div",ft,[e.useCriteria.eduValue?(o(),l("div",pt,c(e.useCriteria.eduValue.name),1)):a("",!0),e.useCriteria.minAgeGroup?(o(),l("div",ct," Min Age Group: "+c((L=e.useCriteria)==null?void 0:L.minAgeGroup.name),1)):a("",!0),e.useCriteria.targetAudiences&&((q=e.useCriteria)==null?void 0:q.targetAudiences.length)>0?(o(),l("div",gt," Audience: "+c((j=e.useCriteria)==null?void 0:j.targetAudiences.map(I=>I.name).join(", ")),1)):a("",!0),e.useCriteria.cost?(o(),l("div",vt,c(e.useCriteria.cost.name),1)):a("",!0),e.useCriteria.ads?(o(),l("div",yt," Ads: "+c(e.useCriteria.ads.name),1)):a("",!0),e.useCriteria.costDetails&&e.useCriteria.costDetails.length>0?(o(),l("div",It,c(e.useCriteria.costDetails.map(I=>I.name).join(", ")),1)):a("",!0),e.useCriteria.content&&e.useCriteria.content.length>0?(o(),l("div",bt," Content includes: "+c(e.useCriteria.content.map(I=>I.name).join(", ")),1)):a("",!0)])):a("",!0),e.item.comment?(o(),l("div",kt,[i("div",wt,[s(g,{icon:"chat-right-text-fill",class:"me-1 remark-color"}),i("span",Ct,c(e.item.comment),1)])])):a("",!0),e.itemFeeds.length?(o(),l("div",$t,[i("div",Tt,[(o(!0),l(R,null,M(e.itemFeeds,(I,S)=>(o(),l("div",{role:"button",key:S,class:"rounded fillrow px-2 py-1 border",title:`Click to ${e.isSubscribedToFeed(I)?"un":""}subscribe`,onClick:z=>e.toggleSubscribe(I)},[e.isSubscribedToFeed(I)?(o(),p(g,{key:0,icon:"check"})):(o(),p(g,{key:1,icon:"newspaper"})),f(" "+c(I.title),1)],8,At))),128))])])):a("",!0),e.item.url&&e.item.type!="link"||e.additionalLinks.length>0?(o(),l("div",Rt,[i("div",Mt,[e.item.url&&e.item.type!="link"?(o(),l("a",{key:0,target:"_blank",href:e.item.url,class:"rounded px-2 border hoverrow linklike"},[s(g,{icon:"link"})],8,Ut)):a("",!0),(o(!0),l(R,null,M(e.additionalLinks,(I,S)=>(o(),l("a",{key:S,href:`${I.url}`,class:"rounded hoverrow px-2 border",target:"_blank"},[I.type=="link"?(o(),p(g,{key:0,icon:"link"})):a("",!0),f(" "+c(I.title),1)],8,Pt))),128))])])):a("",!0),i("div",Lt,[i("div",null,[e.item.feedback&&e.item.feedback.visitCount?(o(),l("div",St," visited "+c(e.prettyTimePast(e.item.feedback.lastVisit)+" ago"||"never"),1)):e.item.updatedAt?(o(),l("div",Et," updated "+c(e.prettyTimePast(e.item.updatedAt)+" ago"||"never"),1)):a("",!0)])])])])])],2)])):a("",!0)}const Ft=H(He,[["render",Vt]]);function oe(e){return Array.isArray(e)&&e!==null?e:[]}const Dt=["start","textinfo","linkinfo","categories","criteria"],ne=["start","textinfo","linkinfo","categories","criteria"],Nt={start:"Info",linkinfo:"Details",textinfo:"Text/Note",categories:"Categories",criteria:"Criteria",thinginfo:"Details"},zt=ee({name:"ItemEdit",mixins:[Z],components:{ItemMinAgeGroup:Le,ItemEduValue:Se,ItemTargetAudiences:Ee,ItemContentTags:Ve,UploadItemImage:ae,ItemContentType:Fe,ItemCategories:De,ItemTypes:Ne,ItemImage:x,AISuggester:ze},props:{itemId:{type:String,default:null},cancelButtonName:{type:String,default:"Cancel"},saveButtonName:{type:String,default:"Save"}},data(){return{page:"start",pages:["start"],url:null,editedURL:null,name:null,comment:null,description:null,tags:null,patterns:null,categories:[],publishId:null,imageFilename:null,details:null,itemInfo:null,additionalLinks:[],additionalLinkForm:{title:null,url:null,type:"link"},additionalLinkFormOptions:[{value:"link",text:"Link"},{value:"rss_feed",text:"RSS Feed"}],infoValue:null,infoEditor:null,meta:{title:null,description:null,keywords:null,image:null},imageRefresh:0,errorMessage:null,publishComplete:!1,loading:!1,categoryOptions:[],useCriteria:{eduValue:null,minAgeGroup:null,targetAudiences:[],cost:null,ads:null,costDetails:[],content:[]}}},mounted(){},computed:{typeIcon(){var e,t,r,h,y;if(((e=this.details)==null?void 0:e.type)=="link")return"link";if(((t=this.details)==null?void 0:t.type)=="note")return"journal-text";if(((r=this.details)==null?void 0:r.type)=="thing")return((y=_()[(h=this.details)==null?void 0:h.subType])==null?void 0:y.icon)||null},typeName(){var e,t,r,h,y,w,g;return(e=this.details)!=null&&e.type?((t=this.details)==null?void 0:t.type)!="thing"?((r=this.details)==null?void 0:r.type.charAt(0).toUpperCase())+((h=this.details)==null?void 0:h.type.slice(1)):((w=_()[(y=this.details)==null?void 0:y.subType])==null?void 0:w.name)||((g=this.details)==null?void 0:g.subType):null},pageIndex(){return this.pages.indexOf(this.page)}},methods:{addAdditionalLink(){const t=(h=>h.toLowerCase().replace(/[^a-z0-9]/g,""))(this.additionalLinkForm.title);if(this.additionalLinkForm.id=t,this.additionalLinks.find(h=>h.id==t)){this.showToast("Link with same title already exists",{variant:"danger"});return}const r=te(this.additionalLinkForm.url);if(!pe(r)){this.showToast("Invalid URL",{variant:"danger"});return}this.additionalLinks.push({...this.additionalLinkForm}),this.additionalLinkForm={id:null,title:null,url:null,type:null},this.save(!1),this.closeModal("add-additional-link-modal")},removeAdditionalLink(e){this.additionalLinks=this.additionalLinks.filter(t=>t!=e)},async saveCategories(){this.closeModal("categories-modal"),await this.save(!1),await this.loadItem()},updateItemType(e){if(D("update",e),!this.details){this.errorMessage="Error loading item details";return}this.details.type=e.type,this.details.subType=e.subType,this.updatePages(),this.save(!1),this.closeModal("item-types-modal")},updatePages(){this.pages=[],this.details.type=="link"?this.pages=[...Dt]:this.details.type=="thing"?this.pages=[...ne]:this.pages=[...ne]},pageName(e){return Nt[e]||e},loadCategories(){this.sendReq("/categories",{availOnly:!1}).then(e=>{e.success?(this.categoryOptions=e.result,this.errorMessage=null,this.loading=!1):(console.error("Error:",e.message),this.errorMessage=e.message)})},async refreshImage(){this.imageRefresh+=1,this.details=null,this.$nextTick(()=>{this.loadItem(),this.closeModal("image-modal")})},async updateWithSuggestion(e){this.name=e.name,this.description=e.description,this.tags=e.tags.join(", "),this.infoValue=e.textContent},async loadItem(){var t,r,h;const e=await this.sendReq("/client/item/info",{itemId:this.itemId});e.success?(this.itemInfo=e.result,this.details=e.result.details,this.updatePages(),this.meta=((t=this.details)==null?void 0:t.meta)||{},this.url=this.details.url,this.editedURL=this.url,this.name=this.details.name||((r=this.meta)==null?void 0:r.title),this.description=this.details.description||((h=this.meta)==null?void 0:h.description),this.comment=this.details.comment,this.patterns=!this.details.patterns||!Array.isArray(this.details.patterns)?"":this.details.patterns.join(`
`),this.tags=!this.details.tags||!Array.isArray(this.details.tags)?"":this.details.tags.join(", "),this.details.info&&(this.additionalLinks=[...oe(this.details.info.additionalLinks)],this.infoValue=this.details.info.value,this.infoEditor=this.details.info.editor),this.useCriteria={...ce(this.details.useCriteria)},this.imageFilename=this.details.imageFilename,this.categories=[...oe(this.details.categories)]):(console.error("Error:",e.message),this.errorMessage=e.message,console.error(e.message))},async loadMetaData(){const e=await this.sendReq("/client/fetchMetadata",{url:this.url});e.success?(this.meta=e.result,this.errorMessage=null):this.errorMessage=e.message},async loadData(){this.loadCategories(),this.loadItem()},async refreshWithMeta(){await this.refreshMeta(),await this.loadItem()},async refreshMeta(){await this.sendReq("/client/refreshItemMeta",{itemIds:[this.itemId]})},async updateItemInfo(){this.editedURL=te(this.editedURL),this.url=this.editedURL,await this.loadMetaData(),this.updatePatterns(),this.save(!1)},updatePatterns(){this.patterns=ge(this.url)},async save(e=!0){var t,r;if(!this.isAdminUser){this.errorMessage="You must be an Admin to edit items directly";return}this.loading=!0;try{let h=this.patterns?this.patterns.split(`
`).map(function(U){return U.trim()}):[],y=this.tags?this.tags.split(",").map(function(U){return U.toLowerCase().trim()}):[];const w=Array.from(new Set([this.useCriteria.eduValue,this.useCriteria.minAgeGroup,...this.useCriteria.targetAudiences,this.useCriteria.cost,this.useCriteria.ads,...this.useCriteria.costDetails,...this.useCriteria.content].filter(U=>U!=null))),g=this.name==((t=this.meta)==null?void 0:t.title)?null:this.name,v=this.description==((r=this.meta)==null?void 0:r.description)?null:this.description,N={url:this.url,key:this.url?X(this.url):null,name:g,description:v,comment:this.comment,tags:y,type:this.details.type,subType:this.details.subType,patterns:h,imageFilename:this.imageFilename,useCriteria:w,categories:this.categories,info:{additionalLinks:[...this.additionalLinks],value:this.infoValue,editor:this.infoEditor},encInfo:this.details.encInfo},C=await this.sendReq("/client/item/update",{itemId:this.itemId,data:N});C.success?(this.url!=this.editedURL&&await this.refreshMeta(),this.RefreshIndexQuick(),e&&this.$emit("close",!0),this.errorMessage=null):(console.error("Error:",C.message),this.errorMessage=C.message)}catch(h){this.errorMessage=h,console.error(h)}this.loading=!1},async close(){this.$emit("close",!0)}},created(){this.loadData()}}),jt={class:"d-flex mt-4 justify-content-end"},Bt={key:0},qt={class:"d-flex flex-gap-1 justify-content-between"},Ot={key:0},Kt=["onClick"],Wt={key:0,class:"mt-3"},Gt={class:"mt-2"},_t={class:"divfit"},Ht={class:"d-flex flex-gap-1 align-items-center p-2 border rounded"},Qt={role:"button"},Yt={class:"d-flex align-items-center mt-2 flex-gap-sm mt-3"},Jt={class:"d-flex mt-1"},Xt={class:"d-flex flex-gap-1 align-items-center truncateme hoverrow p-2 border rounded",role:"button"},Zt={class:"truncatetext"},xt={class:"mb-2"},ei={class:"my-3"},ti={class:"mt-2"},ii={class:"my-2"},si={class:"rounded border"},oi={class:"small text-muted"},ni={class:"small text-muted"},li={key:0,class:"text-muted smal p-2"},ai={class:"my-2 small border rounded p-2 fillrow"},ri={class:"mt-2"},di={class:"text-muted small p-2 my-2 rounded fillrow"},mi={class:"mb-4"},ui={class:"my-2"},hi={class:"my-2"},fi={class:"h5"},pi={class:"ms-2"},ci={key:1},gi={class:"text-muted small p-2 my-2 rounded fillrow"},vi={class:""},yi={class:"mt-3"},Ii={class:"mt-3"},bi={class:"mt-3"},ki={class:"mt-2"},wi={class:"mt-2 mb-4"},Ci={key:0},$i={class:"ms-auto"},Ti={key:1},Ai={key:0},Ri={key:1,class:"text-center my-4"};function Mi(e,t,r,h,y,w){const g=u("b-form-input"),v=u("b-form-group"),N=u("b-form-select"),C=u("b-button"),U=u("b-modal"),V=u("b-form-textarea"),B=u("UploadItemImage"),O=u("ItemCategories"),b=u("ItemTypes"),k=u("b-icon"),P=u("b-col"),L=u("b-row"),q=u("AISuggester"),j=u("ItemImage"),I=u("b-card"),S=u("ItemEduValue"),z=u("ItemMinAgeGroup"),W=u("ItemTargetAudiences"),$=u("ItemContentTags"),Q=u("ItemContentType"),G=u("b-alert"),Y=u("b-button-toolbar"),E=u("b-container"),d=u("b-spinner"),T=le("b-modal");return o(),l("div",null,[s(U,{id:"add-additional-link-modal",title:"Add Link",lazy:"true","hide-footer":""},{default:n(()=>[i("div",null,[s(v,{class:"form-group"},{default:n(()=>[s(g,{modelValue:e.additionalLinkForm.title,"onUpdate:modelValue":t[0]||(t[0]=m=>e.additionalLinkForm.title=m),placeholder:"Title"},null,8,["modelValue"])]),_:1}),s(v,{class:"form-group"},{default:n(()=>[s(g,{autocorrect:"off",autocapitalize:"off",modelValue:e.additionalLinkForm.url,"onUpdate:modelValue":t[1]||(t[1]=m=>e.additionalLinkForm.url=m),placeholder:"URL"},null,8,["modelValue"])]),_:1}),s(v,{class:"form-group"},{default:n(()=>[s(N,{modelValue:e.additionalLinkForm.type,"onUpdate:modelValue":t[2]||(t[2]=m=>e.additionalLinkForm.type=m),options:e.additionalLinkFormOptions},null,8,["modelValue","options"])]),_:1}),i("div",jt,[s(C,{variant:"primary",onClick:t[3]||(t[3]=m=>e.addAdditionalLink())},{default:n(()=>t[27]||(t[27]=[f("Finish")])),_:1})])])]),_:1}),s(U,{lazy:"true",id:"edit-url-modal",title:"Modify URL","ok-only":"",onOk:t[5]||(t[5]=m=>e.updateItemInfo())},{default:n(()=>[s(v,{class:"form-group"},{default:n(()=>[s(V,{id:"formURL",modelValue:e.editedURL,"onUpdate:modelValue":t[4]||(t[4]=m=>e.editedURL=m),placeholder:"url",rows:"7"},null,8,["modelValue"])]),_:1})]),_:1}),s(U,{lazy:"true",id:"image-modal",title:"Item Image",size:"lg","hide-footer":""},{default:n(()=>[s(B,{itemId:e.itemId,onClose:t[6]||(t[6]=m=>e.refreshImage())},null,8,["itemId"])]),_:1}),s(U,{lazy:"true",id:"categories-modal",title:"Categories",size:"lg","hide-footer":""},{default:n(()=>[i("div",null,[s(O,{itemId:e.itemId,onClose:t[7]||(t[7]=m=>e.saveCategories())},null,8,["itemId"])])]),_:1}),s(U,{lazy:"true",id:"item-types-modal",title:"Item Type",size:"lg","hide-footer":""},{default:n(()=>[e.details?(o(),l("div",Bt,[s(b,{itemType:e.details.type,itemSubType:e.details.subType,onUpdate:e.updateItemType,onClose:t[8]||(t[8]=m=>e.closeModal("item-types-modal"))},null,8,["itemType","itemSubType","onUpdate"])])):a("",!0)]),_:1}),i("div",qt,[t[28]||(t[28]=i("h5",{class:"mt-2"},"Edit Item",-1)),s(C,{variant:"link",onClick:t[9]||(t[9]=m=>e.close())},{default:n(()=>[s(k,{icon:"x-lg"})]),_:1})]),t[52]||(t[52]=i("hr",{class:"mt-0 mb-2"},null,-1)),e.details?(o(),l("div",Ot,[s(E,{class:"container"},{default:n(()=>[s(L,{class:"row"},{default:n(()=>[s(P,{class:"d-flex flex-gap-sm flex-wrap my-2"},{default:n(()=>[(o(!0),l(R,null,M(e.pages,(m,F)=>(o(),l("div",{role:"button",key:F,onClick:re=>e.page=m,class:K(["py-1 px-2 rounded",e.page==m?"tsTab":""])},c(e.pageName(m)),11,Kt))),128))]),_:1})]),_:1}),t[51]||(t[51]=i("hr",{class:"my-3"},null,-1)),e.page=="start"?(o(),p(L,{key:0},{default:n(()=>[s(P,{class:"col"},{default:n(()=>[e.isAdminUser?(o(),l("div",Wt,[s(q,{customSuggest:"","confirm-update":!0,"valid-action-ids":["main_attr_improve"],onUpdate:e.updateWithSuggestion,"context-data":{name:e.name,description:e.description,tags:e.tags,textContent:e.infoValue,type:e.typeName}},null,8,["onUpdate","context-data"])])):a("",!0),t[31]||(t[31]=i("div",{class:"mt-2"},[i("div",null,"Item Type")],-1)),i("div",Gt,[i("div",_t,[i("div",Ht,[i("div",null,[i("b",null,[e.typeIcon?(o(),p(k,{key:0,icon:e.typeIcon},null,8,["icon"])):a("",!0),f(" "+c(e.typeName),1)])]),A((o(),l("div",Qt,[s(k,{icon:"pencil"})])),[[T,void 0,void 0,{"item-types-modal":!0}]])])]),t[29]||(t[29]=i("div",{class:"text-muted small mt-1"},' Type "link" will open the link when clicked. ',-1))]),i("div",null,[i("div",Yt,[i("div",null,c(e.details.type=="link"?"Primary URL":"Primary URL (optional)"),1),i("button",{class:"btn btn-link",onClick:t[10]||(t[10]=m=>e.refreshWithMeta()),title:"Refresh Metadata"},[s(k,{icon:"arrow-clockwise"})])]),i("div",Jt,[A((o(),l("div",Xt,[i("div",Zt,c(e.url||"none"),1)])),[[T,void 0,void 0,{"edit-url-modal":!0}]])])]),s(v,{class:"form-group mt-3",label:"Name","label-for":"formName",description:"Name (Leave blank to use default)"},{default:n(()=>{var m;return[s(g,{id:"formName",modelValue:e.name,"onUpdate:modelValue":t[11]||(t[11]=F=>e.name=F),placeholder:(m=e.meta)==null?void 0:m.title},null,8,["modelValue","placeholder"])]}),_:1}),s(v,{class:"form-group",label:"Description","label-for":"formDescription",description:"Description (Leave blank to use default)"},{default:n(()=>{var m;return[s(V,{id:"formDescription",modelValue:e.description,"onUpdate:modelValue":t[12]||(t[12]=F=>e.description=F),placeholder:(m=e.meta)==null?void 0:m.description,rows:"3","max-rows":"6"},null,8,["modelValue","placeholder"])]}),_:1}),i("div",xt,[i("div",ei,[t[30]||(t[30]=i("div",{class:"mb-1"},"Banner Image",-1)),(o(),p(j,{item:e.details,key:"jkalsdjf"+e.imageRefresh,class:"mb-2 rounded",style:{"max-width":"100%"}},null,8,["item"])),A((o(),p(C,{size:"sm",variant:"link"},{default:n(()=>[s(k,{icon:"pencil"})]),_:1})),[[T,void 0,void 0,{"image-modal":!0}]])])]),s(v,{class:"form-group",label:"Remark Comment","label-for":"formComment",description:"Remark Comment is optional (optional)"},{default:n(()=>[s(V,{id:"formComment",modelValue:e.comment,"onUpdate:modelValue":t[13]||(t[13]=m=>e.comment=m),placeholder:"Comment (optional)",rows:"3","max-rows":"6"},null,8,["modelValue"])]),_:1}),s(v,{class:"form-group",label:"Tags","label-for":"tags",description:"Tags seperated by commas. For example: 'tag1, tag2, tag3'"},{default:n(()=>[s(g,{autocorrect:"off",autocapitalize:"off",modelValue:e.tags,"onUpdate:modelValue":t[14]||(t[14]=m=>e.tags=m),name:"tags"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):a("",!0),e.page=="linkinfo"?(o(),p(L,{key:1},{default:n(()=>[s(P,{class:"col"},{default:n(()=>[i("div",ti,[t[33]||(t[33]=i("div",null,"Additional links related to this item",-1)),i("div",ii,[s(C,{variant:"outline-primary",size:"sm",onClick:t[15]||(t[15]=m=>e.showModal("add-additional-link-modal"))},{default:n(()=>t[32]||(t[32]=[f("+ Add")])),_:1})]),i("div",null,[i("div",si,[(o(!0),l(R,null,M(e.additionalLinks,(m,F)=>(o(),l("div",{key:F,class:"d-flex justify-content-between hoverrow p-2"},[i("div",null,[i("div",null,c(m.title),1),i("div",oi,c(m.url),1),i("div",ni,c(m.type),1)]),i("div",null,[s(C,{variant:"link",onClick:re=>e.removeAdditionalLink(m)},{default:n(()=>[s(k,{icon:"x"})]),_:2},1032,["onClick"])])]))),128)),e.additionalLinks.length==0?(o(),l("div",li," No additional links ")):a("",!0)])])]),i("div",null,[t[36]||(t[36]=i("div",{class:"my-2"},null,-1)),s(v,{class:"form-group mt-4",label:"URI Patterns","label-for":"formPatterns",description:"Accepted URI Patterns. one per line, * is wild card. For example: *.google.com/* will match all google.com no matter the path provided"},{default:n(()=>[s(V,{id:"formPatterns",modelValue:e.patterns,"onUpdate:modelValue":t[16]||(t[16]=m=>e.patterns=m),placeholder:"Enter URI Patterns",required:"",rows:"3","max-rows":"6"},null,8,["modelValue"])]),_:1}),i("div",ai,[s(k,{icon:"info-circle",class:"me-2"}),t[34]||(t[34]=i("b",null,"URI Patterns",-1)),t[35]||(t[35]=f(" are used when matching content based on URI, such as checking if similar items are in your library or when checking access for restricted users. "))])])]),_:1})]),_:1})):a("",!0),e.page=="textinfo"?(o(),p(L,{key:2},{default:n(()=>[s(P,{class:"col"},{default:n(()=>[i("div",ri,[t[37]||(t[37]=i("div",{class:"my-2"},null,-1)),s(v,{class:"form-group",label:"Item Text Content","label-for":"formTextValue",description:"Markdown format - Text Content to be displayed when viewing the item (optional)"},{default:n(()=>[s(V,{id:"formTextValue",modelValue:e.infoValue,"onUpdate:modelValue":t[17]||(t[17]=m=>e.infoValue=m),placeholder:"Text Content (optional)",rows:"5","max-rows":"20"},null,8,["modelValue"])]),_:1})])]),_:1})]),_:1})):a("",!0),e.page=="categories"?(o(),p(L,{key:3},{default:n(()=>[s(P,{class:"col"},{default:n(()=>[i("div",di,[s(k,{icon:"info-circle",class:"me-1"}),t[38]||(t[38]=f(" Only used for filtering when published outside of library "))]),i("div",mi,[i("div",null,[i("div",null,[i("div",ui,[i("div",null,[i("div",hi,[i("div",fi,[t[39]||(t[39]=f(" Categories ")),A((o(),p(C,{variant:"link",size:"sm"},{default:n(()=>[s(k,{icon:"pencil"})]),_:1})),[[T,void 0,void 0,{"categories-modal":!0}]])]),i("div",pi,[e.categories&&e.categories.length>0?(o(),p(I,{key:0},{default:n(()=>[(o(!0),l(R,null,M(e.categories,(m,F)=>(o(),l("span",{key:F,class:"mx-2"},c(m),1))),128))]),_:1})):(o(),l("div",ci,"No categories assigned"))])])])])])])])]),_:1})]),_:1})):a("",!0),e.page=="criteria"?(o(),p(L,{key:4},{default:n(()=>[s(P,{class:"col"},{default:n(()=>[i("div",gi,[s(k,{icon:"info-circle",class:"me-1"}),t[40]||(t[40]=f(" Only used for filtering when published outside of library "))]),t[45]||(t[45]=i("div",{class:"mb-4"},[i("div",{class:"h5"},"Age Group and Educational Value")],-1)),i("div",vi,[i("div",yi,[t[41]||(t[41]=i("div",{class:"mb-2"},"Educational Value",-1)),s(S,{value:e.useCriteria,"onUpdate:value":t[18]||(t[18]=m=>e.useCriteria=m),class:"col-md"},null,8,["value"])]),i("div",Ii,[t[42]||(t[42]=i("div",{class:"mb-2"},"Minimum Age Group",-1)),s(z,{value:e.useCriteria,"onUpdate:value":t[19]||(t[19]=m=>e.useCriteria=m),class:"col-md"},null,8,["value"])])]),i("div",bi,[t[43]||(t[43]=i("div",{class:"mb-2"},"Target Audiences",-1)),s(W,{value:e.useCriteria,"onUpdate:value":t[20]||(t[20]=m=>e.useCriteria=m),class:"col-md"},null,8,["value"])]),t[46]||(t[46]=i("hr",null,null,-1)),t[47]||(t[47]=i("div",{class:""}," Content Attributes related to cost, ads and availability ",-1)),i("div",ki,[s($,{value:e.useCriteria,"onUpdate:value":t[21]||(t[21]=m=>e.useCriteria=m)},null,8,["value"])]),i("div",wi,[t[44]||(t[44]=i("div",{class:"mb-3"},"Included Contents:",-1)),s(Q,{value:e.useCriteria,"onUpdate:value":t[22]||(t[22]=m=>e.useCriteria=m)},null,8,["value"])])]),_:1})]),_:1})):a("",!0),s(L,{class:"mt-3"},{default:n(()=>[s(P,{class:"col"},{default:n(()=>[e.errorMessage?(o(),l("div",Ci,[s(G,{variant:"danger","model-value":!!e.errorMessage,innerHTML:e.errorMessage},null,8,["model-value","innerHTML"])])):a("",!0),s(Y,null,{default:n(()=>[s(C,{variant:"outline-secondary",size:"lg",onClick:t[23]||(t[23]=m=>e.close())},{default:n(()=>t[48]||(t[48]=[f(" Close ")])),_:1}),i("span",$i,[e.pageIndex>0?(o(),p(C,{key:0,variant:"outline-secondary",size:"lg",onClick:t[24]||(t[24]=m=>e.page=e.pages[e.pageIndex-1])},{default:n(()=>t[49]||(t[49]=[f("Back")])),_:1})):a("",!0),e.pageIndex<e.pages.length-1?(o(),p(C,{key:1,variant:"primary",size:"lg",class:"ms-2",onClick:t[25]||(t[25]=m=>e.page=e.pages[e.pageIndex+1])},{default:n(()=>t[50]||(t[50]=[f("Next")])),_:1})):a("",!0),s(C,{class:"ms-2",variant:"outline-primary",size:"lg",onClick:t[26]||(t[26]=m=>e.save())},{default:n(()=>[f(c(e.saveButtonName),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})])):(o(),l("div",Ti,[e.errorMessage?(o(),l("div",Ai,[s(G,{variant:"danger","model-value":!!e.errorMessage,innerHTML:e.errorMessage},null,8,["model-value","innerHTML"])])):(o(),l("div",Ri,[s(d,{label:"Loading..."})]))]))])}const Ui=H(zt,[["render",Mi]]),Pi={name:"ShareItem",props:["itemId","itemName"],data(){return{itemPermissions:null,selectedUserId:null,selectedUsers:[],notify:!1,notifyMessage:null,errorMessage:null}},mounted(){},computed:{userOptions(){if(!this.users)return[];const e=new Set([...this.selectedUsers.map(r=>r._id)]),t=this.isAdminUser;return this.users.filter(r=>r._id!=this.currentUserId&&!e.has(r._id)&&(t||r.type=="admin"))},selectedUser(){return this.getUserInfo(this.selectedUserId)}},methods:{async share(){const e=this.selectedUsers.map(r=>r._id),t=await this.sendReq("/item/shareWithUsers",{itemId:this.itemId,userIds:e,notifyMessage:this.notify?this.notifyMessage:null,permission:"editor"});t.success?this.$emit("close"):this.errorMessage=t.message},shareCancel(){this.$emit("close")},shareWithUser(){this.selectedUserId!=null&&(this.page="shareWithUser",this.selectedUsers.push(this.getUserInfo(this.selectedUserId)),this.selectedUserId=null)},getUserInfo(e){const t=this.userLookup[e];return t||{}},async loadAll(){await this.RefreshUsers()}},created(){this.loadAll()}},Li={class:"mb-4 d-flex"},Si=["value"],Ei={key:0,disabled:"",class:"text-muted"},Vi={class:"mb-2"},Fi={class:"form-check"},Di={key:0},Ni={class:"d-flex justify-content-between mt-4"},zi=["disabled"];function ji(e,t,r,h,y,w){return o(),l("div",null,[i("div",Li,[A(i("select",{class:"custom-select me-2","onUpdate:modelValue":t[0]||(t[0]=g=>y.selectedUserId=g),onChange:t[1]||(t[1]=g=>w.shareWithUser())},[t[6]||(t[6]=i("option",{value:null,class:"text-muted"},"- Select User -",-1)),(o(!0),l(R,null,M(w.userOptions,(g,v)=>(o(),l("option",{class:"py-2",key:v,value:g._id},c(g.username),9,Si))),128)),w.userOptions.length==0?(o(),l("option",Ei,"No Users Unassigned")):a("",!0)],544),[[Re,y.selectedUserId]])]),(o(!0),l(R,null,M(y.selectedUsers,(g,v)=>(o(),l("div",{key:v},[i("div",Vi,c(g.username),1)]))),128)),t[9]||(t[9]=i("hr",null,null,-1)),i("div",null,[i("div",Fi,[A(i("input",{class:"form-check-input",type:"checkbox",value:"",id:"notifyCheckbox","onUpdate:modelValue":t[2]||(t[2]=g=>y.notify=g)},null,512),[[Me,y.notify]]),t[7]||(t[7]=i("label",{class:"form-check-label",for:"notifyCheckbox"}," Notify Users? ",-1))])]),y.notify?(o(),l("div",Di,[t[8]||(t[8]=i("div",{class:"mt-2 mb-1"},"Message to users:",-1)),A(i("textarea",{class:"form-control","aria-label":"With textarea","onUpdate:modelValue":t[3]||(t[3]=g=>y.notifyMessage=g)},null,512),[[Ue,y.notifyMessage]])])):a("",!0),i("div",Ni,[i("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=g=>w.shareCancel())},"Cancel"),i("button",{class:"btn btn-primary",onClick:t[5]||(t[5]=g=>w.share()),disabled:!y.selectedUsers||y.selectedUsers.length==0}," Share ",8,zi)])])}const Bi=H(Pi,[["render",ji],["__scopeId","data-v-1489a545"]]),qi=ee({name:"ItemPage",mixins:[Z],components:{CreateOrEditNote:Pe(()=>de(()=>import("./CreateOrEditNoteCTLeJkc5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))),ViewComments:Ke,ShareItem:Bi,ItemEdit:Ui,PopCollectionSelector:Be,ItemInfo:Ft,PublicProfileEdit:qe,ItemPermissions:Oe,Permissions:je,TIIconDefault:me,ProfileImage:ue,ItemAttachments:We,UploadItemImage:ae,ItemImage:x},data(){return{commentFocus:!1,itemId:null,itemInfo:{},item:null,collections:[],matches:null,publishedItem:{overallRating:null,numRatings:null},updateDetails:!1,reviewPage:"main",updateKey:0,itemPermissions:null,similarMatches:null,suggestions:[],exactMatches:null,loading:!0,errorMessage:null,selectedCollectionIds:[],commentsVisible:!1,feedback:{isRead:!1,reaction:null,isReadLater:!1},refreshKey:0,loadingAISuggestions:!1,aiSuggestInstructions:"",aiSuggestionData:null,aiSuggestActionId:se()[0].value,aiSuggestActions:se(),userReactions:[],review:null,comment:null,overallRating:null}},mounted(){},computed:{isOwner(){var e,t;return((t=(e=this==null?void 0:this.itemInfo)==null?void 0:e.details)==null?void 0:t.userId)==this.currentUserId},isEncrypted(){var e;return((e=this.item)==null?void 0:e.encInfo)!=null},editPermission(){return this.isAdminUser||this.currentUserPermission=="owner"||this.currentUserPermission=="editor"},anyEditPermission(){return this.currentUserPermission=="owner"||this.currentUserPermission=="editor"},deleteAble(){return this.isAdminUser||this.currentUserPermission=="owner"||this.currentUserPermission=="editor"},currentUserPermission(){if(!this.itemPermissions||!this.currentUserId)return null;const e=this.itemPermissions.find(t=>t.userId==this.currentUserId);return e?e.permission:null},allMatches(){let e=[];return this.exactMatches&&this.exactMatches.length>0&&e.push(...this.exactMatches),this.similarMatches&&this.similarMatches.length>0&&e.push(...this.similarMatches),e},inLibrary(){return!this.itemPermissions||!this.currentUserId?!1:this.itemPermissions.some(e=>e.userId==this.currentUserId)},viewPermission(){return this.currentUserPermission!=null},isArchived(){var e;return!!((e=this.item)!=null&&e.archived)}},methods:{getKeyName(e){return e.charAt(0).toUpperCase()+e.slice(1)},getItemDataByKey(e,t){var r;return t=="name"?e.name:t=="description"?e.description:t=="tags"?this.formatTags(e.tags):t=="textContent"?(r=e==null?void 0:e.info)==null?void 0:r.value:e[t]},getSuggestedDataByKey(e,t){return t=="tags"?this.formatTags(e.tags):e[t]},formatTags(e){return e?e.map(t=>t.toLowerCase()).join(", "):""},textTruncate:J,extractJSONFromMarkdown(e){const t=/```json\s*([\s\S]*?)\s*```/,r=e.match(t);if(r&&r[1])try{return JSON.parse(r[1])}catch(h){return console.error("Failed to parse JSON:",h),null}return null},async loadItemInfo(){var e;this.loading=!0;try{this.itemInfo=await Ge({itemId:this.itemId}),D("Raw Item Info",this.itemInfo),this.item=ve(this.itemInfo),this.loadSuggestedCollections().catch(()=>{}),D("loadItemInfo run",this.itemInfo),this.selectedCollectionIds=this.itemInfo.collectionIds,(e=this.itemInfo)!=null&&e.feedback?(this.feedback.isReadLater=this.itemInfo.feedback.isReadLaterDate!=null,this.feedback.isRead=this.itemInfo.feedback.isReadDate!=null,this.feedback.reaction=this.itemInfo.feedback.reaction):(this.feedback.isReadLater=!1,this.feedback.isRead=!1,this.feedback.reaction=null),this.updatePageTitle(this.item.name),this.loadCollections(this.selectedCollectionIds),this.loadSimilarItems(),this.loadPublished(),this.loadCurrentReview(),this.errorMessage=null,this.updateKey++}catch(t){console.error("Error:",t),this.errorMessage=t}this.refreshKey++,this.loading=!1},async applyAISuggestions(){if(this.aiSuggestionData){this.item.name=this.aiSuggestionData.name,this.item.description=this.aiSuggestionData.description,this.item.tags=this.aiSuggestionData.tags.map(e=>e.toLowerCase()),this.loading=!0;try{await this.apiReq("/client/item/update",{itemId:this.itemId,data:{name:this.item.name,description:this.item.description,tags:this.item.tags,encInfo:this.item.encInfo}}),this.closeModal("ai-suggestions-for-item-modal"),this.RefreshIndexQuick(),await this.loadItemInfo()}catch(e){this.showToast("Error applying AI suggestions: "+e.message,{variant:"danger"})}this.loading=!1}},async loadAISuggestion(){var e;try{this.loadingAISuggestions=!0;const t={type:this.item.type,name:this.item.name,description:this.item.description,tags:this.item.tags,url:this.item.url,textContent:(e=this.item.info)==null?void 0:e.value},r=await this.apiReq("/client/ai/itemUpdateGenerator",{actionId:this.aiSuggestActionId,itemDetails:t,instructions:this.aiSuggestInstructions});if(D("AI suggestion",r.result),!(r!=null&&r.result)){this.showToast("No AI Suggestion found",{variant:"danger",title:"Error",solid:!0});return}let h=r.result;typeof h=="string"&&(h=JSON.parse(h)),this.aiSuggestionData=h}catch(t){console.error(t),this.showToast("Error loading AI Suggestion",{variant:"danger",title:"Error",solid:!0})}finally{this.loadingAISuggestions=!1}},loadCurrentReview(){this.item.publishId!=null&&this.sendReq("/review/getForUser",{publishId:this.item.publishId}).then(e=>{var t,r;e.success&&(e!=null&&e.result)?(this.review=e==null?void 0:e.result,this.comment=(t=this.review)==null?void 0:t.comment,this.overallRating=(r=this.review)==null?void 0:r.overallRating,this.loading=!1):this.loading=!1})},openPopout(){this.$router.push(`/share?url=${this.item.url}`)},async loadSimilarItems(){if(!this.item)return;const e=await this.sendReq("/client/item/similarItemsByURL",{itemId:this.itemId,url:this.item.url});e.success&&(D("Responsesim:",e),this.similarMatches=ie(e.result.similarMatches),this.exactMatches=ie(e.result.exactMatches))},async listUserFilesForItem(){const e=await this.sendReq("/userfile/listFilesByRef",{refType:"item",refId:this.itemId});e.success&&D("listFilesByRef response:",e)},async encryptItem(){if(await this.getRef("msgBoxConfirm").show("Are you sure you want to encrypt this item?",{title:"Confirm",okVariant:"danger",okTitle:"Encrypt this Item?",cancelTitle:"Cancel",hideHeaderClose:!1})){this.loading=!0;try{await this.apiReq("/client/item/encryptItems",{itemIds:[this.itemId]}),await this.loadData()}catch(t){this.showToast("Error encrypting items: "+t.message,{variant:"danger"})}this.loading=!1}},async decryptItem(){if(await this.getRef("msgBoxConfirm").show("Are you sure you want to decrypt this item?",{title:"Confirm",okVariant:"danger",okTitle:"Decrypt this Item?",cancelTitle:"Cancel",hideHeaderClose:!1})){this.loading=!0;try{await this.apiReq("/client/item/decryptItems",{itemIds:[this.itemId]}),await this.loadData()}catch(t){this.showToast("Error decrypting items: "+t.message,{variant:"danger"})}this.loading=!1}},addCollection(e){if(!e){this.closeModal("select-collection-modal");return}D(e),this.sendReq("/item/addToCollections",{collectionIds:[e],itemId:this.itemId}).then(t=>{t.success?this.loadItemInfo():this.errorMessage=t.message,this.closeModal("select-collection-modal")})},removeItemFromCollection(e){this.sendReq("/item/remove",{collectionId:e,itemId:this.itemId}).then(t=>{t.success?this.loadItemInfo():this.showToast("Error removing item from collection",{title:"Error",variant:"danger",solid:!0})})},loadCollections(e){e&&this.sendReq("/client/collection/listByAccount",{ids:e,includePath:!0,includeUserPermissions:!0}).then(t=>{this.collections=t.result})},async loadSuggestedCollections(){D("Loading suggestions for ",this.item);let t=(await this.apiReq("/client/suggestCollections",{searchQuery:this.item.name+" "+this.item.description,excludeRecent:!0})).result||[];t=t.filter(r=>!this.selectedCollectionIds.includes(r._id)),this.suggestions=t},refreshMeta(){this.sendReq("/client/refreshItemMeta",{itemIds:[this.itemId],force:!0}).then(e=>{e.success?(this.loadItemInfo(),this.errorMessage=null):this.showToast("Error refreshing meta",{title:"Error",variant:"danger",solid:!0})})},async findMatchForItem(){if(!this.item.url){this.matches=null;return}const e=await this.sendReq("/published/matchForURL",{url:this.item.url});this.matches=e.result,e.success?this.errorMessage=null:this.errorMessage=e.message},viewAttachments(){this.showModal("attachments-modal")},async publishAndReview(){this.loading=!0;try{return await this._publishAndReview()}catch(e){this.showToast("Failure to publish, please try again.",{title:"Error",variant:"danger",solid:!0}),console.error(e),this.loading=!1}},async _publishAndReview(){var t,r;await this.loadItemInfo();let e={...this.itemInfo,bannerImage:null};if(e!=null&&e.details.imageFilename&&(t=e==null?void 0:e.details)!=null&&t.imageFilename.startsWith("uf_")){const h=(r=e==null?void 0:e.details)==null?void 0:r.imageFilename;let y=await this.getFromImageCache(h);if(!y){let w=await this.apiReq("/client/userfile/getById",{id:h});if(w.success)y=w.result;else throw new Error("Error getting image file")}if(y.startsWith("data:image")){let{fileData:w,fileType:g}=ye(y);y=w}e.bannerImage=y}if(this.item.publishId||(await this.sendReq("/published/publishItem",{itemId:this.itemId,itemData:e}),await this.loadItemInfo()),this.item.publishId){this.$router.push(`/review/${this.item.publishId}`);return}},async toggleArchive(){if(this.isArchived){if(!await this.confirmModal(`Unarchive item: '${this.item.name}'? `,{title:"Confirm",okVariant:"warning ",okTitle:"Unarchive",cancelTitle:"Cancel",hideHeaderClose:!1}))return}else if(!await this.confirmModal(`Archive item: '${this.item.name}'? `,{title:"Confirm",okVariant:"warning ",okTitle:"Archive",cancelTitle:"Cancel",hideHeaderClose:!1}))return;const e=await this.sendReq("/item/archiveUpdate",{itemId:this.item._id,value:!this.isArchived});e.success?(this.loadData(),this.RefreshIndexQuick(),this.errorMessage=null):this.errorMessage=e.message},async aiDiscuss(){_e({type:"item",itemId:this.itemId,data:this.item})},async deleteItem(){var t;if(await this.getRef("msgBoxConfirm").show(`Delete '${(t=this.item)==null?void 0:t.name}'? `,{title:"Confirm",okVariant:"danger ",okTitle:"Delete Permanently",cancelTitle:"Cancel",hideHeaderClose:!1})){if(!(await this.sendReq("/item/delete",{itemId:this.itemId})).success){this.showToast("Error deleting item",{title:"Error",variant:"danger",solid:!0});return}this.RefreshIndexQuick(),this.$router.go(-1),this.showToast("Delete Successful",{title:"Success",variant:"success",solid:!0})}},async _startReview(){if(this.loading=!0,this.errorMessage=null,this.item.publishId){this.$router.push(`/review/${this.item.publishId}`);return}else this.errorMessage="Failure to publish, please try again.",this.loading=!1},async selectMatch(e){await this.sendReq("/client/item/update",{itemId:this.itemId,data:{publishId:e,encInfo:this.item.encInfo}}),await this.loadItemInfo(),await this._startReview()},clickInfo(e){e=="review"&&this.openReview(),e=="editNote"&&this.showModal("edit-note-modal"),e=="edit"&&this.anyEditPermission&&(this.item.type=="note"?this.showModal("edit-note-modal"):(this.item.type=="link"||this.item.type=="thing")&&this.showModal("edit-item-modal"))},async openReview(){if(D("Review..."),this.loading=!0,await this.loadPublicProfile(),!this.publicProfile){this.showModal("public-profile-modal");return}this.item.publishId?await this._startReview():(await this.findMatchForItem(),this.showModal("confirm-review-modal"),this.reviewPage="main",this.loading=!1)},async loadPermissionsAndFeedback(){const e=await this.sendReq("/item/permissionsAndReactions/list",{itemId:this.itemId});if(!e.success){this.showToast("Error loading permissions",{variant:"danger"});return}this.itemPermissions=e.result.permissions,this.userReactions=e.result.reactions},async loadPublished(){if(this.item.publishId==null)return;const e=await this.sendReq("/published/view",{itemId:this.item.publishId});e.success&&e.result?(this.publishedItem=Ie(e.result.info),this.loading=!1):(console.error("Error:",e),this.loading=!1)},async loadData(){this.itemId=this.$route.query.itemId||this.$route.params.itemId,this.$route.query.action=="newComment"&&this.$nextTick(()=>{this.commentFocus=!0}),this.loadItemInfo().then(()=>{this.$route.query.show=="files"&&this.showModal("attachments-modal")}),this.listUserFilesForItem(),this.loadPermissionsAndFeedback(),this.loadPublicProfile()}},created(){this.loadData()}}),Oi={class:"container"},Ki={class:"container"},Wi={class:""},Gi={class:""},_i={class:"d-flex justify-content-end"},Hi={class:"mt-2"},Qi={key:0,class:"mt-5"},Yi={class:"my-2"},Ji={class:"row mb-2"},Xi={class:"col-2"},Zi={class:"larger"},xi={class:"col-md"},es={class:"col-md"},ts={class:"mt-5 d-flex justify-content-between"},is={class:"d-flex flex-gap-sm align-items-center"},ss={class:"miniItemImageContainer"},os={class:"me-1"},ns={class:"d-flex justify-content-center"},ls={key:0},as={class:"d-flex mt-4"},rs={key:0},ds={class:"my-2"},ms={class:"h4"},us={key:0,class:"small text-muted truncateme"},hs={key:0},fs={key:0},ps={key:0,clas:"my-2"},cs={class:"d-flex justify-content-between align-items-center"},gs={key:0,class:"text-muted small truncateme"},vs={class:"mt-3 d-flex justify-content-between"},ys={key:1},Is={class:"d-flex mt-4"},bs={key:1},ks={key:2},ws={class:"mt-2 card"},Cs={class:"d-flex justify-content-between mt-2"},$s={class:"container-fluid pb-5 px-0 my-0"},Ts={class:"mb-1"},As={key:0,class:"container container-holder"},Rs={class:"container-main"},Ms={class:"row"},Us={class:"col-md"},Ps={class:"ms-auto d-flex align-items-center justify-content-end"},Ls={class:"row"},Ss={class:"col-md mt-4"},Es={class:"d-flex align-items-center mb-2"},Vs={class:"d-flex flex-gap-sm flex-wrap"},Fs={class:"miniItemImageContainer"},Ds={class:"mt-1 truncateme"},Ns={class:"col-md mt-4"},zs={class:"d-flex align-items-center mb-2"},js={key:0,class:"d-flex flex-wrap justify-content-left flex-gap-1"},Bs={key:0,class:"mt-4 col-md"},qs={key:0,class:"container-main"},Os={class:"row"},Ks={class:"col"},Ws={key:1,class:"container container-holder"},Gs={key:0,class:"alert alert-danger my-2"};function _s(e,t,r,h,y,w){const g=u("ShareItem"),v=u("b-modal"),N=u("ItemEdit"),C=u("UploadItemImage"),U=u("CreateOrEditNote"),V=u("b-form-select"),B=u("b-form-group"),O=u("b-form-textarea"),b=u("b-icon"),k=u("b-button"),P=u("b-spinner"),L=u("ItemAttachments"),q=u("ItemPermissions"),j=u("ItemImage"),I=u("PopCollectionSelector"),S=u("PublicProfileEdit"),z=u("router-link"),W=u("ItemInfo"),$=u("b-dropdown-item"),Q=u("b-dropdown"),G=u("ProfileImage"),Y=u("ViewComments"),E=le("b-modal");return o(),l("div",null,[s(v,{lazy:"true",id:"share-item-modal",title:"Share Item","hide-footer":""},{default:n(()=>[s(g,{itemId:e.itemId,onClose:t[0]||(t[0]=d=>e.closeModal("share-item-modal"))},null,8,["itemId"])]),_:1}),s(v,{lazy:"true",id:"edit-item-modal",title:"Edit item","hide-footer":"",fullscreen:"","hide-header-close":"","hide-header":"","no-close-on-esc":""},{default:n(()=>[s(N,{itemId:e.itemId,onClose:t[1]||(t[1]=d=>{e.closeModal("edit-item-modal"),e.loadItemInfo()})},null,8,["itemId"])]),_:1}),s(v,{lazy:"true",id:"item-image-modal",title:"Item Image",size:"lg","hide-footer":""},{default:n(()=>[s(C,{itemId:e.itemId,onClose:t[2]||(t[2]=d=>{e.loadItemInfo(),e.closeModal("item-image-modal")})},null,8,["itemId"])]),_:1}),s(v,{lazy:"true",id:"edit-note-modal",title:"Edit Note","hide-footer":"",size:"lg",fullscreen:""},{default:n(()=>[i("div",Oi,[s(U,{itemId:e.itemId,onClose:t[3]||(t[3]=d=>{e.loadItemInfo(),e.closeModal("edit-note-modal")})},null,8,["itemId"])])]),_:1}),s(v,{id:"ai-suggestions-for-item-modal",title:"AI Suggestions",size:"lg","hide-footer":""},{default:n(()=>[i("div",Ki,[i("div",Wi,[s(B,{label:"Select an action",class:"mb-4"},{default:n(()=>[s(V,{modelValue:e.aiSuggestActionId,"onUpdate:modelValue":t[4]||(t[4]=d=>e.aiSuggestActionId=d),options:e.aiSuggestActions},null,8,["modelValue","options"])]),_:1})]),i("div",Gi,[s(B,{label:"",class:"mb-4",description:"optional"},{default:n(()=>[s(O,{modelValue:e.aiSuggestInstructions,"onUpdate:modelValue":t[5]||(t[5]=d=>e.aiSuggestInstructions=d),placeholder:"Enter additional instructions for AI to suggest item details"},null,8,["modelValue"])]),_:1}),i("div",_i,[s(k,{variant:"secondary",disabled:e.loadingAISuggestions,onClick:t[6]||(t[6]=d=>e.loadAISuggestion())},{default:n(()=>[s(b,{icon:"magic"}),t[27]||(t[27]=i("span",{class:"ms-1"},"Get Suggestions ",-1))]),_:1},8,["disabled"])])]),i("div",Hi,[e.loadingAISuggestions?(o(),p(P,{key:0})):a("",!0)]),e.aiSuggestionData?(o(),l("div",Qi,[i("div",Yi,[t[30]||(t[30]=i("hr",{class:"my-2"},null,-1)),(o(!0),l(R,null,M(Object.entries(e.aiSuggestionData),(d,T)=>(o(),l("div",Ji,[i("div",Xi,[i("div",Zi,c(e.getKeyName(d[0])),1)]),i("div",xi,[t[28]||(t[28]=i("div",{class:"text-muted small"},"Original",-1)),i("div",null,c(e.getItemDataByKey(e.item,d[0])),1)]),i("div",es,[t[29]||(t[29]=i("div",{class:"text-muted small"},"Suggested",-1)),i("div",null,c(e.getSuggestedDataByKey(e.aiSuggestionData,d[0])),1)])]))),256))]),i("div",ts,[t[32]||(t[32]=i("div",null,null,-1)),s(k,{variant:"primary",class:"mt-2",onClick:t[7]||(t[7]=d=>e.applyAISuggestions())},{default:n(()=>t[31]||(t[31]=[f(" Apply Changes")])),_:1})])])):a("",!0)])]),_:1}),e.item?(o(),p(v,{key:0,lazy:"true",id:"attachments-modal",title:"Attachments","hide-footer":"",size:"lg"},{default:n(()=>[(o(),p(L,{key:e.refreshKey,item:e.item,onUpdate:t[8]||(t[8]=d=>e.loadItemInfo())},null,8,["item"]))]),_:1})):a("",!0),s(v,{lazy:"true",id:"edit-item-permissions",title:"Edit Permissions","hide-footer":"",size:"lg"},{default:n(()=>[s(q,{itemId:e.itemId,onUpdate:e.loadPermissionsAndFeedback},null,8,["itemId","onUpdate"])]),_:1}),s(v,{lazy:"true",id:"edit-collections",title:"Edit Collection List","hide-footer":""},{default:n(()=>[(o(!0),l(R,null,M(e.collections,(d,T)=>(o(),l("div",{key:T,class:"d-flex justify-content-between align-items-center mb-1 p-1 hoverrow rounded"},[i("div",is,[i("div",ss,[s(j,{item:d,class:"me-1 miniItemImage"},null,8,["item"])]),i("div",os,c(d.name),1)]),i("div",ns,[s(k,{variant:"link",onClick:m=>e.removeItemFromCollection(d._id)},{default:n(()=>[s(b,{icon:"x-lg"})]),_:2},1032,["onClick"])])]))),128)),e.collections.length==0?(o(),l("div",ls,"Not in any collections")):a("",!0),t[34]||(t[34]=i("hr",null,null,-1)),i("div",as,[A((o(),p(k,{variant:"primary",class:"my-2"},{default:n(()=>[s(b,{icon:"plus"}),t[33]||(t[33]=f(" Add Collection "))]),_:1})),[[E,void 0,void 0,{"select-collection-modal":!0}]])])]),_:1}),s(v,{lazy:"true",id:"select-collection-modal",size:"lg","hide-footer":""},{default:n(()=>[i("div",null,[s(I,{onClose:e.addCollection,suggestionQuery:`${e.item.url} ${e.item.name} ${e.item.description}`},null,8,["onClose","suggestionQuery"])])]),_:1}),s(v,{lazy:"true",id:"raw-info-modal",title:"Item Info Raw","hide-footer":"",size:"lg"},{default:n(()=>[i("pre",null,c(e.itemInfo),1)]),_:1}),s(v,{lazy:"true",id:"public-profile-modal",title:"Public Profile Settings","hide-footer":""},{default:n(()=>[t[35]||(t[35]=i("div",{class:"alert alert-info mb-4"}," Public profile is required to submit a review ",-1)),s(S,{onClose:t[9]||(t[9]=d=>{e.closeModal("public-profile-modal"),e.openReview()})})]),_:1}),e.item?(o(),p(v,{key:1,lazy:"true",id:"confirm-review-modal",title:"Start Review","hide-footer":"",size:"lg"},{default:n(()=>[e.reviewPage=="main"?(o(),l("div",rs,[i("div",ds,[i("div",ms,[i("b",null,c(e.item.name),1)]),e.item.url?(o(),l("div",us,c(e.textTruncate(e.item.url,50)),1)):a("",!0)]),e.item.publishId?(o(),l("div",ys,[i("div",Is,[s(k,{class:"",onClick:t[12]||(t[12]=d=>e.closeModal("confirm-review-modal")),variant:"outline-secondary"},{default:n(()=>t[42]||(t[42]=[f(" Cancel ")])),_:1}),s(k,{class:"ms-auto",onClick:t[13]||(t[13]=d=>e.publishAndReview()),variant:"outline-primary"},{default:n(()=>t[43]||(t[43]=[f(" Continue with Review ")])),_:1})])])):(o(),l("div",hs,[t[41]||(t[41]=i("p",{class:"my-2"}," This item isn't associated with any items in our public library. ",-1)),e.matches&&e.matches.length>0?(o(),l("div",fs,[e.matches.length>0?(o(),l("p",ps," We found a few close matching items. Please select one of the items below or choose new item to continue. ")):a("",!0),t[38]||(t[38]=i("hr",null,null,-1)),(o(!0),l(R,null,M(e.matches,(d,T)=>(o(),l("div",{key:T},[i("div",cs,[i("div",null,[i("div",null,[s(z,{class:"mr1-1",to:`/v/${d._id}`},{default:n(()=>[f(c(d.name),1)]),_:2},1032,["to"])]),d.data&&d.data.url?(o(),l("div",gs,c(e.textTruncate(d.data.url,50)),1)):a("",!0)]),i("div",null,[s(k,{size:"sm",variant:"outline-primary",onClick:m=>e.selectMatch(d._id),target:"_blank"},{default:n(()=>t[36]||(t[36]=[f("Select")])),_:2},1032,["onClick"])])]),t[37]||(t[37]=i("hr",null,null,-1))]))),128))])):a("",!0),i("div",vs,[s(k,{variant:"outline-secondary",onClick:t[10]||(t[10]=d=>e.closeModal("confirm-review-modal"))},{default:n(()=>t[39]||(t[39]=[f("Cancel")])),_:1}),s(k,{variant:"primary",onClick:t[11]||(t[11]=d=>e.reviewPage="new"),target:"_blank"},{default:n(()=>t[40]||(t[40]=[f("New")])),_:1})])]))])):a("",!0),e.reviewPage=="new"?(o(),l("div",bs,[t[44]||(t[44]=i("div",{class:"my-2"},[i("div",{class:"alert alert-info text-center"},[i("b",null," Please confirm item details below and push save button")])],-1)),s(N,{itemId:e.itemId,onClose:t[14]||(t[14]=d=>{e.publishAndReview(),e.reviewPage="confirm"}),saveButtonName:"Save Changes and Review",cancelButtonName:"Back"},null,8,["itemId"])])):a("",!0),e.reviewPage=="confirm"?(o(),l("div",ks,[i("div",ws,[(o(),p(W,{key:e.updateKey,item:e.item,numRatings:e.publishedItem.numRatings,overallRating:e.publishedItem.overallRating,inLibrary:e.inLibrary,onEditNote:t[15]||(t[15]=d=>e.showModal("edit-note-modal"))},null,8,["item","numRatings","overallRating","inLibrary"]))]),i("div",Cs,[s(k,{class:"",onClick:t[16]||(t[16]=d=>e.reviewPage="new"),variant:"outline-secondary"},{default:n(()=>t[45]||(t[45]=[f(" Back ")])),_:1}),s(k,{class:"",onClick:t[17]||(t[17]=d=>e.reviewPage="main"),variant:"primary"},{default:n(()=>t[46]||(t[46]=[f(" Start Review ")])),_:1})])])):a("",!0)]),_:1})):a("",!0),i("div",$s,[i("div",Ts,[i("button",{class:"btn btn-link",onClick:t[18]||(t[18]=d=>e.$router.go(-1))},[s(b,{icon:"chevron-left"})])]),e.item?(o(),l("div",As,[i("div",Rs,[i("div",Ms,[i("div",Us,[(o(),p(W,{key:e.updateKey,item:e.item,numRatings:e.publishedItem.numRatings,onSelect:e.clickInfo,overallRating:e.publishedItem.overallRating,onViewAttachments:e.viewAttachments},{default:n(()=>[i("div",Ps,[e.aiChatEnabled?(o(),p(k,{key:0,title:"AI",variant:"link",class:"p-0 m-0",onClick:t[19]||(t[19]=d=>e.aiDiscuss())},{default:n(()=>[s(b,{icon:"robot"})]),_:1})):a("",!0),s(Q,{"no-caret":"",variant:"link",right:""},{"button-content":n(()=>[s(b,{icon:"three-dots-vertical"})]),default:n(()=>[s($,{to:`/post/create?itemIds=${e.itemId}`},{default:n(()=>[s(b,{icon:"share"}),t[47]||(t[47]=f(" Share in post "))]),_:1},8,["to"]),e.isAdminUser?A((o(),p($,{key:0},{default:n(()=>[s(b,{icon:"key"}),t[48]||(t[48]=f(" Permissions "))]),_:1})),[[E,void 0,void 0,{"edit-item-permissions":!0}]]):a("",!0),e.editPermission?A((o(),p($,{key:1},{default:n(()=>[s(b,{icon:"pencil"}),t[49]||(t[49]=f(" Edit "))]),_:1})),[[E,void 0,void 0,{"edit-item-modal":!0}]]):a("",!0),e.editPermission?A((o(),p($,{key:2},{default:n(()=>[s(b,{icon:"pencil"}),t[50]||(t[50]=f(" Edit Note Text "))]),_:1})),[[E,void 0,void 0,{"edit-note-modal":!0}]]):a("",!0),e.editPermission?A((o(),p($,{key:3},{default:n(()=>[s(b,{icon:"image"}),t[51]||(t[51]=f(" Banner Image "))]),_:1})),[[E,void 0,void 0,{"item-image-modal":!0}]]):a("",!0),e.editPermission?(o(),p($,{key:4,onClick:e.viewAttachments},{default:n(()=>[s(b,{icon:"paperclip"}),t[52]||(t[52]=f(" Attachments "))]),_:1},8,["onClick"])):a("",!0),e.aiFeaturesEnabled?A((o(),p($,{key:5,title:"AI"},{default:n(()=>[s(b,{icon:"magic"}),t[53]||(t[53]=f(" AI Suggest "))]),_:1})),[[E,void 0,void 0,{"ai-suggestions-for-item-modal":!0}]]):a("",!0),e.editPermission&&!e.isEncrypted?(o(),p($,{key:6,onClick:t[20]||(t[20]=d=>e.encryptItem())},{default:n(()=>[s(b,{icon:"lock"}),t[54]||(t[54]=f(" Encrypt "))]),_:1})):a("",!0),e.editPermission&&e.isEncrypted?(o(),p($,{key:7,onClick:t[21]||(t[21]=d=>e.decryptItem())},{default:n(()=>[s(b,{icon:"unlock"}),t[55]||(t[55]=f(" Decrypt "))]),_:1})):a("",!0),s($,{onClick:t[22]||(t[22]=d=>e.toggleArchive())},{default:n(()=>[s(b,{icon:"archive"}),f(" "+c(e.isArchived?"Unarchive":"Archive"),1)]),_:1}),e.isAdminUser||e.isOwner?(o(),p($,{key:8,onClick:t[23]||(t[23]=d=>e.deleteItem())},{default:n(()=>[s(b,{icon:"trash"}),t[56]||(t[56]=f(" Delete"))]),_:1})):a("",!0),e.isAdminUser&&e.item.type=="link"?(o(),p($,{key:9,onClick:t[24]||(t[24]=d=>e.openReview())},{default:n(()=>[s(b,{icon:"star"}),t[57]||(t[57]=f(" Review "))]),_:1})):a("",!0),e.item.publishId?(o(),p($,{key:10,target:"_blank",title:"View Public Version",to:`/v/${e.item.publishId}`},{default:n(()=>[s(b,{icon:"arrow-up-right"}),t[58]||(t[58]=f(" View Published Version "))]),_:1},8,["to"])):a("",!0),e.item.url!=null?(o(),p($,{key:11,title:"Refresh Meta data",onClick:t[25]||(t[25]=d=>e.refreshMeta())},{default:n(()=>[s(b,{icon:"arrow-counterclockwise"}),t[59]||(t[59]=f(" Refresh Meta "))]),_:1})):a("",!0),e.developerMode?A((o(),p($,{key:12,title:""},{default:n(()=>[s(b,{icon:"code"}),t[60]||(t[60]=f(" Raw Data (Developer Option) "))]),_:1})),[[E,void 0,void 0,{"raw-info-modal":!0}]]):a("",!0),e.developerMode?(o(),p($,{key:13,onClick:t[26]||(t[26]=d=>e.openPopout()),title:""},{default:n(()=>t[61]||(t[61]=[f(" Open Popout (Developer Option) ")])),_:1})):a("",!0)]),_:1})])]),_:1},8,["item","numRatings","onSelect","overallRating","onViewAttachments"]))])]),i("div",Ls,[t[65]||(t[65]=i("div",{class:"mt-4 border-top"},null,-1)),i("div",Ss,[i("div",Es,[t[62]||(t[62]=i("div",{class:"text-muted mb-0 me-1"},"Collections",-1)),A((o(),p(k,{size:"sm",variant:"link",small:"",title:"edit collections"},{default:n(()=>[s(b,{icon:"pencil"})]),_:1})),[[E,void 0,void 0,{"edit-collections":!0}]])]),i("div",Vs,[(o(!0),l(R,null,M(e.collections,(d,T)=>(o(),p(z,{key:T,to:`/collection/${d._id}`,class:"px-2 limitWidth200 d-flex flex-gap-sm fillrow rounded bw-color text-center notextdecoration small py-2"},{default:n(()=>[i("div",Fs,[s(j,{item:d,class:"miniItemImage"},null,8,["item"])]),i("div",Ds,c(e.textTruncate(d.name,70)),1)]),_:2},1032,["to"]))),128))])]),i("div",Ns,[i("div",zs,[t[63]||(t[63]=i("div",{class:"text-muted mb-0 me-1"},"Libraries",-1)),e.isAdminUser?A((o(),p(k,{key:0,size:"sm",variant:"link",small:"",title:"Edit Permissions",class:""},{default:n(()=>[s(b,{icon:"pencil"})]),_:1})),[[E,void 0,void 0,{"edit-item-permissions":!0}]]):a("",!0)]),e.itemPermissions&&e.itemPermissions.length>0?(o(),l("div",js,[(o(!0),l(R,null,M(e.itemPermissions,(d,T)=>(o(),l("div",{key:T},[s(z,{to:`/user/profile/${d.userId}`,title:d.permission,class:"d-flex flex-gap-sm align-items-center px-2 fillrow rounded text-muted notextdecoration small py-1"},{default:n(()=>[s(G,{profileImage:d.user.profileImage,width:20},null,8,["profileImage"]),i("div",null,c(e.textTruncate(d.user.displayedName||d.user.username,12)),1)]),_:2},1032,["to","title"])]))),128))])):a("",!0)]),e.allMatches.length>0||e.suggestions.length>0?(o(),l("div",Bs,[t[64]||(t[64]=i("div",{class:"text-muted mb-2"},"Related",-1)),(o(!0),l(R,null,M(e.allMatches,(d,T)=>(o(),l("div",{key:T,class:"small my-1"},[s(z,{to:`/item/${d._id}`,class:"px-1 limitWidth200 nowrap d-flex flex-gap-sm rounded bw-color text-center notextdecoration hoverrow py-1"},{default:n(()=>[d.type=="link"?(o(),p(b,{key:0,icon:"link"})):a("",!0),f(" "+c(e.textTruncate(d.name,55)),1)]),_:2},1032,["to"])]))),128)),(o(!0),l(R,null,M(e.suggestions,(d,T)=>(o(),l("div",{key:T,class:"small my-1"},[s(z,{class:"px-1 limitWidth200 nowrap d-flex flex-gap-sm rounded bw-color text-center notextdecoration hoverrow py-1",to:`/collection/${d._id}`},{default:n(()=>[s(b,{icon:"collection"}),f(" "+c(e.textTruncate(d.name,55)),1)]),_:2},1032,["to"])]))),128))])):a("",!0)])]),e.item?(o(),l("div",qs,[i("div",Os,[i("div",Ks,[t[66]||(t[66]=i("div",{class:"text-muted mb-2 mt-4"},"Comments",-1)),s(Y,{refId:e.itemId,refType:"item",refEncInfo:e.item.encInfo,isFocused:e.commentFocus},null,8,["refId","refEncInfo","isFocused"])])])])):a("",!0)])):a("",!0),e.loading?a("",!0):(o(),l("div",Ws,[e.errorMessage?(o(),l("div",Gs,c(e.errorMessage),1)):a("",!0)]))])])}const Lo=H(qi,[["render",_s]]);export{Lo as default};

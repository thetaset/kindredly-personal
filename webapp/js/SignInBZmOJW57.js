import{j as B}from"./jwt-decodeVWaDGczM.js";import{a as R,d as p,w as A,_ as U}from"./components.globalSAVxUKYX.js";import{P as D}from"./ProviderSigninButtonQ-yv_h1x.js";import q from"./VersionInfojKKG_Pt1.js";import{d as H,j as n,K as t,z as l,k as i,p as v,m as c,s as d,L as y,M,F as j,Q as u,r,ac as z,i as o,R as N,N as F,X as x}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";const G=H({name:"Signin",mixins:[R],components:{ProviderSigninButton:D,VersionInfo:q},data(){return{username:null,password:null,errorMessage:null,loading:!1,loginType:"internal",loginPayload:null,renderedButton:!1,usingExternalLogin:!1,versionInfoLoaded:!1}},mounted(){this.isBrowserMode&&!this.isCustomServer&&!this.isNativeClient&&(this.$loadScript("https://accounts.google.com/gsi/client").then(()=>{p("Script load successful (Google ID)"),this.setupClientGoogle()}).catch(e=>{console.error("Script load error",e)}),this.$loadScript("https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js").then(()=>{p("Script load successful (Apple ID)"),this.setupClientApple()}).catch(e=>{console.error("Script load error",e)}))},computed:{},methods:{setupClientGoogle(){google.accounts.id.initialize({client_id:this.config.googleClientId,callback:e=>{p("Google ID initialized",e);const s=B(e.credential);p("User info from google:",s),this.loginType="google",this.loginPayload=e,this.submitSignIn()}}),google.accounts.id.renderButton(document.getElementById("google-signin-button"),{theme:"outline",size:"large"}),google.accounts.id.prompt()},setupClientApple(){AppleID.auth.init({clientId:this.config.appleClientId,scope:this.config.appleSigninScope,redirectURI:this.config.appleSigninRedirectURI,state:"authType=sign-in",usePopup:!1})},async submitSignIn(){var s;if(!this.loginType||this.loginType=="internal"){if(this.username==null||this.username.length<1){this.errorMessage="Invalid Username";return}else if(this.password==null||this.password.length<1){this.errorMessage="Invalid Password";return}}this.loading=!0;const e=await this.sendReq("/client/signin",{username:this.username,password:this.password,loginType:this.loginType||"internal",loginPayload:this.loginPayload});if(e.success){p("Login successful"),await this.Signin(!0),this.RefreshAll(!0,!1,!1,!0),this.$emit("updateData",null),p("Redirecting now");let g=((s=this.$route.query)==null?void 0:s.redirect)||"";g.length>5?(p("Redirecting to:",g),location.replace(this.appPrefix+"#"+g)):location.replace(this.appPrefix),this.errorMessage=null}else console.error("Error:",e),this.errorMessage=e.message,this.loading=!1},async loadPage(){if(A(!0),this.loginType=="apple"){const e=this.$route.query.access_token;this.loginPayload={accessToken:e},this.submitSignIn()}},async loadVersionInfo(){this.versionInfoLoaded=!1;try{await this.LoadVersionSummary(!0)}catch(e){console.error("Error:",e)}finally{this.versionInfoLoaded=!0}},async externalLoginFailed(e){this.usingExternalLogin=!1,this.errorMessage="Login failed: "+e,this.loading=!1,this.showToast(e,{title:"Error",variant:"danger",solid:!0})}},created(){if(this.loadVersionInfo(),this.$route.query.forceSignout){const e=this.$route.query.forceSignoutMessage||"";this.showToast("You have been signed out. "+e,{title:"Session Expired",variant:"danger",solid:!0})}this.errorMessage=this.$route.query.errorMessage||null,this.loginType=this.$route.query.loginType||"internal",this.loadPage()}}),K={style:{"min-height":"600px"},class:"p-2 d-flex justify-content-center align-items-center"},O={class:""},Y={key:0,href:"/"},Q=["href"],W={class:"container-box-sm"},X={key:0,class:"my-4 text-center"},J={key:1,class:"larger"},Z={class:""},ee={key:0,class:"mt-3"},se={key:1,class:"mt-5"},ie={key:1,class:"text-center"},oe={class:"d-flex justify-content-between mt-4"},te={class:"py-2"},ne={class:"my-4"},re={key:2,class:"text-center my-4"},le=["innerHTML"],ae={key:0},de={class:"mt-5 text-center"},ue={class:"my-3"},pe={class:"my-3"},ge={class:"my-3 small"},me=["href"],ce={key:1,class:"text-center"},fe=["href"],he={key:2,class:"mx-1 text-center small"},ve={key:0},ye={key:0,class:"my-4 py-2 px-3 divfit rounded fillrow border"},be=["href"],Se={key:1,class:"my-4 py-2 px-3 divfit rounded fillrow border"},we=["href"];function ke(e,s,g,_e,Ce,Ie){var C,I,L,$;const P=r("b-modal"),b=r("AppLogo"),m=r("b-icon"),f=r("router-link"),S=r("ProviderSigninButton"),w=r("b-form-input"),k=r("b-form-group"),_=r("b-button"),h=r("b-spinner"),T=r("b-alert"),E=r("b-link"),V=z("b-modal");return o(),n("div",K,[t(P,{id:"external-login-modal",title:"External Login","hide-footer":""},{default:l(()=>s[8]||(s[8]=[i("div",{class:"container-sm"}," A browser window should have opened for you to sign-in ",-1)])),_:1}),i("div",O,[i("div",{class:v(["text-center mb-4",e.isMobile?"mt-3":"mt-5"])},[e.isBrowserMode?(o(),n("a",Y,[t(b)])):(o(),n("a",{key:1,href:e.appPrefix},[t(b)],8,Q))],2),i("div",W,[e.isCustomServer?(o(),n("div",X,[e.isExtension?(o(),c(f,{key:0,to:"/settings/server"},{default:l(()=>[t(m,{icon:"database-fill-gear"}),u(" Using custom server : "+N(e.serverAPIURL),1)]),_:1})):(o(),n("div",J," Personal Edition "))])):d("",!0),y(i("div",Z,[e.isCustomServer?d("",!0):(o(),n(j,{key:0},[e.isBrowserMode&&!e.isNativeClient&&!e.isCustomServer?(o(),n("div",ee,s[9]||(s[9]=[i("div",{class:"gbuttonwrapper"},[i("div",{class:"g-signin2",id:"google-signin-button"})],-1),i("div",{class:"appleid-signin-container mt-3"},[i("div",{id:"appleid-signin","data-color":"white","data-border":"true","data-type":"sign in","data-border-radius":"10","data-width":"180","data-height":"40"})],-1)]))):(o(),n("div",se,[t(S,{onClick:s[0]||(s[0]=a=>e.usingExternalLogin=!0),onHadError:e.externalLoginFailed,loginType:"google"},null,8,["onHadError"]),s[10]||(s[10]=i("div",{class:"mt-3"},null,-1)),t(S,{onClick:s[1]||(s[1]=a=>e.usingExternalLogin=!0),onHadError:e.externalLoginFailed,loginType:"apple"},null,8,["onHadError"])])),s[11]||(s[11]=i("div",null,[i("div",{class:"text-center py-4"},[i("div",{class:"separator text-muted"},"or")])],-1))],64)),t(k,{class:"form-group"},{default:l(()=>[t(w,{onClick:s[2]||(s[2]=a=>e.errorMessage=null),id:"username",autofocus:"",autocorrect:"off",autocapitalize:"off",modelValue:e.username,"onUpdate:modelValue":s[3]||(s[3]=a=>e.username=a),placeholder:"Username/Email",required:""},null,8,["modelValue"])]),_:1}),t(k,{class:"form-gr oup"},{default:l(()=>[t(w,{onSubmit:F(e.submitSignIn,["prevent"]),onKeyup:s[4]||(s[4]=x(a=>e.submitSignIn(),["enter"])),onClick:s[5]||(s[5]=a=>e.errorMessage=null),id:"password",modelValue:e.password,"onUpdate:modelValue":s[6]||(s[6]=a=>e.password=a),type:"password",placeholder:"Password",required:""},null,8,["onSubmit","modelValue"])]),_:1}),e.loading?(o(),n("div",re,[t(h,{class:"spinnerxl",label:"Loading..."})])):(o(),n("div",ie,[i("div",oe,[i("div",te,[t(f,{class:"text-muted",to:"/forgotPassword"},{default:l(()=>s[12]||(s[12]=[u("Forgot password?")])),_:1})]),t(_,{variant:"primary",size:"lg",onClick:s[7]||(s[7]=a=>e.submitSignIn()),id:"signin_btn"},{default:l(()=>s[13]||(s[13]=[u("Sign-In")])),_:1})]),i("hr",{class:v(e.isMobile?"mt-3":"mt-5")},null,2),i("div",ne,[t(_,{id:"register_btn",variant:"outline-primary",size:"lg",to:"/register"},{default:l(()=>s[14]||(s[14]=[u("Register")])),_:1})])])),e.errorMessage?(o(),c(T,{key:3,class:"m-4 text-center",variant:"danger","model-value":!0},{default:l(()=>[i("p",{innerHTML:e.errorMessage},null,8,le),e.isOnline?d("",!0):(o(),n("p",ae," You don't seem to be online. Please check your internet connection "))]),_:1})):d("",!0)],512),[[M,!e.usingExternalLogin&&!e.loading]]),y(i("div",de,[i("div",null,[i("div",ue,[i("div",null,[s[16]||(s[16]=u(" Resume sign-in using other window")),y((o(),c(E,null,{default:l(()=>s[15]||(s[15]=[u("?")])),_:1})),[[V,void 0,void 0,{"external-login-modal":!0}]])]),i("div",pe,[t(h,{class:"spinnerxl",label:"Loading..."})])]),i("div",ge,[i("a",{href:e.homeURL},"cancel",8,me)]),s[17]||(s[17]=i("div",{class:"my-3"},null,-1))])],512),[[M,e.usingExternalLogin]]),e.loading?(o(),n("div",ce,[t(h,{class:"spinnerxl",label:"Loading..."})])):d("",!0),i("div",{class:v(["mx-1 text-center small",e.isMobile?"pt-2":"py-2 "])},[!e.isWebOnly||!e.isCustomServer?(o(),n("a",{key:0,href:`${e.config.serverHostname}`,target:"_blank"},"kindredly.ai",8,fe)):d("",!0)],2),(o(),n("div",he,[e.versionInfoLoaded?(o(),n("div",ve,[(C=e.versionSummary)!=null&&C.success&&!((I=e.versionSummary)!=null&&I.clientSupportedByServer)?(o(),n("div",ye,[t(m,{icon:"exclamation-triangle-fill",class:"text-warning me-2"}),s[18]||(s[18]=u(" Your client is needs to be updated. ")),s[19]||(s[19]=i("br",null,null,-1)),i("a",{target:"_blank",href:`${e.config.serverHostname}/helpdocs/updateClient?appType=${e.appType}`},"Please update your client.",8,be)])):(L=e.versionSummary)!=null&&L.success&&(($=e.versionSummary)!=null&&$.newerClientVersionAvailable)?(o(),n("div",Se,[t(m,{icon:"exclamation-triangle-fill",class:"text-warning me-2"}),i("a",{target:"_blank",href:`${e.config.serverHostname}/helpdocs/updateClient?appType=${e.appType}`},"An update is available.",8,we)])):d("",!0)])):d("",!0),e.isExtension?(o(),c(f,{key:1,to:"/settings/server"},{default:l(()=>[t(m,{icon:"database-fill-gear"}),s[20]||(s[20]=u(" Custom Server Settings "))]),_:1})):d("",!0)]))])])])}const Re=U(G,[["render",ke]]);export{Re as default};

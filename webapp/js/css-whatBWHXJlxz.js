var f;(function(t){t.Attribute="attribute",t.Pseudo="pseudo",t.PseudoElement="pseudo-element",t.Tag="tag",t.Universal="universal",t.Adjacent="adjacent",t.Child="child",t.Descendant="descendant",t.Parent="parent",t.Sibling="sibling",t.ColumnCombinator="column-combinator"})(f||(f={}));var m;(function(t){t.Any="any",t.Element="element",t.End="end",t.Equals="equals",t.Exists="exists",t.Hyphen="hyphen",t.Not="not",t.Start="start"})(m||(m={}));const N=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,M=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,Q=new Map([[126,m.Element],[94,m.Start],[36,m.End],[42,m.Any],[33,m.Not],[124,m.Hyphen]]),z=new Set(["has","not","matches","is","where","host","host-context"]);function O(t){switch(t.type){case f.Adjacent:case f.Child:case f.Descendant:case f.Parent:case f.Sibling:case f.ColumnCombinator:return!0;default:return!1}}const V=new Set(["contains","icontains"]);function _(t,n,a){const i=parseInt(n,16)-65536;return i!==i||a?n:i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,i&1023|56320)}function q(t){return t.replace(M,_)}function l(t){return t===39||t===34}function W(t){return t===32||t===9||t===10||t===12||t===13}function Y(t){const n=[],a=H(n,`${t}`,0);if(a<t.length)throw new Error(`Unmatched selector: ${t.slice(a)}`);return n}function H(t,n,a){let i=[];function p(s){const h=n.slice(a+s).match(N);if(!h)throw new Error(`Expected name, found ${n.slice(a)}`);const[u]=h;return a+=s+u.length,q(u)}function r(s){for(a+=s;a<n.length&&W(n.charCodeAt(a));)a++}function c(){a+=1;const s=a;let h=1;for(;h>0&&a<n.length;a++)n.charCodeAt(a)===40&&!d(a)?h++:n.charCodeAt(a)===41&&!d(a)&&h--;if(h)throw new Error("Parenthesis not matched");return q(n.slice(s,a-1))}function d(s){let h=0;for(;n.charCodeAt(--s)===92;)h++;return(h&1)===1}function k(){if(i.length>0&&O(i[i.length-1]))throw new Error("Did not expect successive traversals.")}function w(s){if(i.length>0&&i[i.length-1].type===f.Descendant){i[i.length-1].type=s;return}k(),i.push({type:s})}function v(s,h){i.push({type:f.Attribute,name:s,action:h,value:p(1),namespace:null,ignoreCase:"quirks"})}function $(){if(i.length&&i[i.length-1].type===f.Descendant&&i.pop(),i.length===0)throw new Error("Empty sub-selector");t.push(i)}if(r(0),n.length===a)return a;a:for(;a<n.length;){const s=n.charCodeAt(a);switch(s){case 32:case 9:case 10:case 12:case 13:{(i.length===0||i[0].type!==f.Descendant)&&(k(),i.push({type:f.Descendant})),r(1);break}case 62:{w(f.Child),r(1);break}case 60:{w(f.Parent),r(1);break}case 126:{w(f.Sibling),r(1);break}case 43:{w(f.Adjacent),r(1);break}case 46:{v("class",m.Element);break}case 35:{v("id",m.Equals);break}case 91:{r(1);let h,u=null;n.charCodeAt(a)===124?h=p(1):n.startsWith("*|",a)?(u="*",h=p(2)):(h=p(0),n.charCodeAt(a)===124&&n.charCodeAt(a+1)!==61&&(u=h,h=p(1))),r(0);let e=m.Exists;const P=Q.get(n.charCodeAt(a));if(P){if(e=P,n.charCodeAt(a+1)!==61)throw new Error("Expected `=`");r(2)}else n.charCodeAt(a)===61&&(e=m.Equals,r(1));let b="",E=null;if(e!=="exists"){if(l(n.charCodeAt(a))){const A=n.charCodeAt(a);let o=a+1;for(;o<n.length&&(n.charCodeAt(o)!==A||d(o));)o+=1;if(n.charCodeAt(o)!==A)throw new Error("Attribute value didn't end");b=q(n.slice(a+1,o)),a=o+1}else{const A=a;for(;a<n.length&&(!W(n.charCodeAt(a))&&n.charCodeAt(a)!==93||d(a));)a+=1;b=q(n.slice(A,a))}r(0);const y=n.charCodeAt(a)|32;y===115?(E=!1,r(1)):y===105&&(E=!0,r(1))}if(n.charCodeAt(a)!==93)throw new Error("Attribute selector didn't terminate");a+=1;const D={type:f.Attribute,name:h,action:e,value:b,namespace:u,ignoreCase:E};i.push(D);break}case 58:{if(n.charCodeAt(a+1)===58){i.push({type:f.PseudoElement,name:p(2).toLowerCase(),data:n.charCodeAt(a)===40?c():null});continue}const h=p(1).toLowerCase();let u=null;if(n.charCodeAt(a)===40)if(z.has(h)){if(l(n.charCodeAt(a+1)))throw new Error(`Pseudo-selector ${h} cannot be quoted`);if(u=[],a=H(u,n,a+1),n.charCodeAt(a)!==41)throw new Error(`Missing closing parenthesis in :${h} (${n})`);a+=1}else{if(u=c(),V.has(h)){const e=u.charCodeAt(0);e===u.charCodeAt(u.length-1)&&l(e)&&(u=u.slice(1,-1))}u=q(u)}i.push({type:f.Pseudo,name:h,data:u});break}case 44:{$(),i=[],r(1);break}default:{if(n.startsWith("/*",a)){const e=n.indexOf("*/",a+2);if(e<0)throw new Error("Comment was not terminated");a=e+2,i.length===0&&r(0);break}let h=null,u;if(s===42)a+=1,u="*";else if(s===124){if(u="",n.charCodeAt(a+1)===124){w(f.ColumnCombinator),r(2);break}}else if(N.test(n.slice(a)))u=p(0);else break a;n.charCodeAt(a)===124&&n.charCodeAt(a+1)!==124&&(h=u,n.charCodeAt(a+1)===42?(u="*",a+=2):u=p(1)),i.push(u==="*"?{type:f.Universal,namespace:h}:{type:f.Tag,name:u,namespace:h})}}}return $(),a}var C;(function(t){t.Attribute="attribute",t.Pseudo="pseudo",t.PseudoElement="pseudo-element",t.Tag="tag",t.Universal="universal",t.Adjacent="adjacent",t.Child="child",t.Descendant="descendant",t.Parent="parent",t.Sibling="sibling",t.ColumnCombinator="column-combinator"})(C||(C={}));var g;(function(t){t.Any="any",t.Element="element",t.End="end",t.Equals="equals",t.Exists="exists",t.Hyphen="hyphen",t.Not="not",t.Start="start"})(g||(g={}));const j=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,B=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,G=new Map([[126,g.Element],[94,g.Start],[36,g.End],[42,g.Any],[33,g.Not],[124,g.Hyphen]]),J=new Set(["has","not","matches","is","where","host","host-context"]);function K(t){switch(t.type){case C.Adjacent:case C.Child:case C.Descendant:case C.Parent:case C.Sibling:case C.ColumnCombinator:return!0;default:return!1}}const R=new Set(["contains","icontains"]);function X(t,n,a){const i=parseInt(n,16)-65536;return i!==i||a?n:i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,i&1023|56320)}function S(t){return t.replace(B,X)}function F(t){return t===39||t===34}function U(t){return t===32||t===9||t===10||t===12||t===13}function Z(t){const n=[],a=L(n,`${t}`,0);if(a<t.length)throw new Error(`Unmatched selector: ${t.slice(a)}`);return n}function L(t,n,a){let i=[];function p(s){const h=n.slice(a+s).match(j);if(!h)throw new Error(`Expected name, found ${n.slice(a)}`);const[u]=h;return a+=s+u.length,S(u)}function r(s){for(a+=s;a<n.length&&U(n.charCodeAt(a));)a++}function c(){a+=1;const s=a;let h=1;for(;h>0&&a<n.length;a++)n.charCodeAt(a)===40&&!d(a)?h++:n.charCodeAt(a)===41&&!d(a)&&h--;if(h)throw new Error("Parenthesis not matched");return S(n.slice(s,a-1))}function d(s){let h=0;for(;n.charCodeAt(--s)===92;)h++;return(h&1)===1}function k(){if(i.length>0&&K(i[i.length-1]))throw new Error("Did not expect successive traversals.")}function w(s){if(i.length>0&&i[i.length-1].type===C.Descendant){i[i.length-1].type=s;return}k(),i.push({type:s})}function v(s,h){i.push({type:C.Attribute,name:s,action:h,value:p(1),namespace:null,ignoreCase:"quirks"})}function $(){if(i.length&&i[i.length-1].type===C.Descendant&&i.pop(),i.length===0)throw new Error("Empty sub-selector");t.push(i)}if(r(0),n.length===a)return a;a:for(;a<n.length;){const s=n.charCodeAt(a);switch(s){case 32:case 9:case 10:case 12:case 13:{(i.length===0||i[0].type!==C.Descendant)&&(k(),i.push({type:C.Descendant})),r(1);break}case 62:{w(C.Child),r(1);break}case 60:{w(C.Parent),r(1);break}case 126:{w(C.Sibling),r(1);break}case 43:{w(C.Adjacent),r(1);break}case 46:{v("class",g.Element);break}case 35:{v("id",g.Equals);break}case 91:{r(1);let h,u=null;n.charCodeAt(a)===124?h=p(1):n.startsWith("*|",a)?(u="*",h=p(2)):(h=p(0),n.charCodeAt(a)===124&&n.charCodeAt(a+1)!==61&&(u=h,h=p(1))),r(0);let e=g.Exists;const P=G.get(n.charCodeAt(a));if(P){if(e=P,n.charCodeAt(a+1)!==61)throw new Error("Expected `=`");r(2)}else n.charCodeAt(a)===61&&(e=g.Equals,r(1));let b="",E=null;if(e!=="exists"){if(F(n.charCodeAt(a))){const A=n.charCodeAt(a);let o=a+1;for(;o<n.length&&(n.charCodeAt(o)!==A||d(o));)o+=1;if(n.charCodeAt(o)!==A)throw new Error("Attribute value didn't end");b=S(n.slice(a+1,o)),a=o+1}else{const A=a;for(;a<n.length&&(!U(n.charCodeAt(a))&&n.charCodeAt(a)!==93||d(a));)a+=1;b=S(n.slice(A,a))}r(0);const y=n.charCodeAt(a)|32;y===115?(E=!1,r(1)):y===105&&(E=!0,r(1))}if(n.charCodeAt(a)!==93)throw new Error("Attribute selector didn't terminate");a+=1;const D={type:C.Attribute,name:h,action:e,value:b,namespace:u,ignoreCase:E};i.push(D);break}case 58:{if(n.charCodeAt(a+1)===58){i.push({type:C.PseudoElement,name:p(2).toLowerCase(),data:n.charCodeAt(a)===40?c():null});continue}const h=p(1).toLowerCase();let u=null;if(n.charCodeAt(a)===40)if(J.has(h)){if(F(n.charCodeAt(a+1)))throw new Error(`Pseudo-selector ${h} cannot be quoted`);if(u=[],a=L(u,n,a+1),n.charCodeAt(a)!==41)throw new Error(`Missing closing parenthesis in :${h} (${n})`);a+=1}else{if(u=c(),R.has(h)){const e=u.charCodeAt(0);e===u.charCodeAt(u.length-1)&&F(e)&&(u=u.slice(1,-1))}u=S(u)}i.push({type:C.Pseudo,name:h,data:u});break}case 44:{$(),i=[],r(1);break}default:{if(n.startsWith("/*",a)){const e=n.indexOf("*/",a+2);if(e<0)throw new Error("Comment was not terminated");a=e+2,i.length===0&&r(0);break}let h=null,u;if(s===42)a+=1,u="*";else if(s===124){if(u="",n.charCodeAt(a+1)===124){w(C.ColumnCombinator),r(2);break}}else if(j.test(n.slice(a)))u=p(0);else break a;n.charCodeAt(a)===124&&n.charCodeAt(a+1)!==124&&(h=u,n.charCodeAt(a+1)===42?(u="*",a+=2):u=p(1)),i.push(u==="*"?{type:C.Universal,namespace:h}:{type:C.Tag,name:u,namespace:h})}}}return $(),a}export{m as A,f as S,C as a,Z as b,K as c,g as d,O as i,Y as p};

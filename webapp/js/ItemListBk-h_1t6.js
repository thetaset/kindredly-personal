import{a as q,T as H,E,ax as Q,p as U,t as R,_ as A,aj as X,d as B}from"./components.globalBic2x0kT.js";import{o as S}from"./browserTabsB3WsZHRs.js";import{T as j,P as W}from"./TIIconDefaultCMdnLD-P.js";import{T as Y}from"./TIFeedbackInfoC6PM9-5H.js";import{I as N}from"./ItemImagelPteIRA_.js";import{d as L,j as s,k as n,N as V,K as o,Q as p,R as a,m as f,z as d,A as Z,s as l,F as _,P as D,l as M,r as u,i,L as K,ac as G,p as F}from"./@vueC3Nhqlrl.js";import{T as x}from"../kindredapp.js";import ee from"./PopCollectionSelectorCwff-9C9.js";import{P as te}from"./PlaceholderListDgoFc2vF.js";const ie=L({name:"ItemRow",mixins:[q],components:{TIcon:H,TIIconDefault:j,TIFeedbackInfo:Y,ProfileImage:W,ItemImage:N},props:{item:{type:Object,required:!0},context:{type:Object,required:!1},hideFeedback:{type:Boolean,default:!1},itemViewOptions:{type:Object,required:!1,default(){return{hideCollectionBadge:!1,hideFeedOptions:!1}}}},data(){return{forceDetailedView:!1,loading:!0,errorMessage:null}},mounted(){},computed:{myPermission(){var e;return(e=this.item)!=null&&e.permission&&this.item.permission.length>0?this.item.permission:""}},methods:{dateToMDYFormat:E,prettyDate:Q,prettyTimePast:U,textTruncate:R,openTab:S,showPermission(e){return e&&e.length>0?e[0].toUpperCase()+e.slice(1):""},emitClick(e=null){this.item.type=="tab"?(S(this.item.index,this.item.windowId),this.$emit("close",null)):this.item.type=="col"?this.$router.push(`/collection/${this.item._id}`):this.item.type=="note"?this.$router.push(`/item/${this.item._id}`):e=="img"?this.$router.push(`/item/${this.item._id}`):this.visit(this.item,this.context)}},created(){}}),se={key:0,class:"d-flex hoverrow rounded"},oe={class:"w-100 toverflow"},ne={key:0,class:"py-1 ms-1 d-flex align-items-center flex-gap-sm"},le=["href"],re={class:"tNameColSm"},ae={class:"itemTitle link me-2"},de={class:"tInfoColSm"},me={class:"tNameColSm"},ue=["title"],ce={class:"tInfoColSm px-1"},he={key:0,class:"xsmall border rounded divfit white-color blue-bg py-0 px-1"},pe={class:"hide-label-md ms-1"},fe={key:1,class:"primarycolor urlText small px-1"},ve={class:"hide-label-md ms-1"},ye={key:2,class:"text-muted urlText small px-1"},ge={class:"hide-label-md"},ke=["title"],be=["title"],Ie={key:1},we={class:"reItemContainer"},$e={class:"reImageCol"},Ce=["title"],_e=["href"],Te={class:"px-1 d-flex justify-content-center flex-gap-1"},Me={class:"reInfoCol w-100"},Oe={key:0},Ve=["title"],De={class:"me-2"},Ae={key:0,class:"text-muted urlText small"},Pe={title:"Parent Collections"},Se=["to"],qe={class:"text-muted"},Le={key:0,class:"mx-1"},Fe={class:"text-muted"},Ue={key:1,class:"d-flex xsmall flex-gap-sm"},Re={class:"border rounded divfit white-color blue-bg py-0 px-1"},je={key:1},Ne={class:"d-flex flex-no-wrap"},ze={class:"itemTitle link linkcolor",role:"button"},Be={class:"urlText"},He={class:"me-2 link small",role:"button",title:"open tab"},Ee={key:2},Qe=["title"],We={key:0,class:"xsmall d-flex align-items-center text-muted"},Ye=["title","href"],Ke={key:1,class:"xsmall d-flex align-items-center text-muted"},Ge={key:2,class:"xsmall text-muted"},Je=["title"],Xe={key:1,class:"xsmall my-1 d-flex align-items-center flex-gap-sm flex-wrap"},Ze={class:"text-muted"},xe={key:0,class:"me-2 px-1 fillrow rounded small",title:"Your permission to this item"},et={key:1,class:"me-2 d-flex align-items-center flex-wrap small",title:"Users with permission to this item"},tt=["title"],it={key:0,class:"mx-1"},st={key:5,class:"me-2 small"},ot={key:6,class:"me-2 small"},nt={key:2},lt={class:"divfit py-1 px-2 my-2 rounded border small"},rt={class:"small"},at={key:0,class:"d-flex justify-content-end align-items-center small ps-1"},dt=["title"],mt={key:1},ut={class:"d-flex justify-content-end"},ct=["title"];function ht(e,t,b,w,$,O){var T;const y=u("ItemImage"),h=u("b-icon"),C=u("TruncateExpand"),c=u("TIFeedbackInfo"),I=u("b-badge"),v=u("b-link");return e.item?(i(),s("div",se,[n("div",oe,[e.getViewType()=="row_c"&&!e.forceDetailedView?(i(),s("div",ne,[n("div",null,[e.item.type=="link"?(i(),s("a",{key:0,class:"miniImageContainer d-flex justify-content-center align-items-center",href:e.item.url,onClick:t[0]||(t[0]=V(m=>e.emitClick("img"),["prevent"])),role:"button"},[o(y,{class:"miniImage rounded fade-in-fast",item:e.item,alt:""},null,8,["item"])],8,le)):(i(),s("div",{key:1,class:"miniImageContainer d-flex justify-content-center align-items-center",onClick:t[1]||(t[1]=m=>e.emitClick("img")),role:"button"},[o(y,{class:"miniImage rounded fade-in-fast",item:e.item,alt:""},null,8,["item"])]))]),e.item.type=="tab"?(i(),s("div",{key:0,class:"d-flex",onClick:t[3]||(t[3]=m=>e.emitClick()),role:"button"},[n("div",re,[n("div",ae,[o(h,{icon:"window"}),p(" "+a(e.item.name),1)])]),n("div",de,[n("div",{class:"text-muted urlText small",title:"Open Tab",onClick:t[2]||(t[2]=m=>e.emitClick()),role:"button"},a(e.item.url),1)])])):(i(),f(Z(e.item.type=="link"?"a":"div"),{key:1,href:e.item.url,class:"d-flex",onClick:t[4]||(t[4]=V(m=>e.emitClick(),["prevent"])),role:"button"},{default:d(()=>[n("div",me,[n("div",{class:"itemTitle me-2",title:e.item.name},a(e.item.name),9,ue)]),n("div",ce,[e.item.type=="col"?(i(),s("div",he,[o(h,{icon:"collection-fill",class:""}),n("span",pe,a(e.item.typeName),1)])):e.item.type=="link"?(i(),s("div",fe,[o(h,{icon:"link"}),n("span",ve,a(e.item.url),1)])):(i(),s("div",ye,[o(h,{icon:e.item.typeIcon,class:"me-1"},null,8,["icon"]),n("span",ge,a(e.item.typeName),1)]))]),e.item.description&&!e.isMobile?(i(),s("div",{key:0,title:e.item.description,class:"tNameColFill small notlinktext truncatew"},[o(C,{content:e.item.description,class:"wwrap"},{default:d(()=>t[15]||(t[15]=[n("span",{class:"linklike ms-1",role:"button"},"more",-1)])),_:1},8,["content"])],8,ke)):e.item.description&&e.isMobile?(i(),s("div",{key:1,title:e.item.description,class:"tNameColFill small linklike-bw truncatew"},a(e.item.description),9,be)):l("",!0)]),_:1},8,["href"]))])):(i(),s("div",Ie,[n("div",we,[n("div",$e,[n("div",{class:"w-100 text-center",title:e.item.name},[e.item.type=="link"&&((T=e.item)!=null&&T.url)?(i(),s("a",{key:0,class:"reImageContainer",href:e.item.url,onClick:t[5]||(t[5]=V(m=>e.emitClick(),["prevent"]))},[o(y,{item:e.item,alt:"",class:"shadow-sm reImage mx-2 fade-in-fast rounded"},null,8,["item"])],8,_e)):(i(),s("div",{key:1,class:"reImageContainer",onClick:t[6]||(t[6]=m=>e.emitClick()),role:"button"},[o(y,{item:e.item,alt:"",class:"shadow-sm reImage mx-2 fade-in-fast rounded"},null,8,["item"])]))],8,Ce),n("div",Te,[!e.hideFeedback&&!["tab"].includes(e.item.type)?(i(),f(c,{key:0,value:e.item,"onUpdate:value":t[7]||(t[7]=m=>e.item=m)},null,8,["value"])):l("",!0),e.item.type=="tab"?(i(),s("div",{key:1,role:"button",class:"small border rounded text-muted px-1 btn-primary",onClick:t[8]||(t[8]=m=>e.emitClick())}," tab ")):l("",!0)])]),n("div",Me,[n("div",{onClick:t[11]||(t[11]=m=>e.emitClick()),role:"button"},[e.item.type=="col"?(i(),s("div",Oe,[n("div",{class:"itemTitle link me-2",title:`${e.item.name} (Collection)`},[n("div",De,a(e.textTruncate(e.item.name,e.isMobile?30:150)),1)],8,Ve),e.item.parents!=null?(i(),s("div",Ae,[n("span",Pe,[(i(!0),s(_,null,D(e.item.parents,(m,g)=>(i(),s("span",{key:g,onClick:V(P=>!0,["prevent"]),to:`/collection/${m._id}`},[t[16]||(t[16]=p(" / ")),n("span",qe,a(m.name),1),g<e.item.parents.length-1?(i(),s("span",Le," • ")):l("",!0)],8,Se))),128))]),t[17]||(t[17]=p(" / ")),n("span",Fe,a(e.item.name),1)])):(i(),s("div",Ue,[n("div",Re,[o(h,{icon:"collection-fill"}),t[18]||(t[18]=n("span",{class:"ms-1"},"Collection",-1))])]))])):e.item.type=="tab"?(i(),s("div",je,[n("div",Ne,[n("a",ze,[o(I,{variant:"primary"},{default:d(()=>[o(h,{icon:"window"})]),_:1}),p(" "+a(e.item.name),1)])]),n("div",Be,[t[19]||(t[19]=n("span",{class:"badge badge-info me-2"},"Tab",-1)),n("a",He,a(e.item.url),1)])])):(i(),s("div",Ee,[n("a",{class:"itemTitle me-2",title:e.item.name},a(e.textTruncate(e.item.name,e.isMobile?60:100)),9,Qe),e.item.type=="link"?(i(),s("div",We,[o(h,{icon:"link",class:"text-muted me-1"}),n("a",{class:"linkview text-muted urlText",title:e.item.url,href:e.item.url,onClick:t[9]||(t[9]=V(()=>{},["prevent"]))},a(e.textTruncate(e.item.url,e.isMobile?30:50)),9,Ye)])):e.item.type=="thing"?(i(),s("div",Ke,[o(h,{icon:e.item.typeIcon,class:"me-1"},null,8,["icon"]),p(" "+a(e.item.typeName),1)])):e.item.type=="note"?(i(),s("div",Ge,[o(h,{icon:e.item.typeIcon,class:"me-1"},null,8,["icon"]),t[20]||(t[20]=p(" Note "))])):l("",!0)])),n("div",null,[e.item.description&&!e.isMobile?(i(),s("div",{key:0,class:"small",title:e.item.description},[o(C,{content:e.item.description,class:"wwrap"},{default:d(()=>t[21]||(t[21]=[n("span",{class:"linklike ms-1",role:"button"},"more",-1)])),_:1},8,["content"])],8,Je)):l("",!0),e.item.parentList&&e.item.parentList.length>0?(i(),s("div",Xe,[(i(!0),s(_,null,D(e.item.parentList,(m,g)=>(i(),f(v,{key:g,class:"px-1 fillrow rounded text-muted",title:m.name,to:`/collection/${m._id}`,onClick:t[10]||(t[10]=V(()=>{},["stop"]))},{default:d(()=>[o(h,{icon:"diagram-2",class:"me-1"}),n("span",null,a(e.textTruncate(m.name,e.isMobile?12:20)),1)]),_:2},1032,["title","to"]))),128))])):l("",!0),n("div",Ze,[e.item.permissionUserId==e.currentUserId&&e.myPermission!="owner"?(i(),s("span",xe,a(e.myPermission),1)):l("",!0),e.item.permissionUserId!=e.currentUserId&&e.item.allPerms?(i(),s("div",et,[(i(!0),s(_,null,D(e.item.allPerms,(m,g)=>(i(),s("span",{key:g,class:"d-flex align-items-center flex-wrap px-1 fillrow rounded",title:m.permission},[n("span",null,a(m.username),1),g<e.item.allPerms.length-1?(i(),s("span",it," • ")):l("",!0)],8,tt))),128))])):l("",!0),e.item.publishedUpdatedAt?(i(),f(h,{key:2,class:"primary-color",icon:"cloud-check-fill",title:"Published as part of this collection"})):e.item.publishId&&!e.item.published?(i(),f(h,{key:3,icon:"cloud",class:"default-text-color",title:"imported collection"})):e.item.publishId&&e.item.published?(i(),f(h,{key:4,icon:"cloud-check",class:"default-text-color",title:"Published"})):l("",!0),e.item.sharedByUsername?(i(),s("div",st," Shared by "+a(e.item.sharedByUsername)+" "+a(e.prettyTimePast(e.item.sharedAt))+" ago ",1)):l("",!0),e.item.sharedWithUsername?(i(),s("div",ot," Shared with "+a(e.item.sharedWithUsername)+" "+a(e.prettyTimePast(e.item.sharedAt))+" ago ",1)):l("",!0)]),e.item.comment?(i(),s("div",nt,[n("div",lt,[o(h,{icon:"chat-right-text-fill",class:"me-1 remark-color"}),n("span",rt,a(e.item.comment),1)])])):l("",!0)])]),M(e.$slots,"main",{},void 0,!0)])])]))]),n("div",null,[e.getViewType()=="row_c"?(i(),s("div",at,[e.isMobile?l("",!0):(i(),s("div",{key:0,class:"p-1 nowwrap text-muted",title:e.item.createdAt},a(e.prettyDate(e.item.createdAt)),9,dt)),e.forceDetailedView?l("",!0):(i(),s("div",mt,[!e.hideFeedback&&!["tab"].includes(e.item.type)?(i(),f(c,{key:0,"shift-left":!0,value:e.item,"onUpdate:value":t[12]||(t[12]=m=>e.item=m)},null,8,["value"])):l("",!0)])),e.forceDetailedView?l("",!0):(i(),s("div",{key:2,role:"button",class:"btn btn-link",onClick:t[13]||(t[13]=m=>e.forceDetailedView=!0)},[o(h,{icon:"chevron-down",class:"iconNonLinkColorMuted"})])),e.forceDetailedView?(i(),s("div",{key:3,role:"button",class:"btn btn-link",onClick:t[14]||(t[14]=m=>e.forceDetailedView=!1)},[o(h,{icon:"chevron-up",class:"iconNonLinkColorMuted"})])):l("",!0)])):l("",!0),n("div",ut,[e.getViewType()=="row"&&!e.isMobile?(i(),s("div",{key:0,class:"nowwrap text-muted small",title:e.item.createdAt},a(e.prettyDate(e.item.createdAt)),9,ct)):l("",!0),e.getViewType()=="row"||e.forceDetailedView?M(e.$slots,"default",{key:1},void 0,!0):l("",!0)])])])):l("",!0)}const pt=A(ie,[["render",ht],["__scopeId","data-v-3f6ce989"]]),ft=L({name:"TISuggestions",mixins:[q],components:{},props:{text:{type:String,required:!0},excludeItemIds:{type:Array,default:()=>[]}},data(){return{items:[],errorMessage:"",loading:!1}},computed:{itemList(){return this.excludeItemIds?this.items.filter(e=>!this.excludeItemIds.includes(e._id)):this.items}},methods:{async load(){if(this.errorMessage="",this.loading=!0,!this.text||this.text.length==0){this.loading=!1;return}const e=this.text.trim().toLowerCase(),t=await this.apiReq("/client/suggestCollections",{searchQuery:e});t.success?this.items=t.result:(this.errorMessage=t.message,console.error(this.errorMessage)),this.loading=!1},select(e){this.$emit("select",e)}},created(){this.load()}}),vt={class:"d-flex flex-wrap justify-content-around border"},yt=["onClick"];function gt(e,t,b,w,$,O){return i(),s("div",null,[n("div",vt,[(i(!0),s(_,null,D(e.itemList,(y,h)=>(i(),s("div",{class:"btn btn-link",key:h,role:"button",onClick:C=>e.select(y)},a(y.name),9,yt))),128))])])}const kt=A(ft,[["render",gt]]),bt={name:"OrganizeItem",components:{PopCollectionSelector:ee,ItemImage:N,TISuggestions:kt},props:["userId","itemId","item"],data(){return{parents:[],selectedCollectionId:null,selectedCollection:null,loading:!1,errorMessage:null}},mounted(){},computed:{},methods:{searchText(){try{const e=new URL(this.item.url).hostname;return`${this.item.name} ${e}`}catch{return this.item.name}},async loadParents(){this.loading=!0;try{let e=await this.sendReq("/client/item/parents/bychildid",{itemId:this.itemId,includePath:!0});e.success?(e.result.sort(function(t,b){return X(t,b,"name")}),this.parents=e.result,this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)}catch(e){console.error(e)}this.loading=!1},createPathString(e){let t="/";return e&&e.length>0&&(t=t+[...e].reverse().join("/")+"/"),t},removeFromCollection(e){this.sendReq("/item/remove",{itemId:this.itemId,collectionId:e}).then(t=>{t.success?(this.loadParents(),this.errorMessage=null):(console.error("Error:",t.message),this.errorMessage=t.message)})},addCollection(e){if(!e){this.closeModal("select-col-modal");return}this.sendReq("/item/addToCollections",{itemId:this.itemId,collectionIds:[e]}).then(t=>{t.success?(this.loadParents(),this.closeModal("select-col-modal"),this.errorMessage=null):(console.error("Error:",t.message),this.errorMessage=t.message)})},closeMe(){this.$emit("close",!1)}},created(){this.loadParents()}},It={key:0,class:"d-flex justify-content-center flex-column"},wt={class:"mt-3"},$t={class:"miniItemImageContainer"},Ct={class:"d-flex justify-content-center"},_t={key:0,class:"ms-3"},Tt={class:"mt-5"},Mt={key:1,class:"text-center ani-fade-in-slow mt-3"};function Ot(e,t,b,w,$,O){const y=u("PopCollectionSelector"),h=u("b-modal"),C=u("ItemImage"),c=u("b-link"),I=u("b-icon"),v=u("b-button"),T=u("b-spinner"),m=G("b-modal");return i(),s("div",null,[o(h,{lazy:"true",id:"select-col-modal",title:"Select Collection",size:"lg","hide-footer":""},{default:d(()=>[o(y,{onClose:O.addCollection},null,8,["onClose"])]),_:1}),$.loading?l("",!0):(i(),s("div",It,[n("div",wt,[(i(!0),s(_,null,D($.parents,(g,P)=>(i(),s("div",{key:P,class:"d-flex justify-content-between align-items-center mb-1 p-1 hoverrow rounded"},[o(c,{to:`/collection/${g._id}`,class:"d-flex flex-gap-sm align-items-center"},{default:d(()=>[n("div",$t,[o(C,{item:g,class:"miniItemImage"},null,8,["item"])]),n("div",null,a(g.name),1)]),_:2},1032,["to"]),n("div",Ct,[o(v,{variant:"link",onClick:z=>O.removeFromCollection(g._id),title:"Remove from collection"},{default:d(()=>[o(I,{icon:"x-lg"})]),_:2},1032,["onClick"])])]))),128)),!$.parents||$.parents.length==0?(i(),s("div",_t," Not in any collections. ")):l("",!0),n("div",Tt,[K((i(),f(v,{class:"float-right",variant:"outline-primary"},{default:d(()=>t[0]||(t[0]=[p("Choose Collection")])),_:1})),[[m,void 0,void 0,{"select-col-modal":!0}]])])])])),$.loading?(i(),s("div",Mt,[o(T,{variant:"primary",label:"Loading..."})])):l("",!0)])}const Vt=A(bt,[["render",Ot]]),Dt=L({name:"ItemRow",mixins:[q],components:{TIcon:H,TIIconDefault:j,TIFeedbackInfo:Y,ProfileImage:W,ItemImage:N},props:{item:{type:Object,required:!0},context:{type:Object,required:!1},hideFeedback:{type:Boolean,required:!1,default:!1},itemViewOptions:{type:Object,required:!1,default(){return{hideCollectionBadge:!1,hideFeedOptions:!1}}}},data(){return{forceDetailedView:!1,loading:!0,errorMessage:null}},mounted(){},computed:{myPermission(){var e;return(e=this.item)!=null&&e.permission&&this.item.permission.length>0?this.item.permission:""}},methods:{dateToMDYFormat:E,prettyDate:Q,prettyTimePast:U,textTruncate:R,openTab:S,showPermission(e){return e&&e.length>0?e[0].toUpperCase()+e.slice(1):""},showComment(e){this.$bvModal.show("commentModal",e)},emitClick(e=null){this.item.type=="tab"?(S(this.item.index,this.item.windowId),this.$emit("close",null)):this.item.type=="col"?this.$router.push(`/collection/${this.item._id}`):this.item.type=="note"?this.$router.push(`/item/${this.item._id}`):e=="img"?this.$router.push(`/item/${this.item._id}`):this.visit(this.item,this.context)}},created(){}}),At={class:"itemTileHover hoverBrighten shadow-lg colItem2 rounded h-100"},Pt={key:0,class:""},St={class:"tileImageOverlay rounded-top"},qt={key:0,role:"button"},Lt={class:"divfit border p-1 m-1 rounded fillrow small bg-dark"},Ft={class:"small text-muted"},Ut={key:1,title:"Published"},Rt={key:3},jt=["title"],Nt={class:"truncateme"},zt=["title"],Bt={key:1,class:"text-muted"},Ht={class:"xsmall border rounded divfit white-color blue-bg py-0 px-1"},Et={key:2,class:"text-muted"};function Qt(e,t,b,w,$,O){const y=u("b-icon"),h=u("TIFeedbackInfo"),C=u("ItemImage"),c=G("b-popover");return i(),s("div",At,[e.item?(i(),s("div",Pt,[n("div",St,[e.item.comment?K((i(),s("div",qt,[n("div",Lt,[o(y,{icon:"chat-right-text-fill",class:"me-1 remark-color"}),n("span",Ft,a(e.textTruncate(e.item.comment,40)),1)])])),[[c,e.item.comment,void 0,{hover:!0,right:!0}]]):l("",!0),e.item.published?(i(),s("div",Ut,[o(y,{icon:"cloud"})])):l("",!0),!e.hideFeedback&&!["tab"].includes(e.item.type)?(i(),f(h,{key:2,"main-icon-class":"white-color",value:e.item,"onUpdate:value":t[0]||(t[0]=I=>e.item=I),shiftLeft:!0},null,8,["value"])):(i(),s("div",Rt)),M(e.$slots,"default",{},void 0,!0)]),n("div",{class:"card-image-container2 d-flex justify-content-center align-items-center",onClick:t[1]||(t[1]=I=>e.emitClick())},[o(C,{item:e.item,iconSize:2,class:"card-image-top rounded-top card-image-cls2 fade-in-fast"},null,8,["item"])]),n("div",{class:"p-1 small",onClick:t[2]||(t[2]=I=>e.emitClick())},[n("div",{class:"d-flex align-items-center flex-gap-xs",title:e.item.name,role:"button"},[o(y,{icon:e.item.typeIcon},null,8,["icon"]),n("div",Nt,a(e.textTruncate(e.item.name,42)),1)],8,jt),e.item.type=="link"?(i(),s("div",{key:0,class:"text-muted truncateme",title:e.item.url},a(e.textTruncate(e.item.url,42)),9,zt)):e.item.type=="col"?(i(),s("div",Bt,[n("span",Ht,[o(y,{icon:"collection-fill"}),t[3]||(t[3]=p()),t[4]||(t[4]=n("span",{class:""},"Collection",-1))])])):e.item.type=="tab"?(i(),s("div",Et,"Tab")):l("",!0)])])):l("",!0)])}const Wt=A(Dt,[["render",Qt],["__scopeId","data-v-c203eab3"]]),Yt=L({name:"ItemList",mixins:[q],components:{OrganizeItem:Vt,ItemRow:pt,ItemTile:Wt,TIListViewOptions:x,TIIconDefault:j,PlaceholderList:te},emits:["update","changeOrderNoSave","changeOrderAndSave"],props:{items:{type:Array,required:!0},loading:{type:Boolean,required:!0},showViewOptions:{type:Boolean,required:!1,default:!1},allowMoveInList:{type:Boolean,required:!1,default:!1},hideOptionsMenu:{type:Boolean,required:!1,default:!1},hideFeedback:{type:Boolean,required:!1,default:!1},loadAmount:{type:Number,required:!1,default:15},readonly:{type:Boolean,required:!1,default:!1},disableDrag:{type:Boolean,required:!1,default:!1},parentId:{type:String,required:!1,default:null},itemViewOptions:{type:Object,required:!1,default(){return{hideCollectionBadge:!1,hideFeedOptions:!1}}}},data(){return{selectedItemId:null,selectedItem:null,selectedItemName:null,errorMessage:null,sourceItem:null,targetItem:null,loadAmountCounter:0,observer:null,dragging:!1,excludedIdSet:new Set}},computed:{listContainerClasses(){return{tileViewContainer:this.getViewType()=="tile",centerTiles:this.getViewType()=="tile"&&this.itemList.length>5}},loadAmountActual(){const e=this.loadAmount;return this.getViewType()=="row_c"?e*2:this.getViewType()=="tile"?this.isMobile?e:e*4:e},itemList(){return this.filteredItems.slice(0,this.loadAmountCounter)},filteredItems(){return!this.items||this.items.length==0?[]:this.items.filter(e=>!this.excludedIdSet.has(e._id))}},mounted(){this.observer=new IntersectionObserver(this.handleIntersect,{root:null,rootMargin:"0px",threshold:.1});let e=this.$refs.loadMoreTrigger;this.observer.observe(e)},methods:{handleIntersect(e){if(this.loading||this.itemList.length>=this.filteredItems.length)return;e[0].isIntersecting&&!this.loading&&(B("updating load amount"),this.loadAmountCounter+=this.loadAmountActual)},getItemClasses(e){const t=[];return this.getViewType()=="tile"&&t.push("mb-2"),t.push("fade-out"),e.removing&&t.push("fade-out-leave-active"),t},prettyTimePast:U,async organizeItem(e){const t=e._id;this.selectedItemId=t,this.selectedItem=e,this.selectedItemName=e.name?": "+R(e.name,20):null,this.showModal("move-modal")},async checkItemPermissions(e){return(await this.sendReq("/item/permissions/list",{itemId:e})).result},async closeTab(e){chrome.tabs.remove(e,()=>{this.$emit("update",null)})},async updateParent(){this.$emit("update",null)},dragStart(e){this.disableDrag||this.readonly||(this.sourceItem=e)},dropItem(e){this.disableDrag||this.readonly||(e.type=="col"&&e._id!=this.sourceItem._id?(this.targetItem=e,this.attemptMove()):this.allowMoveInList&&this.dropItemOrder(e))},dropItemOrder(e){!this.sourceItem||!e||this.$emit("changeOrderAndSave",{sourceId:this.sourceItem._id,targetId:e._id})},trytochangeOrder(e){var t;e._id==((t=this.sourceItem)==null?void 0:t._id)||(e==null?void 0:e.type)=="col"||this.$emit("changeOrderNoSave",{sourceId:this.sourceItem._id,targetId:e._id})},async updateHidden(e,t){if(!await this.confirmModal(t?"Hide this item?  This item will no longer show up in search results.":"Unhide this item?  This item will show up in search results.",{title:"Confirm",okVariant:"primary",okTitle:t?"Hide":"Unhide",cancelTitle:"Cancel"}))return;e.feedback||(e.feedback={isHidden:!1}),e.feedback.isHidden=t;const w=await this.sendReq("/item/feedback/value/update",{itemId:e._id,attr:"isHidden",value:t});w.success?this.errorMessage=null:this.errorMessage=w.message},async deleteItem(e){await this.confirmModal(`Delete '${e.name}'? `,{title:"Confirm",okVariant:"danger ",okTitle:"Delete Permanently",cancelTitle:"Cancel",hideHeaderClose:!1})&&(await this.sendReq("/item/delete",{itemId:e._id}),this.excludedIdSet.add(e._id),this.RefreshIndexQuick())},isArchived(e){return(e==null?void 0:e.archived)||!1},isHidden(e){var t;return((t=e==null?void 0:e.feedback)==null?void 0:t.isHidden)||!1},async toggleArchive(e){let t=this.isArchived(e);if(t){if(!await this.confirmModal(`Unarchive item: '${e.name}'? `,{title:"Confirm",okVariant:"warning ",okTitle:"Unarchive",cancelTitle:"Cancel",hideHeaderClose:!1}))return}else if(!await this.confirmModal(`Archive item: '${e.name}'? `,{title:"Confirm",okVariant:"warning ",okTitle:"Archive",cancelTitle:"Cancel",hideHeaderClose:!1}))return;const b=await this.sendReq("/item/archiveUpdate",{itemId:e._id,value:!t});b.success?(this.RefreshIndexQuick().then(()=>{this.updateParent()}),this.errorMessage=null):this.errorMessage=b.message},async attemptMove(){B("Move : ",this.sourceItem.name," to ",this.targetItem.name),this.apiReq("/item/addToCollections",{itemId:this.sourceItem._id,collectionIds:[this.targetItem._id],removeCollectionIds:this.parentId?[this.parentId]:[]}).then(e=>{if(!e.success)throw new Error("Error adding item to collection");this.showToast("Item added to collection.",{variant:"success",title:"Success",solid:!0}),this.parentId&&(this.excludedIdSet.add(this.sourceItem._id),this.RefreshIndexQuick())}).catch(e=>{console.error("Error adding item to collection",e),this.showToast("Error adding item to collection.",{variant:"danger",title:"Error",solid:!0})})}},beforeDestroy(){this.observer&&this.observer.disconnect()},created(){this.loadAmountCounter=this.loadAmountActual}}),Kt={key:0,class:"d-flex justify-content-between"},Gt=["draggable","onDragstart","onDragover","onDrop"],Jt={key:1},Xt={key:0},Zt=["onClick"],xt={key:0,class:"ms-auto"},ei={key:0},ti=["onClick"],ii={key:1},si={key:2},oi={key:0},ni={key:2,class:"mt-4 tsFadeInAnimationMed"},li={key:3,class:"text-center mt-4 pb-4"},ri={ref:"loadMoreTrigger",class:"loading ms-4 my-3"},ai={key:0,class:"text-center"},di={key:4,class:"div-10"};function mi(e,t,b,w,$,O){const y=u("OrganizeItem"),h=u("b-modal"),C=u("TIListViewOptions"),c=u("b-icon"),I=u("router-link"),v=u("b-dropdown-item"),T=u("b-dropdown-divider"),m=u("b-dropdown"),g=u("ItemTile"),P=u("ItemRow"),z=u("PlaceholderList"),J=u("b-spinner");return i(),s("div",null,[o(h,{lazy:"true",id:"move-modal",size:"lg",title:`Move/Organize${e.selectedItemName}`,"ok-only":"","ok-title":"Done",onOk:t[1]||(t[1]=r=>e.updateParent())},{default:d(()=>[o(y,{onClose:t[0]||(t[0]=r=>e.closeModal("move-modal")),itemId:e.selectedItemId,item:e.selectedItem},null,8,["itemId","item"])]),_:1},8,["title"]),e.showViewOptions?(i(),s("div",Kt,[M(e.$slots,"title"),t[2]||(t[2]=n("div",null,null,-1)),o(C)])):l("",!0),e.loading?(i(),s("div",ni,[o(z,{"num-of-items":12})])):(i(),s("div",{key:1,class:F(e.listContainerClasses),ref:"listContainer"},[(i(!0),s(_,null,D(e.itemList,(r,ci)=>(i(),s("div",{key:r._id,draggable:e.disableDrag!=!0,class:F(e.getItemClasses(r)),onDragstart:k=>e.dragStart(r),onDragover:k=>e.trytochangeOrder(r),onDrop:k=>e.dropItem(r)},[e.getViewType()=="tile"?(i(),f(g,{key:0,item:r,itemViewOptions:e.itemViewOptions,hideFeedback:e.hideFeedback},{default:d(()=>[["tab","col"].includes(r.type)?l("",!0):(i(),f(I,{key:0,class:"p-0 white-color",to:`/item/${r._id}`,title:"View Details"},{default:d(()=>[o(c,{icon:"info-square-fill"})]),_:2},1032,["to"])),!e.hideOptionsMenu&&r.type!="tab"?(i(),s("div",Jt,[o(m,{variant:"link",dropstart:"","no-caret":"","toggle-class":"white-color p-0",lazy:!0},{"button-content":d(()=>[o(c,{icon:"three-dots-vertical"})]),default:d(()=>[o(v,{class:"",to:`/${r.type=="col"?"collection":"item"}/${r._id}`},{default:d(()=>[o(c,{class:"me-1",icon:"info-square"}),t[3]||(t[3]=p(" Details"))]),_:2},1032,["to"]),r.type=="link"?(i(),f(v,{key:0,class:"",title:"edit",href:e.toURL(r.url)},{default:d(()=>[o(c,{class:"me-1",icon:"box-arrow-in-right"}),t[4]||(t[4]=p(" Visit "))]),_:2},1032,["href"])):l("",!0),e.readonly?l("",!0):(i(),f(v,{key:1,class:"",onClick:k=>e.organizeItem(r)},{default:d(()=>[o(c,{class:"me-1",icon:"ui-radios-grid"}),t[5]||(t[5]=p(" Move/Organize"))]),_:2},1032,["onClick"])),e.readonly?l("",!0):(i(),f(v,{key:2,class:"",to:`/post/create?itemIds=${r._id}`},{default:d(()=>[o(c,{class:"me-1",icon:"share"}),t[6]||(t[6]=p(" Share"))]),_:2},1032,["to"])),e.readonly?l("",!0):(i(),s(_,{key:3},[o(T),o(v,{onClick:k=>e.toggleArchive(r)},{default:d(()=>[o(c,{icon:"archive"}),p(" "+a(e.isArchived(r)?"Unarchive":"Archive"),1)]),_:2},1032,["onClick"]),e.readonly?l("",!0):(i(),f(v,{key:0,class:"",role:"button",onClick:k=>e.deleteItem(r),style:{color:"red"},title:"Remove"},{default:d(()=>[o(c,{icon:"trash"}),t[7]||(t[7]=p(" Delete "))]),_:2},1032,["onClick"]))],64)),M(e.$slots,"menu",{item:r})]),_:2},1024),n("div",null,[r.type=="tab"&&e.getViewType()!="tile"?(i(),s("div",Xt,[n("button",{class:"btn btn-link",onClick:k=>e.closeTab(r.tabId),title:"View Details"},[o(c,{icon:"x"})],8,Zt)])):l("",!0)])])):l("",!0)]),_:2},1032,["item","itemViewOptions","hideFeedback"])):(i(),f(P,{key:r._id,item:r,itemViewOptions:e.itemViewOptions,hideFeedback:e.hideFeedback,class:F("py-1")},{main:d(()=>[M(e.$slots,"main",{item:r})]),default:d(()=>[e.hideOptionsMenu?l("",!0):(i(),s("div",xt,[o(m,{variant:"link",right:"","no-caret":"","toggle-class":"linklike-bw pt-0",lazy:!0},{"button-content":d(()=>[o(c,{icon:"three-dots-vertical"})]),default:d(()=>[o(v,{class:"",to:`/${r.type=="col"?"collection":"item"}/${r._id}`},{default:d(()=>[o(c,{class:"me-1",icon:"info-square"}),t[8]||(t[8]=p(" Details"))]),_:2},1032,["to"]),r.type=="link"?(i(),f(v,{key:0,class:"",title:"edit",href:e.toURL(r.url)},{default:d(()=>[o(c,{class:"me-1",icon:"box-arrow-in-right"}),t[9]||(t[9]=p(" Visit "))]),_:2},1032,["href"])):l("",!0),e.readonly?l("",!0):(i(),f(v,{key:1,class:"",onClick:k=>e.organizeItem(r)},{default:d(()=>[o(c,{class:"me-1",icon:"ui-radios-grid"}),t[10]||(t[10]=p(" Move/Organize"))]),_:2},1032,["onClick"])),e.readonly?l("",!0):(i(),f(v,{key:2,class:"",to:`/post/create?itemIds=${r._id}`},{default:d(()=>[o(c,{class:"me-1",icon:"share"}),t[11]||(t[11]=p(" Share"))]),_:2},1032,["to"])),e.readonly?l("",!0):(i(),s(_,{key:3},[o(T),o(v,{class:"",onClick:k=>e.updateHidden(r,!e.isHidden(r))},{default:d(()=>[o(c,{icon:"eye"}),p(" "+a(e.isHidden(r)?"Unhide":"Hide"),1)]),_:2},1032,["onClick"]),o(v,{onClick:k=>e.toggleArchive(r)},{default:d(()=>[o(c,{icon:"archive"}),p(" "+a(e.isArchived(r)?"Unarchive":"Archive"),1)]),_:2},1032,["onClick"]),!e.readonly&&e.isAdminUser?(i(),f(v,{key:0,class:"",role:"button",onClick:k=>e.deleteItem(r),style:{color:"red"},title:"Remove"},{default:d(()=>[o(c,{icon:"trash"}),t[12]||(t[12]=p(" Delete "))]),_:2},1032,["onClick"])):l("",!0)],64)),M(e.$slots,"menu",{item:r})]),_:2},1024),n("div",null,[r.type=="tab"?(i(),s("div",ei,[n("button",{class:"btn btn-link linklike-bw",onClick:k=>e.closeTab(r.id),title:"View Details"},[o(c,{icon:"x"})],8,ti)])):r.type!="col"?(i(),s("div",ii,[o(I,{class:"btn btn-link linklike-bw",to:`/${r.type=="col"?"collection":"item"}/${r._id}`,title:"View Details"},{default:d(()=>[o(c,{icon:"info-square"})]),_:2},1032,["to"])])):(i(),s("div",si))])]))]),_:2},1032,["item","itemViewOptions","hideFeedback"]))],42,Gt))),128)),e.filteredItems.length==0?(i(),s("div",oi,t[13]||(t[13]=[n("div",{class:"ms-3 my-3"},"No items found.",-1)]))):l("",!0)],2)),!e.loading&&e.itemList.length<e.filteredItems.length?(i(),s("div",li)):l("",!0),n("div",ri,[e.loading?(i(),s("div",ai,[o(J,{label:"Loading..."})])):l("",!0)],512),e.isMobile?(i(),s("div",di)):l("",!0)])}const ui=A(Yt,[["render",mi]]),wi=Object.freeze(Object.defineProperty({__proto__:null,default:ui},Symbol.toStringTag,{value:"Module"}));export{ui as I,Vt as O,pt as a,wi as b};

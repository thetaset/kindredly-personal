import{a as $,J as C,_ as V}from"./components.globalDizx_NTC.js";import{P as E}from"./PublicProfileEditBFuSujZu.js";import{d as M,r as s,ac as U,i as r,j as d,K as o,z as l,k as i,Q as n,m as u,R as m,L as T,s as f}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";const q=M({name:"ReviewItem",mixins:[$],components:{PublicProfileEdit:E},data(){return{itemInfo:null,item:null,overallRating:null,comment:null,review:null,itemId:null,loading:!1}},mounted(){},computed:{},methods:{loadPublished(){this.sendReq("/published/view",{itemId:this.itemId}).then(t=>{t.success&&t.result?(this.item=C(t.result.info),this.loading=!1):(console.error("Error:",t),this.loading=!1)})},loadCurrentReview(){this.sendReq("/review/getForUser",{publishId:this.itemId}).then(t=>{var e,v;t.success&&t.result?(this.review=t.result,this.comment=(e=this.review)==null?void 0:e.comment,this.overallRating=(v=this.review)==null?void 0:v.overallRating,this.loading=!1):(console.error("Error:",t),this.loading=!1)})},publishReview(){var t;if(!this.currentUser.publicId){this.errorMessage="error ";return}if(!this.overallRating){this.errorMessage="Rating required ";return}this.sendReq("/review/save",{publishId:this.itemId,data:{reviewId:(t=this.review)==null?void 0:t._id,overallRating:this.overallRating,comment:this.comment}}).then(e=>{e.success?(this.showModal("saved-modal"),this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)})}},created(){this.isAdminUser?(this.itemId=this.$route.params.itemId,this.loadPublished(),this.loadPublicProfile(),this.loadCurrentReview()):(this.showToast("You are not authorized to view this page.  Redirecting to home"),this.$router.push("/"))}}),z={class:"text-center"},B={class:"h4"},D=["href"],N={key:0,class:"d-flex align-items-center"},S={key:1,class:"mt-2"},Y={class:"linkcolor",role:"button"},j={class:"my-5"},A={class:"my-2"},F={class:"my-5"},J={class:"my-5 d-flex justify-content-between"},K={class:"my-5 d-flex justify-content-between"};function L(t,e,v,O,Q,G){const p=s("router-link"),h=s("b-modal"),g=s("PublicProfileEdit"),P=s("TruncateExpand"),b=s("b-col"),c=s("b-row"),_=s("b-icon"),R=s("b-rating"),y=s("b-form-textarea"),w=s("b-button"),k=s("b-container"),I=U("b-modal");return r(),d("div",null,[o(h,{lazy:"true",id:"saved-modal",title:"Review Published Successfully","hide-footer":"","hide-header":""},{default:l(()=>[i("div",z,[e[6]||(e[6]=i("div",{class:"my-4"},"You review submitted has been submitted. Thank you!",-1)),o(p,{class:"btn btn-primary",to:`/v/${t.itemId}`,onClick:e[0]||(e[0]=a=>t.closeModal("saved-modal"))},{default:l(()=>e[5]||(e[5]=[n(" Ok")])),_:1},8,["to"])])]),_:1}),o(h,{lazy:"true",id:"public-profile-modal",title:"Public Profile Settings","hide-footer":""},{default:l(()=>[o(g,{onClose:e[1]||(e[1]=a=>{t.closeModal("public-profile-modal"),t.loadPublicProfile()})})]),_:1}),i("div",null,[e[15]||(e[15]=i("div",{class:"text-center mb-4"},[i("h3",null,"Review Item")],-1)),t.item?(r(),u(k,{key:0},{default:l(()=>[o(c,{class:"row"},{default:l(()=>[o(b,{class:"col"},{default:l(()=>[i("div",B,[i("a",{target:"_blank",href:`/v/${t.itemId}`},m(t.item.name),9,D)]),i("div",null,[o(P,{content:t.item.description,class:"wwrap"},{default:l(()=>e[7]||(e[7]=[i("span",{class:"linklike ms-1",role:"button"},"more",-1)])),_:1},8,["content"])])]),_:1})]),_:1}),o(c,{class:"my-3"},{default:l(()=>[o(b,{class:"col"},{default:l(()=>[t.publicProfile&&t.publicProfile.username?(r(),d("div",N,[e[8]||(e[8]=i("div",{class:"me-2"},"Publish Publicly as:",-1)),o(p,{to:`/profile/${t.publicProfile._id}`},{default:l(()=>[n(m(t.publicProfile.username),1)]),_:1},8,["to"])])):(r(),d("div",S,[o(_,{icon:"exclamation-triangle-fill"}),e[10]||(e[10]=n(" You must create a ")),T((r(),d("span",Y,e[9]||(e[9]=[n("public profile")]))),[[I,void 0,void 0,{"public-profile-modal":!0}]]),e[11]||(e[11]=n(" to post a review."))]))]),_:1})]),_:1}),t.publicProfile&&t.publicProfile.username?(r(),u(c,{key:0},{default:l(()=>[o(b,{class:"col"},{default:l(()=>[e[14]||(e[14]=i("hr",null,null,-1)),i("div",j,[i("div",A,"Your Rating: "+m(t.overallRating),1),o(R,{modelValue:t.overallRating,"onUpdate:modelValue":e[2]||(e[2]=a=>t.overallRating=a)},null,8,["modelValue"])]),i("div",F,[e[12]||(e[12]=i("div",{class:"my-2"},"Comment:",-1)),o(y,{modelValue:t.comment,"onUpdate:modelValue":e[3]||(e[3]=a=>t.comment=a)},null,8,["modelValue"])]),i("div",J,[t.publicProfile?f("",!0):(r(),u(w,{key:0,class:"ms-auto",variant:"primary"},{default:l(()=>e[13]||(e[13]=[n("Submit")])),_:1}))]),i("div",K,[t.publicProfile?(r(),u(w,{key:0,class:"ms-auto",variant:"primary",onClick:e[4]||(e[4]=a=>t.publishReview())},{default:l(()=>[n(m(t.review?"Update Review":"Publish Review"),1)]),_:1})):f("",!0)])]),_:1})]),_:1})):f("",!0)]),_:1})):f("",!0)])])}const te=V(q,[["render",L]]);export{te as default};

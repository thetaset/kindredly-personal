import{a as _,_ as C}from"./components.globalDizx_NTC.js";import{P as L}from"./TIIconDefaultB4jiNlod.js";import{d as w,j as i,k as r,m as k,z as c,s as l,F as g,P as I,Q as a,K as d,R as m,r as u,i as n}from"./@vueC3Nhqlrl.js";const F=w({name:"CreatePost",mixins:[_],props:{userIds:{type:Array,default:()=>[]},nofriends:{type:Boolean,default:!1},includeSelf:{type:Boolean,default:!1}},components:{ProfileImage:L},data(){return{selectedUserIds:[],errorMessage:null,loading:!1,friends:[]}},mounted(){},computed:{selectedCount(){return this.selectedUserIds.filter(e=>this.includeSelf||e!=this.currentUserId).length},userList(){let e=[...this.users||[]];return e=e.map(s=>(s.selected=this.selectedUserIds.includes(s._id),s)),e=e.filter(s=>this.includeSelf||s._id!=this.currentUserId).sort((s,o)=>s.username<o.username?-1:s.username>o.username?1:0),e},friendList(){let e=[...this.friends||[]];return e=e.map(s=>(s.selected=this.selectedUserIds.includes(s._id),s)),e=e.sort((s,o)=>s.username<o.username?-1:s.username>o.username?1:0),e}},methods:{isSelected(e){return this.selectedUserIds.includes(e)},async toggleUser(e){this.selectedUserIds.includes(e)?await this.removeUser(e):await this.addUser(e)},async addFamily(){this.selectedUserIds=Array.from(new Set([...this.userList.map(e=>e._id),...this.selectedUserIds]))},async addFriends(){this.selectedUserIds=Array.from(new Set([...this.friendList.map(e=>e._id),...this.selectedUserIds]))},async addUser(e){this.selectedUserIds.push(e)},async removeUser(e){this.selectedUserIds=this.selectedUserIds.filter(s=>s!=e)},submit(){this.$emit("update",this.selectedUserIds)},async loadFriends(){if(this.isCustomServer)return;const e=await this.sendReq("/user/friend/list",{});e.success?(this.friends=e.result.friends,this.errorMessage=null):(console.error("Error:",e.message),this.errorMessage=e.message)},async loadData(){this.loading=!0,await this.loadFriends(),await this.RefreshUsers(),this.$nextTick(()=>{this.loading=!1})}},created(){this.selectedUserIds=Array.from(new Set([...this.userIds||[]])),this.loadData()}}),S={key:0,class:"scrollbox"},$={key:0,class:"mb-3"},N={key:0,class:"mb-3 d-flex align-items-center justify-content-between"},A={class:""},B=["onClick"],P={class:"ms-2"},q={key:0},M={key:1,class:"mb-3 d-flex align-items-center justify-content-between"},j=["onClick"],D={class:"ms-2"},V={key:2,class:"mb-3 text-muted"},R={key:1,class:"text-center mt-5"},E={class:"d-flex justify-content-between align-items-center my-2"};function T(e,s,o,z,K,O){const f=u("b-button"),p=u("b-icon"),y=u("ProfileImage"),U=u("b-link"),v=u("b-spinner");return n(),i("div",null,[e.loading?(n(),i("div",R,[d(v)])):(n(),i("div",S,[e.userList&&e.userList.length>0?(n(),i("div",$,[e.nofriends?l("",!0):(n(),i("div",N,[s[2]||(s[2]=r("div",{class:"text-muted"}," Family Members ",-1)),e.userList.length>0?(n(),k(f,{key:0,variant:"link",onClick:e.addFamily,class:"linklike"},{default:c(()=>s[1]||(s[1]=[a(" select all ")])),_:1},8,["onClick"])):l("",!0)])),r("div",A,[(n(!0),i(g,null,I(e.userList,(t,h)=>(n(),i("div",{key:h,class:"hoverrow rounded my-3 border p-3",onClick:b=>e.toggleUser(t._id),role:"button"},[d(p,{icon:t.selected?"check-square":"square"},null,8,["icon"]),d(y,{profileImage:t.profileImage,width:30,class:"ms-4"},null,8,["profileImage"]),r("span",P,m(t.displayedName||t.username)+" "+m(t.displayedName?` (${t.username})`:""),1),t._id==e.currentUserId?(n(),i("span",q,"(you)")):l("",!0)],8,B))),128))])])):l("",!0),!e.nofriends&&e.friendList&&e.friendList.length>0?(n(),i("div",M,[s[4]||(s[4]=r("div",{class:"text-muted"}," Friends ",-1)),e.friendList.length>0?(n(),k(f,{key:0,variant:"link",onClick:e.addFriends,class:"linklike"},{default:c(()=>s[3]||(s[3]=[a(" select all ")])),_:1},8,["onClick"])):l("",!0)])):l("",!0),r("div",null,[(n(!0),i(g,null,I(e.friendList,(t,h)=>(n(),i("div",{role:"button",key:h,class:"hoverrow rounded my-3 border p-3",onClick:b=>e.toggleUser(t._id)},[d(p,{icon:t.selected?"check-square":"square"},null,8,["icon"]),d(y,{profileImage:t.profileImage,width:30,class:"ms-4"},null,8,["profileImage"]),r("span",D,m(t.username),1)],8,j))),128))]),!(!e.nofriends&&e.friendList&&e.friendList.length>0)&&(!e.userList||e.userList.length==0)?(n(),i("div",V,[s[6]||(s[6]=a(" No other users found. ")),d(U,{to:"/people",onClick:s[0]||(s[0]=t=>e.closeAllModals())},{default:c(()=>s[5]||(s[5]=[a("Add Family or Friends")])),_:1})])):l("",!0)])),r("div",E,[r("div",null,[r("span",null,m(e.selectedCount)+" users selected",1)]),r("div",null,[d(f,{variant:"primary","data-test-id":"selectusers",onClick:e.submit},{default:c(()=>s[7]||(s[7]=[a("Ok")])),_:1},8,["onClick"])])])])}const J=C(F,[["render",T],["__scopeId","data-v-13bc762c"]]);export{J as S};

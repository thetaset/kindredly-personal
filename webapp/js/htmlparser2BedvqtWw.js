import{x as C,h as H,g as j,B as _,r as X,i as L,E as W,j as J,k as K,D as V,l as v}from"./entitiesL-JVAG0g.js";import{q as Y,r as tt}from"./domhandlerCjB8Dp5l.js";var h;(function(e){e[e.Tab=9]="Tab",e[e.NewLine=10]="NewLine",e[e.FormFeed=12]="FormFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.Number=35]="Number",e[e.Amp=38]="Amp",e[e.SingleQuote=39]="SingleQuote",e[e.DoubleQuote=34]="DoubleQuote",e[e.Dash=45]="Dash",e[e.Slash=47]="Slash",e[e.Zero=48]="Zero",e[e.Nine=57]="Nine",e[e.Semi=59]="Semi",e[e.Lt=60]="Lt",e[e.Eq=61]="Eq",e[e.Gt=62]="Gt",e[e.Questionmark=63]="Questionmark",e[e.UpperA=65]="UpperA",e[e.LowerA=97]="LowerA",e[e.UpperF=70]="UpperF",e[e.LowerF=102]="LowerF",e[e.UpperZ=90]="UpperZ",e[e.LowerZ=122]="LowerZ",e[e.LowerX=120]="LowerX",e[e.OpeningSquareBracket=91]="OpeningSquareBracket"})(h||(h={}));var n;(function(e){e[e.Text=1]="Text",e[e.BeforeTagName=2]="BeforeTagName",e[e.InTagName=3]="InTagName",e[e.InSelfClosingTag=4]="InSelfClosingTag",e[e.BeforeClosingTagName=5]="BeforeClosingTagName",e[e.InClosingTagName=6]="InClosingTagName",e[e.AfterClosingTagName=7]="AfterClosingTagName",e[e.BeforeAttributeName=8]="BeforeAttributeName",e[e.InAttributeName=9]="InAttributeName",e[e.AfterAttributeName=10]="AfterAttributeName",e[e.BeforeAttributeValue=11]="BeforeAttributeValue",e[e.InAttributeValueDq=12]="InAttributeValueDq",e[e.InAttributeValueSq=13]="InAttributeValueSq",e[e.InAttributeValueNq=14]="InAttributeValueNq",e[e.BeforeDeclaration=15]="BeforeDeclaration",e[e.InDeclaration=16]="InDeclaration",e[e.InProcessingInstruction=17]="InProcessingInstruction",e[e.BeforeComment=18]="BeforeComment",e[e.CDATASequence=19]="CDATASequence",e[e.InSpecialComment=20]="InSpecialComment",e[e.InCommentLike=21]="InCommentLike",e[e.BeforeSpecialS=22]="BeforeSpecialS",e[e.SpecialStartSequence=23]="SpecialStartSequence",e[e.InSpecialTag=24]="InSpecialTag",e[e.BeforeEntity=25]="BeforeEntity",e[e.BeforeNumericEntity=26]="BeforeNumericEntity",e[e.InNamedEntity=27]="InNamedEntity",e[e.InNumericEntity=28]="InNumericEntity",e[e.InHexEntity=29]="InHexEntity"})(n||(n={}));function w(e){return e===h.Space||e===h.NewLine||e===h.Tab||e===h.FormFeed||e===h.CarriageReturn}function B(e){return e===h.Slash||e===h.Gt||w(e)}function M(e){return e>=h.Zero&&e<=h.Nine}function et(e){return e>=h.LowerA&&e<=h.LowerZ||e>=h.UpperA&&e<=h.UpperZ}function it(e){return e>=h.UpperA&&e<=h.UpperF||e>=h.LowerA&&e<=h.LowerF}var T;(function(e){e[e.NoValue=0]="NoValue",e[e.Unquoted=1]="Unquoted",e[e.Single=2]="Single",e[e.Double=3]="Double"})(T||(T={}));const S={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])};let st=class{constructor({xmlMode:t=!1,decodeEntities:i=!0},s){this.cbs=s,this.state=n.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=n.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=t,this.decodeEntities=i,this.entityTrie=t?C:H}reset(){this.state=n.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=n.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(t){this.offset+=this.buffer.length,this.buffer=t,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}getIndex(){return this.index}getSectionStart(){return this.sectionStart}stateText(t){t===h.Lt||!this.decodeEntities&&this.fastForwardTo(h.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=n.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&t===h.Amp&&(this.state=n.BeforeEntity)}stateSpecialStartSequence(t){const i=this.sequenceIndex===this.currentSequence.length;if(!(i?B(t):(t|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!i){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=n.InTagName,this.stateInTagName(t)}stateInSpecialTag(t){if(this.sequenceIndex===this.currentSequence.length){if(t===h.Gt||w(t)){const i=this.index-this.currentSequence.length;if(this.sectionStart<i){const s=this.index;this.index=i,this.cbs.ontext(this.sectionStart,i),this.index=s}this.isSpecial=!1,this.sectionStart=i+2,this.stateInClosingTagName(t);return}this.sequenceIndex=0}(t|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===S.TitleEnd?this.decodeEntities&&t===h.Amp&&(this.state=n.BeforeEntity):this.fastForwardTo(h.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(t===h.Lt)}stateCDATASequence(t){t===S.Cdata[this.sequenceIndex]?++this.sequenceIndex===S.Cdata.length&&(this.state=n.InCommentLike,this.currentSequence=S.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=n.InDeclaration,this.stateInDeclaration(t))}fastForwardTo(t){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===t)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(t){t===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===S.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=n.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):t!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(t){return this.xmlMode?!B(t):et(t)}startSpecial(t,i){this.isSpecial=!0,this.currentSequence=t,this.sequenceIndex=i,this.state=n.SpecialStartSequence}stateBeforeTagName(t){if(t===h.ExclamationMark)this.state=n.BeforeDeclaration,this.sectionStart=this.index+1;else if(t===h.Questionmark)this.state=n.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(t)){const i=t|32;this.sectionStart=this.index,!this.xmlMode&&i===S.TitleEnd[2]?this.startSpecial(S.TitleEnd,3):this.state=!this.xmlMode&&i===S.ScriptEnd[2]?n.BeforeSpecialS:n.InTagName}else t===h.Slash?this.state=n.BeforeClosingTagName:(this.state=n.Text,this.stateText(t))}stateInTagName(t){B(t)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=n.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateBeforeClosingTagName(t){w(t)||(t===h.Gt?this.state=n.Text:(this.state=this.isTagStartChar(t)?n.InClosingTagName:n.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(t){(t===h.Gt||w(t))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=n.AfterClosingTagName,this.stateAfterClosingTagName(t))}stateAfterClosingTagName(t){(t===h.Gt||this.fastForwardTo(h.Gt))&&(this.state=n.Text,this.baseState=n.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(t){t===h.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=n.InSpecialTag,this.sequenceIndex=0):this.state=n.Text,this.baseState=this.state,this.sectionStart=this.index+1):t===h.Slash?this.state=n.InSelfClosingTag:w(t)||(this.state=n.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(t){t===h.Gt?(this.cbs.onselfclosingtag(this.index),this.state=n.Text,this.baseState=n.Text,this.sectionStart=this.index+1,this.isSpecial=!1):w(t)||(this.state=n.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateInAttributeName(t){(t===h.Eq||B(t))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=n.AfterAttributeName,this.stateAfterAttributeName(t))}stateAfterAttributeName(t){t===h.Eq?this.state=n.BeforeAttributeValue:t===h.Slash||t===h.Gt?(this.cbs.onattribend(T.NoValue,this.index),this.state=n.BeforeAttributeName,this.stateBeforeAttributeName(t)):w(t)||(this.cbs.onattribend(T.NoValue,this.index),this.state=n.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(t){t===h.DoubleQuote?(this.state=n.InAttributeValueDq,this.sectionStart=this.index+1):t===h.SingleQuote?(this.state=n.InAttributeValueSq,this.sectionStart=this.index+1):w(t)||(this.sectionStart=this.index,this.state=n.InAttributeValueNq,this.stateInAttributeValueNoQuotes(t))}handleInAttributeValue(t,i){t===i||!this.decodeEntities&&this.fastForwardTo(i)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(i===h.DoubleQuote?T.Double:T.Single,this.index),this.state=n.BeforeAttributeName):this.decodeEntities&&t===h.Amp&&(this.baseState=this.state,this.state=n.BeforeEntity)}stateInAttributeValueDoubleQuotes(t){this.handleInAttributeValue(t,h.DoubleQuote)}stateInAttributeValueSingleQuotes(t){this.handleInAttributeValue(t,h.SingleQuote)}stateInAttributeValueNoQuotes(t){w(t)||t===h.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(T.Unquoted,this.index),this.state=n.BeforeAttributeName,this.stateBeforeAttributeName(t)):this.decodeEntities&&t===h.Amp&&(this.baseState=this.state,this.state=n.BeforeEntity)}stateBeforeDeclaration(t){t===h.OpeningSquareBracket?(this.state=n.CDATASequence,this.sequenceIndex=0):this.state=t===h.Dash?n.BeforeComment:n.InDeclaration}stateInDeclaration(t){(t===h.Gt||this.fastForwardTo(h.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=n.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(t){(t===h.Gt||this.fastForwardTo(h.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=n.Text,this.sectionStart=this.index+1)}stateBeforeComment(t){t===h.Dash?(this.state=n.InCommentLike,this.currentSequence=S.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=n.InDeclaration}stateInSpecialComment(t){(t===h.Gt||this.fastForwardTo(h.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=n.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(t){const i=t|32;i===S.ScriptEnd[3]?this.startSpecial(S.ScriptEnd,4):i===S.StyleEnd[3]?this.startSpecial(S.StyleEnd,4):(this.state=n.InTagName,this.stateInTagName(t))}stateBeforeEntity(t){this.entityExcess=1,this.entityResult=0,t===h.Number?this.state=n.BeforeNumericEntity:t===h.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=n.InNamedEntity,this.stateInNamedEntity(t))}stateInNamedEntity(t){if(this.entityExcess+=1,this.trieIndex=j(this.entityTrie,this.trieCurrent,this.trieIndex+1,t),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];const i=this.trieCurrent&_.VALUE_LENGTH;if(i){const s=(i>>14)-1;if(!this.allowLegacyEntity()&&t!==h.Semi)this.trieIndex+=s;else{const r=this.index-this.entityExcess+1;r>this.sectionStart&&this.emitPartial(this.sectionStart,r),this.entityResult=this.trieIndex,this.trieIndex+=s,this.entityExcess=0,this.sectionStart=this.index+1,s===0&&this.emitNamedEntity()}}}emitNamedEntity(){if(this.state=this.baseState,this.entityResult===0)return;switch((this.entityTrie[this.entityResult]&_.VALUE_LENGTH)>>14){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~_.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}stateBeforeNumericEntity(t){(t|32)===h.LowerX?(this.entityExcess++,this.state=n.InHexEntity):(this.state=n.InNumericEntity,this.stateInNumericEntity(t))}emitNumericEntity(t){const i=this.index-this.entityExcess-1;i+2+ +(this.state===n.InHexEntity)!==this.index&&(i>this.sectionStart&&this.emitPartial(this.sectionStart,i),this.sectionStart=this.index+Number(t),this.emitCodePoint(X(this.entityResult))),this.state=this.baseState}stateInNumericEntity(t){t===h.Semi?this.emitNumericEntity(!0):M(t)?(this.entityResult=this.entityResult*10+(t-h.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}stateInHexEntity(t){t===h.Semi?this.emitNumericEntity(!0):M(t)?(this.entityResult=this.entityResult*16+(t-h.Zero),this.entityExcess++):it(t)?(this.entityResult=this.entityResult*16+((t|32)-h.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)}allowLegacyEntity(){return!this.xmlMode&&(this.baseState===n.Text||this.baseState===n.InSpecialTag)}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===n.Text||this.state===n.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===n.InAttributeValueDq||this.state===n.InAttributeValueSq||this.state===n.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const t=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case n.Text:{this.stateText(t);break}case n.SpecialStartSequence:{this.stateSpecialStartSequence(t);break}case n.InSpecialTag:{this.stateInSpecialTag(t);break}case n.CDATASequence:{this.stateCDATASequence(t);break}case n.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(t);break}case n.InAttributeName:{this.stateInAttributeName(t);break}case n.InCommentLike:{this.stateInCommentLike(t);break}case n.InSpecialComment:{this.stateInSpecialComment(t);break}case n.BeforeAttributeName:{this.stateBeforeAttributeName(t);break}case n.InTagName:{this.stateInTagName(t);break}case n.InClosingTagName:{this.stateInClosingTagName(t);break}case n.BeforeTagName:{this.stateBeforeTagName(t);break}case n.AfterAttributeName:{this.stateAfterAttributeName(t);break}case n.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(t);break}case n.BeforeAttributeValue:{this.stateBeforeAttributeValue(t);break}case n.BeforeClosingTagName:{this.stateBeforeClosingTagName(t);break}case n.AfterClosingTagName:{this.stateAfterClosingTagName(t);break}case n.BeforeSpecialS:{this.stateBeforeSpecialS(t);break}case n.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(t);break}case n.InSelfClosingTag:{this.stateInSelfClosingTag(t);break}case n.InDeclaration:{this.stateInDeclaration(t);break}case n.BeforeDeclaration:{this.stateBeforeDeclaration(t);break}case n.BeforeComment:{this.stateBeforeComment(t);break}case n.InProcessingInstruction:{this.stateInProcessingInstruction(t);break}case n.InNamedEntity:{this.stateInNamedEntity(t);break}case n.BeforeEntity:{this.stateBeforeEntity(t);break}case n.InHexEntity:{this.stateInHexEntity(t);break}case n.InNumericEntity:{this.stateInNumericEntity(t);break}default:this.stateBeforeNumericEntity(t)}this.index++}this.cleanup()}finish(){this.state===n.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const t=this.buffer.length+this.offset;this.state===n.InCommentLike?this.currentSequence===S.CdataEnd?this.cbs.oncdata(this.sectionStart,t,0):this.cbs.oncomment(this.sectionStart,t,0):this.state===n.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===n.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===n.InTagName||this.state===n.BeforeAttributeName||this.state===n.BeforeAttributeValue||this.state===n.AfterAttributeName||this.state===n.InAttributeName||this.state===n.InAttributeValueSq||this.state===n.InAttributeValueDq||this.state===n.InAttributeValueNq||this.state===n.InClosingTagName||this.cbs.ontext(this.sectionStart,t)}emitPartial(t,i){this.baseState!==n.Text&&this.baseState!==n.InSpecialTag?this.cbs.onattribdata(t,i):this.cbs.ontext(t,i)}emitCodePoint(t){this.baseState!==n.Text&&this.baseState!==n.InSpecialTag?this.cbs.onattribentity(t):this.cbs.ontextentity(t)}};const k=new Set(["input","option","optgroup","select","button","datalist","textarea"]),f=new Set(["p"]),O=new Set(["thead","tbody"]),F=new Set(["dd","dt"]),U=new Set(["rt","rp"]),nt=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",f],["h1",f],["h2",f],["h3",f],["h4",f],["h5",f],["h6",f],["select",k],["input",k],["output",k],["button",k],["datalist",k],["textarea",k],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",F],["dt",F],["address",f],["article",f],["aside",f],["blockquote",f],["details",f],["div",f],["dl",f],["fieldset",f],["figcaption",f],["figure",f],["footer",f],["form",f],["header",f],["hr",f],["main",f],["nav",f],["ol",f],["pre",f],["section",f],["table",f],["ul",f],["rt",U],["rp",U],["tbody",O],["tfoot",O]]),at=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),G=new Set(["math","svg"]),$=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),rt=/\s|\//;let ht=class{constructor(t,i={}){var s,r,l,u,c;this.options=i,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=t??{},this.lowerCaseTagNames=(s=i.lowerCaseTags)!==null&&s!==void 0?s:!i.xmlMode,this.lowerCaseAttributeNames=(r=i.lowerCaseAttributeNames)!==null&&r!==void 0?r:!i.xmlMode,this.tokenizer=new((l=i.Tokenizer)!==null&&l!==void 0?l:st)(this.options,this),(c=(u=this.cbs).onparserinit)===null||c===void 0||c.call(u,this)}ontext(t,i){var s,r;const l=this.getSlice(t,i);this.endIndex=i-1,(r=(s=this.cbs).ontext)===null||r===void 0||r.call(s,l),this.startIndex=i}ontextentity(t){var i,s;const r=this.tokenizer.getSectionStart();this.endIndex=r-1,(s=(i=this.cbs).ontext)===null||s===void 0||s.call(i,L(t)),this.startIndex=r}isVoidElement(t){return!this.options.xmlMode&&at.has(t)}onopentagname(t,i){this.endIndex=i;let s=this.getSlice(t,i);this.lowerCaseTagNames&&(s=s.toLowerCase()),this.emitOpenTag(s)}emitOpenTag(t){var i,s,r,l;this.openTagStart=this.startIndex,this.tagname=t;const u=!this.options.xmlMode&&nt.get(t);if(u)for(;this.stack.length>0&&u.has(this.stack[this.stack.length-1]);){const c=this.stack.pop();(s=(i=this.cbs).onclosetag)===null||s===void 0||s.call(i,c,!0)}this.isVoidElement(t)||(this.stack.push(t),G.has(t)?this.foreignContext.push(!0):$.has(t)&&this.foreignContext.push(!1)),(l=(r=this.cbs).onopentagname)===null||l===void 0||l.call(r,t),this.cbs.onopentag&&(this.attribs={})}endOpenTag(t){var i,s;this.startIndex=this.openTagStart,this.attribs&&((s=(i=this.cbs).onopentag)===null||s===void 0||s.call(i,this.tagname,this.attribs,t),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(t){this.endIndex=t,this.endOpenTag(!1),this.startIndex=t+1}onclosetag(t,i){var s,r,l,u,c,g;this.endIndex=i;let b=this.getSlice(t,i);if(this.lowerCaseTagNames&&(b=b.toLowerCase()),(G.has(b)||$.has(b))&&this.foreignContext.pop(),this.isVoidElement(b))!this.options.xmlMode&&b==="br"&&((r=(s=this.cbs).onopentagname)===null||r===void 0||r.call(s,"br"),(u=(l=this.cbs).onopentag)===null||u===void 0||u.call(l,"br",{},!0),(g=(c=this.cbs).onclosetag)===null||g===void 0||g.call(c,"br",!1));else{const I=this.stack.lastIndexOf(b);if(I!==-1)if(this.cbs.onclosetag){let m=this.stack.length-I;for(;m--;)this.cbs.onclosetag(this.stack.pop(),m!==0)}else this.stack.length=I;else!this.options.xmlMode&&b==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=i+1}onselfclosingtag(t){this.endIndex=t,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=t+1):this.onopentagend(t)}closeCurrentTag(t){var i,s;const r=this.tagname;this.endOpenTag(t),this.stack[this.stack.length-1]===r&&((s=(i=this.cbs).onclosetag)===null||s===void 0||s.call(i,r,!t),this.stack.pop())}onattribname(t,i){this.startIndex=t;const s=this.getSlice(t,i);this.attribname=this.lowerCaseAttributeNames?s.toLowerCase():s}onattribdata(t,i){this.attribvalue+=this.getSlice(t,i)}onattribentity(t){this.attribvalue+=L(t)}onattribend(t,i){var s,r;this.endIndex=i,(r=(s=this.cbs).onattribute)===null||r===void 0||r.call(s,this.attribname,this.attribvalue,t===T.Double?'"':t===T.Single?"'":t===T.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(t){const i=t.search(rt);let s=i<0?t:t.substr(0,i);return this.lowerCaseTagNames&&(s=s.toLowerCase()),s}ondeclaration(t,i){this.endIndex=i;const s=this.getSlice(t,i);if(this.cbs.onprocessinginstruction){const r=this.getInstructionName(s);this.cbs.onprocessinginstruction(`!${r}`,`!${s}`)}this.startIndex=i+1}onprocessinginstruction(t,i){this.endIndex=i;const s=this.getSlice(t,i);if(this.cbs.onprocessinginstruction){const r=this.getInstructionName(s);this.cbs.onprocessinginstruction(`?${r}`,`?${s}`)}this.startIndex=i+1}oncomment(t,i,s){var r,l,u,c;this.endIndex=i,(l=(r=this.cbs).oncomment)===null||l===void 0||l.call(r,this.getSlice(t,i-s)),(c=(u=this.cbs).oncommentend)===null||c===void 0||c.call(u),this.startIndex=i+1}oncdata(t,i,s){var r,l,u,c,g,b,I,m,N,p;this.endIndex=i;const q=this.getSlice(t,i-s);this.options.xmlMode||this.options.recognizeCDATA?((l=(r=this.cbs).oncdatastart)===null||l===void 0||l.call(r),(c=(u=this.cbs).ontext)===null||c===void 0||c.call(u,q),(b=(g=this.cbs).oncdataend)===null||b===void 0||b.call(g)):((m=(I=this.cbs).oncomment)===null||m===void 0||m.call(I,`[CDATA[${q}]]`),(p=(N=this.cbs).oncommentend)===null||p===void 0||p.call(N)),this.startIndex=i+1}onend(){var t,i;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let s=this.stack.length;s>0;this.cbs.onclosetag(this.stack[--s],!0));}(i=(t=this.cbs).onend)===null||i===void 0||i.call(t)}reset(){var t,i,s,r;(i=(t=this.cbs).onreset)===null||i===void 0||i.call(t),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(r=(s=this.cbs).onparserinit)===null||r===void 0||r.call(s,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(t){this.reset(),this.end(t)}getSlice(t,i){for(;t-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let s=this.buffers[0].slice(t-this.bufferOffset,i-this.bufferOffset);for(;i-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),s+=this.buffers[0].slice(0,i-this.bufferOffset);return s}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(t){var i,s;if(this.ended){(s=(i=this.cbs).onerror)===null||s===void 0||s.call(i,new Error(".write() after done!"));return}this.buffers.push(t),this.tokenizer.running&&(this.tokenizer.write(t),this.writeIndex++)}end(t){var i,s;if(this.ended){(s=(i=this.cbs).onerror)===null||s===void 0||s.call(i,new Error(".end() after done!"));return}t&&this.write(t),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(t){this.write(t)}done(t){this.end(t)}};function St(e,t){const i=new Y(void 0,t);return new ht(i,t).end(e),i.root}var o;(function(e){e[e.Tab=9]="Tab",e[e.NewLine=10]="NewLine",e[e.FormFeed=12]="FormFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.Number=35]="Number",e[e.Amp=38]="Amp",e[e.SingleQuote=39]="SingleQuote",e[e.DoubleQuote=34]="DoubleQuote",e[e.Dash=45]="Dash",e[e.Slash=47]="Slash",e[e.Zero=48]="Zero",e[e.Nine=57]="Nine",e[e.Semi=59]="Semi",e[e.Lt=60]="Lt",e[e.Eq=61]="Eq",e[e.Gt=62]="Gt",e[e.Questionmark=63]="Questionmark",e[e.UpperA=65]="UpperA",e[e.LowerA=97]="LowerA",e[e.UpperF=70]="UpperF",e[e.LowerF=102]="LowerF",e[e.UpperZ=90]="UpperZ",e[e.LowerZ=122]="LowerZ",e[e.LowerX=120]="LowerX",e[e.OpeningSquareBracket=91]="OpeningSquareBracket"})(o||(o={}));var a;(function(e){e[e.Text=1]="Text",e[e.BeforeTagName=2]="BeforeTagName",e[e.InTagName=3]="InTagName",e[e.InSelfClosingTag=4]="InSelfClosingTag",e[e.BeforeClosingTagName=5]="BeforeClosingTagName",e[e.InClosingTagName=6]="InClosingTagName",e[e.AfterClosingTagName=7]="AfterClosingTagName",e[e.BeforeAttributeName=8]="BeforeAttributeName",e[e.InAttributeName=9]="InAttributeName",e[e.AfterAttributeName=10]="AfterAttributeName",e[e.BeforeAttributeValue=11]="BeforeAttributeValue",e[e.InAttributeValueDq=12]="InAttributeValueDq",e[e.InAttributeValueSq=13]="InAttributeValueSq",e[e.InAttributeValueNq=14]="InAttributeValueNq",e[e.BeforeDeclaration=15]="BeforeDeclaration",e[e.InDeclaration=16]="InDeclaration",e[e.InProcessingInstruction=17]="InProcessingInstruction",e[e.BeforeComment=18]="BeforeComment",e[e.CDATASequence=19]="CDATASequence",e[e.InSpecialComment=20]="InSpecialComment",e[e.InCommentLike=21]="InCommentLike",e[e.BeforeSpecialS=22]="BeforeSpecialS",e[e.BeforeSpecialT=23]="BeforeSpecialT",e[e.SpecialStartSequence=24]="SpecialStartSequence",e[e.InSpecialTag=25]="InSpecialTag",e[e.InEntity=26]="InEntity"})(a||(a={}));function E(e){return e===o.Space||e===o.NewLine||e===o.Tab||e===o.FormFeed||e===o.CarriageReturn}function D(e){return e===o.Slash||e===o.Gt||E(e)}function ot(e){return e>=o.LowerA&&e<=o.LowerZ||e>=o.UpperA&&e<=o.UpperZ}var A;(function(e){e[e.NoValue=0]="NoValue",e[e.Unquoted=1]="Unquoted",e[e.Single=2]="Single",e[e.Double=3]="Double"})(A||(A={}));const x={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97])};class lt{constructor({xmlMode:t=!1,decodeEntities:i=!0},s){this.cbs=s,this.state=a.Text,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=a.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.xmlMode=t,this.decodeEntities=i,this.entityDecoder=new W(t?J:K,(r,l)=>this.emitCodePoint(r,l))}reset(){this.state=a.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=a.Text,this.currentSequence=void 0,this.running=!0,this.offset=0}write(t){this.offset+=this.buffer.length,this.buffer=t,this.parse()}end(){this.running&&this.finish()}pause(){this.running=!1}resume(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()}stateText(t){t===o.Lt||!this.decodeEntities&&this.fastForwardTo(o.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=a.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&t===o.Amp&&this.startEntity()}stateSpecialStartSequence(t){const i=this.sequenceIndex===this.currentSequence.length;if(!(i?D(t):(t|32)===this.currentSequence[this.sequenceIndex]))this.isSpecial=!1;else if(!i){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=a.InTagName,this.stateInTagName(t)}stateInSpecialTag(t){if(this.sequenceIndex===this.currentSequence.length){if(t===o.Gt||E(t)){const i=this.index-this.currentSequence.length;if(this.sectionStart<i){const s=this.index;this.index=i,this.cbs.ontext(this.sectionStart,i),this.index=s}this.isSpecial=!1,this.sectionStart=i+2,this.stateInClosingTagName(t);return}this.sequenceIndex=0}(t|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===x.TitleEnd?this.decodeEntities&&t===o.Amp&&this.startEntity():this.fastForwardTo(o.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(t===o.Lt)}stateCDATASequence(t){t===x.Cdata[this.sequenceIndex]?++this.sequenceIndex===x.Cdata.length&&(this.state=a.InCommentLike,this.currentSequence=x.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=a.InDeclaration,this.stateInDeclaration(t))}fastForwardTo(t){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===t)return!0;return this.index=this.buffer.length+this.offset-1,!1}stateInCommentLike(t){t===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===x.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=a.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):t!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}isTagStartChar(t){return this.xmlMode?!D(t):ot(t)}startSpecial(t,i){this.isSpecial=!0,this.currentSequence=t,this.sequenceIndex=i,this.state=a.SpecialStartSequence}stateBeforeTagName(t){if(t===o.ExclamationMark)this.state=a.BeforeDeclaration,this.sectionStart=this.index+1;else if(t===o.Questionmark)this.state=a.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(t)){const i=t|32;this.sectionStart=this.index,this.xmlMode?this.state=a.InTagName:i===x.ScriptEnd[2]?this.state=a.BeforeSpecialS:i===x.TitleEnd[2]?this.state=a.BeforeSpecialT:this.state=a.InTagName}else t===o.Slash?this.state=a.BeforeClosingTagName:(this.state=a.Text,this.stateText(t))}stateInTagName(t){D(t)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=a.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateBeforeClosingTagName(t){E(t)||(t===o.Gt?this.state=a.Text:(this.state=this.isTagStartChar(t)?a.InClosingTagName:a.InSpecialComment,this.sectionStart=this.index))}stateInClosingTagName(t){(t===o.Gt||E(t))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=a.AfterClosingTagName,this.stateAfterClosingTagName(t))}stateAfterClosingTagName(t){(t===o.Gt||this.fastForwardTo(o.Gt))&&(this.state=a.Text,this.sectionStart=this.index+1)}stateBeforeAttributeName(t){t===o.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=a.InSpecialTag,this.sequenceIndex=0):this.state=a.Text,this.sectionStart=this.index+1):t===o.Slash?this.state=a.InSelfClosingTag:E(t)||(this.state=a.InAttributeName,this.sectionStart=this.index)}stateInSelfClosingTag(t){t===o.Gt?(this.cbs.onselfclosingtag(this.index),this.state=a.Text,this.sectionStart=this.index+1,this.isSpecial=!1):E(t)||(this.state=a.BeforeAttributeName,this.stateBeforeAttributeName(t))}stateInAttributeName(t){(t===o.Eq||D(t))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=this.index,this.state=a.AfterAttributeName,this.stateAfterAttributeName(t))}stateAfterAttributeName(t){t===o.Eq?this.state=a.BeforeAttributeValue:t===o.Slash||t===o.Gt?(this.cbs.onattribend(A.NoValue,this.sectionStart),this.sectionStart=-1,this.state=a.BeforeAttributeName,this.stateBeforeAttributeName(t)):E(t)||(this.cbs.onattribend(A.NoValue,this.sectionStart),this.state=a.InAttributeName,this.sectionStart=this.index)}stateBeforeAttributeValue(t){t===o.DoubleQuote?(this.state=a.InAttributeValueDq,this.sectionStart=this.index+1):t===o.SingleQuote?(this.state=a.InAttributeValueSq,this.sectionStart=this.index+1):E(t)||(this.sectionStart=this.index,this.state=a.InAttributeValueNq,this.stateInAttributeValueNoQuotes(t))}handleInAttributeValue(t,i){t===i||!this.decodeEntities&&this.fastForwardTo(i)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(i===o.DoubleQuote?A.Double:A.Single,this.index+1),this.state=a.BeforeAttributeName):this.decodeEntities&&t===o.Amp&&this.startEntity()}stateInAttributeValueDoubleQuotes(t){this.handleInAttributeValue(t,o.DoubleQuote)}stateInAttributeValueSingleQuotes(t){this.handleInAttributeValue(t,o.SingleQuote)}stateInAttributeValueNoQuotes(t){E(t)||t===o.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(A.Unquoted,this.index),this.state=a.BeforeAttributeName,this.stateBeforeAttributeName(t)):this.decodeEntities&&t===o.Amp&&this.startEntity()}stateBeforeDeclaration(t){t===o.OpeningSquareBracket?(this.state=a.CDATASequence,this.sequenceIndex=0):this.state=t===o.Dash?a.BeforeComment:a.InDeclaration}stateInDeclaration(t){(t===o.Gt||this.fastForwardTo(o.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=a.Text,this.sectionStart=this.index+1)}stateInProcessingInstruction(t){(t===o.Gt||this.fastForwardTo(o.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=a.Text,this.sectionStart=this.index+1)}stateBeforeComment(t){t===o.Dash?(this.state=a.InCommentLike,this.currentSequence=x.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=a.InDeclaration}stateInSpecialComment(t){(t===o.Gt||this.fastForwardTo(o.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=a.Text,this.sectionStart=this.index+1)}stateBeforeSpecialS(t){const i=t|32;i===x.ScriptEnd[3]?this.startSpecial(x.ScriptEnd,4):i===x.StyleEnd[3]?this.startSpecial(x.StyleEnd,4):(this.state=a.InTagName,this.stateInTagName(t))}stateBeforeSpecialT(t){const i=t|32;i===x.TitleEnd[3]?this.startSpecial(x.TitleEnd,4):i===x.TextareaEnd[3]?this.startSpecial(x.TextareaEnd,4):(this.state=a.InTagName,this.stateInTagName(t))}startEntity(){this.baseState=this.state,this.state=a.InEntity,this.entityStart=this.index,this.entityDecoder.startEntity(this.xmlMode?V.Strict:this.baseState===a.Text||this.baseState===a.InSpecialTag?V.Legacy:V.Attribute)}stateInEntity(){const t=this.entityDecoder.write(this.buffer,this.index-this.offset);t>=0?(this.state=this.baseState,t===0&&(this.index=this.entityStart)):this.index=this.offset+this.buffer.length-1}cleanup(){this.running&&this.sectionStart!==this.index&&(this.state===a.Text||this.state===a.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===a.InAttributeValueDq||this.state===a.InAttributeValueSq||this.state===a.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}shouldContinue(){return this.index<this.buffer.length+this.offset&&this.running}parse(){for(;this.shouldContinue();){const t=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case a.Text:{this.stateText(t);break}case a.SpecialStartSequence:{this.stateSpecialStartSequence(t);break}case a.InSpecialTag:{this.stateInSpecialTag(t);break}case a.CDATASequence:{this.stateCDATASequence(t);break}case a.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(t);break}case a.InAttributeName:{this.stateInAttributeName(t);break}case a.InCommentLike:{this.stateInCommentLike(t);break}case a.InSpecialComment:{this.stateInSpecialComment(t);break}case a.BeforeAttributeName:{this.stateBeforeAttributeName(t);break}case a.InTagName:{this.stateInTagName(t);break}case a.InClosingTagName:{this.stateInClosingTagName(t);break}case a.BeforeTagName:{this.stateBeforeTagName(t);break}case a.AfterAttributeName:{this.stateAfterAttributeName(t);break}case a.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(t);break}case a.BeforeAttributeValue:{this.stateBeforeAttributeValue(t);break}case a.BeforeClosingTagName:{this.stateBeforeClosingTagName(t);break}case a.AfterClosingTagName:{this.stateAfterClosingTagName(t);break}case a.BeforeSpecialS:{this.stateBeforeSpecialS(t);break}case a.BeforeSpecialT:{this.stateBeforeSpecialT(t);break}case a.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(t);break}case a.InSelfClosingTag:{this.stateInSelfClosingTag(t);break}case a.InDeclaration:{this.stateInDeclaration(t);break}case a.BeforeDeclaration:{this.stateBeforeDeclaration(t);break}case a.BeforeComment:{this.stateBeforeComment(t);break}case a.InProcessingInstruction:{this.stateInProcessingInstruction(t);break}case a.InEntity:{this.stateInEntity();break}}this.index++}this.cleanup()}finish(){this.state===a.InEntity&&(this.entityDecoder.end(),this.state=this.baseState),this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const t=this.buffer.length+this.offset;this.sectionStart>=t||(this.state===a.InCommentLike?this.currentSequence===x.CdataEnd?this.cbs.oncdata(this.sectionStart,t,0):this.cbs.oncomment(this.sectionStart,t,0):this.state===a.InTagName||this.state===a.BeforeAttributeName||this.state===a.BeforeAttributeValue||this.state===a.AfterAttributeName||this.state===a.InAttributeName||this.state===a.InAttributeValueSq||this.state===a.InAttributeValueDq||this.state===a.InAttributeValueNq||this.state===a.InClosingTagName||this.cbs.ontext(this.sectionStart,t))}emitCodePoint(t,i){this.baseState!==a.Text&&this.baseState!==a.InSpecialTag?(this.sectionStart<this.entityStart&&this.cbs.onattribdata(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+i,this.index=this.sectionStart-1,this.cbs.onattribentity(t)):(this.sectionStart<this.entityStart&&this.cbs.ontext(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+i,this.index=this.sectionStart-1,this.cbs.ontextentity(t,this.sectionStart))}}const y=new Set(["input","option","optgroup","select","button","datalist","textarea"]),d=new Set(["p"]),z=new Set(["thead","tbody"]),P=new Set(["dd","dt"]),Q=new Set(["rt","rp"]),ut=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",d],["h1",d],["h2",d],["h3",d],["h4",d],["h5",d],["h6",d],["select",y],["input",y],["output",y],["button",y],["datalist",y],["textarea",y],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",P],["dt",P],["address",d],["article",d],["aside",d],["blockquote",d],["details",d],["div",d],["dl",d],["fieldset",d],["figcaption",d],["figure",d],["footer",d],["form",d],["header",d],["hr",d],["main",d],["nav",d],["ol",d],["pre",d],["section",d],["table",d],["ul",d],["rt",Q],["rp",Q],["tbody",z],["tfoot",z]]),ct=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),R=new Set(["math","svg"]),Z=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),ft=/\s|\//;class dt{constructor(t,i={}){var s,r,l,u,c,g;this.options=i,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=t??{},this.htmlMode=!this.options.xmlMode,this.lowerCaseTagNames=(s=i.lowerCaseTags)!==null&&s!==void 0?s:this.htmlMode,this.lowerCaseAttributeNames=(r=i.lowerCaseAttributeNames)!==null&&r!==void 0?r:this.htmlMode,this.recognizeSelfClosing=(l=i.recognizeSelfClosing)!==null&&l!==void 0?l:!this.htmlMode,this.tokenizer=new((u=i.Tokenizer)!==null&&u!==void 0?u:lt)(this.options,this),this.foreignContext=[!this.htmlMode],(g=(c=this.cbs).onparserinit)===null||g===void 0||g.call(c,this)}ontext(t,i){var s,r;const l=this.getSlice(t,i);this.endIndex=i-1,(r=(s=this.cbs).ontext)===null||r===void 0||r.call(s,l),this.startIndex=i}ontextentity(t,i){var s,r;this.endIndex=i-1,(r=(s=this.cbs).ontext)===null||r===void 0||r.call(s,v(t)),this.startIndex=i}isVoidElement(t){return this.htmlMode&&ct.has(t)}onopentagname(t,i){this.endIndex=i;let s=this.getSlice(t,i);this.lowerCaseTagNames&&(s=s.toLowerCase()),this.emitOpenTag(s)}emitOpenTag(t){var i,s,r,l;this.openTagStart=this.startIndex,this.tagname=t;const u=this.htmlMode&&ut.get(t);if(u)for(;this.stack.length>0&&u.has(this.stack[0]);){const c=this.stack.shift();(s=(i=this.cbs).onclosetag)===null||s===void 0||s.call(i,c,!0)}this.isVoidElement(t)||(this.stack.unshift(t),this.htmlMode&&(R.has(t)?this.foreignContext.unshift(!0):Z.has(t)&&this.foreignContext.unshift(!1))),(l=(r=this.cbs).onopentagname)===null||l===void 0||l.call(r,t),this.cbs.onopentag&&(this.attribs={})}endOpenTag(t){var i,s;this.startIndex=this.openTagStart,this.attribs&&((s=(i=this.cbs).onopentag)===null||s===void 0||s.call(i,this.tagname,this.attribs,t),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""}onopentagend(t){this.endIndex=t,this.endOpenTag(!1),this.startIndex=t+1}onclosetag(t,i){var s,r,l,u,c,g,b,I;this.endIndex=i;let m=this.getSlice(t,i);if(this.lowerCaseTagNames&&(m=m.toLowerCase()),this.htmlMode&&(R.has(m)||Z.has(m))&&this.foreignContext.shift(),this.isVoidElement(m))this.htmlMode&&m==="br"&&((u=(l=this.cbs).onopentagname)===null||u===void 0||u.call(l,"br"),(g=(c=this.cbs).onopentag)===null||g===void 0||g.call(c,"br",{},!0),(I=(b=this.cbs).onclosetag)===null||I===void 0||I.call(b,"br",!1));else{const N=this.stack.indexOf(m);if(N!==-1)for(let p=0;p<=N;p++){const q=this.stack.shift();(r=(s=this.cbs).onclosetag)===null||r===void 0||r.call(s,q,p!==N)}else this.htmlMode&&m==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=i+1}onselfclosingtag(t){this.endIndex=t,this.recognizeSelfClosing||this.foreignContext[0]?(this.closeCurrentTag(!1),this.startIndex=t+1):this.onopentagend(t)}closeCurrentTag(t){var i,s;const r=this.tagname;this.endOpenTag(t),this.stack[0]===r&&((s=(i=this.cbs).onclosetag)===null||s===void 0||s.call(i,r,!t),this.stack.shift())}onattribname(t,i){this.startIndex=t;const s=this.getSlice(t,i);this.attribname=this.lowerCaseAttributeNames?s.toLowerCase():s}onattribdata(t,i){this.attribvalue+=this.getSlice(t,i)}onattribentity(t){this.attribvalue+=v(t)}onattribend(t,i){var s,r;this.endIndex=i,(r=(s=this.cbs).onattribute)===null||r===void 0||r.call(s,this.attribname,this.attribvalue,t===A.Double?'"':t===A.Single?"'":t===A.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""}getInstructionName(t){const i=t.search(ft);let s=i<0?t:t.substr(0,i);return this.lowerCaseTagNames&&(s=s.toLowerCase()),s}ondeclaration(t,i){this.endIndex=i;const s=this.getSlice(t,i);if(this.cbs.onprocessinginstruction){const r=this.getInstructionName(s);this.cbs.onprocessinginstruction(`!${r}`,`!${s}`)}this.startIndex=i+1}onprocessinginstruction(t,i){this.endIndex=i;const s=this.getSlice(t,i);if(this.cbs.onprocessinginstruction){const r=this.getInstructionName(s);this.cbs.onprocessinginstruction(`?${r}`,`?${s}`)}this.startIndex=i+1}oncomment(t,i,s){var r,l,u,c;this.endIndex=i,(l=(r=this.cbs).oncomment)===null||l===void 0||l.call(r,this.getSlice(t,i-s)),(c=(u=this.cbs).oncommentend)===null||c===void 0||c.call(u),this.startIndex=i+1}oncdata(t,i,s){var r,l,u,c,g,b,I,m,N,p;this.endIndex=i;const q=this.getSlice(t,i-s);!this.htmlMode||this.options.recognizeCDATA?((l=(r=this.cbs).oncdatastart)===null||l===void 0||l.call(r),(c=(u=this.cbs).ontext)===null||c===void 0||c.call(u,q),(b=(g=this.cbs).oncdataend)===null||b===void 0||b.call(g)):((m=(I=this.cbs).oncomment)===null||m===void 0||m.call(I,`[CDATA[${q}]]`),(p=(N=this.cbs).oncommentend)===null||p===void 0||p.call(N)),this.startIndex=i+1}onend(){var t,i;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(let s=0;s<this.stack.length;s++)this.cbs.onclosetag(this.stack[s],!0)}(i=(t=this.cbs).onend)===null||i===void 0||i.call(t)}reset(){var t,i,s,r;(i=(t=this.cbs).onreset)===null||i===void 0||i.call(t),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(r=(s=this.cbs).onparserinit)===null||r===void 0||r.call(s,this),this.buffers.length=0,this.foreignContext.length=0,this.foreignContext.unshift(!this.htmlMode),this.bufferOffset=0,this.writeIndex=0,this.ended=!1}parseComplete(t){this.reset(),this.end(t)}getSlice(t,i){for(;t-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();let s=this.buffers[0].slice(t-this.bufferOffset,i-this.bufferOffset);for(;i-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),s+=this.buffers[0].slice(0,i-this.bufferOffset);return s}shiftBuffer(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()}write(t){var i,s;if(this.ended){(s=(i=this.cbs).onerror)===null||s===void 0||s.call(i,new Error(".write() after done!"));return}this.buffers.push(t),this.tokenizer.running&&(this.tokenizer.write(t),this.writeIndex++)}end(t){var i,s;if(this.ended){(s=(i=this.cbs).onerror)===null||s===void 0||s.call(i,new Error(".end() after done!"));return}t&&this.write(t),this.ended=!0,this.tokenizer.end()}pause(){this.tokenizer.pause()}resume(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()}parseChunk(t){this.write(t)}done(t){this.end(t)}}function It(e,t){const i=new tt(void 0,t);return new dt(i,t).end(e),i.root}export{It as a,St as p};

import{a as N,p as C,aJ as R,_ as w}from"./components.globalSAVxUKYX.js";import{d as A,j as a,k as o,m as p,z as h,s as r,F as k,P as y,r as _,i,K as l,Q as g,R as d}from"./@vueC3Nhqlrl.js";import"./vue3-toastifyDll2FbVh.js";import"./@capacitorCjBcbZvA.js";import"./bootstrap-vue-nextDnMzdrWQ.js";const T=A({name:"UserNotifications",mixins:[N],prop:{},data(){return{items:[],loading:!0}},mounted(){},computed:{},methods:{prettyTimePast:C,dismiss(t){this.sendReq("/user/notification/remove",{id:t}).then(e=>{this.loadNotifications(),this.RefreshStats()})},async runNotificationAction(t,e){e.name=="shareKey"&&(R(e.data.userId)?(this.dismiss(t._id),this.showToast("Key shared successfully",{variant:"success"})):this.showToast("Error sharing key",{variant:"danger"}))},prepfeedMessage(t){return this.isExtension&&(t=t.split('href="/kindredapp/#').join('href="/index.html#')),this.isExtension&&(t=t.split("TS_BASE_PATH").join("/index.html#")),t},clear(){this.sendReq("/user/notification/clear").then(t=>{this.loadNotifications(),this.RefreshStats()})},async markNotificationsRead(t){await this.sendReq("/user/notification/markRead",{ids:t})},async markNotificationsUnread(t){await this.sendReq("/user/notification/markUnread",{ids:t});for(let e=0;e<this.items.length;e++)t.includes(this.items[e]._id)&&(this.items[e].readAt=null)},async loadNotifications(){this.loading=!0;try{const t=await this.sendReq("/user/notification/list",{},{needAuth:!0});this.items=t.result}finally{this.loading=!1}},async loadPage(){if(this.currentUserId)try{await this.loadNotifications();const t=this.items.filter(e=>!e.readAt).map(e=>e._id);t.length>0&&(await this.markNotificationsRead(t),await this.RefreshStats(!0))}catch(t){console.error("Unable to load notifications",t)}}},created(){this.loadPage()}}),$={key:0},x={class:"d-flex justify-content-end mb-3 mx-2"},P={class:"mx-2"},S={class:"ms-1 mb-2"},U={key:0},j=["innerHTML"],q={key:0,class:"ms-1 mb-2 d-flex flex-gap-1 flex-wrap"},B={class:"ms-1 d-flex justify-content-between align-items-center"},E=["onClick"],z=["onClick"],K={key:1},M={key:0,class:"mb-2"},V={key:1};function H(t,e,v,L,D,F){const c=_("b-icon"),m=_("b-button");return t.loading?(i(),a("div",V)):(i(),a("div",$,[o("div",x,[t.items&&t.items.length>0?(i(),p(m,{key:0,size:"sm",class:"border rouned",variant:"outline-secondary",onClick:e[0]||(e[0]=s=>t.clear())},{default:h(()=>[l(c,{icon:"x"}),e[1]||(e[1]=g(" dismiss all "))]),_:1})):r("",!0)]),e[2]||(e[2]=o("hr",null,null,-1)),o("div",P,[(i(!0),a(k,null,y(t.items,(s,u)=>{var f;return i(),a("div",{class:"mb-2",key:u},[o("div",S,[(f=s==null?void 0:s.data)!=null&&f.highPriority?(i(),a("span",U,[l(c,{icon:"exclamation-triangle-fill",class:"text-danger me-2"})])):r("",!0),o("span",null,d(s.data.title),1)]),o("p",{class:"ms-1 mb-1 small",innerHTML:t.prepfeedMessage(s.data.message)},null,8,j),s.data.actions?(i(),a("div",q,[(i(!0),a(k,null,y(s.data.actions,(n,b)=>(i(),p(m,{size:"sm",variant:"primary",onClick:I=>t.runNotificationAction(s,n),key:b,class:"ms-1 mb-2"},{default:h(()=>[g(d(n.label),1)]),_:2},1032,["onClick"]))),128))])):r("",!0),o("div",B,[s.readAt?(i(),a("div",{key:0,class:"small text-muted",role:"button",onClick:n=>t.markNotificationsUnread([s._id])},d(t.prettyTimePast(s.createdAt))+" ago ",9,E)):(i(),a("div",{key:1,class:"small font-weight-strong",role:"button",onClick:n=>t.markNotificationsRead([s._id])},d(t.prettyTimePast(s.createdAt))+" ago ",9,z)),o("div",null,[l(m,{variant:"link",size:"sm",onClick:n=>t.dismiss(s._id)},{default:h(()=>[l(c,{icon:"x-lg"})]),_:2},1032,["onClick"])])]),u!=t.items.length-1?(i(),a("hr",K)):r("",!0)])}),128)),t.items&&t.items.length==0?(i(),a("div",M,"No notifications")):r("",!0)])]))}const X=w(T,[["render",H]]);export{X as default};
